/*
 https://fareharbor.com/about/licenses/
*/
window.FH_VERSION="0.9.0.1";
(function(){window.configure=function(m){var c=window.slipstream?window.slipstream.configuration:"unknown";m.factory("$exceptionHandler",[function(){return function(k,d){var h=_.isArray(k.stack)?k.stack.join("\n"):k.stack;if("production"!==c){var f="$exceptionHandler: uncaught exception "+k.message;d&&(f+=' (caused by "'+d+'")',k.message+=' (caused by "'+d+'")');console.error(f,h||"(no stack trace)")}}}]);m.config(["$animateProvider","$compileProvider","$injector","$interpolateProvider","$httpProvider",
"$locationProvider","$sceProvider","convertProvider",function(k,d,h,f,n,a,q,g){d.debugInfoEnabled("production"!==c);a.html5Mode(!0);a.hashPrefix("!");f.startSymbol("[[");f.endSymbol("]]");f.staticStartSymbol("[!");f.staticEndSymbol("!]");n.defaults.transformResponse.push(function(a){return g.serverResponse(a)});n.defaults.transformRequest.unshift(function(a){return g.clientRequest(a)});n.defaults.xsrfCookieName="csrftoken";n.defaults.xsrfHeaderName="X-CSRFToken";n.defaults.headers.common["X-Requested-With"]=
"XMLHttpRequest";n.defaults.headers.common["X-CSRFToken"]=window.slipstream.csrfToken||"";k.classNameFilter(/\banimatable\b/)}]);m.run(["$filter","$browser","$injector","$interpolate","$rootScope",function(c,d,h,f,n){window.$$injector=h;n.isReadonlyEnabled=window.slipstream.isReadonlyEnabled;n.max=Math.max;n.addClassIf=c("addClassIf");n.isUndefined=c("isUndefined");n.handheldsMaxWidth=window.slipstream.isEmbedded?549:679;n.T=window.T;n.cT=window.cT;n.nT=window.nT;n.ncT=window.ncT;n.interpolate=interpolate;
n.$bind=function(a,g){var b=this,e=function(){var e=_.get(b,g);_.set(b,a,e)};e();b.$watch(e)};n.$model=function(a){var g=_.bind(a,a,this);g.assign=_.bind(a.assign,a,this);return g};n.$once=function(a,g){var b=this.$on(a,function(){b();return g.apply(this,arguments)});return b};n.isSet=function(a){return _.isUndefined(a)?!1:""===a?!0:this.$eval(a)};var a=n.$new;n.$new=function(q,g){return q?a.call(this,!1,this.$root):a.call(this,q,g)};n.$safeApply=function(a){if(this.$root){var g=this.$root.$$phase;
return"$apply"==g||"$digest"==g?a&&a():this.$apply(a)}};n.$safeDigest=function(){if(this.$root){var a=this.$root.$$phase;"$apply"==a||"$digest"==a||this.$digest()}};n.$asyncApply=function(a){var g=d.defer(_.ignore,31536E6),b=function(){d.defer.cancel(g)};a(b);return b};n.$interpolate=function(a,g){var b=this,e=!1;g&&(b=b.$new(),_.extend(b,g),e=!0);if(_.isUndefined(a))return"";var z=f(a);if(!z)return"";z=z(b);e&&b.$destroy();return z};window.$$digest=function(a,g){var b=angular.element(document.querySelector("[ng-app]"));
g=g||b.injector().get("$rootScope");a=a||100;console.info("digest: running "+a+"...");for(var b=performance.now(),e=0;e<a;e++)g.$digest();e=performance.now();console.info("digest: average time "+(e-b)/a+"ms");var b=0,e=g,z;do if(b+=e.$$watchers?e.$$watchers.length:0,!(z=e.$$childHead||e!==g&&e.$$nextSibling))for(;e!==g&&!(z=e.$$nextSibling);)e=e.$parent;while(e=z);console.info("digest: watcher count",b)};window.$$scope=function(a){return angular.element(a).scope()}}])}})();angular.module("lib","lib.controllers lib.directives lib.filters lib.factories lib.services lib.services.interpolate".split(" "));
(function(){var m=angular.module("lib.directives",[]),c={isTouchEnabled:"ontouchstart"in window||navigator.msMaxTouchPoints,isTextInput:function(a){return a.is("input")&&_.isUndefined(a.attr("type"))||a.is('input[type="text"], input[type="password"], input[type="email"], input[type="tel"], input[type="number"], input[type="url"], input[type="search"], textarea')},bind:function(a,g,b){a.$watch(b,function(b){a[g]=b})},watcher:function(a,g,b,e,z){var c=a.$eval(g);a.$watch(g,function(a){c=a;e&&e(c)},
z);return function(){return!_.isUndefined(c)?c:b}},observer:function(a,g,b,e){var z;z=a[g];a.$observe(g,function(a){z=a;e&&e(z)});return function(){if(!_.isUndefined(z))return z;if(!_.isUndefined(b))return b;throw Error("d: undefined attribute "+g+" for observer");}},restrictKeypresses:function(a,g){a.on("keypress",function(a){if(a.which&&(!a.metaKey&&!a.controlKey&&!a.altKey)&&!(8===a.which||9===a.which||13===a.which)){var q=String.fromCharCode(a.which);g.test(q)||a.preventDefault()}})},safeInvoke:function(a,
g){return _.isArray(g)?a.invoke(g):g},conditionalDirective:function(a){a=_.extend({operator:_.constant(_.identity),link:_.constant(_.ignore),transclude:_.constant(_.ignore),once:_.never},a);return["$animate","$injector",function(g,b){return _.extend({transclude:"element",priority:800,terminal:!0,restrict:"A",compile:function(e,z,v){var r=c.safeInvoke(b,a.watch),d=c.safeInvoke(b,a.operator),s=c.safeInvoke(b,a.transclude),f=c.safeInvoke(b,_.isBoolean(a.once)?_.constant(a.once):a.once);return function(b,
e,z,c){a.link(b,e,z,c);var h,k,n=r(b,e,z,c),m=s(b,e,z,c),B=d(b,e,z,c),M=b.$watch(n,function(a){h&&(g.leave(h),h=void 0);k&&(k.$destroy(),k=void 0);B(a)&&(k=b.$new(),v(k,function(a){h=a;m(k,a);g.enter(a,e.parent(),e)}));f(b,e,z)&&M()})}}},a.directiveDescription)}]},isDropdownSupported:/iP(od|hone|ad)/i.test(window.navigator.userAgent)||/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)||/BlackBerry|Windows Phone|webOS/i.test(window.navigator.userAgent)?!1:!0};m.constant("d",
c);m.config(["$provide",function(a){a.decorator("ngIfDirective",["$delegate",function(a){a.shift();return a}])}]);var k=function(a){var g=a.$modelValue;_.forEach(a.$formatters,function(a){g=a(g)});a.$viewValue=g;a.$render()},d=function(a,g){m.directive(a,[function(){return{restrict:g,priority:500,require:"form",link:function(a,e,q,g){g.$errorCallbacks=[];g.$successCallbacks=[];e.attr("novalidate","novalidate")}}}])};d("form","E");d("ngForm","A");var h=function(a,g){var b="20"+a,e=parseInt(g,10).toFixed();
if(!isNaN(e))return{month:e,year:b}},f=[{device:"MSR100U",trackSeparator:"^",fullName:function(a){var g=a.split("/");a=(g[1]||"").trim();g=(g[0]||"").trim();return a?a+" "+g:g},details:function(a){var g=/;(\d+)=(\d\d)(\d\d)/.exec(a);g||(g=/%B(\d+)=(\d\d)(\d\d)/.exec(a));if(g&&(a=g[1],g=h(g[2],g[3])))return{number:a,expiryMonth:g.month,expiryYear:g.year}}},{device:"denzer-has-a-weird-one",trackSeparator:"^",fullName:_.identity,details:function(a){var g=/;(\d+)=(\d\d)(\d\d)/.exec(a);if(g&&(a=g[1],g=
h(g[2],g[3])))return{number:a,expiryMonth:g.month,expiryYear:g.year}}},{device:"knock-off-MSR100U",trackSeparator:"",details:function(a){var g=/^(\d+)=(\d\d)(\d\d)/.exec(a);if(g&&(a=g[1],g=h(g[2],g[3])))return{number:a,expiryMonth:g.month,expiryYear:g.year}}}];m.directive("ngOverthrow",[function(){return{restrict:"A",link:function(a,g,b){g.addClass("overthrow")}}}]);m.directive("ngSticky",["$parse","$window","auth","d",function(a,g,b,e){return{restrict:"A",link:function(a,q,r){if(!a.isSet(r.ngStickyAllowTouch)&&
e.isTouchEnabled)console.info("ng-sticky: touch is enabled");else{var c=a.isSet(r.ngStickyDisableMsie),s=document.documentMode;if(!c||!(s&&11>=s)){var d=a.$eval(r.ngStickyEdgeTopMargin)||0;a.$eval(r.ngStickyEdgeBottomMargin);var l=a.$eval(r.ngStickyTopMargin)||0,p=a.$eval(r.ngStickyBottomMargin)||0,f=$(g),h=function(){var a=$(r.ngStickyContent);if(a.length){var e=b.currentUser.isAuthenticated?93:0,g=f.height()-e,z=f.scrollTop(),c=a.offset().top,a=a.outerHeight(),s=q.outerHeight();if(s>a||s>g)return q.removeClass("sticky sticky-pinned sticky-floating").css({top:"",
bottom:""}),"no-sticky";g=z+(d+e);z=c+l;c=g+s>c+a-p;a=g>z&&!c;if(g<=z)return c=l,q.removeClass("sticky-floating"),q.addClass("sticky sticky-pinned").css({top:c,bottom:""}),["sticky-pinned","top",c];if(a)return c=e+d,q.removeClass("sticky-pinned"),q.addClass("sticky sticky-floating").css({top:e+d,bottom:""}),["sticky-floating","top",c];if(c)return q.removeClass("sticky-floating"),q.addClass("sticky sticky-pinned").css({top:"",bottom:p}),["sticky-pinned","bottom",p];console.warn("ng-sticky: nothing makes sense")}},
k,n=function(){var b=h();angular.equals(k,b)||(k=b,a.$apply())};f.on("scroll",n);f.on("resize",n);a.$watch(function(){setTimeout(n)})}}}}}]);m.directive("ngSwipe",[function(){return{restrict:"A",link:function(a,g,b){var e=a.$eval(b.ngSwipe),z=function(a){return _.chooseFirst(f,function(b){var e="";if(b.trackSeparator){var q=a.split(b.trackSeparator);if(3!==q.length)return;e=b.fullName(q[1]);if(_.isUndefined(e))return}else q=["","",a];b=b.details(q[2]);if(!_.isUndefined(b))return _.extend(b,{fullName:e})})};
g.on("keypress",function(b){13===b.which&&a.$apply(function(){e(z(g.val()))})});g.on("blur",function(){a.$apply(function(){e()})});g.val("");g.focus()}}}]);m.directive("ngApp",[function(){return{restrict:"A",link:function(a,g,b){$("html").removeClass("html-loading")}}}]);m.directive("ngAutoselect",["d",function(a){return{restrict:"A",link:function(g,b,e){b.attr("readonly","readonly");if(!a.isTouchEnabled){var z=!1;b.on("click",function(){b.focus();z||(b.select(),z=!0)});b.on("blur",function(){z=!1})}}}}]);
m.directive("ngAutofocus",["$parse","$timeout","d",function(a,g,b){var e="input, textarea, select",z=function(a){if(a.is(e))return a;a=a.find(e).first();if(a.length)return a};return{restrict:"A",link:function(c,r,d){var s=c.isSet(d.ngAutofocus),f=c.isSet(d.ngAutofocusSelect),l=c.isSet(d.ngAutofocusOpen),p=d.ngAutofocusWhen?a(d.ngAutofocusWhen):_.always;e+=d.ngAutofocusElement?", "+d.ngAutofocusElement:"";s&&(b.isTouchEnabled?f&&g(function(){var a=z(r);if(a&&!a.is("select"))a.on("focus",function(){g(function(){a[0].setSelectionRange(0,
1E3)})})}):g(function(){if(p(c)){var a=z(r);a&&(a.hasClass("ng-dropdown")?(a.trigger("dropdown:focus"),l&&a.trigger("dropdown:open")):(a.focus(),f&&!a.is("select")&&a.select()))}}))}}}]);m.directive("ngAutoNavigate",["$location","$timeout","$window","navigation",function(a,g,b,e){return{restrict:"A",link:function(c,v,r){var d=!1;(d=r.ngAutoNavigate?c.$eval(r.ngAutoNavigate):!0)&&g(function(){var g=v.prop("href");a.$$rewrite(g)?e.navigate(g):(b.parent||window).location.href=g})}}}]);m.directive("ngCurrentOption",
["$parse",function(a){return{restrict:"A",scope:!0,controller:["$scope","$attrs",function(g,b){var e=this,c=a(b.ngCurrentOption),d=a(b.ngCurrentOptionTarget||"currentOption"),r=a(b.ngCurrentOptionCollection),f=g.$eval(b.ngCurrentOptionKey)||"pk",s=function(a,b){var q=_.find(b,function(b){return b[f]===a});q||(q=null);d.assign(g.$parent,q);e.currentOption=q};g.$parent.$watch(c,function(a){var b=r(g);s(a,b)});g.$parent.$watch(function(){return _.pluck(r(g),"uri")},function(){var a=r(g),b=c(g);s(b,a)},
!0)}],controllerAs:"currentOptionCtrl"}}]);m.directive("ngWatchHeight",["$document","$window","db","lightframe",function(a,g,b,e){return{restrict:"A",link:function(b,g,r){var c=function(){if(a[0].body)return a[0].body.offsetHeight},s=function(a){e.updateHeight(a)};b.$watch(c,s);setInterval(function(){s(c())},2500)}}}]);m.directive("ngDimensions",["$document","$parse","$window","$rootScope","scrollbar",function(a,g,b,e,c){var d=function(){return{width:Math.max(a[0].documentElement.clientWidth,b.innerWidth||
0),height:Math.max(a[0].documentElement.clientHeight,b.innerHeight||0)}},r=function(a){return{width:a.width(),height:a.height(),outerWidth:a.outerWidth(),outerHeight:a.outerHeight()}};return{restrict:"A",link:function(a,e,q){if(!q.ngDimensionsWhen||a.$eval(q.ngDimensionsWhen)){var l=a.isSet(q.ngDimensionsViewport)?d:_.bind(r,null,e);e=g(q.ngDimensions||"dimensions");var p=l();e.assign(a,p);var f=Math.max(c.getWidth(),15);e=function(){var b=l();if(!(b.width===p.width&&b.height===p.height)){var e=p.width-
b.width;0<e&&e<=f||(_.extend(p,b),a.$digest())}};var h=_.debounce(e,0),k=_.debounce(e,250);a.$watch(h);$(b).on("resize",k);a.$on("$destroy",function(){$(b).off("resize",k);h.cancel();k.cancel()})}}}}]);m.directive("ngStyleOnce",[function(){return{restrict:"A",link:function(a,g,b){g.css(a.$eval(b.ngStyleOnce))}}}]);d=function(a){m.directive(a.name,[function(){return{restrict:"A",link:function(g,b,e){var c=a.transform||_.identity,d=a.isNumeric&&!_.isUndefined(e[a.name+"AddToInitial"]),r=function(){var r=
g.$eval(e[a.name+"Selector"]);return r?$(r):b},f=e[a.name+"ForceInitialValue"]?g.$eval(e[a.name+"ForceInitialValue"]):r().css(a.property);a.isNumeric&&(f=parseInt(f,10));if(_.isUndefined(f)||_.contains(a.emptyValues,f))f="";var s=function(b){b?(d&&f&&(b+=f),r().css(a.property,c(b))):r().css(a.property,f)};a.interpolate?e.$observe(a.name,s):g.$watch(e[a.name],s);g.$on("$destroy",function(){s()})}}}])};d({name:"ngBackgroundImage",property:"background-image",transform:function(a){return"url("+(-1===
a.indexOf("Cdn")?a.replace("Url","CdnUrl"):a)+")"},emptyValues:["none"]});d({name:"ngBackgroundColor",property:"background-color",emptyValues:["rgba(0, 0, 0, 0)","transparent"]});d({name:"ngTop",property:"top",isNumeric:!0});m.directive("ngLocation",[function(){return{restrict:"A",link:function(a,g,b){var e=function(){var a={width:g[0].offsetWidth,height:g[0].offsetHeight},b;try{b=g.position()}catch(q){b={top:0,left:0}}a={position:b,size:a};e.position=a.position;e.size=a.size;return a};a[b.ngLocation]=
e}}}]);m.directive("ngScrollStatic",["$window",function(a){return{restrict:"A",link:function(g,b,e){var c=e.ngScrollStaticContainer||"html,body",d=!e.ngScrollStaticContainer,r=g.$eval(e.ngScrollStaticPadding)||0;(function(){var b=e.ngScrollStatic,g=$(c),b=g.find(b);if(b.length&&g.length){var b=_.min(_.map(b,function(a){return $(a).position().top||0})),f=_.chooseFirst(g,function(a){if(a.scrollHeight)return a.scrollHeight})||0,l=_.min(_.choose(g,function(a){if(a=$(a).height())return a}));d&&(l=Math.min(l,
a.innerHeight));f=Math.max(0,f-l);b-=r;0>b?b=0:b>f&&(b=f);g.scrollTop(b)}})()}}}]);m.directive("ngScrollTo",["$window",function(a){return{restrict:"A",link:function(g,b,e){var c=g.isSet(e.ngScrollOnClick),d=g.isSet(e.ngScrollSmooth),r=g.isSet(e.ngScrollForce),f=e.ngScrollContainer||"html,body",s=!e.ngScrollContainer,h=function(){var b=e.ngScrollTo;if(b){"top"===b&&(b="body");var g=$(b),b=$(f);if(g.length&&b.length){var g=Math.min.apply(Math,_.map(g,function(a){return $(a).offset().top||0})),c=_.chooseFirst(b,
function(a){if(a=$(a).scrollTop())return a})||0,z=_.chooseFirst(b,function(a){if(a.scrollHeight)return a.scrollHeight})||0,h=Math.min.apply(Math,_.choose(b,function(a){if(a=$(a).height())return a}));s&&(h=Math.min(h,a.innerHeight));var z=Math.max(0,z-h),c=1>Math.abs(g-c),k;0>g?(k=15,g=0):c?k=g-15:g>z&&(k=z-15,g=z);z&&(r&&!_.isUndefined(k)?b.stop().animate({scrollTop:k},250,"swing").animate({scrollTop:g},250,"swing"):d?b.stop().animate({scrollTop:g},500,"swing"):b.scrollTop(g))}}};if(c)b.on("click",
function(a){e.ngScrollPreAction&&g.$safeApply(function(){g.$eval(e.ngScrollPreAction)});h()});else h()}}}]);m.directive("ngTopScrolled",["$document",function(a){return{restrict:"A",link:function(g,b,e){g=g.$eval(e.ngTopScrolled)||0;g=a.scrollTop()+g;b.css({top:g})}}}]);m.directive("ngWithLocation",[function(){return{restrict:"A",link:function(a,g,b){a.$watch(b.ngWithLocation,function(e){g.toggleClass("with-location",!!e);if(e){var c=0,d=0;if(b.ngWithLocationOffset)var r=a.$eval(b.ngWithLocationOffset)||
{},c=r.x||c,d=r.y||d;r=a.$eval(b.ngWithLocationRight)||!1;d={top:e.position.top+d};d.left=r?e.position.left+-g[0].offsetWidth+c:e.position.left+e.size.width+c;g.toggleClass("left",!r);g.toggleClass("right",r);g.css(d)}})}}}]);m.directive("ngTranslate",["$window","translate",function(a,g){return{restrict:"A",link:function(a,e){g.initialize(e)}}}]);var n=function(a){return a&&!_.isUndefined(a.x)&&!_.isUndefined(a.y)&&a.width&&a.height};m.directive("ngImage",["$parse",function(a){var g=function(a){return _.map(a,
function(a,b){return b+"="+a.toString()}).join("&")};return{restrict:"A",compile:function(b,e){var c=a(e.ngImage),d=_.isUndefined(e.ngImageOnce)?_.always:""===e.ngImageOnce?_.always:a(e.ngImageOnce);return function(a,b,e){var q=function(q){if(q){var l=a.$eval(e.ngImageCrop),c=a.$eval(e.ngImageSquare),z=a.$eval(e.ngImageMaxWidth),d=a.$eval(e.ngImageMaxHeight),f=a.$eval(e.ngImageMaxSize),v=a.$eval(e.ngImageWidth),h=a.$eval(e.ngImageHeight),k=a.$eval(e.ngImageFilter),D=a.$eval(e.ngImageFilterAmount),
m=["blur","sharpen"],y={cache:!0,compress:!0,quality:90};n(l)&&_.extend(y,{crop:l.x.toFixed(0)+","+l.y.toFixed(0)+","+l.width.toFixed(0)+","+l.height.toFixed(0)});c&&_.extend(y,{w:c,h:c,fit:"crop"});z&&_.extend(y,{w:z,fit:"max"});d&&_.extend(y,{h:d,fit:"max"});f&&_.extend(y,{w:f,h:f,fit:"max"});v&&_.extend(y,{w:v});h&&_.extend(y,{h:h});k&&(-1!==_.indexOf(m,k)&&D)&&(y.filter=k,y[k+"Amount"]=D);_.startsWith(q,"https://fh-sites.imgix.net")||(q=q+"/convert?"+g(y));b.is("img")?b.attr("src",q):b.css("background-image",
"url("+q+")");return q}console.info("ng-image: no url supplied")};if(d()){var l=q(c(a));console.info("ng-image: once",l)}else a.$watch(c,function(a){a=q(a);console.info("ng-image: watch",a)})}}}}]);m.directive("ngCrop",["$parse","$timeout",function(a,g){return{restrict:"A",require:"^form",link:function(b,e,c,d){e.attr("src",b.$eval(c.ngCrop));var r=b.$eval(c.ngCropAspectRatio),r=!1===r?0:r||1.9,f=a(c.ngCropModel),s=function(a){b.$safeApply(function(){var g=f(b),q=e[0].naturalWidth/e.width();g.x=Math.floor(a.x*
q);g.y=Math.floor(a.y*q);g.width=Math.floor(a.w*q);g.height=Math.floor(a.h*q);d.$setDirty()})},h,l=function(){e.Jcrop({onSelect:s,keySupport:!1,aspectRatio:r},function(){h=this;var a=f(b),g=e[0].naturalWidth/e.width();if(n(a)){var q=Math.floor(a.x/g),l=Math.floor(a.y/g),c=q+Math.floor(a.width/g),a=l+Math.floor(a.height/g);h.setSelect([q,l,c,a])}else l=h.getWidgetSize(),q=l[0],l=l[1],r?(q/r<l?(c=q,a=q/r,q=0,l=(l-a)/2):(c=l*r,a=l,q=(q-c)/2,l=0),q=Math.floor(q),l=Math.floor(l),c=q+Math.floor(c),a=l+
Math.floor(a),h.setSelect([q,l,c,a])):h.setSelect([0,0,q,l])})};g(function(){l();b.$on("$destroy",function(){h&&h.destroy()})})}}}]);m.directive("ngAudio",[function(){return{restrict:"A",link:function(a,g,b){var e=b.ngAudioSrc,c;a[b.ngAudio]=function(){c||(c=$('<audio><source src="'+e+'"></audio>'),g.append(c));c[0].load();c[0].play()};a.$on("$destroy",function(){c&&c.remove()})}}}]);m.directive("ngTip",["$compile","$parse","$sanitize","$templateCache","d",function(a,g,b,e,c){var d;return{restrict:"A",
link:function(r,f,s){var h=s.ngTipLocation,l=s.ngTipWhen?g(s.ngTipWhen):_.always,p=$("body"),k=s.ngTipPosition;if(!c.isTouchEnabled||r.$eval(s.ngTipTouch)){d||(d=$('<span class="tip" aria-live="polite"></span>'),p.append(d));var n=function(){var a=f.attr("class")||"",a=a.split(" "),a=_.choose(a,function(a){if(a)return"tip-ele--"+a});return a=a.join(" ")},u,m,x,t=!1,B=function(g){var c=f;if(h&&(c=f.find(h),!c.length))return;if(l(r)){var z=k?"tip-"+k:"";d.attr("class","tip").addClass(y()+" "+n()+" "+
z);var B;if(s.ngTipTemplate){var z=s.ngTipTemplate,O=e.get(z);if(!O){console.warn("ng-tip: invalid template",z);return}var fa=a(O);r.$safeApply(function(){B=fa(r)})}else B=b(H());d.html(B);d.css({width:"auto"});z=c.offset();O=c.outerWidth();0===O&&c[0]instanceof SVGElement&&(O=c[0].getBoundingClientRect().width);x=d.outerWidth();m=d.outerHeight();var M=parseInt(p.css("top"),10)||0;u={};c=c.outerHeight();if("right"===k||"left"===k)u.top=Math.floor(z.top+c/2-m/2)-M;"right"===k?u.left=z.left+O+8:"left"===
k?u.left=z.left-x-8:"cursor"===k&&(50<=O||50<=c)?(t=!0,Q(g)):(u.top=Math.floor(z.top-m-8-M),u.left=Math.floor(Math.max(z.left+(O-x)/2,0)));d.css(u);d.addClass("showing")}},M=function(){d.attr("class","tip");d.css({top:-100,left:-100})},Q=function(a){u.top=Math.max(a.pageY-m-8,0);u.left=Math.max(a.pageX-Math.floor(x/2),0)},H=c.observer(s,"ngTip",""),y=c.observer(s,"ngTipClasses","");f.on("mouseenter",B);f.on("mouseleave",M);if("cursor"===k)f.on("mousemove",function(a){t&&(Q(a),d.css(u))});f.on("retip",
function(a){window.setTimeout(function(){if(r.$root){var b=d.hasClass("showing");M();b&&B(a)}})});s.ngDisabled&&f.is("button, input, select, textarea")&&s.$observe("disabled",function(a){a&&d.hasClass("showing")&&M()});r.$on("$destroy",M)}}}}]);m.directive("ngRadioFlyer",[function(){return{link:function(a,g,b){var e=function(a){g.find('input[type="radio"]').each(function(){var b=$(this),e=_.isUndefined(a)?b.is(":checked"):b.val()===a;b.closest("label").toggleClass("radio-selected",e)})};b.ngRadioFlyer?
a.$watch(b.ngRadioFlyer,function(a){e(a)}):a.$watch(function(){e()});a.$evalAsync(function(){e()})}}}]);m.directive("ngCheckboxMadness",[function(){return{require:"ngModel",link:function(a,g,b){a.$watch(b.ngModel,function(a){g.closest(".field").toggleClass("checkbox-selected",!!a)})}}}]);m.directive("ngSupportHacks",_.optional(["d","events","?native",function(a,g,b){return{restrict:"A",link:function(e){var c=$("html");c.addClass(a.isTouchEnabled?"touch":"not-touch");c.addClass(b&&b.isNative?"native":
"not-native");g.on(e,"fareharbor.native.inApp",function(a,b){c.addClass("native").removeClass("not-native")})}}}]));m.directive("ngBlurEscape",["$document","d",function(a,g){return{restrict:"A",link:function(b,e,c){a.on("keydown",function(a){if(27===a.which){var b=$(a.target);g.isTextInput(b)&&(a.preventDefault(),a.stopPropagation(),b.trigger("blur"))}})}}}]);m.directive("ngShortcut",["$parse","navigation","shortcuts",function(a,g,b){return{restrict:"A",compile:function(e,c){var d=a(c.ngShortcut),
r=c.ngShortcutAction?a(c.ngShortcutAction):_.ignore;return function(a,e,q){var l=d(a);if(!_.isUndefined(l)){var l=l.split("|"),c=_.ignore;a.isSet(q.ngShortcutClick)&&(c=_.then(c,function(){e.trigger("click")}));a.isSet(q.ngShortcutFocus)&&(c=_.then(c,function(){e.is("input, textarea, select")?setTimeout(function(){e.trigger("focus")}):e.find("input, textarea").first().trigger("focus")}));if(q.ngShortcutNavigate)var z=a.$interpolate(q.ngShortcutNavigate),c=_.then(c,function(){a.$apply(function(){g.navigate(z)})});
q.ngShortcutAction&&(c=_.then(c,function(){a.$apply(function(){r(a)})}));a.isSet(q.ngShortcutOnly)&&e.addClass("ng-hide");_.forEach(l,function(e){var g=b.register({keySet:e,action:c,description:q.ngShortcutDescription||""});a.$on("$destroy",function(){b.unregister(g)})})}}}}}]);m.directive("ngGenericForm",[function(){return{link:function(a,g,b){a[b.ngGenericForm]={}}}}]);m.directive("ngSortable",[function(){return{restrict:"A",require:"^?form",link:function(a,g,b,e){var c=a.$eval(b.ngSortable)||_.ignore,
d=b.ngSortableHandle||".sortable-handle",r=b.ngSortableSelector||"li.sortable",f='<li class="sortable sortable-placeholder"></li>';a.$eval(b.ngSortableTable)&&(f='<tbody class="sortable"><tr><td style="height: 50px"></td></tr></tbody>');b={itemSelector:r,placeHolderTemplate:f,dragEnd:function(b,g){var l=$(this),r=$(b),d=$(g),f=l.data("ng-sortable-item"),h=r.data("ng-sortable-item"),k=d.data("ng-sortable-item");f===k&&(k=null);f===h&&(h=null);return a.$apply(function(){e&&e.$setDirty();return c(f,
h,k)})}};d&&(b.dragSelector=d,b.dragSelectorExclude="input, textarea");g.dragsort(b);a.$on("$destroy",function(){g.dragsort("destroy")})}}}]);m.directive("ngSortableItem",[function(){return{restrict:"A",link:function(a,g,b){if(a=a.$eval(b.ngSortableItem))g.data("ng-sortable-item",a),g.addClass("sortable")}}}]);m.directive("ngDropdown",["$interpolate","$parse","$sanitize","d",function(a,g,b,e){var c=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,
d=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+hide\s+when\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)?$/,r=T("Choose an option"),f={errorLoading:_.constant(T("The results could not be loaded")),inputTooLong:function(a){a=a.input.length-a.maximum;return interpolate(nT("Please delete %(count)s character","Please delete %(count)s characters",a),{count:a})},inputTooShort:function(a){a=a.minimum-a.input.length;
return interpolate(nT("Please enter %(count)s or more character","Please enter %(count)s or more characters",a),{count:a})},loadingMore:_.constant(T("Loading more results...")),maximumSelected:function(a){return interpolate(nT("You can only select %(count)s item","You can only select %(count)s items",a.maximum),{count:a.maximum})},noResults:_.constant(T("No results found")),searching:_.constant(T("Searching..."))};return{restrict:"A",require:"ngModel",compile:function(s,h){var l,p,k,n,u,m,x,t,B,M,
Q;if(h.ngDropdownRemoteOptions){M="remote-options-mode";l=h.ngDropdownRemoteOptions.match(d);if(!l){console.error("ngDropdown: malformed ngDropdownRemoteOptions expression.");return}u=g(l[2]||l[1]);x=l[3]?g(l[3]):null;t=l[4]?g(l[4]):null;p=l[6];k=l[5]||l[7];n=g(l[2]?l[1]:k);m=g(l[8]);Q=h.ngDropdownMinimum?g(h.ngDropdownMinimum):_.constant(2)}else if(h.ngOptions){M="ng-options-mode";l=h.ngOptions.match(c);if(!l){console.error("ngDropdown: ng-options regex must match angular.");return}p=l[5];k=l[4]||
l[6];B=g(l[7])}else{console.error("ngDropdown: ngDropdownRemoteOptions or ngOptions required.");return}var H="ng-options-mode"===M&&!e.isDropdownSupported,y=a(h.ngPlaceholder||r),E=h.ngPlaceholderValue?g(h.ngPlaceholderValue):_.constant(null),R=h.ngDropdownCurrentOption&&g(h.ngDropdownCurrentOption),X=h.ngDropdownAllowClear&&g(h.ngDropdownAllowClear),Y=g(h.ngModel);l=$("<option class='empty-option' value='' label=''></option>");s.prepend(l);H?s.closest(".the-field").addClass("ng-dropdown-disabled"):
(s.css("width","100%"),s.addClass("ng-dropdown"));return function(a,e,g,q){var l=!X||X(a);if(H&&!l)var c=a.$watch(g.ngModel,function(a){""!==e.val()&&(e.find(".empty-option").remove(),c())});var r=E(a);q.$parsers.push(function(a){return null===a?r:a});if(!H){var d,l={language:f,minimumResultsForSearch:8,allowClear:l,placeholder:y(a)},z={};l.templateResult=function(a){var e=$("<span>"+b(a.text)+"</span>");a=z[a.id];_.isObject(a)&&a.classes&&e.addClass(a.classes);return e};var h={},s=function(b,e,g){if(!b)return null;
p&&(h[p]=g);h[k]=e;return b(a,h)};if("remote-options-mode"===M){var v=m(a),D=function(a,b){return{id:a.uri||a.pk.toString(),text:s(u,a,b),disabled:s(t,a,b),ngModelValue:s(n,a,b),originalValue:a}};l.minimumInputLength=Q(a);l.ajax={delay:250,transport:function(a,b,e){var g=v(a.data.term);g.$promise.then(function(){b(g)},function(){e(g)});return{abort:g.$promise.cancel}},processResults:function(a){z={};var b=[];_.forEach(a,function(a,e){if(!s(x,a,e)){var g=D(a,e);b.push(g);z[g.id]=g.ngModelValue}});
return{results:b}}};q.$parsers.unshift(function(a){return z[a]||null})}else if("ng-options-mode"===M){q={"default":function(){var b=B(a);if(_.isArray(b))if(b.length)if(_.isUndefined(b[0].label))if(_.isUndefined(b[0].uri))if(_.isUndefined(b[0].pk)){if(_.isString(b[0]))return b}else return _.pluck(b,"pk");else return _.pluck(b,"uri");else return _.pluck(b,"label");else return b;else if(_.isObject(b))return _.keys(b)},uri:function(){var b=B(a);return _.pluck(b,"uri")},pk:function(){var b=B(a);return _.pluck(b,
"pk")}}[a.$eval(g.ngDropdownWatchType)||"default"];var L=function(){window.setTimeout(function(){e.trigger("change.select2")})};a.$watch(q,function(){z=_.indexBy(B(a),function(a,b){return b.toString()});d.dataAdapter.destroy();L()},!0);a.$watch(g.ngModel,L)}q=e.closest(".ng-dropdown-context");q.length&&(l.dropdownParent=q);_.forEach(["open","focus"],function(a){e.bind("dropdown:"+a,function(){e.select2(a)})});a.$watch(g.ngDisabled,function(a){e.attr("disabled",!!a)});a.$watch(function(){return!!e.parents("fieldset[disabled]").length},
function(a){e.attr("disabled",a)});a.$on("$destroy",function(){d.destroy()});e.select2(l);d=e.data("select2");"remote-options-mode"===M&&R&&(a.$watch(R,function(a){if(!_.isUndefined(a)){var b=[];a&&b.push(D(a));d.trigger("selection:update",{data:b})}}),a.$watch(Y,function(b){b||R.assign(a,null)}),d.on("select",function(b){a.$apply(function(){R.assign(a,b.data.originalValue)})}))}}}}}]);m.directive("ngIf",c.conditionalDirective({watch:["$parse",function(a){return function(g,b,e){var c=a(e.ngIf);return function(){return!!c(g)}}}],
operator:function(a,g,b){return function(e){b.ngThen&&(a[b.ngThen]=e);return e}}}));m.directive("ngIfOnce",c.conditionalDirective({watch:["$parse",function(a){return function(g,b,e){var c=a(e.ngIfOnce);return function(){return!!c(g)}}}],operator:function(a,g,b){return function(e){b.ngThen&&(a[b.ngThen]=e);return e}},once:!0}));m.directive("ngIfInLabs",c.conditionalDirective({watch:["labs",function(a){return function(g,b,e){return function(){var b=e.ngIfInLabs.replace("!",""),c=e.ngIfInLabsVariation,
r=0===e.ngIfInLabs.indexOf("!"),b=a.isInVariation(b,c);e.ngThen&&(g[e.ngThen]=b);return r?!b:b}}}]}));m.directive("ngElse",c.conditionalDirective({watch:["$parse",function(a){return function(g,b,e){var c=a(e.ngElse);return function(){return!c(g)}}}]}));m.directive("ngElseOnce",c.conditionalDirective({watch:["$parse",function(a){return function(g,b,e){var c=a(e.ngElseOnce);return function(){return!c(g)}}}],once:!0}));m.directive("ngWatch",c.conditionalDirective({watch:["$parse",function(a){return function(g,
b,e){return a(e.ngWatch)}}],operator:_.constant(_.always),transclude:["$parse",function(a){return function(g,b,e){var c=a(e.ngWatchAction)||_.ignore;return function(){c(g)}}}]}));m.directive("ngInterval",[function(){return{link:function(a,g,b){g=a.$eval(b.ngInterval)||1;var e=setInterval(function(){a.$digest()},1E3*g);a.$on("$destroy",function(){clearInterval(e)})}}}]);m.directive("ngData",["$q",function(a){return{scope:!0,transclude:!0,templateUrl:"ng-data",controllerAs:"dataCtrl",controller:["$scope",
"$attrs",function(g,b){var e=this;e.status="loading";g.isSet(b.ngDataSmall)?e.type="small":g.isSet(b.ngDataManual)?e.type="manual":e.type="large";e.transcludeOnError="transclude"===(b.ngDataOnError||"");var c=g.$eval(b.ngData);if(_.isUndefined(c))e.status="success";else{var d=_.isArray(c);if(!d&&(!_.isObject(c)||!_.isFunction(c.then)))e.status="success";else{d&&(c=a.all(c));var r=g.$eval(b.ngDataStale);if(!_.isUndefined(r)&&(r=d?r:[r],!_.any(r,"$fresh"))){e.status="success";return}c.then(function(){e.status=
"success"},function(){e.status="error"})}}}]}}]);m.config(["$provide",function(a){a.decorator("ngShowDirective",["$delegate",function(a){a.shift();return a}])}]);m.directive("ngShow",["$parse",function(a){return{restrict:"A",compile:function(g,b){var e=a(b.ngShow);return function(a,b,g){a.$watch(e,function(e){b.toggleClass("ng-hide",!e);g.ngThen&&(a[g.ngThen]=e)})}}}}]);m.directive("ngShowOnce",["$parse",function(a){return{restrict:"A",compile:function(g,b){var e=a(b.ngShowOnce);return function(a,
b,g){var q=e(a);b.toggleClass("ng-hide",!q);g.ngThen&&(a[g.ngThen]=q)}}}}]);m.config(["$provide",function(a){a.decorator("ngHideDirective",["$delegate",function(a){a.shift();return a}])}]);m.directive("ngHideOnce",["$parse",function(a){return{restrict:"A",compile:function(g,b){var e=a(b.ngHideOnce);return function(a,b,g){var q=!!e(a);b.toggleClass("ng-hide",q);g.ngThen&&(a[g.ngThen]=q)}}}}]);m.directive("ngHide",["$parse",function(a){return{restrict:"A",compile:function(g,b){var e=a(b.ngHide);return function(a,
b,g){a.$watch(e,function(e){e=!!e;b.toggleClass("ng-hide",e);g.ngThen&&(a[g.ngThen]=e)})}}}}]);m.directive("ngAutoExporter",["$interpolate","autoExport",function(a,g){return{scope:!0,templateUrl:"auto-exporter",replace:!0,compile:function(b,e){var c=a(e.ngAutoExporter),d=a(e.ngAutoExporterFilename);return function(a,b,e){a.autoExport=g;a.isLeft=a.isSet(e.ngAutoExporterLeft);a.$watch(c,function(b){a.namespace=b});a.$watch(d,function(b){a.filename=b})}}}}]);m.directive("ngAutoExportValue",[function(){return{restrict:"A",
compile:function(a,g){var b=g.ngAutoExportValue||"";g.$set("ngAutoExportValue","");return function(a,g,q){g.data("ngAutoExportValue",function(){return a.$interpolate(b)})}}}}]);m.directive("ngAutoExportSkip",["$parse",function(a){return{restrict:"A",compile:function(g,b){var e=a(b.ngAutoExportSkip||"true");return function(a,b,g){b.data("ngAutoExportSkip",_.bind(e,null,a))}}}}]);m.directive("ngAutoExportOnly",["$parse",function(a){return{restrict:"A",compile:function(g,b){if(b.ngAutoExportOnly){var e=
a(b.ngAutoExportOnly);return function(a,b,g){a.$watch(e,function(a){b.toggleClass("ng-hide",a)})}}g.addClass("ng-hide")}}}]);m.directive("ngAutoExport",["$interpolate","$parse","autoExport",function(a,g,b){return{restrict:"A",scope:!0,compile:function(e,c){var d=a(c.ngAutoExport),r=c.ngAutoExportProcess?g(c.ngAutoExportProcess):null;return function(a,e){var g=d(a),l={isCSS:a.isSet(c.ngAutoExportCss),tableSelector:c.ngAutoExportTable,rowSelector:c.ngAutoExportRow,cellSelector:c.ngAutoExportCell};r&&
(l.process=_.bind(r,null,a));var q=b.addExport(g,e,l);a.$on("$destroy",function(){b.removeExport(q)})}}}}]);m.directive("ngTableFilters",["$parse","$rootScope","require",function(a,g,b){return{restrict:"A",scope:!0,controller:function(){var a=this;a.ignore=null;a.filters=[];a.addFilter=function(g){b.assert(g.type,"ng-table-filter: expected filter description to include type");b.assert(g.filter,"ng-table-filter: expected filter description to include filter");a.filters.push(g);h(g)};a.removeFilter=
function(b){f(b);_.overwriteWithout(a.filters,b)};a.reset=function(){_.forEach(a.filters,function(a){a.resetValue()});a.update()};a.isFiltering=function(b){return _.any(_.map(a.filters,function(a){return a.isFiltering()}))};var c=function(b,g){for(var c=[],q=a.filters.length,r,d,f,h=0,z=g.length;h<z;h++){d=g[h];r=!0;if(d&&d!==a.ignore)for(var s=0;s<q;s++)if(f=a.filters[s],f.isFiltering()&&!f.filter(d)){r=!1;break}r&&c.push(d)}_.overwrite(b,c);b.filtered=g.length-c.length},q={},r={};a.update=function(){console.info("ng-table-filters: filtering collections");
_.forEach(q,function(a,b){c(r[b],a)});f()};a.debouncedUpdate=_.debounce(function(){g.$apply(function(){a.update()})},500);a.addCollection=function(a,b){q[a.$id]=b||[];var e=r[a.$id];_.isUndefined(e)&&(e=r[a.$id]=[]);c(e,q[a.$id]);return e};a.removeCollection=function(a){delete q[a.$id];delete r[a.$id]};var d={},f=function(b){d&&(_.isUndefined(b)?_.forEach(a.filters,function(a){f(a)}):!_.isUndefined(b.identifier)&&!_.isUndefined(b.value)&&(d[b.identifier]=b.value))},h=function(b){if(d)if(_.isUndefined(b))_.forEach(a.filters,
h);else if(!_.isUndefined(b.identifier)){var g=d[b.identifier];_.isUndefined(g)?b.resetValue():b.value=g}};a.updateModel=function(b){f();d=b||{};h();a.update();return d};a.storeModel=function(){f();return d}},compile:function(b,g){var c=g.ngTableFilters?a(g.ngTableFilters):null,r=g.ngTableFiltersModel?a(g.ngTableFiltersModel):null,d=g.ngTableFiltersIgnore?a(g.ngTableFiltersIgnore):null;return{pre:function(a,b,e,g){a.$tableFilters=g;r&&a.$watch(r,function(b){r.assign(a,g.updateModel(b))});c&&a.$watchCollection(c,
function(b){a.$collection=g.addCollection(a,b)});d&&a.$watch(d,function(a){g.ignore=a;g.update()})}}}}}]);m.directive("ngTableFilter",["$compile","$parse","$templateCache",function(a,g,b){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],scope:!0,controller:function(){this.name="";this.isFiltering=_.never;this.filter=_.always},compile:function(e,c){var d=b.get(c.ngTableFilterTemplate||"tableFilter.filter");if(d){var r=a(d),f=c.ngTableFilterIdentifier?g(c.ngTableFilterIdentifier):null;
return{pre:function(a,b,e,g){var c=g[0],q=g[1];a.$tableFilter=q;q.reset=function(){q.resetValue();c.update()};q.name=q.identifier=e.ngTableFilter;f&&(q.identifier=f(a));e.$observe("ngTableFilter",function(a){q.name=a});b.addClass("ng-table-filter");a.$watch(function(){return q.isFiltering()},function(a){b.toggleClass("filtering",a)});r(a,function(a){b.append(a)})},post:function(a,b,e,g){var c=g[0],q=g[1];c.addFilter(q);a.$on("$destroy",function(){c.removeFilter(q)})}}}console.error("ng-table-filter-filter: template not found")}}}]);
m.directive("ngTableFilterString",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(g,b){var e=a(b.ngTableFilterString);return{post:function(a,b,g,c){var q=c[0],d=c[1];d.type="string";d.value="";d.resetValue=function(){d.value=""};var l="";d.isFiltering=function(){l=d.value.toLowerCase();return!!l};d.filter=function(b){return 0<=(e(a,{$row:b})||"").toLowerCase().indexOf(l)};a.$watch(function(){return d.value},function(){q.debouncedUpdate()})}}}}}]);
m.directive("ngTableFilterDate",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(g,b){var e=a(b.ngTableFilterDate);return{pre:function(a,b,g,c){var q=c[0],d=c[1];d.operations=[{name:T("Before"),value:"before"},{name:T("On"),value:"on"},{name:T("After"),value:"after"}];var l={},f;l.on=function(b){return(b=e(a,{$row:b})||0)?0===b.diff(f,"days"):!1};l.before=function(b){return(b=e(a,{$row:b})||0)?0>b.diff(f,"days"):!1};l.after=function(b){return(b=
e(a,{$row:b})||0)?0<b.diff(f,"days"):!1};d.type="date";d.value={operation:"on",date:""};d.resetValue=function(){d.value.date=""};d.isFiltering=function(){f=d.value.date?moment(d.value.date,"YYYY-MM-DD"):null;return!!f};d.filter=l[d.value.operation];a.$watch(function(){return d.value.operation},function(a){d.filter=l[a];q.debouncedUpdate()});a.$watch(function(){return d.value.date},function(){q.debouncedUpdate()})}}}}}]);m.directive("ngTableFilterAmount",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters",
"ngTableFilter"],compile:function(g,b){var e=a(b.ngTableFilterAmount);return{pre:function(a,b,g,c){var q=c[0],d=c[1];d.operations=[{name:T("is"),value:"equal"},{name:T("less than"),value:"less-than"},{name:T("greater than"),value:"greater-than"}];var l={equal:function(b){return(e(a,{$row:b})||0)===d.value.amount},"less-than":function(b){return(e(a,{$row:b})||0)<d.value.amount},"greater-than":function(b){return(e(a,{$row:b})||0)>d.value.amount}};d.type="amount";d.value={operation:"greater-than",amount:""};
d.resetValue=function(){d.value.amount=""};d.isFiltering=function(){return""!==d.value.amount};d.filter=l[d.value.operation];a.$watch(function(){return d.value.operation},function(a){d.filter=l[a];q.debouncedUpdate()});a.$watch(function(){return d.value.amount},function(){q.debouncedUpdate()})}}}}}]);m.directive("ngTableFilterNumber",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(g,b){var e=a(b.ngTableFilterNumber);return{pre:function(a,b,g,
c){var q=c[0],d=c[1];d.operations=[{name:T("is"),value:"equal"},{name:T("less than"),value:"less-than"},{name:T("greater than"),value:"greater-than"}];var l={equal:function(b){return(e(a,{$row:b})||0)===d.value.number},"less-than":function(b){return(e(a,{$row:b})||0)<d.value.number},"greater-than":function(b){return(e(a,{$row:b})||0)>d.value.number}};d.type="number";d.value={operation:"greater-than",number:""};d.resetValue=function(){d.value.number=""};d.isFiltering=function(){return""!==d.value.number};
d.filter=l[d.value.operation];a.$watch(function(){return d.value.operation},function(a){d.filter=l[a];q.debouncedUpdate()});a.$watch(function(){return d.value.number},function(){q.debouncedUpdate()})}}}}}]);m.directive("ngTableFilterChoice",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(g,b){var e=a(b.ngTableFilterChoice),c=a(b.ngTableFilterChoices),d=a(b.ngTableFilterChoiceName||"$choice.name"),r=a(b.ngTableFilterChoiceValue||"$choice.pk");
return{pre:function(a,b,g,q){var f=q[0],h=q[1];h.choiceValue=function(b){return r(a,{$choice:b})};h.choiceName=function(b){return d(a,{$choice:b})};b=c(a);var k=_.map(b,function(a){return h.choiceValue(a)});h.type="choices";h.choices=b;h.value={};h.resetValue=function(){_.forEach(k,function(a){h.value[a]=!1})};h.resetValue();h.isFiltering=function(){return _.any(_.values(h.value))};h.filter=function(b){var g=e(a,{$row:b})||!1;if(_.isArray(g)){for(var c=0,q=g.length;c<q;c++)if(b=h.choiceValue(g[c]),
0<=k.indexOf(b)&&h.value[b])return!0;return!1}b=h.choiceValue(g);return 0<=k.indexOf(b)?h.value[b]:!1};a.$watch(function(){return h.value},function(){f.debouncedUpdate()},!0)}}}}}]);m.directive("ngTableFilterYesno",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(g,b){var e=a(b.ngTableFilterYesno);return{pre:function(a,b,g,c){var q=c[0],d=c[1],l=d.ANY="any";d.type="yesno";d.value=l;d.resetValue=function(){d.value=l};d.isFiltering=function(){return d.value!==
l};d.filter=function(b){return(e(a,{$row:b})||!1)===d.value};a.$watch(function(){return d.value},function(){q.debouncedUpdate()})}}}}}]);m.directive("ngTableFilterView",["$compile","$templateCache",function(a,g){var b={};return{require:"^ngTableFilter",link:{pre:function(e,c,d,r){d="tableFilter.filters."+r.type;var f=b[d];if(!f){f=g.get(d);if(!f){console.warn("ng-table-filter-view: invalid or custom type",r.type);c.remove();return}f=b[d]=a(f)}f(e,function(a){c.append(a)})}}}}]);m.directive("ngTables",
[function(){return{restrict:"A",scope:!0,controllerAs:"tablesCtrl",controller:function(){var a=this;a.tables=[];a.predicate=null;a.addTable=function(g){_.contains(a.tables,g)||a.tables.push(g)};a.removeTable=function(g){_.overwriteWithout(a.tables,g)};a.toggle=function(g){a.predicate=g;_.forEach(a.tables,function(a){a.toggle(g)})}}}}]);m.directive("ngTable",["$filter",function(a){var g=a("orderBy");return{restrict:"A",scope:!0,controller:["$scope","$attrs","$parse","$element",function(a,e,c,q){var d=
this,f,h=e.ngTableName||"$table",k=a.isSet(e.ngTableFiltered)?q.controller("ngTableFilters"):null;d.collection=[];d.predicate=null;d.isReversed=!1;d.isHeadersIgnored=a.isSet(e.ngTableIgnoreHeaders);d.toggle=function(a){a&&d.predicate===a?d.isReversed=!d.isReversed:(d.predicate=a,d.isReversed=!1);d.update()};d.update=function(a){_.isUndefined(a)||(f=a);a=f;d.predicate&&(a=g(f,d.predicate,d.isReversed));_.overwrite(d.collection,a);_.forEach(l,function(a){a()})};var l=[];d.watch=function(a,b){l.push(b);
a.$on("$destroy",function(){_.overwriteWithout(l,b)})};a.tablesCtrl&&a.isSet(e.ngTableTables)&&(a.tablesCtrl.addTable(d),d.predicate=a.tablesCtrl.predicate,a.$on("$destroy",function(){a.tablesCtrl.removeTable(d)}));e=c(e.ngTable);d.update(e(a));var p;a.$watchCollection(e,function(e){k?p=k.addCollection(a,e):d.update(e)});k&&(a.$watchCollection(function(){return p},function(a){d.update(a);d.filtered=a.filtered}),a.$on("$destroy",function(){k.removeCollection(a)}));_.set(a,h,d)}]}}]);m.directive("ngTableHeader",
["tableHeaders","require",function(a,g){return{restrict:"A",require:["^?ngTable","^?ngTables"],link:function(b,e,c,d){var r=d[0]||d[1];r&&(r===d[0]&&r.isHeadersIgnored)&&(r=d[1],g.assert(r,"If ngTable is only for summaries, ngTables is required for headers!"));g.assert(r,"ngTable or ngTables required");if(!c.ngTableHeaderWhen||b.$eval(c.ngTableHeaderWhen)){var f=a.parsePredicate(b,c.ngTableHeader,b.isSet(c.ngTableHeaderDefault),c.ngTableHeaderKey);b.isSet(c.ngTableHeaderDisabled)||(e.on("click",function(){b.$apply(function(){r.toggle(f)})}),
e.addClass("ng-table-header"),b.$watch(function(){return r.predicate===f},function(a){e.toggleClass("active",a)}));f.isDefault&&r.toggle(f)}}}}]);m.directive("ngTableSummary",["$parse","require",function(a,g){return{scope:!0,restrict:"A",compile:function(b,e){var c=e.ngTableSummary?a(e.ngTableSummary):null,d=e.ngTableSummaryOperator?a(e.ngTableSummaryOperator):function(a,b){return(b.$acc||0)+(b.$row||0)},r=e.ngTableSummaryInitial?a(e.ngTableSummaryInitial):e.ngTableSummaryOperator?null:_.constant(0);
e.ngTableSummaries&&(c=a(e.ngTableSummaries),r=function(){return[]},d=function(a,b){_.forEach(b.$row,function(a,e){b.$acc[e]=(b.$acc[e]||0)+(a||0)});return b.$acc});return{pre:function(b,e,f){e=f.ngTableSummaryTableName||"$table";g.inScope(b,e,"ngTable controller must be in scope");var l=b[e],h=f.ngTableSummaryWhen?a(f.ngTableSummaryWhen):_.always,k=function(){if(!h(b))return"";var a=r?r(b):null;return _.reduce(l.collection,function(a,e){return d(b,{$acc:a,$row:c?c(b,{$row:e}):e})},a)};e=function(){b.$summary=
k()};e();b.isSet(f.ngTableSummaryOnce)||(b.isSet(f.ngTableSummaryTableOnly)?l.watch(b,e):b.$watch(e))}}}}}]);m.directive("ngGroup",[function(){return{scope:!0,restrict:"A",require:["ngGroup","^?ngGroups"],controller:function(){var a=this;a.collection=[];a.groups=[];a.byFn=a.asFn=a.name=null;a.group=function(){var g=!0,b=a.byFn;b||(b=_.constant(""),g=!1);var e=a.asFn?a.asFn:b,c={},d={};if(a.collection.length){var r={};_.forEach(a.collection,function(g){var l={$row:g},f=b(l)||"",f=_.isArray(f)?f:[f];
f.length||(f=[null]);_.forEach(f,function(f){l.$by=f;f=_.isModelObject(f)?f.uri:f;if(_.isUndefined(c[f])){var h=e===b?f:e(l);c[f]=h||null}_.isUndefined(d[f])&&(d[f]=a.sortByFn?a.sortByFn(l):c[f]);delete l.$by;h=r[f]||[];h.push(g);r[f]=h})});var f={};_.forEach(a.groups,function(a){f[a.by]=a});var h=_.map(r,function(b,e){var r=f[e]||{};_.extend(r,{isGrouped:g,by:e,as:c[e],name:a.name,rows:b,sortBy:d[e]});return r});_.overwrite(a.groups,_.sortBy(h,"sortBy"))}else _.overwrite(a.groups,[{isGrouped:g,name:a.name,
rows:[]}])};a.groupBy=function(g,b,e,c){a.byFn=g;a.asFn=b;a.sortByFn=e;a.name=c;a.group()};a.update=function(g){a.collection=g;a.group()}},link:function(a,g,b,e){var c=e[0],d=e[1];d&&(d.addNgGroupCtrl(c),a.$on("$destroy",function(){d.removeNgGroupCtrl(c)}));a.$groups=c.groups;a.$watchCollection(b.ngGroup,function(a){c.update(a)})}}}]);m.directive("ngGroupBy",["$parse","require",function(a,g){return{require:["^?ngGroup","^?ngGroups"],compile:function(b,e){var c=e.ngGroupBy?a(e.ngGroupBy):null,d=e.ngGroupAs?
a(e.ngGroupAs):null,r=e.ngGroupSortBy?a(e.ngGroupSortBy):null,f=e.ngGroupByModel?a(e.ngGroupByModel):null;return function(a,b,q,h){var k=h[0]||h[1];g.assert(k,"Either ngGroup or ngGroups required on ancestor");var n,u,m;c&&(n=_.bind(c,null,a),u=_.bind(d,null,a));r&&(m=_.bind(r,null,a));var x=function(){k.groupBy(n,u,m,q.ngGroupName)};a.isSet(q.ngGroupDefault)&&x();b.on("click",function(){f?f.assign(a,e.ngGroupBy):x()});a.$watch(function(){return k.byFn===n},function(a){b.toggleClass("toggled",a)});
f&&a.$watch(f,function(a,b){a===e.ngGroupBy&&x()})}}}}]);m.directive("ngGroups",["$parse","events",function(a,g){return{scope:!0,restrict:"A",controller:["$scope","$attrs",function(a,e){var c=this;c.ngGroupCtrls=[];var d=function(a){a.groupBy(c.byFn,c.asFn,c.sortByFn,c.name)};c.groupBy=function(a,b,e,g){c.byFn=a;c.asFn=b;c.sortByFn=e;c.name=g;_.forEach(c.ngGroupCtrls,d)};c.addNgGroupCtrl=function(a){c.ngGroupCtrls.push(a);c.byFn&&d(a)};c.removeNgGroupCtrl=function(a){_.ref.remove(c.ngGroupCtrls,a)};
if(e.ngGroupsRegroupEvent)g.on(a,e.ngGroupsRegroupEvent,function(){_.forEach(c.ngGroupCtrls,d)})}]}}]);m.directive("ngToggle",["$parse","$rootScope","toggles",function(a,g,b){return{restrict:"A",compile:function(e,g){var c=a(g.ngToggleValue),d=a(g.ngToggleDefault),f=a(g.ngToggleGroupValue),h=g.ngToggleWhen?a(g.ngToggleWhen):null;return function(a,e,g){var q=c(a)||g.ngToggle,k=d(a)||!1,n=f(a)||g.ngToggleGroup,z=a.isSet(g.ngToggleAutoClose),m=a.isSet(g.ngToggleGroupCloseable),t=_.isUndefined(g.ngToggleInteractive)||
a.isSet(g.ngToggleInteractive),B=h?_.bind(h,null,a):null;b.create(q,{autoClose:z,defaultState:k,group:n,isCloseableGroup:m,when:B});t&&(k="click",a.isSet(g.ngToggleMousedown)&&(k="mousedown"),e.on(k,function(e){a.$apply(function(){b.toggle(q)})}));a.$watch(function(){return b.state(q)},function(a){e.toggleClass("toggled",a)});a.$on("$destroy",function(){b.destroy(q)})}}}}]);m.directive("ngToggled",c.conditionalDirective({watch:["$parse","toggles",function(a,g){return function(b,e,c){var d=b.$eval(c.ngToggledValue)||
c.ngToggled,f=c.ngToggledAlwaysWhen?a(c.ngToggledAlwaysWhen):_.never;return function(){return g.state(d)||f(b)}}}],operator:["$parse",function(a){return function(g,b,e){var c=e.ngToggledAction?a(e.ngToggledAction):_.ignore;return function(a){c(g,{$value:a});return a}}}]}));m.directive("ngToggledShow",["$parse","toggles",function(a,g){return{link:function(b,e,c){var d=c.ngToggledAction?a(c.ngToggledAction):_.ignore,f=c.ngToggledAlwaysWhen?a(c.ngToggledAlwaysWhen):_.never,h=b.$eval(c.ngToggledShowValue)||
c.ngToggledShow;b.$watch(function(){return g.state(h)||f(b)},function(a){d(b,{$value:a});e.css("display",a?"":"none")})}}}]);m.directive("ngWith",["$parse",function(a){return{restrict:"A",scope:!0,priority:900,compile:function(g,b){var e=a(b.ngWith);return{pre:function(a,b,g){e(a);a.$watch(e)}}}}}]);m.directive("ngFadeIn",[function(){return{restrict:"A",link:function(a,g,b){a=parseInt(b.ngFadeIn);g.hide();g.fadeIn(a)}}}]).directive("ngFadeOut",[function(){return{restrict:"A",link:function(a,g,b){var e=
parseInt(b.ngFadeOut);b=b.ngFadeTarget;var c=$(g);g=a;b&&(g=a.$eval(b));g.fadeOut=function(b){c.fadeOut(e,function(){b&&b(a)})}}}}]);m.directive("ngNullForm",[function(){return{name:"form",controller:function(){this.$setPristine=this.$setDirty=this.$removeControl=this.$setValidity=this.$addControl=_.ignore;this.$$renameControl=function(a,g){a.$name=g}},link:{pre:function(a){a.nullForm={$dirty:!1,$pristine:!0,$valid:!0,$invalid:!1}}}}}]);m.directive("ngName",[function(){return{restrict:"A",require:["ngModel",
"^?form"],link:function(a,g,b,e){a.$watch(b.ngName,function(a){g.attr("name",a);var b=e[0],c=e[1];c.$removeControl(b);b.$name=a;c.$addControl(b)})}}}]).directive("ngPrefix",[function(){return{restrict:"A",priority:100,controller:["$scope","$element","$attrs",function(a,g,b){var e=g.attr("name");a.$watch(b.ngPrefix,function(a){var g=e;a&&(g=a+"-"+g);b.$set("name",g)})}]}}]);m.directive("ngOutboundLink",[function(){return{restrict:"A",priority:-1,link:function(a,g,b){var e=a.$interpolate(b.ngOutboundLink)||
"_self";(!b.ngOutboundLinkWhen||a.$eval(b.ngOutboundLinkWhen))&&g.attr("target",e)}}}]);m.directive("ngBackButton",["$window",function(a){return{restrict:"A",link:function(g,b,e){b.on("click",function(b){setTimeout(function(){a.history.back()},50)})}}}]);m.directive("ngSearchLink",["navigation",function(a){return{restrict:"A",link:function(g,b,e){e.$observe("ngSearchLink",function(c){var d=g.$eval(e.ngSearchLinkCompany)||a.currentCompany;d&&(c=d.$url(urls.dashboard.bookings.index)+"?q="+c,b.attr("href",
c))})}}}]);m.directive("ngPrint",_.optional(["$timeout","$window","?native",function(a,g,b){var e=b&&b.isNative;return{restrict:"A",link:function(c,d,f){var h=function(){if(e){var a;if(f.ngPrintNative){a=$(c.$interpolate(f.ngPrintNative));if(!a.length)return;a=a[0]}b.print(a)}else g.print()};d.on("click",function(a){a.preventDefault();a.stopPropagation();h()});c.isSet(f.ngPrintAuto)&&a(function(){h()},e?0:400)}}}]));m.directive("ngOpenWindow",["$window","d",function(a,g){return{restrict:"A",link:function(b,
e,c){var d=g.observer(c,"ngOpenWindow"),f=g.observer(c,"ngOpenWindowArguments","toolbar=0,status=0,scrollbars=1");e.on("click",function(e){if(d()){var g=b.$eval(c.ngOpenWindowWidth);e=b.$eval(c.ngOpenWindowHeight);var h=f();if(g)var l=Math.max(0,(a.screen.width-g)/2),h=h+(",width="+g)+(",left="+l);e&&(g=Math.max(0,(a.screen.height-e)/2),h+=",height="+e,h+=",top="+g);a.open(d(),"angular-open-winow",h)}})}}}]);m.directive("ngCloseWindow",["$window","d",function(a,g){return{restrict:"A",link:function(b,
e,g){e.on("click",function(b){a.close()})}}}]);m.directive("ngTouch",["$parse","d",function(a,g){return{restrict:"A",compile:function(b,e){var c=a(e.ngTouch);return function(a,b){b.on(g.isTouchEnabled?"touchstart":"click",function(){a.$apply(function(){c(a)})})}}}}]);m.directive("ngConfirmClick",[function(){return{priority:-1,restrict:"A",link:function(a,g,b){var e=a.isSet(b.ngConfirmClickStrict);g.on("click",function(g){if(!(e&&this!==g.target)){var c=b.ngConfirmClick,d;if(d=c)d=_.isUndefined(b.ngConfirmClickWhen)?
!0:a.$eval(b.ngConfirmClickWhen,{$event:g}),d=d&&!confirm(c);d&&(g.stopImmediatePropagation(),g.preventDefault())}})}}}]);m.directive("ngCancelClick",[function(){return{priority:-1,restrict:"A",link:function(a,g,b){g.on("click",function(e){a.$eval(b.ngCancelClick)&&(e.stopImmediatePropagation(),e.preventDefault())})}}}]);d=function(a,g){m.directive(a,[function(){return{restrict:"A",link:function(b,e,c){var d=b.isSet(c[a+"Strict"]),f=c[a+"On"]||"";e.on("click",function(e){d&&this!==e.target||(!f||
$(e.target).is(f))&&g.test(e)&&b.$apply(function(){!1===b.$eval(c[a])&&(e.stopPropagation(),e.preventDefault())})})}}}])};m.config(["$provide",function(a){a.decorator("ngClickDirective",["$delegate",function(a){a.shift();return a}])}]);m.directive("ngKeyboardAccessibleClick",[function(){var a=[13,32];return{restrict:"A",link:function(g,b,e){var c=!1,d=function(a){(c=a)?(b.attr("role","button"),b.attr("tabindex","0")):(b.removeAttr("role"),b.removeAttr("tabindex"))};e.ngKeyboardAccessibleClick?g.$watch(e.ngKeyboardAccessibleClick,
d):d(!0);b.on("keydown",function(b){_.contains(a,b.keyCode)&&c&&(b.preventDefault(),b.stopPropagation(),$(b.target).click())})}}}]);d("ngClick",{test:function(a){return!a.shiftKey&&!a.ctrlKey&&!a.metaKey&&!a.altKey}});d("ngShiftClick",{test:function(a){return a.shiftKey&&!a.ctrlKey&&!a.metaKey&&!a.altKey}});d("ngControlClick",{test:function(a){return!a.shiftKey&&a.ctrlKey&&!a.metaKey&&!a.altKey}});d("ngMetaClick",{test:function(a){return!a.shiftKey&&!a.ctrlKey&&a.metaKey&&!a.altKey}});d("ngAltClick",
{test:function(a){return!a.shiftKey&&!a.ctrlKey&&!a.metaKey&&a.altKey}});d("ngShiftOrAltClick",{test:function(a){return(a.shiftKey||a.altKey)&&!a.ctrlKey&&!a.metaKey}});m.directive("ngPhoneNumberInput",["d",function(a){return{priority:1,restrict:"A",link:function(g,b){a.restrictKeypresses(b,/\+|\d/)}}}]);m.directive("ngAmountInput",["$parse","d",function(a,g){return{priority:1,require:"ngModel",restrict:"A",link:function(b,e,c,d){var f=a(c.ngModel),h=parseFloat(c.max),n=parseFloat(c.min),D=c.ngAmountInputMax&&
a(c.ngAmountInputMax),l=c.ngAmountInputMin&&a(c.ngAmountInputMin),p=c.ngAmountInputDefault&&a(c.ngAmountInputDefault),m=b.isSet(c.ngAmountInputAllowEmpty),m=!c.required||m,w=function(){return p?p(b)/100:0},u=/[0-9]|\./;if(c.ngAmountInputPositive?!b.$eval(c.ngAmountInputPositive):1)u=/[0-9]|\.|\-/;g.restrictKeypresses(e,u);d.$parsers.push(function(a){if(_.isUndefined(a)||""===a||null===a){if(m)return"";d.$$lastCommittedViewValue=w().toString();return _.roundHalfToEven(100*w())}d.$setValidity("required",
!0);var e=l?Math.max(l(b)/100,n):n,c=D?Math.min(D(b)/100,h):h;!_.isNaN(e)&&a<e&&(a=e,d.$setValidity("min_value",!0));!_.isNaN(c)&&a>c&&(a=c,d.$setValidity("max_value",!0));return _.roundHalfToEven(100*a)});d.$formatters.unshift(function(a){return _.isUndefined(a)||""===a||null===a?m?"":w():_.roundHalfToEven(a/100,2).toFixed(2)});b.$watch(f,function(a,e){!m&&(_.isUndefined(a)&&_.isUndefined(e))&&f.assign(b,w())});e.on("blur",function(){k(d)})}}}]);m.directive("ngJsonInput",["$parse",function(a){var c=
/^(?!^[_\-])(?!.*[_\-]$)[a-zA-Z0-9_\-]+$/,b=function(a){try{_.parseJSON(a)}catch(b){return!1}return!0};return{require:"ngModel",restrict:"A",link:function(e,d,f,h){var k=a(f.ngModel);h.$parsers.push(function(a){a=$.trim(a);if(_.isUndefined(a)||""===a||null===a)return h.$setValidity("valid_json",!0),"";var e=a;c.test(e)&&(e='"'+e+'"');h.$setValidity("valid_json",b(e));return a});e.$watch(k,function(a){a&&('"'===a.charAt(0)&&'"'===a.slice(-1))&&(a=a.slice(1,a.length-1),(!a||c.test(a))&&k.assign(e,a))})}}}]);
m.directive("ngBindOnce",[function(){return{link:function(a,c,b){c.addClass("ng-binding").data("$binding",b.ngBindOnce);a=a.$eval(b.ngBindOnce)||"";c[0].textContent=a.toString()}}}]);m.directive("ngBindHtmlOnce",["$sce","clientOptions",function(a,c){return{link:function(b,e,d){e.addClass("ng-binding").data("$binding",d.ngBindHtmlOnce);c.reflectUrlsInHrefs(e);e.html(a.getTrustedHtml(b.$eval(d.ngBindHtmlOnce))||"")}}}]);var d=function(a,c,b){m.directive(a,["$compile","$filter","$injector","auth","navigation",
function(e,d,f,h,k){var n=T("You don't have permission to see this amount"),D=f.invoke(c.render),l=d("currencySymbol");return{restrict:"A",compile:function(c,g){c.addClass("notranslate amount");var d={};d.showNullAsZero="ngAmountShowNullAsZero"in g;return function(c,g,f){var k,p;d.hideDecimalWhenInteger=c.isSet(f.ngAmountHideCents);var z=function(a,q){if(!(a===p&&q===k)){p=a;k=q;var z=c.$eval(f.ngAmountCurrency)||c.processorCurrency||q;b=b||"viewAmounts";q&&!h.permissions.can(b,q)?(z=l(z,"short"),
e('<span ng-tip="'+n+'">'+z+"?</span>")(c,function(a){g.empty().append(a)}),g.addClass("amount-hidden")):(z=D(c,f,p,q,z,d),g.text(z),g.addClass("amount-visible"),g.toggleClass("negative",0>p))}};c.$watch(f[a],function(b){z(b,c.$eval(f[a+"Company"])||c.company||null)});_.isUndefined(f[a+"Company"])||c.$watch(f[a+"Company"],function(b){z(c.$eval(f[a]),b||null)})}}}}])},a={render:["$filter",function(a){var c=a("amount");return function(a,e,d,f,h,q){return c(d,h,q.hideDecimalWhenInteger,!0,q.showNullAsZero)}}]};
d("ngAmount",a);d("ngInvoiceAmount",a,"viewInvoiceAmounts");d("ngAmountRate",{render:["$filter",function(a){var c=a("percentage");return function(a,e,d){return c(d)}}]});m.directive("ngFloatInput",function(){return{priority:1,require:"ngModel",link:function(a,c,b,e){a.$eval(b.ngFloatInput);var d=b.ngFloatInputMaxDigits?a.$eval(b.ngFloatInputMaxDigits):null,f=b.ngFloatInputDecimalPlaces?a.$eval(b.ngFloatInputDecimalPlaces):null,h;if(c=b.ngFloatInputMin||b.min){var k=a.$eval(c);h=function(a){e.$setValidity("min_value",
a>=k)}}var n;if(b=b.ngFloatInputMax||b.max){var D=a.$eval(b);n=function(a){e.$setValidity("max_value",a<=D)}}e.$parsers.push(function(a){"."===a&&(a="");if(null!==f){var b=a.indexOf(".");-1!==b&&a.length-(b+1)>f&&(a=a.slice(0,b+1)+a.slice(b+1,b+1+f))}null!==d&&(b=d,_.startsWith(a,"-")&&(b+=1),_.contains(a,".")&&(b+=1),a.length>b&&(a=a.substring(0,b)));b=parseFloat(a);if(isNaN(b))return a;h&&h(b);n&&n(b);return b})}}});m.directive("ngBooleanSelect",function(){return{priority:1,require:"ngModel",link:function(a,
c,b,e){e.$parsers.push(function(a){return _.contains([!0,"True","true","1"],a)?!0:_.contains([!1,"False","false","0"],a)?!1:a});e.$formatters.push(function(a){return!0===a?"True":!1===a?"False":a})}}});m.directive("ngIntInput",["$parse","d",function(a,c){return{require:"ngModel",priority:1,compile:function(b,e){var d=a(e.ngIntInputMin),f=a(e.ngIntInputMax);return function(a,b,e,h){if(a.isSet(e.ngIntInput)){var l=_.isUndefined(e.ngIntInputAllowEmpty)||a.isSet(e.ngIntInputAllowEmpty);c.restrictKeypresses(b,
/[-0-9]/);h.$parsers.push(function(b){var e=d(a),c=f(a);if(""===b)return l?b:0;var g=parseInt(b,10);if(isNaN(g))return b;_.isUndefined(e)||(g<e&&(g=e),h.$setValidity("min",!0));_.isUndefined(c)||(g>c&&(g=c),h.$setValidity("max",!0));return g});b.on("blur",function(){k(h)})}}}}}]);m.directive("ngLoadTime",["$window",function(a){return{restrict:"A",link:function(){console.info("ng-load-time",(new Date-a.$$loadTime)/1E3)}}}]);m.directive("ngPlaceholder",[function(){return function(a,c,b){b.$observe("ngPlaceholder",
function(a){c.attr("placeholder",a);if("SELECT"===c[0].nodeName){var b=c.children("option").first();b.text()||(b.attr("label",a),b.text(a))}else a&&c.placeholder()})}}]);m.directive("ngDatepicker",["$parse","d","localization","moment","Pikaday",function(a,c,b,e,d){return{require:"ngModel",priority:1,restrict:"A",compile:function(b,f){var h=a(f.ngDatepickerYearRange),n=a(f.ngDatepickerMinDate);return function(a,b,q,v){var m=a.isSet(q.ngDatepickerAllowEmpty),u=e.localeData().longDateFormat("L"),J=a.company&&
a.company.features?a.company.features.isSundayBased:!0;_.isUndefined(f.ngDatepickerSundayBased)||(J=a.isSet(f.ngDatepickerSundayBased));var x=$(b),t=_.replaceAll(u,/[a-zA-Z]/,"");c.restrictKeypresses(b,RegExp("[0-9]|/|["+t+"]"));var B=function(a,b){var c=e(a,b);return!c||!c.isValid()?m?"":e():c},J={field:x[0],format:u,onSelect:function(){a.$apply(function(){v.$setViewValue(M.toString())})},minDate:n,yearRange:h,onOpen:function(){var a=B(v.$modelValue,"YYYY-MM-DD");a&&M.setMoment(a)},firstDay:J?0:
1,i18n:{previousMonth:T("Previous Month"),nextMonth:T("Next Month"),months:[T("January"),T("February"),cT("the month of March","March"),T("April"),cT("the month of May","May"),T("June"),T("July"),T("August"),T("September"),T("October"),T("November"),T("December")],weekdays:[T("Sunday"),T("Monday"),T("Tuesday"),T("Wednesday"),T("Thursday"),T("Friday"),T("Saturday")],weekdaysShort:[cT("Abbreviation of Sunday","Sun"),cT("Abbreviation of Monday","Mon"),cT("Abbreviation of Tuesday","Tue"),cT("Abbreviation of Wednesday",
"Wed"),cT("Abbreviation of Thursday","Thu"),cT("Abbreviation of Friday","Fri"),cT("Abbreviation of Saturday","Sat")]}},M=new d(J),Q=function(a,b,e){return(a=B(a,b))?a.format(e):""};v.$parsers.push(function(a){return Q(a,u,"YYYY-MM-DD")});v.$formatters.unshift(function(a){return Q(a,"YYYY-MM-DD",u)});!a.$eval(q.ngModel)&&!m&&(q=v.$pristine,v.$pristine=!1,v.$setViewValue(e().format(u)),v.$render(),v.$pristine=q);b.on("blur",function(){k(v)});a.$on("$destroy",function(){M.destroy()});n&&a.$watch(n,function(a){M.config({minDate:a?
a.toDate():void 0});a&&0>e(v.$modelValue,"YYYY-MM-DD").diff(a)&&(v.$modelValue=a.format("YYYY-MM-DD"),v.$$writeModelToScope(),k(v))})}}}}]);m.directive("ngTimepicker",["$parse","$timeout","d","localization","moment",function(a,c,b,e,d){return{require:"ngModel",restrict:"A",link:function(a,f,h,q){var n=e.current().TIME_FORMATS.default;h=e.current().SERVER_TIME_FORMAT;var l=$(f);b.restrictKeypresses(f,/[0-9]|[:amp]/);var p=l.timepicker({timeFormat:h});f.on("selectTime",function(){a.$safeApply(function(){var a=
p.val();a!==q.$viewValue&&q.$setViewValue(a)})});var m=function(a,b,e){b=d(a,b);return!a||!b||!b.isValid()?"":b.format(e)};q.$parsers.push(function(a){return m(a,n,"HH:mm")});q.$formatters.unshift(function(a){var b=m(a,"HH:mm",n);c(function(){p.timepicker("setTime",b)});return b});f.on("blur",function(){k(q)});a.$on("$destroy",function(){p.timepicker("remove")})}}}]);m.directive("ngInternationalPhoneField",["$compile","$parse","$timeout","auth","localization","models","navigation",function(a,c,b,
e,d,f,h){return{require:"ngModel",restrict:"A",link:function(f,k,n,l){var p=c(n.ngModel),v=c(n.ngInternationalPhoneFieldPhoneCountryModel),p=p(f),m=v(f),u=$(k);k=f.$eval(n.ngInternationalPhoneFieldCountries)||[];var J=function(){return u.intlTelInput("getSelectedCountryData")},x=function(){var b=J(),e=u.siblings(".flag-container").find(".selected-flag");e.attr("ng-tip",function(){return T("Country Code")+(_.isEmpty(b)?"":": +"+b.dialCode+" "+b.name)}).attr("ng-tip-classes","tip-indent").attr("title",
null);a(e)(f)},t=_.map(k,function(a){return a[0].toLowerCase()}),B=function(a){a=a?a.toLowerCase():"";return _.contains(t,a)},M=function(a){b(function(){v.assign(f,a.toUpperCase())},0)};k=[];if(1<t.length){e.currentUser.isAuthenticated||k.push(d.browser.ACCEPT_LANGUAGE_COUNTRY_CODE.toLowerCase());n=h.currentCompany;var Q=n.country;if("US"===n.processorCountry||!n.country)Q=n.processorCountry;k.push(Q.toLowerCase());k=_.uniq(k);k=_.filter(k,function(a){return B(a)})}var H="";m&&B(m)?H=m.toLowerCase():
p||(k.length?H=k[0]:t.length&&(H=t[0]));u.intlTelInput({autoPlaceholder:"off",formatOnDisplay:!1,onlyCountries:t,preferredCountries:k,initialCountry:H});M(H);x();p&&u.intlTelInput("setNumber",p);f.$watch(v,function(a,b){u.parents(".international-phone-field").toggleClass("no-country",!a);if(a!==b)if(!a||B(a)){var e=a,e=e?e.toLowerCase():"";u.intlTelInput("setCountry",e)}else M(H)});u.on("countrychange",function(){f.$safeApply(function(){var a;a=J();a=!a||!a.iso2?"":a.iso2.toUpperCase();M(a);l.$setDirty();
l.$setViewValue(u.val());x()})});u.on("open:countrydropdown",function(){f.$safeApply(function(){var a=u.siblings(".flag-container").find(".country-list");a.length&&!a.hasClass("tb-flyout")&&a.addClass("tb-flyout")})});f.$on("$destroy",function(){u.intlTelInput("destroy")})}}}]);m.directive("ngSlideshow",["$animate","$compile","$templateCache","$timeout",function(a,c,b,e){return{restrict:"A",controller:["$scope","$element","$attrs",function(b,e,c){var g=b.$eval(c.ngSlideshowDelay)||4500,d,f,l=this;
l.isPlaying=!1;l.slides=[];l.currentSlide=null;l.addSlide=function(a){a={element:a};l.slides.push(a);return a};l.removeSlide=function(a){l.slides[f]===a&&(f+=1,f>=l.slides.length&&(f=0));_.overwriteWithout(l.slides,a);l.slides[f]||(f=void 0)};l.showSlide=function(b){if(l.slides.length){var e=_.indexOf(l.slides,b);0>e||(!_.isUndefined(f)&&l.slides[f]!==b&&(b=l.slides[f],l.currentSlide=null,a.removeClass(b.element,"slideshow-showing")),f=e,e=l.slides[f],l.currentSlide=e,a.addClass(e.element,"slideshow-showing"),
l.isPlaying&&l.play())}};l.next=function(){var a;_.isUndefined(f)?a=0:(a=f+1,a>=l.slides.length&&(a=0));l.showSlide(l.slides[a])};l.previous=function(){var a;_.isUndefined(f)?a=0:(a=f-1,0>a&&(a=l.slides.length-1));l.showSlide(l.slides[a])};l.pause=function(){a.removeClass("slideshow-playing");a.addClass("slideshow-paused");clearTimeout(d);l.isPlaying=!1};var h=function(){b.$safeApply(function(){d=null;l.slides.length&&l.next()})};l.play=function(a){l.isPlaying=!0;d&&clearTimeout(d);d=setTimeout(h,
a?0:g)}}],link:function(a,e,d,f){d=b.get("slideshow-dots");var h=b.get("slideshow-arrows");a=a.$new();a.slideshow=f;e.append(c(d)(a));e.append(c(h)(a));f.play(!0)}}}]);m.directive("ngSlideshowSlide",[function(){return{restrict:"A",require:"^ngSlideshow",link:function(a,c,b,e){c.addClass("slideshow-slide");e.slides.length||c.addClass("slideshow-showing");var d=e.addSlide(c);a.$on("$destroy",function(){e.removeSlide(d)})}}}]);m.directive("ngDiff",["diff",function(a){return{restrict:"A",link:function(c,
b,e){var d=c.$eval(e.ngDiff);c=c.$eval(e.ngDiffWith);if(_.isUndefined(d)||null===d)d="";if(_.isUndefined(c)||null===c)c="";b.addClass("diff");_.forEach(a.diffWords(c,d),function(a){var e=$("<span />");a.added?e.addClass("diff-added"):a.removed?e.addClass("diff-removed"):e.addClass("diff-unchanged");e.text(a.value);b.append(e)})}}}]);m.directive("ngMarkdownFileUpload",["$timeout","fileuploader","flash",function(a,c,b){return{require:"ngModel",restrict:"A",link:function(e,d,f,h){var k,n=_.first(d);
d.bind("keyup click",function(){_.isUndefined(n.selectionStart)||(k=n.selectionStart)});var m=d.parents(f.ngMarkdownParent).first(),l=f.ngMarkdownFileUpload;a(function(){m.find(l).on("click",function(){c.uploadAsMarkdown().then(function(a){if(a){var e=h.$viewValue||"",c=_.isUndefined(k)?e.length:k,g=e.substr(0,c);g&&!g.match(/\s$/)&&(g+="\n");(e=e.substr(c))&&!e.match(/^\s/)&&(e="\n"+e);h.$setViewValue(g+a+e);h.$render();b.success(T("Uploaded file"))}},function(){b.error(T("File was not uploaded, please try again"))})})})}}}]);
m.directive("ngMarkdownBulkFileUpload",["events","fileuploader","flash",function(a,c,b){return{restrict:"A",link:function(e,d,f){var h=f.ngMarkdownBulkFileUpload?"ngMarkdownBulkFileUpload."+f.ngMarkdownBulkFileUpload:null;d.on("click",function(){c.uploadAsMarkdown().then(function(e){e&&(a.broadcast(h,e),b.success(T("Uploaded file")))})})}}}]);m.directive("ngMarkdownBulkFileUploadChild",["events",function(a){return{restrict:"A",require:"ngModel",link:function(c,b,e,d){a.on(c,e.ngMarkdownBulkFileUploadChild?
"ngMarkdownBulkFileUpload."+e.ngMarkdownBulkFileUploadChild:null,function(a,b){if(b){var e=d.$viewValue||"",c=b;e&&(c=e+"\n"+b);d.$setViewValue(c);d.$render()}})}}}]);m.directive("ngMarkdownPreview",["$sanitize","Showdown",function(a,c){return{require:"ngModel",restrict:"A",link:function(b,e,d,f){var h=new c.converter;b=e.parents(d.ngMarkdownParent).first();e=b.find(d.ngMarkdownPreview);var k=b.find(d.ngMarkdownPreviewResult);e.on("click",function(){var b="",e=f.$viewValue;e&&(b=h.makeHtml(_.escape(e).replace("&gt;",
">")));k.html(a(b))})}}}]);m.directive("ngMarkdown",["$sanitize","Showdown",function(a,c){var b=new c.converter;return{restrict:"A",link:function(e,c,g,d){d=function(e){var g="";e&&(g=b.makeHtml(_.escape(e).replace("&gt;",">")));c.html(a(g))};e.isSet(g.ngMarkdownOnce)?d(e.$eval(g.ngMarkdown)):e.$watch(g.ngMarkdown,_.debounce(d,250,{maxWait:1250}))}}}]);m.directive("ngMailcheck",["Mailcheck",function(a){return{restrict:"A",scope:{email:"=ngMailcheck"},template:'<a ng-show="suggestedEmail">'+T("Did you mean")+
" <b>[[ suggestedEmail ]]</b>?</a>",link:function(c,b,e,d){c.suggestedEmail="";c.$watch("email",function(b){b?a.run({email:b,suggested:function(a){c.suggestedEmail=a.full},empty:function(){c.suggestedEmail=""}}):c.suggestedEmail=""});b.on("click",function(){c.email=c.suggestedEmail})}}}]);d=function(a){return m.directive(a.name,[function(){return{restrict:"A",link:function(c,b,e){b="$"+a.name;var d=c[b],f;d&&(f=d.isEnabled,d.isEnabled=!1);if(c.hasOwnProperty(b))throw Error("lib.directives: multiple copies of "+
a.name+" modifier in same scope");var h={isEnabled:!0};c[b]=h;var k=$(a.selector),n=a.get(k),m=n;e.$observe(a.name,function(b,c){h.isEnabled&&(m=b,a.set(k,b,c))});c.$on("$destroy",function(){a.set(k,n,m);d&&(d.isEnabled=f)})}}}])};d({name:"ngTitle",selector:"title",get:function(a){return document.title},set:function(a,c){return document.title=c}});d({name:"ngMetaViewport",selector:'meta[name="viewport"]',get:function(a){return a.attr("content")},set:function(a,c){return a.attr("content",c)}});m.directive("ngBodyClass",
[function(){return{restrict:"A",link:function(a,c,b){var e=$("body"),d="";a.$watch(function(){var c=a.$eval(b.ngBodyClass);return _.isObject(c)?_.mapObject(c,function(a){return!!a}):c},function(a){e.removeClass(d);var b="";_.isObject(a)?_.forEach(a,function(a,c){a&&(b+=c+" ")}):b=a;e.addClass(b);d=b},!0);a.$on("$destroy",function(){e.removeClass(d)})}}}]);m.directive("ngBodyClassOnce",[function(){return{restrict:"A",link:function(a,c,b){c=$("body");a=a.$eval(b.ngBodyClassOnce);var e="";_.isObject(a)?
_.forEach(a,function(a,b){a&&(e+=b+" ")}):e=a;c.addClass(e)}}}]);m.directive("ngInline",["$templateCache",function(a){return{restrict:"A",priority:400,compile:function(c,b){var e=b.ngInline,d=a.get(e);d?c.html(d):console.warn("ng-inline: invalid template",e)}}}]);m.directive("ngLink",["$compile","$templateCache",function(a,c){var b={};return{restrict:"A",priority:400,link:function(e,d,f){if(f=e.$interpolate(f.ngLink)){var h=b[f];if(!h){h=c.get(f);if(!h){console.warn("ng-link: invalid template",f);
return}h=a(h);b[f]=h}h(e,function(a){d.empty().append(a)})}else console.warn("ng-link: invalid template name",f)}}}]);m.directive("ngLoad",["$compile","$http","$templateCache",function(a,c,b){return{restrict:"A",priority:400,compile:function(e,d){var f="/"+d.ngLoad,h=b.get(f);if(h)console.info("ng-load: compiled load",f),e.html(h);else{(h=b.get("ng-load-spinner"))&&e.html(h);var k;return function(e,d,l){var h=function(){k(e,function(a){d.empty().append(a)})};l=function(c){c=c.data;b.put(f,c);console.info("ng-load: downloaded load",
f);k=a(c);h()};k?(console.info("ng-load: linked load",f),h(e,d)):c.get(f).then(null,function(){console.error("ng-load: unable failed to load, retrying...",f);return c.get(f)}).then(l,function(){console.error("ng-load: unable to load",f);var c=b.get("ng-load-error");d.empty().append(a(c)(e))})}}}}}]);m.directive("ngNewTransportation",["$parse",function(a){return{restrict:"A",require:"^?form",controller:"lib.shared.NewTransportationCtrl",link:{pre:function(a,b,c,d){if(d){d.$setValidity("loading-transportation",
!1);var f=a.$watch("newTransportationCtrl.status",function(a){if("success"===a||"error"===a)d.$setValidity("loading-transportation",!0),f()});a.$on("$destroy",function(){d.$setValidity("loading-transportation",!0)})}}}}}]);m.directive("ngDebug",[function(){return{restrict:"A",link:function(a,c,b){debugger}}}]);m.directive("ngLog",[function(){return{restrict:"A",link:function(a,c,b){console.log("ng-log: link",a.$eval(b.ngLog));a.$on("$destroy",function(){console.log("ng-log: $destroy",a.$eval(b.ngLog))})}}}]);
m.directive("ngCurrentBlock",["$parse",function(a){return{restrict:"A",link:function(c,b,e){var d=a(e.ngCurrentBlockBlocks);c.$watch(e.ngCurrentBlockAffiliation,function(a){var b;a&&(b=d(c),b=_.find(b,function(b){return b.affiliation===a}));c.currentBlock=b})}}}]);m.directive("ngStartBooking",["navigation","postBook",function(a,c){return{priority:-1,restrict:"A",link:function(b,e,d){e.on("click",function(){b.$apply(function(){var e;e=d.ngStartBooking?b.$interpolate(d.ngStartBooking):a.url;c.startBooking(e)})})}}}]);
m.directive("ngDump",["$parse",function(a){return{restrict:"A",link:function(c,b,e){var d=a(e.ngDump);console.log("ng-dump: link",d(c));c.isSet(e.ngDumpWatch)&&c.$watch(function(){console.log("ng-dump: $watch",d(c))})}}}]);m.directive("ngQrCode",["$interpolate","QRCode",function(a,c){return{restrict:"A",compile:function(b,e){var d=a(e.ngQrCode);return function(a,b){var e=d(a);new c(b[0],{text:e,width:256,height:256,colorDark:"#000000"})}}}}]);m.directive("ngModelDependencies",["$parse",function(a){return{restrict:"A",
controller:function(){var a=this;a.dependents=[];a.addDependent=function(b){a.dependents.push(b)}},compile:function(c,b){var e=a(b.ngModelDependencies);return function(a,b,c,d){a.$watch(e,function(a){a?b.prop("disabled",!1):(b.prop("disabled",!0),_.forEach(d.dependents,function(a){a(!1)}))})}}}}]);m.directive("ngModel",["$parse",function(a){return{require:"^?ngModelDependencies",link:function(c,b,e,d){if(d){console.info("adding dependent",e.ngModel);var f=a(e.ngModel);d.addDependent(function(a){return f.assign(c,
a)})}}}}]);m.directive("ngModelIgnore",[function(){return{restrict:"A",require:"ngModel",link:function(a,c,b,e){e.$setPristine=_.ignore;e.$pristine=!1}}}]);m.directive("ngSelectAll",["$parse",function(a){return{restrict:"A",templateUrl:"ng-select-all",scope:!0,compile:function(c,b){var e=a(b.ngSelectAll),d=a(b.ngSelectAllModel),f=b.ngSelectAllWhen?a(b.ngSelectAllWhen):_.always,h=a(b.ngSelectAllDefaults),k=a(b.ngSelectAllDefaultField);return function(a,c,g){var q=function(g){if(!c.parents("fieldset[disabled]").length){var h=
e(a);_.forEach(h,function(b){var c={$element:b};f(a,c)&&d.assign(a,g(b),c)});(h=a.$eval(b.ngSelectAllCallback))&&h()}};a.selectText=a.$interpolate(g.ngSelectAllText);a.selectAll=_.bind(q,null,_.constant(!0));a.selectNone=_.bind(q,null,_.constant(!1));a.allowDefaults=!!h(a);if(a.allowDefaults){var n=_.makeIteratee(k(a));a.selectDefaults=function(){var b=h(a);q(function(a){return!!b[n(a)]})}}}}}}]);m.directive("ngClearInput",["$parse",function(a){return{restrict:"A",compile:function(c,b){c.addClass("ng-clear-input");
var e=a(b.ngClearInput);return function(a,b,c){var d=_.isUndefined(c.ngClearInputRefocus)||a.isSet(c.ngClearInputRefocus);console.info("refocus",d);a.$watch(e,function(a){b.toggleClass("ng-hide",!a)});b.on("click",function(c){c.preventDefault();c.stopPropagation();d&&b.prev().focus();a.$apply(function(){e.assign(a,"")})})}}}}]);m.directive("ngDjangoField",["$parse",function(a){return{restrict:"A",compile:function(c,b){var e=a(b.ngDjangoField),d=a(b.ngDjangoFieldModel),f=_.isUndefined(b.ngDjangoFieldRequired)?
_.constant(!1):""===b.ngDjangoFieldRequired?_.constant(!0):a(b.ngDjangoFieldRequired),h=_.isUndefined(b.ngDjangoFieldDisabled)?_.constant(!1):a(b.ngDjangoFieldDisabled);return{pre:function(a,b){b.addClass("field")},post:function(a,b){a.$watch(function(){var b=e(a)||{},c=d(a),g=f(a),k=h(a),c=""===c||_.isUndefined(c);return{"ng-pristine":b.$pristine,"ng-dirty":b.$dirty,"ng-invalid":b.$invalid||c&&g,"ng-disabled":k,"ng-required":g}},function(a){var c=_.map(a,function(a,b){if(a)return b});a=_.map(a,function(a,
b){if(!a)return b});b.addClass(c.join(" ")).removeClass(a.join(" "))},!0)}}}}}]);m.directive("ngNoisyInvalidFields",[function(){return{restrict:"A",require:"ngNoisyInvalidFields",controller:["$scope",function(a){var c=this;c.isShowing=!1;var b=function(){$("body").toggleClass("noisy-invalid-fields",c.isShowing)};c.show=function(a){c.isShowing=_.isUndefined(a)?!0:a;b()};c.hide=function(){c.isShowing=!1;b()};a.$on("$destroy",function(){c.hide()})}],controllerAs:"noisyInvalidFieldsCtrl"}}]);m.directive("ngFiltered",
["$parse","$timeout",function(a,c){return{restrict:"A",scope:!0,controller:["$scope","$attrs","$element",function(b,e,d){var f=this;f.searchTerm="";f.isFiltering=!1;f.objects=[];f.reset=function(){h.assign(b,"");N("")};var h=a(e.ngFiltered),k=a(e.ngFilteredObjects),n;e.ngFilteredSearchDocument&&(n=a(e.ngFilteredSearchDocument));var m=!1;b.isSet(e.ngFilteredElements)&&(m=!0,k=function(){return d.find("[ng-filtered-element]")},n=function(a,b){var c=b.$obj.getAttribute("ng-filtered-element")||"";return b.$obj.innerText+
" "+c});var l=function(){_.forEach(d.find("[ng-filtered-element-group]"),function(a){a=$(a);var b=0<a.find("[ng-filtered-element]:not(.ng-hide)").length;a.toggleClass("ng-hide",!b)})},p=function(){var a=k(b);if(!f.searchTerm)return m&&(_.forEach(a,function(a){$(a).removeClass("ng-hide")}),_.forEach(d.find("[ng-filtered-element-group]"),function(a){$(a).removeClass("ng-hide")})),a;a=_.filter(a,function(a){var c;c=n?n(b,{$obj:a}):a;c=_.contains(c.toLowerCase(),f.searchTerm.toLowerCase());m&&$(a).toggleClass("ng-hide",
!c);return c});m&&l();return a},N=function(a){b.$safeApply(function(){f.searchTerm=a;f.isFiltering=!!f.searchTerm;c(function(){f.objects=p()})})},w=_.debounce(N,100);b.$watch(h,function(a){w(a)})}],controllerAs:"filteredCtrl"}}]);m.directive("ngNegateCheckbox",[function(){return{require:"ngModel",link:function(a,c,b,e){e.$parsers.push(function(a){return!a});e.$formatters.push(function(a){return!a})}}}]);m.directive("ngShortcutsOverlay",[function(){return{templateUrl:"lib.shortcutsOverlay"}}]);m.directive("ngSvg",
["$document",function(a){return{replace:!0,template:function(c,b){var e=a[0].getElementById(b.ngSvg);return!e?(console.warn("ng-svg: unable to find svg:",b.ngSvg),"<span></span>"):(new XMLSerializer).serializeToString(e)}}}]);m.directive("ngHoursBeforeMidnight",["$parse",function(a){return{restrict:"A",templateUrl:"ng-hours-before-midnight",controllerAs:"hoursBeforeMidnightCtrl",controller:["$scope","$attrs",function(c,b){var e=this,d=a(b.ngHoursBeforeMidnight);c.$watch(d,function(a){if(!(_.isUndefined(a)||
""===a)){var b=moment().startOf("day").subtract(a,"hours");a=Math.ceil(a/24);e.time=b;e.days=a}})}]}}]);d=function(a,c){m.directive(a,["cache","clientOptions","db",function(b,e,d){return{restrict:"A",templateUrl:c,controllerAs:"itemPricingCtrl",controller:["$scope","$attrs",function(c,g){var f=this;f.status="loading";f.item=c.$eval(g[a]);if(f.item.isRetail||!f.item.company.features.isPriceEstimateEnabled||f.item.settings.isPriceEstimateHidden)f.status="hidden";else{var h=function(a){var c={};e.defaultTotalSheetPk?
c.totalSheetPk=e.defaultTotalSheetPk:e.defaultTotalSchedulePk&&(c.totalSchedulePk=e.defaultTotalSchedulePk);a&&(c.date=a.format("YYYY-MM-DD"));var g=d.item.pricingOverview({shortname:f.item.company.shortname,itemPk:f.item.pk},null,null,c,{flashError:!1});b.fresh(g)?(f.status=f.pricingOverview?"success":"loading",g.$promise.then(function(){f.pricingOverview=g;f.status="success"},function(a){f.pricingOverview=null;f.status=a&&404===a.status?"success":"error"})):(f.status="success",f.pricingOverview=
g)},k=g[a+"Date"];k?c.$watch(k,function(a){h(a)}):h()}}]}}])};d("ngItemPricingEstimate","ng-item-pricing-estimate");d("ngItemPricingSummary","ng-item-pricing-summary");m.directive("ngGallery",[function(){return{require:"A",controllerAs:"galleryCtrl",controller:["$scope","$element","$attrs",function(a,c,b){var e=this,d,f,h=function(){var a=e.objects.indexOf(d),b=c.find("[ng-gallery-selects]"),a=c.find("[ng-gallery-select]")[a];b.length&&a&&b.stop().animate({scrollLeft:a.offsetLeft-a.clientWidth/2})},
k=function(b){if(e.isAutoAdvance||b)b=e.objects.indexOf(d),b=(b+1)%e.objects.length,d=e.objects[b],a.$safeApply(),h()},n=function(a){clearInterval(f);a&&k();f=setInterval(function(){k()},4E3)};e.isAutoAdvance=a.isSet(b.ngGalleryAutoAdvance);e.objects=a.$eval(b.ngGallery)||[];b=a.$eval(b.ngGalleryPreselect)||0;d=e.objects[b];e.isSelected=function(a){return d===a};e.select=function(a){d=a;h()};e.isPaused=!1;e.pause=function(a){a||(e.isPaused=!0);clearInterval(f)};e.unpause=function(a){if(!e.isPaused||
!a)e.isPaused=!1,n(!a)};e.next=function(){k(!0)};c.on("mouseenter",function(){e.pause(!0)});c.on("mouseleave",function(){e.unpause(!0)});n()}]}}]);m.directive("ngGalleryOverlay",[function(){return{require:"A",controllerAs:"galleryOverlayCtrl",controller:["$scope","$attrs",function(a,c){var b=this;b.isShowing=!1;b.show=function(a){b.isShowing=!0;b.preselectIndex=0;a&&(b.preselectIndex=b.objects.indexOf(a),b.preselectIndex=-1===b.preselectIndex?0:b.preselectIndex)};b.hide=function(){b.isShowing=!1};
b.objects=a.$eval(c.ngGalleryOverlay)}]}}]);m.directive("ngGalleryOverlayContent",[function(){return{restrict:"A",require:"ngGalleryOverlay",templateUrl:"ng-gallery-overlay-content"}}])})();
(function(){var m=angular.module("lib.filters",["lib.services"]);m.factory("filterFields",[function(){var c=[void 0,"",null,[],{}],k=function(d){return _.any(c,function(c){return _.isEqual(c,d)})};return{EMPTY_VALUES:c,isEmpty:k,isSet:function(c,h){return k(h)?!k(c):_.isArray(c)&&_.isArray(h)?!_.isEqual(c.sort(),h.sort()):!_.isEqual(c,h)}}}]);m.filter("isNumber",[function(){return _.isNumber}]);m.filter("isBoolean",[function(){return _.isBoolean}]);m.filter("humanize",["convert",function(c){return c.humanize}]);
m.filter("indexOf",[function(){return _.indexOf}]);m.filter("percentage",["localization",function(c){return function(k,d,h,f){_.isUndefined(h)&&(h=1);var n=c.current();if(h)k=k?k/h:0;else return n.formatPercentage(1,0,!d);f?_.isNumber(f)||(f=0):f=5;return n.formatPercentage(k,f,!d)}}]);m.filter("percentageFromPercentage",["$filter",function(c){return function(k,d,h,f){return c("percentage")(k/100,d,h,f)}}]);m.filter("cssPercentage",[function(){return function(c){if(_.isUndefined(c))return"";c=Math.floor(1E4*
c)/100;return c+"%"}}]);m.filter("pluralize",[function(){return function(c,k,d){d=d||"s";k=k||"";c=parseInt(c||"0",10);c=isNaN(c)?0:c;return 1===c?k:d}}]).filter("capitalize",[function(){return function(c){return _.capitalize(c)}}]).filter("lowercase",[function(){return function(c){return c.toLowerCase()}}]).filter("uppercase",[function(){return function(c){return c.toUpperCase()}}]).filter("bracketWrap",[function(){return function(c){return"["+c+"]"}}]).filter("aOrAnBefore",[function(){var c=/[aeiouAEIOU]/;
return function(k,d){return(k&&c.test(k.charAt(0))?d?"An":"an":d?"A":"a")+" "+k}}]).filter("css",[function(){return function(c){c=(c||"").replace(/\s+/g,"-");c=c.replace(/-+/g,"-");c=c.replace(/[^-\w]/g,"");return c.toLowerCase()}}]).filter("addClassIf",[function(){return function(c,k,d){return c?k||"":d||""}}]).filter("addClasses",[function(){return function(c){var k=[];_.forEach(c,function(c,h){c&&k.push(h)});return k.join(" ")}}]).filter("isDefined",[function(){return function(c){return!_.isUndefined(c)}}]).filter("isUndefined",
[function(){return function(c){return _.isUndefined(c)}}]).filter("map",[function(){return function(c,k){return _.map(c,k)}}]).filter("any",[function(){return _.any}]).filter("keys",[function(){return _.keys}]).filter("exclude",[function(){return function(c,k){return _.filter(c,function(c){return!k(c)})}}]).filter("colonless",[function(){var c=/:+\s*$/;return function(k){return(k||"").replace(c,"")}}]).filter("commaSeparated",[function(){return function(c){return!c?"":_.filter(c).join(", ")}}]).filter("replaceAll",
[function(){return _.replaceAll}]).filter("ageInYears",[function(){return function(c){return moment().diff(c,"years")}}]).filter("get",[function(){return _.get}]).filter("pluck",[function(){return _.pluck}]).filter("compactObject",[function(){return _.ref.compactObject}]);m.factory("localization",["$browser","$window","auth","convert","db","models","moment","navigation",function(c,k,d,h,f,n,a,q){a.locale("en-us");var g=f.slipstream("unitsLanguageFormats"),b=f.slipstream("unitsLanguageCodes"),e=function(a){if(!a)return"";
a=a.toLowerCase().match(/^([a-z]{2}-)?([a-z]{2})$/);if(!a||3!==a.length)return"";a=a[2];if(!a)return"";a=a.toUpperCase();return _.contains(n.Company.COUNTRY_CODES,a)?a:""};k.ldmlnum.round=_.roundHalfToEven;var z=function(a){g[a]||(console.warn("localization: unsupported language",a),a="en-us");var b=g[a],c=T("Today"),e=_.extend({"export":"MM/YYYY"},b.client.month),d=_.extend({"default":b.client.date.short,"export":"YYYY-MM-DD"},b.client.date);k.ldmlnum.locale.xx=k.ldmlnum.locale(b.groupSymbol,b.decimalSymbol,
b.plusSignSymbol,b.minusSignSymbol);var f=k.ldmlnum(b.decimalPattern,"xx"),h=k.ldmlnum(b.currencyPattern,"xx"),l=k.ldmlnum(b.percentPattern,"xx"),n=RegExp("\\"+b.decimalSymbol+"0+");return{language:a,formatNumber:f,formatCurrency:function(a,b,c){b=b||"";b=h(a).replace("\u00a4\u00a4\u00a4",b).replace("\u00a4\u00a4",b).replace("\u00a4",b);_.isInteger(a)&&c&&(b=b.replace(n,""));return b},formatPercentage:function(a,c,e){c=l(a,c);e&&(0<a&&-1===c.indexOf(b.plusSignSymbol))&&(c=b.plusSignSymbol+c);return c},
PERCENT_SYMBOL:b.percentSymbol,VALID_DATETIME_FORMATS:"default short shortNoYear shortFullYear dayWithMonthAbbr long longNoYear export input".split(" "),TIME_SEPARATOR:b.timeSeparator,HTML_TIME_SEPARATOR:b.htmlTimeSeparator,RANGE_SEPARATOR:" - ",HTML_RANGE_SEPARATOR:"<br/>- ",TODAY:c,DAY_FORMAT:"dddd",DAYS_FORMATS:{"default":"[[ days ]] [days]"},ALL_DAY_FORMATS:{"default":"[All day]"},MONTH_FORMATS:e,DATE_FORMATS:d}};c=(f.slipstream("acceptLanguage")||"").split(",");c=c.length?_.find(c,function(a){return!!e(a)}):
"";var v=e(c),r="",m={},s=function(a,b,c){c=c||{};c.server&&c.topOfHour&&console.error("localization: unsupported use of `server` and `topOfHour` options in `__getTimeFormat()");var e;c.server?(e="server",c="exact"):(e="client",c=c.topOfHour?"topOfHour":"exact");var d=g[a];if(d){var f=d[e];if(f)if(f=f.time)if(f=f[c]){b=b||d[e].time[c].default;if(d=f.values)return(d=d[h.camelKey(b)])||console.warn("localization: failed to identify time format for:",a,e,"time",c,"values",b),d;console.warn("localization: failed to identify time format for:",
a,e,"time",c,"values")}else console.warn("localization: failed to identify time format for:",a,e,"time",c);else console.warn("localization: failed to identify time format for:",a,e,"time");else console.warn("localization: failed to identify time format for:",a,e)}else console.warn("localization: failed to identify time format for:",a)},D=n.Company,l=function(a,b){b=b||{};b.server&&b.topOfHour&&console.error("localization: unsupported use of `server` and `topOfHour` options in `__fallbackTimeFormat()");
return a===D.TWENTY_FOUR_HOUR_TIME_FORMAT_TYPE?b.server?D.FALLBACK_SERVER_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:b.topOfHour?D.FALLBACK_CLIENT_TOP_OF_HOUR_TWENTY_FOUR_HOUR_TIME_FORMAT:D.FALLBACK_CLIENT_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:b.server?D.FALLBACK_SERVER_EXACT_TWELVE_HOUR_TIME_FORMAT:b.topOfHour?D.FALLBACK_CLIENT_TOP_OF_HOUR_TWELVE_HOUR_TIME_FORMAT:D.FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT},p=function(a,b){var c;if(d.currentUser.isAuthenticated){c=d.currentUser.company.isAdmin&&q.currentCompany?
q.currentCompany:d.currentUser.company;var e;e=c.timeFormatType===D.COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE?s(c.language,void 0,b):s(c.language,c.timeFormatType,b);e||(console.warn("localization: falling back for time format type:",c.timeFormatType,b),e=l(c.timeFormatType,b));return e}if(q.currentCompany)return c=q.currentCompany,e=c.anonymousTimeFormatType===D.ANONYMOUS_USER_LOCALE_DEFAULT_TIME_FORMAT_TYPE?s(a,void 0,b):c.anonymousTimeFormatType===D.COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE?s(c.language,
void 0,b):s(c.language,c.anonymousTimeFormatType,b),e||(console.warn("localization: falling back for anonymous time format type:",c.anonymousTimeFormatType,b),e=l(c.anonymousTimeFormatType,b)),e;console.warn("localization: falling back to 12-hour time for an anonymous user with no current company");return D.FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT},N=function(a,b){if(_.contains(b,a))return a;var c=a.split("-")[0];if(_.contains(b,c))return c;for(var e=0,d=b.length;e<d;e++){var f=b[e],g=f.split("-")[0];
if(c===g)return f}};c={browser:{ACCEPT_LANGUAGE:c,ACCEPT_LANGUAGE_COUNTRY_CODE:v},setLanguageManuallyForAnonymousUser:function(a,c){var e;a:if(e=N(a,b),!e){if(c&&(e=N(c.language,b)))break a;e="en-us"}g[e]?(console.log("localization: manually setting units language for anonymous user",e,"based on target language",a),r=e):console.warn("localization: unsupported language",e)},current:function(){var b;b=!d.currentUser.isAuthenticated&&r?r:f.slipstream("unitsLanguage")||"en-us";m[b]=m[b]||z(b);var c=m[b];
a.locale(b);b={TIME_FORMATS:_.extend({"default":"h:mma","export":"hh:mma"},p(b)),TOP_OF_HOUR_TIME_FORMATS:_.extend({"default":"ha","export":"hh:mma"},p(b,{topOfHour:!0})),SERVER_TIME_FORMAT:p(b,{server:!0})};return _.extend({},c,b)}};c.current();return c}]);m.factory("dates",["$interpolate","localization",function(c,k){var d=k.current,h=function(a,b,e,d){var f=b[e.format]||b["default"];if(!f)return console.warn("dates: invalid date format",e.format,"valid formats",b),"";_.isUndefined(d)||(f=c(f)(d));
return!f?"":a.format(f)},f={format:"short",isRelative:!1,isRelativeTime:!1,isHtml:!1,endAt:null,hideDate:null},n=function(a,b,c,e){return e?b||"":b&&c?b+a+c:b||c},a=function(a,b){if(!moment.isMoment(a)||!moment.isMoment(b))return!1;var c=a.clone().startOf("day"),e=b.clone().startOf("day");return!c.diff(e)},q=function(a){var b=a.clone().startOf("day");return!a.diff(b)},g=function(a){var b=a.clone().startOf("hour");return!a.diff(b)},b=function(a,b){if(b.isRelative&&b.isRelativeTime){var c=moment(),
c=a.diff(c,"hours");if(b.isRelative&&0<=c&&6>c)return a.fromNow()}},e=function(a,c){c=c||f;var e=b(a,c);if(e)return e;if(c.endAt&&q(a)&&q(c.endAt)){e=Math.abs(c.endAt.diff(a,"days"));if(1<e)return h(a,d().DAYS_FORMATS,c,{days:e});if(1===e)return h(a,d().ALL_DAY_FORMATS,c)}return g(a)?h(a,d().TOP_OF_HOUR_TIME_FORMATS,c):h(a,d().TIME_FORMATS,c)},z=function(b,c){c=c||f;return c.isRelative&&a(b,moment())?d().TODAY:h(b,d().DATE_FORMATS,c)},v=function(c,g){g=g||f;if(g.endAt&&q(c)&&q(g.endAt))return z(c,
g);var h=z(c,g),k=b(c,g);if(k)return k;k=_.extend({},g);delete k.endAt;return(k=e(c,k))&&g.isHideDate&&a(c,g.hideDate)?k:n(d().TIME_SEPARATOR,h,k)};return{options:function(a){var b=_.extend({},f);_.contains(a,"short")?console.warn("date: unnecessary short format specifier"):_.find(d().VALID_DATETIME_FORMATS,function(c){if(_.contains(a,c))return b.format=c,!0});b.isRelative=_.contains(a,"relative");b.isRelativeTime=_.contains(a,"relative-time");b.isAlwaysHideDate=_.contains(a,"always-hide-date");b.isHideDate=
b.isAlwaysHideDate||_.contains(a,"hide-date");b.isHtml=_.contains(a,"html");b.is12amPlus1=_.contains(a,"12am+1");_.forEach(a,function(c){moment.isMoment(c)&&(b.endAt?b.isHideDate?b.hideDate=c:console.warn("date: extra moments",a,skipEndAt):b.endAt=c)});return b},isSameDay:a,isMidnight:q,isTopOfHour:g,getMonth:function(a,b){b=b||f;return h(a,d().MONTH_FORMATS,b)},getDay:function(b,c){c=c||f;return c.isRelative&&a(b,moment())?d().TODAY:h(b,d().DAY_FORMAT,c)},getDate:z,getDateRange:function(b,c,e){e=
e||f;if(a(b,c))return z(b,e);var g=e.isHtml?d().HTML_RANGE_SEPARATOR:d().RANGE_SEPARATOR;return n(g,z(b,e),z(c,e))},getTime:e,getRelativeTime:b,getTimeRange:function(a,b,c){c=c||f;var g=c.isHtml?d().HTML_RANGE_SEPARATOR:d().RANGE_SEPARATOR,l=Math.abs(a.diff(b,"days"));if(0===a.diff(b))return e(a,c);if(q(a)&&q(b))return 1<l?h(a,d().DAYS_FORMATS,c,{days:l}):h(a,d().ALL_DAY_FORMATS,c);c=null;return 0===l?n(g,e(a,c),e(b,c)):1===l?n(g,e(a,c),e(b,c)+" "+T("(next day)")):n(g,e(a,c),e(b,c)+" "+interpolate(T("(%(count)s days later)"),
{count:l.toString()}))},getDatetime:v,getDatetimeRange:function(b,c,g){g=g||f;if(0===b.diff(c))return v(b,g);var h=g.isHtml?d().HTML_RANGE_SEPARATOR:d().RANGE_SEPARATOR;if(q(b)&&q(c))return 1<Math.abs(b.diff(c,"days"))?(c=c.clone(),c.subtract(1,"days"),n(h,z(b,g),z(c,g))):g.isAlwaysHideDate&&a(b,g.hideDate)?e(b,g):z(b,g);var l;if(l=g.is12amPlus1)if(l=q(c)){l=b;var k=c;!moment.isMoment(l)||!moment.isMoment(k)?l=!1:(l=l.clone().startOf("day"),k=k.clone().startOf("day"),l=1===k.diff(l,"days"))}if(a(b,
c)||l){c=n(d().RANGE_SEPARATOR,e(b,g),e(c,g));l&&(c+="+1");if(g.isHideDate&&a(b,g.hideDate))return c;b=z(b,g);g=g.isHtml?d().HTML_TIME_SEPARATOR:d().TIME_SEPARATOR;return n(g,b,c)}g.isHideDate?(l=_.defaults({isHideDate:!1,hideDate:null},g),g=g.isAlwaysHideDate?g:l):g=l=g;return n(h,v(b,g),v(c,l))}}}]);m.filter("dateOffset",["moment",function(c){return function(k,d,h,f){if(!c.isMoment(k))return"";d=d||0;h=h||"minutes";k=k.clone();return f?k.add(d,h):k.subtract(d,h)}}]).filter("dateSubtract",["$filter",
function(c){return function(k,d,h){return c("dateOffset")(k,d,h,!1)}}]).filter("dateAdd",["$filter",function(c){return function(k,d,h){return c("dateOffset")(k,d,h,!0)}}]);m.filter("dateRange",["dates","moment",function(c,k){return function(d){var h=c.options(_.rest(arguments)),f=h.endAt;return!k.isMoment(d)||!k.isMoment(f)?(console.log("dateRange: invalid moments",d,f,h),""):c.getDateRange(d,f,h)}}]).filter("datetimeRange",["dates","moment",function(c,k){return function(d){var h=c.options(_.rest(arguments)),
f=h.endAt;return!k.isMoment(d)||!k.isMoment(f)?(console.log("datetimeRange: invalid moments",d,f,h),""):c.getDatetimeRange(d,f,h)}}]).filter("timeRange",["dates","moment",function(c,k){return function(d){var h=c.options(_.rest(arguments)),f=h.endAt;return!k.isMoment(d)||!k.isMoment(f)?(console.log("timeRange: invalid moments",d,f,h),""):c.getTimeRange(d,f,h)}}]).filter("date",["dates","moment",function(c,k){return function(d){_.isString(d)&&(d=k(d));var h=c.options(_.rest(arguments));return!k.isMoment(d)?
(console.log("date: invalid moment",d,h),""):c.getDate(d,h)}}]).filter("day",["dates","moment",function(c,k){return function(d){var h=c.options(_.rest(arguments));return!k.isMoment(d)?(console.log("day: invalid moment",d,h),""):c.getDay(d,h)}}]).filter("month",["dates","moment",function(c,k){return function(d){var h=c.options(_.rest(arguments));return!k.isMoment(d)?(console.log("day: invalid moment",d,h),""):c.getMonth(d,h)}}]).filter("datetime",["dates","moment",function(c,k){return function(d){var h=
c.options(_.rest(arguments));return!k.isMoment(d)?(console.log("datetime: invalid moment",d,h),""):c.getDatetime(d,h)}}]).filter("datetimeWithTimezone",["dates","moment",function(c,k){return function(d,h){var f=c.options(_.slice(arguments,2));if(!k.isMoment(d))return console.log("datetimeWithTimezone: invalid moment",d,h,f),"";if(!_.isString(h))return console.log("datetimeWithTimezone: invalid timezone",d,h,f),"";var n=k.tz(d.valueOf(),h);return c.getDatetime(n,f)}}]).filter("timeWithTimezone",["dates",
"moment",function(c,k){return function(d,h){var f=c.options(_.slice(arguments,2));if(!_.isString(h))return console.log("timeWithTimezone: invalid timezone",d,h,f),"";var n=k.tz(d.valueOf(),h);return c.getTime(n,f)}}]).filter("dateWithTimezone",["dates","moment",function(c,k){return function(d,h){var f=c.options(_.slice(arguments,2));if(!k.isMoment(d))return console.log("dateWithTimezone: invalid moment",d,h,f),"";var n=k.tz(d.valueOf(),h);return c.getDate(n,f)}}]).filter("time",["dates","moment",
function(c,k){return function(d){var h=c.options(_.rest(arguments));return!d||_.isString(d)&&(d=k(d,"HH:mm"),!k.isMoment(d))?"":c.getTime(d,h)}}]);m.filter("range",[function(){return function(c,k){return _.range(c,k)}}]);m.filter("safeHtml",[function(){return function(c){return c.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}}]);m.filter("firstLineOfMarkdown",[function(){var c=/^\s*$/,k=/^#+/,d=/([*_]{1,3})(\S.*?\S?)\1/;return function(h){if(!h)return"";h=_.find(h.split("\n"),function(d){return!c.test(d)})||
"";return _.trim(h.replace(k,"").replace(d,"$2").replace(d,"$2"))}}]);m.filter("encodeURIComponent",[function(){return function(c){return encodeURIComponent(c)}}]);m.filter("hostname",[function(){return function(c){if(!c)return"";var k=c.toLowerCase(),d=document.createElement("a");d.setAttribute("href",k);d=d.hostname;return!d||-1===k.indexOf(d)?c:d=d.replace(/^www./,"")}}]);m.filter("withLineBreaks",[function(){return function(c){return c.replace(/\n+/g,"\n<br />\n")}}]);m.factory("phoneNumbers",
[function(){var c=_.toTrueKeys([201,202,203,205,206,207,208,209,210,212,213,214,215,216,217,218,219,220,224,225,227,228,229,231,234,239,240,248,251,252,253,254,256,260,262,267,269,270,272,274,276,278,281,283,301,302,303,304,305,307,308,309,310,312,313,314,315,316,317,318,319,320,321,323,325,327,330,331,334,336,337,339,341,346,347,351,352,360,361,364,369,380,385,386,401,402,404,405,406,407,408,409,410,412,413,414,415,417,419,423,424,425,430,432,434,435,440,442,443,447,458,464,469,470,475,478,479,480,
484,501,502,503,504,505,507,508,509,510,512,513,515,516,517,518,520,530,531,534,539,540,541,551,557,559,561,562,563,564,567,570,571,573,574,575,580,582,585,586,601,602,603,605,606,607,608,609,610,612,614,615,616,617,618,619,620,623,626,627,628,629,630,631,636,641,646,650,651,657,659,660,661,662,667,669,678,679,681,682,689,701,702,703,704,706,707,708,712,713,714,715,716,717,718,719,720,724,725,727,730,731,732,734,737,740,743,747,754,757,760,762,763,764,765,769,770,772,773,774,775,779,781,785,786,801,
802,803,804,805,806,808,810,812,813,814,815,816,817,818,828,830,831,832,843,845,847,848,850,854,856,857,858,859,860,862,863,864,865,870,872,878,901,903,904,906,907,908,909,910,912,913,914,915,916,917,918,919,920,925,927,928,929,930,931,934,935,936,937,938,940,941,947,949,951,952,954,956,959,970,971,972,973,975,978,979,980,984,985,989]),k=function(c){return c?c.replace(/\D/g,""):""},d=function(c){return!c?"":("+"===c[0]?"+":"")+k(c)},h=/^\+?\d{5,15}$/,f=function(d){d=k(d);11===d.length&&"1"===d[0]&&
(d=d.slice(1));if(10===d.length){var a=d.slice(0,3);if(c[a])return{isUsPhoneNumber:!0,areaCode:a,exchange:d.slice(3,6),suffix:d.slice(6,10)}}return{isUsPhoneNumber:!1}};return{cleanPhoneNumber:d,digits:k,isPossiblyValid:function(c){return h.test(d(c))},parseUsPhoneNumber:f,formatUsPhoneNumber:function(c){c=c||"";if("+"===c[0])return c;var a=f(c);return!a.isUsPhoneNumber?c:"("+a.areaCode+") "+a.exchange+"-"+a.suffix}}}]);m.filter("phone",["navigation","phoneNumbers",function(c,k){return function(c){return k.formatUsPhoneNumber(c)}}]);
m.filter("contactPhone",["navigation",function(c){return function(k){if(k){var d=c.currentCompany,d=d.country||d.processorCountry;return!k.phoneCountry||k.phoneCountry===d?k.displayPhoneNational:k.displayPhoneInternational}}}]);m.filter("currencyClass",[function(){return function(c){return(c=_.resolveCurrency(c))?"currency--"+c:""}}]);m.filter("currencySymbol",["auth","db","localization",function(c,k,d){var h=k.slipstream("currencies");return function(f,k){f=_.resolveCurrency(f);var a=h[f];if(!a)return console.warn("currencySymbol filter: unsupported currency",
f),"";c.currentUser.isAuthenticated&&(k=c.currentUser.company.isAdmin?"long":"short");if("short"===k)return a.symbol;if("long"===k)return a.symbolLong;var q=a.symbolLongByLanguage;return(q?q[d.current().language]:"")||a.symbolLong}}]);m.filter("currencyDisplayName",["db","localization",function(c,k){var d=c.slipstream("currencies");return function(c,f){c=_.resolveCurrency(c);var k=d[c];return!k?(console.warn("currencyDisplayName filter: unsupported currency",c),""):"short"==f?k.displayName:k.displayNameLong}}]);
m.filter("amount",["$filter","db","localization","navigation",function(c,k,d,h){var f=k.slipstream("currencies"),n=c("currencySymbol");return function(a,c,g,b,e){e&&null===a&&(a=0);if(!_.isNumber(a))return"";_.isBoolean(c)&&_.isUndefined(b)&&(b=!g,g=c,c=null);c=_.resolveCurrency(c);c||(h.currentCompany?(console.warn("amount filter: not passed currency, falling back to currentCompany"),c=h.currentCompany.processorCurrency):(console.warn("amount filter: not passed currency, no currentCompany to fall back to"),
c="",b=!1));_.isUndefined(b)&&(b=!0);e=d.current();var k=f[c];k?k=k.decimalPlaces:(console.warn("amount filter: passed unsupported currency:",c),b=!1,k=2);a/=Math.pow(10,k);c=b?n(c,b):"";return e.formatCurrency(a,c,g)}}]);m.filter("count",["localization",function(c){return function(k,d){return null===k||void 0===k?"":c.current().formatNumber(k,d||4)}}]);m.filter("stripNewlines",[function(){return function(c){return c.replace(/\r|\n/g,"").replace(/\s+/g," ")}}]);m.filter("yesno",[function(){return function(c,
k,d){k=_.isUndefined(k)?"Yes":k;d=_.isUndefined(d)?"No":d;return c?k:d}}]);m.filter("name",[function(){return function(c,k,d){k=k||"";return _.isString(c)?c||k:_.isObject(c)?(c.shortName||c.name||c.unicode||k)+(c.isArchived&&!d?" ("+T("archived")+")":""):k}}]);m.filter("primaryImageUrl",[function(){return function(c){return c.imageCdnUrl||(c.images&&c.images.length?c.images[0].croppedCdnUrl:"")}}]);m.filter("availabilityOrItemImageUrl",[function(){return function(c){return c.availabilityHeadline&&
c.availabilityHeadline.imageCdnUrl?c.availabilityHeadline.imageCdnUrl:c.item.images&&c.item.images.length?c.item.images[0].croppedCdnUrl:c.item.imageCdnUrl||""}}]);m.filter("value",[function(){return function(c){return _.isString(c)?c:c.value}}]);m.filter("personalizeCollectedByText",["$filter","auth",function(c,k){var d=c("name");return function(c){return k.isCompanyUser(c)?T("Collected by you"):interpolate(T("Collected by %(companyName)s"),{companyName:d(c)})}}]);m.filter("lastNameFirst",[function(){return function(c){c=
c.split(/\s+/);var k=c.pop();c.length&&(k+=",");c.unshift(k);return c.join(" ")}}]);m.filter("initials",[function(){return function(c){c=c.split(/\s+/);return 1<c.length?c[0][0]+c[c.length-1][0]:c[0][0]||""}}]);m.filter("onlineStatusClass",[function(){return function(c){return!c?"":c.isBookableOnlyByPhone?"icon-ava-phone":c.isBookable&&c.isUnlisted?"icon-ava-unlisted":!c.isBookable&&(c.isResourcesAvailable||c.item.company.companyFeatures.isResourceBookableCapacityEnabled)?"icon-ava-lock":""}}]);m.filter("capacityIndicatorClass",
[function(){return function(c){var k=_.contains(arguments,"filled"),d=_.contains(arguments,"large")?"icon-user":"icon-user-small";return c.companyFeatures.isResourceBookableCapacityEnabled?k?"cb-square filled":"cb-square":k?d+" full":d+" empty"}}]);m.filter("blockedCapacityClass",[function(){return function(c,k){return 0===c?"ava-is-empty":c===k?"ava-is-full":c>k?"ava-is-overbooked":"ava-is-booked"}}]);m.filter("capacityClass",["models",function(c){return function(k,d,h){var f=k.customerCount,n=k.capacity;
_.isUndefined(d)||(f=d);var a;_.isUndefined(h)&&(h=!0);if(k.cls===c.ItemGroup.cls)return 0<(k.bookingCount||0)?"ava-is-booked":"ava-is-empty";k.cls===c.Block.cls&&(a=k.reservedCapacity-f);k.cls===c.CustomerTypeRate.cls&&(a=n-f);if(k.cls===c.Availability.cls){a=h?"bookableCapacity":"blocksIncludedBookableCapacity";h=h?"nonResourceBookableCapacity":"blocksIncludedNonResourceBookableCapacity";if(!f)return"ava-is-empty";if(k.company.companyFeatures.isResourceBookableCapacityEnabled){a=k[a];if(_.isUndefined(a))return console.log("capacityClass: no capacity information for object",
k.uri),"ava-is-empty";if(k.isOverusingResources||0>k[h])return"ava-is-overbooked"}else{a=k[h];if(_.isUndefined(a))return console.log("capacityClass: no capacity information for object",k.uri),"ava-is-empty";null!==a&&(a+=k.customerCount-f)}}return 0>=f?"ava-is-empty":0>a?"ava-is-overbooked":0===a?"ava-is-full":null===a||0<a?"ava-is-booked":"ava-is-empty"}}]);m.filter("liveCapacityClass",["models",function(c){return function(c,d){if(!c||c.$fresh)return"ava-is-empty";var h=d.bookCountsCtrl.availabilityCustomerCount;
if(!h)return"ava-is-empty";if(0===d.bookCountsCtrl.customerCount&&(d.availability.isOverbooked||d.availability.isOverusingResources)||c.isOverbookingAvailability||c.isOverusingResources)return"ava-is-overbooked";if(0===c.availabilityLiveBookableCapacity)return"ava-is-full";if(0<h&&(null===c.availabilityLiveBookableCapacity||0<c.availabilityLiveBookableCapacity))return"ava-is-booked";console.log("liveCapacityClass: no capacity information.",c,h);return"ava-is-empty"}}]);m.filter("availableClass",[function(){return function(c,
k){var d=c.capacity-c.customerCount;_.isUndefined(k)||(d=k);return 0>=d?"ava-is-unbookable":"ava-is-bookable"}}]);m.filter("paymentAmountClass",["models",function(c){return function(k){return k.disputeStatus===c.Payment.LOST_DISPUTE_STATUS?"strike":c.Payment.isPaymentFailed(k)?"negative":k.expiresAt?"fh-grey":"positive"}}]);m.filter("hasCustomersClass",[function(){return function(c){return 0<c.customerCount?"ava-is-booked":"ava-is-empty"}}]);m.filter("abs",[function(){return function(c){return Math.abs(c||
0)}}]);m.filter("isAllDay",["dates",function(c){return function(k){return!k?(console.warn("isAllDay: invalid range"),!1):!k.startAt||!k.endAt||+k.startAt===+k.endAt?!1:c.isMidnight(k.startAt)&&c.isMidnight(k.endAt)}}]);m.filter("isMidnight",["dates","moment",function(c,k){return function(d){return!k.isMoment(d)?(console.warn("isMidnight: invalid date",d),!1):c.isMidnight(d)}}]);m.filter("contains",[function(){return function(c,k){return _.contains(c,k)}}]);m.filter("bookingUrl",["auth","navigation",
"urls",function(c,k,d){return function(h){var f=h.company;return h.isPending?(h=h.$url(d.embeds.book.wait.booking),k.extendQuery(h,{status:"initial"})):c.permissions.can("viewDashboardSection",f)?h.$url(d.dashboard.overlay.contact.booking):h.affiliation&&c.permissions.can("viewDashboardSection",h.affiliation.affiliateCompany)?h.$url(d.dashboard.bookings.contact.affiliateBookingPermalink):h.$url(d.company.item.booking)}}]);m.filter("orderUrl",["auth","navigation","urls",function(c,k,d){return function(h){if(c.permissions.can("viewDashboardSection",
h.company))return h.$url(d.dashboard.overlay.contact.order);var f=_.filter(h.allBookings,function(d){return d.affiliation&&c.permissions.can("viewDashboardSection",d.affiliation.affiliateCompany)});return 0<f.length?d.populate(d.dashboard.bookings.contact.affiliateOrderPermalink,{affiliateShortname:f[0].affiliation.affiliateCompany.shortname,shortname:h.company.shortname,contactPk:h.contact.pk,orderUuid:h.uuid}):h.$url(d.company.order.index)}}]);m.filter("contactUrl",["auth","navigation","urls","require",
function(c,k,d,h){return function(f){if(c.permissions.can("viewDashboardSection",f.company))return f.$url(d.dashboard.overlay.contact.index);var h=_.findWhere(c.currentUser.company.partners,{company:f.company});return h&&h.affiliateGroup&&c.permissions.can("viewDashboardSection",c.currentUser.company)?d.populate(d.dashboard.bookings.contact.affiliateContactPermalink,{affiliateShortname:c.currentUser.company.shortname,shortname:f.company.shortname,contactPk:f.pk}):f.$url(d.company.index)}}]);m.filter("availabilityUrl",
["auth","models","urls",function(c,k,d){return function(h){return c.permissions.can("viewDashboardSection",h.item.company)?h.$url(d.dashboard.overlay.availability.index):h.$url(d.company.item.book)}}]);m.filter("itemGroupUrl",["auth","flows","models","urls",function(c,k,d,h){return function(d,n){var a=c.permissions.can("viewDashboardSection",d.item.company)?h.dashboard.overlay.item.date:h.company.item.date,a=h.populate(a,{shortname:d.item.company.shortname,itemPk:d.item.pk,date:n.format("YYYY-MM-DD")});
return a=k.extendWithFlow(a)}}]);m.filter("itemUrl",["auth","urls",function(c,k){return function(d){return c.permissions.can("viewItemsSection",d.company)?d.$url(k.dashboard.items.item.index):d.$url(k.company.item.index)}}]);m.filter("checkinUrl",["db","urls",function(c,k){return function(d){return!d?"":c.slipstream("checkinDomain")+k.populate(k.embeds.checkin.qr,{encodedCustomerPk:d.encodedPk})}}]);m.filter("waiverUrl",[function(){return function(c,k){return c.company.smartwaiverUrl+"?auto_waiverid="+
c.waiverUuid+"&auto_tag=fh_id_"+k.pk}}]);m.filter("invoiceUrl",["auth","navigation","urls",function(c,k,d){return function(h,f){f=f||"index";var n;n=k.currentCompany===h.company&&c.permissions.can("viewDashboardSection",h.company)?d.dashboard.reports.invoices.invoice[f]:h.affiliation&&c.permissions.can("viewDashboardSection",h.affiliation.affiliateCompany)?d.dashboard.reports.invoices.partnerInvoice[f]:d.company.invoice.index;if(!n)throw Error("invoiceUrl: invalid view "+f);return h.$url(n)}}]);m.filter("uploadUrl",
["navigation","urls",function(c,k){return function(d){return k.populate(k.dashboard.reports.accounts.upload,{shortname:c.currentCompany.shortname,uploadPk:d.pk})}}]);m.filter("companyDefaultIntegrationsUrl",["navigation","urls","auth","models",function(c,k,d,h){return function(c){var n={shortname:c.shortname};return d.permissions.canList(h.ResellerCompany,c)?c.isAdmin?k.populate(k.dashboard.settings.reseller.apps.index,n):k.populate(k.dashboard.settings.reseller.index,n):k.populate(k.dashboard.settings.integrations.subscribe,
n)}}]);m.filter("key",[function(){return function(c){return c.cls+"."+c.pk}}]);m.filter("summary",[function(){return function(c,k,d){return _.reduce(c,function(c,d){return c+(_.getDotted(d,k)||0)},d||0)}}]);m.filter("uniqueCount",["$filter",function(c){var k=c("pluralize");return function(c,h,f,n){var a={};_.forEach(c,function(c){c=_.get(c,h);_.isObject(c)&&c.uri&&(c=c.uri);a[c]=1});c=_.sum(a);return f||n?c.toString()+" "+k(c,f,n):c}}]);m.filter("uncamel",[function(){var c=/([a-z])([A-Z])/g,k=function(c,
h,f){return h+" "+f};return function(d){return d.replace(c,k)}}]);m.filter("activityChange",["$filter","models",function(c,k){var d=c("amount"),h=c("percentage"),f=function(a){moment.isMoment(a)||(a=moment.parseZone(a));return a},n={AmountField:d,PositiveAmountField:d,PercentField:h,PositivePercentField:h,DateTimeField:function(a){return c("datetime")(f(a))},DateField:function(a){return c("date")(f(a))},ColumnWidthField:function(a){return k.FlowNode.WIDTH_LABELS[a]||a},PKListField:function(a){return a||
T("all")},ArrayField:function(a){return _.isArray(a)?a.join(", "):""}};return function(a,d){var g=n[d];return g?g(a):_.isObject(a)?c("name")(a):a}}]);m.filter("defaultIfUndefined",[function(){return function(c,k){return _.isUndefined(c)?k:c}}]);m.filter("fieldOrBoolean",["$filter",function(c){return function(k){return!0===k?"is set":!1===k?"is empty":_.isObject(k)?c("name")(k):k}}]);m.filter("names",["$filter",function(c){return function(k){return _.map(k,c("name")).join(", ")}}]);m.filter("isEmptyFilter",
["filterFields",function(c){return function(k){return _.any(c.EMPTY_VALUES,function(c){return _.isEqual(c,k)})}}]);m.filter("defaults",[function(){return _.defaults}]);m.filter("parsePresetDateRange",["dateUtils",function(c){return function(k,d){return c.dateRange(k,d)}}]);m.filter("colorClass",["models",function(c){return function(k,d,h){d=d||"";h=h||"";if(!k)return h;k.cls===c.Booking.cls?k=k.availability.item:k.item&&(k=k.item);k.color&&(k=k.color);if(!k||!_.isNumber(k))return h;d&&"-"!==d.charAt(0)&&
(d=" "+d);return"color-"+k+d}}]);m.filter("approximate",["$filter",function(c){return function(k,d){var h,f=1,n=d?"+":"";if(1E3<=k)h=100,f=1E3,n="k"+n;else if(100<=k)h=100;else if(10<=k)h=10;else return k;return c("count")((k-k%h)/f,1)+n}}]);m.filter("displayLanguage",["models",function(c){return function(k){return c.SupportedLanguage.display(k)}}]);m.filter("bankAccountDescription",[function(){return function(c){return c?c.bankName+" "+c.accountLast4:""}}])})();
(function(){var m=angular.module("lib.services","flash.services lib.factories lib.filters lib.models lib.processors ngSanitize".split(" "));m.factory("sessionStorage",[function(){var c=function(){var c={};return{get:function(h){h=c[h];if(!_.isUndefined(h))return _.parseJSON(h)},set:function(h,f){c[h]=_.stringifyJSON(f)},del:function(h){delete c[h]},clear:function(){c={}}}},k=c();k.create=c;return k}]);m.factory("storage",["$window","sessionStorage",function(c,k){var d;try{window.localStorage.setItem("$test",
"$test"),window.localStorage.removeItem("$test"),d=!0}catch(h){d=!1}var f;d?(f={key:function(d){try{return c.localStorage.key(d)}catch(a){}},get:function(d){try{var a=c.localStorage.getItem(d);if(_.isString(a))return _.parseJSON(a)}catch(f){}},set:function(d,a){try{c.localStorage.setItem(d,_.stringifyJSON(a))}catch(f){}},del:function(d){try{c.localStorage.removeItem(d)}catch(a){}},clear:function(){try{c.localStorage.clear()}catch(d){}}},Object.defineProperty(f,"length",{get:function(){try{return c.localStorage.length}catch(d){return 0}},
configurable:!1,enumerable:!1})):f=k.create();f.isPersistent=function(){return d};return f}]);m.factory("persistentStorage",["$q","$rootScope","clientOptions","db","events","navigation","require","storage",function(c,k,d,h,f,n,a,q){_.isValidUuid(d.userIdentifier)||(c=q.get("persistentStorageIdentifier"),d.userIdentifier=_.isValidUuid(c)?c:_.uuid());q.set("persistentStorageIdentifier",d.userIdentifier);var g=d.userIdentifier;console.log("persistentStorage: identified user:",d.userIdentifier);var b=
function(b){a.notNull(n.currentCompany,"shortname","persistentStorage needs currentCompany");var c={identifier:d.userIdentifier,shortname:n.currentCompany.shortname};b&&(c.key=b);return c},e={getIdentifier:function(){return d.userIdentifier},setIdentifier:function(a){q.set("persistentStorageIdentifier",a);d.userIdentifier=a;console.log("persistentStorage: re-identified user:",a);f.broadcast("persistentStorage.reIdentifiedUser")},restoreIdentifier:function(){e.setIdentifier(g)},regenerateIdentifier:function(){e.setIdentifier(_.uuid())},
get:function(a){a=b(a);var c=h.persistentStoreItem(a);return c.$promise.then(function(a){return c})},set:function(a,c){var e=b(a),d=h.persistentStoreItem.update(e,c);return d.$promise.then(function(){return d})},del:function(a){a=b(a);return h.persistentStoreItem.remove(a).$promise},clear:function(){var a=b();return h.persistentStoreForCompany.remove(a).$promise},getForAllCompanies:function(a){var b=h.persistentStore({identifier:d.userIdentifier});return b.$promise.then(function(){var c={};_.forEach(b,
function(b){c[b.company.shortname]={company:b.company};c[b.company.shortname][a]=b[a]});return c})}};f.on(k,"auth.logout",e.regenerateIdentifier);f.on(k,"auth.login",e.regenerateIdentifier);return e}]);m.factory("translate",["$rootScope","$window","db",function(c,k,d){var h,f=function(a){0>=a?console.warn("translate: failed to load Google Translate"):!k.google||!k.google.translate||!k.google.translate.TranslateElement?(console.info("translate: not yet loaded, retrying..."),setTimeout(_.bind(f,_,a-
1),1E3)):(console.info("translate: loaded"),c.$apply(function(){n.isReady=!0}))},n={isReady:!1,initialize:function(a){n.isReady?h?a.append(h):(h=$('<div id="google-translate"></div>'),a.append(h),new k.google.translate.TranslateElement({pageLanguage:"en"},h[0])):console.warn("translate: attempting to initialize before load")}};d.slipstream("isAnonymous")&&f(3);return n}]);m.factory("postBook",["$filter","auth","navigation","require",function(c,k,d,h){return{startBooking:function(c){console.log("postBook: start booking",
c);k.sessionStorage.set("postBook.path",c)},stopBooking:function(f){h.assert(f,"postBook: expected booking");var n=c("bookingUrl")(f),a=k.sessionStorage.get("postBook.path");k.sessionStorage.del("postBook.path");console.log("postBook: stop booking",f,n,a);if(!a)return n;f=d.parseMultiUrl(n);if(!f||0!==a.indexOf(f.path))return n;n={};n[f.key]=f.multiPath;_.extend(n,f.search);return d.extendQuery(a,n)}}}]);m.constant("Showdown",window.Showdown);m.constant("Mailcheck",window.Mailcheck);m.constant("moment",
window.moment);m.constant("Pikaday",window.Pikaday);m.constant("QRCode",window.QRCode);m.factory("filepicker",function(){return window.filepicker||null});m.factory("fileuploader",["$q","$window",function(c,k){var d={},h=window.filepicker;d.upload=function(){var d=c.defer();h.pickAndStore({},{location:"S3"},function(c){var a=c?_.first(c):"";if(a.url){c=a.url.replace(k.slipstream.remoteFileDomain,k.slipstream.remoteFileCdnDomain);var h=a.filename||"attachment",a=(a.mimetype||"").match(/^image\/\S+$/);
d.resolve({url:c,fileName:h,isImage:a})}else d.reject()},function(c){c&&101===c.code?d.resolve():d.reject()});return d.promise};d.uploadAsMarkdown=function(){return d.upload().then(function(c){if(c){var d=c.url,a=c.fileName;c=c.isImage?"!["+T("Description of image")+"]("+d+")":"["+T("View")+" "+a+"]("+d+")";return c}return""})};return d}]);m.factory("d3",function(){return window.d3});m.factory("diff",function(){return window.JsDiff});m.factory("exporter",["$q","$rootScope","$timeout","$window","filepicker",
function(c,k,d,h,f){var n=document.createElement("a"),a="download"in n&&"Blob"in window,q=function(a,b,d){var g=c.defer();f.store(a,{filename:b,mimetype:d},function(a){k.$safeApply(function(){g.resolve(a.url)})},function(){k.$safeApply(function(){g.reject()})});return g.promise},g=function(b,g,k){k=k||{};var r=c.defer();if(a)d(function(){var a=new Blob([b],{type:k.mediaType}),a=URL.createObjectURL(a);n.setAttribute("href",a);n.setAttribute("download",g);document.body.appendChild(n);n.click();document.body.removeChild(n);
r.resolve()},0,!1);else if(k.openWindow){var m=encodeURIComponent(b);window.open("data:"+k.mediaType+";charset=utf-8,"+m);r.resolve()}else{if(!f||f._queue)return r.reject(),r.promise;q(b,g,"application/octet-stream").then(function(a){h.location.href=a;r.resolve()},function(){r.reject()})}return r.promise},b=function(a){var b="\ufeff";_.forEach(a,function(a){a=_.map(a,function(a){_.isUndefined(a)?a="":_.isString(a)&&(a=a.replace(/^\s+|\s+$/g,""),a=a.replace(/\s+/g," "),a=a.replace(/,$/,""),a=a.replace(/"/g,
'""'),a='"'+a+'"');return a});b+=a.join(",")+"\n"});return b};return{exportToCsvFile:function(a,c,d){d=d||{};d.mediaType="text/csv";a=b(a);return g(a,c,d)},isDownloadSupported:a}}]);m.factory("xmessage",["$window","db",function(c,k){return{broadcast:function(d,h,f){d={type:d};_.extend(d,h);f=f||"*";h="";try{h=_.stringifyJSON(d),k.slipstream("isDebug")&&console.info("xmessage: broadcast",h),c.parent.postMessage(h,f)}catch(n){console.error("xmessage: unable to broadcast",h)}},on:function(d,h,f,n){n=
n||"*";var a=function(a){try{var b=_.parseJSON(a.data);_.isObject(b)&&(k.slipstream("isDebug")&&console.info("xmessage: on",b),h&&b.type===h&&("*"!==n&&(!n||n!==b.origin)||f(b.data)))}catch(c){}};c.addEventListener("message",a);var q=function(){c.removeEventListener("message",a)};d.$on("$destroy",function(){q()});return q}}}]);m.factory("events",["$rootScope",function(c){return{on:function(c,d,h){return c.$on(d,h)},broadcast:function(){c.$broadcast.apply(c,arguments)}}}]);m.factory("require",function(){var c=
function(c,d){c="require: "+c;return d?c+" ("+d+")":c};return{assert:function(k,d){if(!k)throw Error(c("expected '"+k+"' to be true",d));},assertDefined:function(k,d){if(_.isUndefined(k))throw Error(c("expected '"+k+"' to be defined",d));},notNull:function(k,d,h){if(null===k[d])throw Error(c("expected '"+d+"' not to be null",h));},defined:function(k,d,h){if(_.isUndefined(k[d]))throw Error(c("expected '"+d+"' to be defined",h));},unDefined:function(k,d,h){if(!_.isUndefined(k[d]))throw Error(c("expected '"+
d+"' to be undefined",h));},inScope:function(k,d,h){if(_.isUndefined(_.getDotted(k,d)))throw Error(c("expected '"+d+"' to be in scope",h));},notInScope:function(k,d,h){if(!_.isUndefined(k[d]))throw Error(c("expected '"+d+"' not to be in scope",h));}}});m.provider("convert",["moment",function(c){var k=/_([a-z0-9])/g,d=function(a){a=a||"";return"/"===a[0]?a:a.replace(k,function(a,b){return b.toUpperCase()})},h=function(a,b){if(!a)return null;var e=c(a,"YYYY-MM-DDTHH:mm:ssZZ",!0);if(e.isValid())return e;
e=c(a,"YYYY-MM-DDTHH:mm:ss",!0);if(e.isValid())return e;e=c(a,"YYYY-MM-DD",!0);if(e.isValid())return e;throw Error("convert: invalid date "+b+": "+a);},f=/_at$/,n=function(a){if(_.isArray(a))for(var b=0,c=a.length;b<c;b++)n(a[b]);else if(_.isObject(a))for(b in a)if(a.hasOwnProperty(b)){c=a[b];delete a[b];var e=d(b);f.test(b)||"at"===b?a[e]=h(c,e):a[e]=n(c)}return a},a=function(a,b,c){return b+"_"+c.toLowerCase()},q=/([a-z])([A-Z0-9])/g,g=/([0-9])([a-zA-Z])/g,b=function(b){b=b.replace(q,a);return b.replace(g,
a)},e=function(a){var d,g;if(c.isMoment(a))d=a.format();else{if(_.isDate(a))throw Error("convert: expected moment, not date "+a);if(_.isArray(a)){d=[];g=0;for(var f=a.length;g<f;g++)d.push(e(a[g]))}else if(_.isObject(a))for(f in d={},a)f&&(a.hasOwnProperty(f)&&"$"!==f[0])&&(g=b(f),d[g]=e(a[f]));else d=a}return d},m=function(a,b,c){return b+" "+c},v=function(a,b){a=a.toString();a=a.replace(q,m);a=a.replace(g,m);a=a.replace(/-/g," ");return _[b?"titleize":"capitalize"](a.toLowerCase())};this.serverResponse=
n;this.clientRequest=e;this.$get=function(){return{serverResponse:n,clientRequest:e,camelKey:d,unCamelKey:b,humanize:v}}}]);m.factory("shortcutsOverlay",["$rootScope","auth","db","events",function(c,k,d,h){var f={isShowing:!1,shouldConfirmClose:!1,show:function(){f.isShowing=!0},hide:function(){f.isShowing=!1},confirmClose:function(a){f.shouldConfirmClose=a}},n;h.on(c,"navigation.company.updated",function(a,c){if(!d.slipstream("isDebug")){var g=c.company;g&&n!==g&&(n=g,g.adminNotes&&k.permissions.canAdminUpdate(g)&&
f.show())}});return f}]);m.factory("shortcuts",["$document","auth","d",function(c,k,d){var h=[],f={"delete":8,tab:9,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},n=function(a,c){for(var d=a.length,g=0;g<d;g++)f[a[g]]=c+g};n("1234567890",49);n("abcdefghijklmnopqrstuvwxyz",65);var a={};_.forEach(f,function(b,c){a[b]=c});var q={shift:"shift",ctrl:"ctrl",meta:"meta",alt:"alt"},g=function(a){a=
a.split("+");var c={};_.forEach(q,function(a){c[a]=!1});_.forEach(a,function(a){var b=q[a];b?c[b]=!0:c.keyCode=f[a]});return c};c.on("keydown",function(b){if(k.currentUser.isAuthenticated){var c=$(b.target);if(!d.isTextInput(c)&&!c.is(".js-disable-shortcuts, select")){c={};c.keyCode=f[a[b.which]];c.meta=b.metaKey||!1;c.alt=b.altKey||!1;c.ctrl=b.ctrlKey||!1;c.shift=b.shiftKey||!1;for(var g,q=h.length-1;0<=q;q--)if(g=h[q],c&&g.keys&&c.keyCode===g.keys.keyCode&&c.ctrl===g.keys.ctrl&&c.alt===g.keys.alt&&
c.meta===g.keys.meta&&c.shift===g.keys.shift){b.preventDefault();g.action();break}}}});return{shortcuts:h,register:function(a){a.keys=g(a.keySet);if(a.keys)return h.push(a),a},unregister:function(a){_.overwriteWithout(h,a)}}}]);m.factory("toggles",["$document","$rootScope",function(c,k){$("html").on("click",function(h){var f=$(h.target);f.closest("[ng-toggle], [ng-toggled], [ng-toggled-show]").length||$.contains(c[0].documentElement,h.target)&&(f.closest(".select2-container, .pika-select").length||
k.$apply(function(){_.forEach(d.toggles,function(c,a){if(c.autoClose&&(!c.group||c.isCloseableGroup))c.state=!1})}))});var d={toggles:{},create:function(c,f){var n=d.toggles[c];n?(n.state=f.defaultState||n.state||!1,n.count+=1):(n={autoClose:f.autoClose||!1,state:f.defaultState||!1,group:f.group||null,isCloseableGroup:f.isCloseableGroup||!1,when:f.when||_.always,count:1},d.toggles[c]=n,n.group&&(n.deregisterGroupWatch=k.$watch(function(){return n.state},function(a){a&&_.forEach(d.toggles,function(a,
c){n!==a&&n.group===a.group&&(a.state=!1)})})))},destroy:function(c){var f=d.toggles[c];f?(f.count-=1,f.count||(f.deregisterGroupWatch&&f.deregisterGroupWatch(),delete d.toggles[c])):console.warn("invalid toggle",c)},toggle:function(c,f){var k=d.toggles[c];k?k.when()?(f=_.isUndefined(f)?!k.state:!!f,k.state=k.group?k.isCloseableGroup?f:!0:f):console.info("toggles: disabled toggle",c):console.warn("toggles: invalid toggle",c)},state:function(c){c=d.toggles[c];return!c?!1:c.state},closeAll:function(){_.forEach(d.toggles,
function(c){c.state=!1})}};return d}]);angular.module("lib.services.interpolate",[]).provider("$interpolate",[function(){var c="{{",k="}}",d="{!",h="!}";this.startSymbol=function(d){return d?(c=d,this):c};this.endSymbol=function(c){return c?(k=c,this):k};this.staticStartSymbol=function(c){return c?(d=c,this):d};this.staticEndSymbol=function(c){return c?(h=c,this):h};this.$get=["$parse","$exceptionHandler","$sce",function(f,n,a){var q=c.length,g=k.length,b=d.length,e=h.length;n=function(n,v,r){for(var m,
s,D=0,l=[],p=n.length,N=!1,w,u,J,x,t=[];D<p;)-1!=(m=n.indexOf(c,D))&&-1!=(s=n.indexOf(k,m+q))?(D!=m&&l.push(n.substring(D,m)),l.push({fn:f(w=n.substring(m+q,s)),exp:w,"static":!1}),D=s+g,N=!0):-1!=(m=n.indexOf(d,D))&&-1!=(s=n.indexOf(h,m+b))?(D!=m&&l.push(n.substring(D,m)),l.push({fn:f(w=n.substring(m+b,s)),exp:w,"static":!0}),D=s+e,N=!0):(D!=p&&l.push(n.substring(D)),D=p);if(!(p=l.length))l.push(""),p=1;if(r&&1<l.length)throw Error("$interpolate: error while interpolating: SCE violation");if(!v||
N)return t.length=p,x=function(b){if("undefined"!==typeof x.value)return x.value;try{for(var c=0,e=0,d=p,g;e<d;e++)g=l[e],"object"===typeof g?(u=g.fn(b),u=r?a.getTrusted(r,u):a.valueOf(u),J=typeof u,null===u||"undefined"===J?u="":"number"===J?u=""+u:"string"!==J&&(u=angular.toJson(u)),g.static?l[e]=u:c++):u=g,t[e]=u;var f=t.join("");c||(x.value=f);return f}catch(h){console.error("unable to interpolate",n,"error",h)}},x.exp=n,x.parts=l,x};n.startSymbol=function(){return c};n.endSymbol=function(){return k};
n.staticStartSymbol=function(){return d};n.staticEndSymbol=function(){return h};return n}]}]);m.factory("selectedItems",["navigation",function(c){return{extendUrl:function(k,d){if(d.length){var h={"selected-items":_.pluck(d,"pk").join(",")};return c.compose(k,h)}return k}}}]);m.factory("parseAttrsForScope",["$parse",function(c){return function(k,d,h,f){var n={},a=_.isString(f)?function(a){return f+_.capitalize(a.slice(0,1))+a.slice(1)}:function(a){return a};_.forEach(h,function(f,g){var b=a(g);"@"===
f?n[g]=k[b]:"="===f?n[g]=d.$eval(k[b]):"&"===f&&(n[g]=c(k[b]).bind(null,d))});return n}}]);m.factory("tableHeaders",["$parse",function(c){return{parsePredicate:function(k,d,h,f){f=f||"$row";var n=_.choose(d.split(";"),function(a){if(a)return c(a)}),n=_.map(n,function(a,c){return function(c){var b={};b[f]=c;b=a(k,b);moment.isMoment(b)&&(b=b.unix());return _.isUndefined(b)?(console.warn("ng-table-header: predicate returned undefined",d,c),0):b}});1===n.length&&(n=n[0]);n.source=d;n.isDefault=h||!1;
return n}}}]);m.factory("autoExport",["$filter","$q","$timeout","exporter","flash",function(c,k,d,h,f){var n=c("stripNewlines"),a=function(a){return a.replace(/\u2011/g,"-")},q=function(a){return _.map(a.contents(),function(a){var b=$(a);if(3===a.nodeType)return b.text();if(b.is(":visible")&&!b.is("[ng-auto-export-skip]"))return q(b)}).join(" ")},g=function(a){a=!_.isUndefined(a)?a:1;return _.map(_.range(a),_.constant(""))},b=function(a){if(!a||!a.length)console.warn("autoExport: no exports found");
else{if(1===a.length)return a[0];var b={rows:a[0].rows,filename:a[0].filename};_.forEach(_.rest(a),function(a){b.rows.push(g());_.ref.append(b.rows,a.rows)});return b}},e=function(b,c){var e=c.rowSelector?c.rowSelector:c.isCSS?"> .thead > .tr, > .tbody > .tr, > .tfoot > .tr":"> thead > tr, > tbody > tr, > tfoot > tr",d=c.cellSelector?c.cellSelector:c.isCSS?"> .td, > .th":"> td, > th",f=b.data().ngAutoExportSkip;if(!f||!f()){var h=[];_.forEach(b.find(e),function(b){b=$(b);var c;if(!(c=b.data().ngAutoExportSkip)||
!c()){var e=[];_.forEach(b.find(d),function(b){b=$(b);var c=b.data(),d;if(!(d=c.ngAutoExportSkip)||!d()){var f;d=(f=c.ngAutoExportValue)?f():q(b);e.push(a(n(d).trim()));f=(f=b.prop("colspan"))?parseInt(f,10):1;_.ref.append(e,g(f-1))}});h.push(e)}});return{rows:h}}},m={},v={status:"ready",ready:function(){return"ready"===v.status||"error"===v.status},autoExport:function(a,c,g){a=a||"default";c=c||a;if(v.ready()){var n=m[a]||[];if(n.length){var l=function(){v.status="error";f.error("Error exporting "+
c)};v.status="processing";d(function(){var a=[];try{var d=[];_.forEach(n,function(b){if(b.process){var c=b.process(),c=k.when(c);d.push(c);c.then(function(b){b&&a.push({rows:b})})}else{var c=b.tableSelector?b.tableSelector:b.isCSS?".table":"table",g=b.element;g.is(c)||(g=g.find(c));_.forEach(g,function(c){(c=e($(c),b))&&a.push(c)})}});k.all(d).then(function(){var e=b(a);e?(v.status="exporting",h.exportToCsvFile(e.rows,c,g).then(function(){v.status="ready"},l)):v.status="ready"})}catch(f){l(),console.error("Error exporting",
f)}},0,!1)}else console.warn("autoExport: no exports")}else console.warn("autoExport: not ready")},addExport:function(a,b,c){a=a||"default";var e=m[a]=m[a]||[];a={element:b,namespace:a};_.extend(a,c||{});e.push(a);return a},removeExport:function(a){var b=m[a.namespace]=m[a.namespace]||[];_.ref.remove(b,a)},isDownloadSupported:h.isDownloadSupported,canExport:function(a){return m[a]?0<m[a].length:!1}};return v}]);m.factory("scrollbar",[function(){var c={width:null,getWidth:function(){if(null!==c.width)return c.width;
var k=document.createElement("p");k.style.width="100%";k.style.height="200px";var d=document.createElement("div");d.style.position="absolute";d.style.top="0px";d.style.left="0px";d.style.visibility="hidden";d.style.width="200px";d.style.height="150px";d.style.overflow="hidden";d.appendChild(k);document.body.appendChild(d);var h=k.offsetWidth;d.style.overflow="scroll";k=k.offsetWidth;h==k&&(k=d.clientWidth);document.body.removeChild(d);c.width=Math.max(h-k,0);return c.width}};return c}]);m.factory("dateUtils",
["moment","models",function(c,k){var d=/^\d\d:\d\d$/,h=function(a){return _.isUndefined(a)?c():c().tz(a)},f=function(a,b){return function(c){return[h(c).subtract(1,a+"s").startOf(a),b?h(c).subtract(1,a+"s"):h(c).subtract(1,a+"s").endOf(a)]}},n=function(a,b){return function(c){return[h(c).startOf(a),b?h(c):h(c).endOf(a)]}},a=function(a){return function(b){return[h(b).add(1,a+"s").startOf(a),h(b).add(1,a+"s").endOf(a)]}},q=function(a){return function(b){return[h(b).startOf("day"),h(b).add(a-1,"days").endOf("day")]}},
g=function(a){return function(b){return[h(b).subtract(a-1,"days").startOf("day"),h(b).endOf("day")]}},b=k.Report,e={};e[b.TODAY_DATE_RANGE]=n("day");e[b.THIS_WEEK_DATE_RANGE]=n("week");e[b.THIS_WEEK_TO_DATE_DATE_RANGE]=n("week",!0);e[b.THIS_MONTH_DATE_RANGE]=n("month");e[b.THIS_MONTH_TO_DATE_DATE_RANGE]=n("month",!0);e[b.THIS_QUARTER_DATE_RANGE]=n("quarter");e[b.THIS_QUARTER_TO_DATE_DATE_RANGE]=n("quarter",!0);e[b.THIS_YEAR_DATE_RANGE]=n("year");e[b.THIS_YEAR_TO_DATE_DATE_RANGE]=n("year",!0);e[b.REMAINING_THIS_YEAR_DATE_RANGE]=
function(a){return function(b){return[h(b).startOf("day"),h(b).endOf(a)]}}("year");e[b.YESTERDAY_DATE_RANGE]=f("day");e[b.LAST_WEEK_DATE_RANGE]=f("week");e[b.LAST_WEEK_TO_DATE_DATE_RANGE]=f("week",!0);e[b.LAST_MONTH_DATE_RANGE]=f("month");e[b.LAST_MONTH_TO_DATE_DATE_RANGE]=f("month",!0);e[b.LAST_QUARTER_DATE_RANGE]=f("quarter");e[b.LAST_QUARTER_TO_DATE_DATE_RANGE]=f("quarter",!0);e[b.LAST_YEAR_DATE_RANGE]=f("year");e[b.LAST_YEAR_TO_DATE_DATE_RANGE]=f("year",!0);e[b.TOMORROW_DATE_RANGE]=a("day");e[b.NEXT_WEEK_DATE_RANGE]=
a("week");e[b.NEXT_MONTH_DATE_RANGE]=a("month");e[b.NEXT_YEAR_DATE_RANGE]=a("year");e[b.LAST_SEVEN_DAYS_DATE_RANGE]=g(7);e[b.LAST_THIRTY_DAYS_DATE_RANGE]=g(30);e[b.NEXT_SEVEN_DAYS_DATE_RANGE]=q(7);e[b.NEXT_THIRTY_DAYS_DATE_RANGE]=q(30);e[b.ALL_TIME_DATE_RANGE]=function(){return function(a){return[h(a).startOf("year").year(1),h(a).endOf("year").year(9999)]}}();var m={};m[b.THIS_WEEK_DATE_RANGE]=[!0,!0];m[b.THIS_WEEK_TO_DATE_DATE_RANGE]=[!0,!1];m[b.LAST_WEEK_DATE_RANGE]=[!0,!0];m[b.LAST_WEEK_TO_DATE_DATE_RANGE]=
[!0,!1];m[b.NEXT_WEEK_DATE_RANGE]=[!0,!0];var v={DATE_RANGES:e,dateRange:function(a,c){var d=e[a];d||(d=e[b.TODAY_DATE_RANGE]);var g=d(c.timezone);c.features.isSundayBased||(d=m[a])&&_.forEach(d,function(a,b){a&&g[b].add(1,"days")});return g},isInvertedRange:function(a){if(!a[0]||!a[1])return!1;var b=d.test(a[0]),e=b?"HH:mm":null;if(b&&"00:00"===a[1])return!1;b=c(a[0],e);a=c(a[1],e);return b.isValid()&&a.isValid()&&b>a},formatMoment:function(a){return a.format("YYYY-MM-DD-HH-mm-ss")},formatTimeRange:function(a){return v.formatMoment(a.startAt)+
"/"+v.formatMoment(a.endAt)},parseTimeRange:function(a){var b=_.split(a,"/");return{startAt:c(b[0],"YYYY-MM-DD-HH-mm-ss"),endAt:c(b[1],"YYYY-MM-DD-HH-mm-ss"),formatted:a}},overlapsWith:function(a,b){return function(c){return a.startAt<c.endAt&&c.startAt<a.endAt?!0:b?c.startAt.isSame(c.endAt)&&c.startAt.isSame(a.startAt):!1}}};return v}]);m.factory("searchTerms",[function(){return{}}]);m.factory("flows",["$q","availabilityCalendarController","cache","clientOptions","db","models","navigation","require",
"urls",function(c,k,d,h,f,n,a,q,g){var b=n.FlowNode,e=a.getPks("selected-items"),m=function(a,c){!a.children.length&&c&&(a.emptyPageChildren=_.map(c,function(c){return{cls:b.cls,uri:"",pk:null,company:a.company,type:b.ITEM_TYPE,parent:a,item:c,properties:{},unicode:c.unicode}}))},v,r=function(a,b){var c=f.defaultFlowPage({shortname:a});c.$promise.then(function(){b.resolve();C.initialFlowNode=c.flowNode},b.reject)},C={wrapEndpoint:function(a,b){return function(c,d,g,h,k){h=h||{};e.length&&(h.selectedItems=
e.join(","));b||(h.isPage=!0);k=k||{};k.ignoreQueryParamsInCacheUri=!0;k.sideKeys=["emptyPageItems"];c=a(c,d,g,h,k);c.$promise.then(function(a){a!==f.CANCELLED&&m(b?a.primaryData.flowNode:a.primaryData,a.emptyPageItems)});return c}},isNoFlow:function(){return C.initialFlowNode===b.NO_FLOW},currentFlowNodePk:function(){var c=a.get(b.FLOW_QUERY);return"no"===c?!1:c?_.int(c):null},currentFlowNodeUrl:function(a,b){var c=C.currentFlowNodePk();if(!1===c)return null;var e;if(c)return e=a.features.isFlowDateViewEnabled?
g.company.flowNode.date.index:g.company.flowNode.calendar,e=b?e:g.company.flowNode.index,g.populate(e,{flowNodePk:c,shortname:a.shortname});c=a.features.isFlowDateViewEnabled?g.company.items.date.index:g.company.items.calendar;e=b?c:g.company.items.index;return a.$url(e)},currentFlowNodeFromCache:function(a){q.assert(C.initialFlowNode,"flows must be initialized");var b=C.currentFlowNodePk();if(b){a={shortname:a,flowNodePk:b};b=g.populate(g.api.flowNode,a);b=d.cache[b];if(!b||!b.breadcrumbs)b=f.flowNode(a);
return b}return C.initialFlowNode},initialFlowNode:void 0,initialItemBindings:void 0,initialize:function(e){if(v)return console.log("flows: already initialized"),v;var d=c.defer();v=d.promise;var h=C.currentFlowNodePk();if(!1===h){var k=a.pathStartsWith(g.company.item.index);if(k)return C.initialItemBindings=k,C.initialFlowNode=b.NO_FLOW,d.resolve(),v;a.clear(b.FLOW_QUERY,!0)}if(a.get(b.IS_FROM_CART_QUERY))k=[],k.push(f.defaultFlowPage({shortname:e}).$promise),h&&!C.isOnFlowNodePage()&&k.push(f.flowNode({shortname:e,
flowNodePk:h}).$promise),c.all(k).then(function(a){C.initialFlowNode=a[0].primaryData.flowNode;d.resolve()},d.reject);else if(h){var n=f.flowNode({shortname:e,flowNodePk:h});n.$promise.then(function(){C.initialFlowNode=n;d.resolve()},function(c){a.clear(b.FLOW_QUERY,!0);r(e,d)})}else r(e,d);return v},initialUrl:function(){q.assert(C.initialFlowNode,"flows must be initialized");return C.initialFlowNode===b.NO_FLOW?g.populate(g.company.item.index,C.initialItemBindings):C.initialFlowNode.$url(g.company.flowNode.index)},
extendWithFlow:function(c){var e=b.FLOW_QUERY,d=a.get(e);if(_.isUndefined(d))return c;var g={};g[e]=d;return a.compose(c,g,!0)},endpointParams:function(a){var b={shortname:a.company.shortname},c={allowGrouped:"yes",bookableOnly:h.isBookableOnly?"yes":"no"};0<a.childrenCount?c.flow=a.pk:e.length&&(b.itemPks=e.join(","));return{params:b,queryParams:c}},calendarController:function(a,b,c){var e=f.company.calendar,d=C.endpointParams(b);d.itemPks&&(e=f.items.calendar);c.params=_.extend({},c.params,d.params);
c.queryParams=_.extend({},c.queryParams,d.queryParams);return k(a,_.extend({url:c.url,company:b.company,endpoint:e},c))},isOnInitialFlowNode:function(){q.assert(C.initialFlowNode,"flows must be initialized");var a=C.currentFlowNodePk();return null===a||a===C.initialFlowNode.pk},isOnFlowNodePage:function(){return!(!a.pathEquals(g.company.items.index)&&!a.pathStartsWith(g.company.items.calendar)&&!a.pathStartsWith(g.company.items.date.index))},backToCartUrl:function(){var c={};c[b.IS_FROM_CART_QUERY]=
"";return a.compose(C.initialFlowNode.$url(g.embeds.book.cart.flowNode),c)}};return C}]);m.factory("poller",["$timeout","$q","db","flash",function(c,k,d,h){var f=[1,1,1,1,1,2,2,3,3,4,4,5,5,10],n=function(a){var d=this;if(!d.isCancelled)if(d.result&&!d.result.isInProgress)d.deferred.resolve(d.result);else{a=a||0;var g=d.pollIntervals[Math.min(a,d.pollIntervals.length-1)],g=1E3*g;d.result=d.endpoint(d.params,d.payload);d.request=d.result.$promise;d.request.then(function(b){d.status="success";d.isCancelled||
(d.result.isInProgress?(d.request=c(_.bind(n,d,a+1),g,d.request),d.request.cancel=function(){c.cancel(d.request)}):d.deferred.resolve(d.result))},function(a){d.status="success";d.cancel();var c=a.data.errorMessage;h.error(d.errorMessage+(c?"("+c+")":""));d.deferred.reject(a)})}};return function(a){var c=k.defer();return{endpoint:a.endpoint,params:a.params||{},payload:a.payload||{},errorMessage:a.errorMessage||"",isComplete:a.isComplete||_.constant(!0),status:"initial",isCancelled:!1,request:null,
result:null,deferred:c,pollIntervals:a.pollIntervals||f,poll:function(){this.isCancelled=!1;n.apply(this);return this},cancel:function(){this.isCancelled=!0;this.request&&this.request.cancel();this.request=null;return this},$promise:c.promise}}}]);m.run(["$rootScope","flows","searchTerms","shortcutsOverlay","toggles","translate",function(c,k,d,h,f,n){c.toggles=f;c.translate=n;c.searchTerms=d;c.shortcutsOverlay=h;c.flows=k}])})();
(function(){var m=angular.module("lib.controllers",["auth.services","db.services","lib.services"]);m.controller("lib.shared.CompanyAdminNotesEditableCtrl",["$scope","controllers","db","require","shortcutsOverlay",function(c,k,d,h,f){h.inScope(c,"company","lib.shared.CompanyAdminNotesEditableCtrl");k.editController(c,{collectionKey:"companies",elementKey:"company",modelKey:"editableCompany",update:d.company.adminNotes.update,editCallback:function(){c.editableCompany.adminNotes||(c.editableCompany.adminNotes=
"# Dashboard Flag Explanation\n\nIf there is anything critical FH Admins should know before working with this Dashboard or this client please:\n\n1. Add all critical information here, be as specific as possible\n2. Check the **Flag this company** box below\n\nOR - Erase this section if it is not applicable to this Dashboard or client\n\n-----\n# Dashboard Notes\n\nBasic overview of company, what they do/sell\n\n-----\n# Additional Feature Notes\n\nIf anything enabled in **Advanced settings** needs further explanation please include that information here, be as specific as possible.\n\nIf usage is straightforward please do not retype enabled features here.\n\n-----\n# Items\n\n\u2022 Settings that must be active on all new items\n\u2022 Information and item numbers for any items that vary in setup from the majority of the Dashboard\n\n-----\n# Resources\n\nBasic overview of company resource layout, other useful information.\n\n-----\n# Affiliates\n\nIf OTAs such as Viator, Expedia, GYG, or Google are in use please explain usage.\n\n-----\n# Related Dashboards\n\nInclude links\n\n-----\n# Major Dashboard Updates Log\n\nYour name:\nWhat you updated:\nWhen you updated it:");
f.confirmClose(!0)},cancelCallback:_.partial(f.confirmClose,!1),successCallback:function(){c.editCtrl.editing=!1;f.confirmClose(!1)},params:function(){return{shortname:c.company.shortname}}})}]);m.controller("lib.shared.NewTransportationCtrl",["$scope","$attrs","$injector","$interpolate","$parse","auth","controllers","convert","db","require","models",function(c,k,d,h,f,n,a,q,g,b,e){b.inScope(c,"customField","lib.shared.NewTransportationCtrl");var m=d.get("plusbook"),v=d.get("rebook"),r=f(k.ngNewTransportation),
C=r(c);C&&_.isString(C)&&(C=q.serverResponse(_.parseJSON(C)));var s=function(a){c.newTransportationCtrl.data=a;a.lodging?(c.newTransportationCtrl.currentLodging=_.find(c.newTransportationCtrl.lodgings,function(b){return b.pk===a.lodging}),c.newTransportationCtrl.currentLodging||(a.lodging="")):c.newTransportationCtrl.currentLodging=null;a.route&&!m.currentSourceBooking&&!l()?(c.newTransportationCtrl.currentRoute=_.find(c.newTransportationCtrl.routes,function(b){return b.pk===a.route}),c.newTransportationCtrl.currentRoute||
(a.route="")):c.newTransportationCtrl.currentRoute=null;a.stop&&c.newTransportationCtrl.currentRoute?(c.newTransportationCtrl.currentStop=_.find(c.newTransportationCtrl.currentRoute.stops,function(b){return b.pk===a.stop}),c.newTransportationCtrl.currentStop||(a.stop="")):(a.route="",c.newTransportationCtrl.currentRoute=null,a.stop="",c.newTransportationCtrl.currentStop=null);c.newTransportationCtrl.needsTransportation=!!c.newTransportationCtrl.currentStop||c.customFieldPricing.visibility.isRequired;
c.newTransportationCtrl.needsTransportation&&v.currentBooking&&D()},D=function(){c.newTransportationCtrl.rebookingTransportation=!0;c.newTransportationCtrl.rebookTransportationOptions=[];c.newTransportationCtrl.rebookTransportationOption=null;var a=function(a){_.find(c.newTransportationCtrl.rebookTransportationOptions,function(b){return b.route===a.route&&b.stop===a.stop})||(c.newTransportationCtrl.rebookTransportationOptions.push(a),c.newTransportationCtrl.rebookTransportationOption||(c.newTransportationCtrl.rebookTransportationOption=
a))};if(c.availability.defaultRoute){if(v.currentBooking.stop){var b=_.find(c.availability.defaultRoute.stops,function(a){return a.pickup===v.currentBooking.stop.pickup});b&&a({text:T("Match pickup location"),tip:T("Move to route of new availability but keep same pickup location"),route:c.availability.defaultRoute,stop:b})}(b=_.chooseFirst(c.newTransportationCtrl.currentLodging.preferredPickups,function(a){return _.find(c.availability.defaultRoute.stops,function(b){if(b.pickup===a.pickup)return b})}))&&
a({text:T("Use new availability's default"),tip:T("Use the lodging's preferred stop on the default route"),route:c.availability.defaultRoute,stop:b})}c.newTransportationCtrl.currentRoute&&c.newTransportationCtrl.currentStop&&a({text:T("Keep old booking's options"),route:c.newTransportationCtrl.currentRoute,stop:c.newTransportationCtrl.currentStop});if(c.newTransportationCtrl.canOverrideTransportation){var e={text:T("Pick new options"),route:c.availability.defaultRoute||"",stop:""};a(e)}c.newTransportationCtrl.rebookTransportationOption&&
(c.newTransportationCtrl.data.route=c.newTransportationCtrl.rebookTransportationOption.route.pk,c.newTransportationCtrl.currentRoute=c.newTransportationCtrl.rebookTransportationOption.route,c.newTransportationCtrl.data.stop=c.newTransportationCtrl.rebookTransportationOption.stop.pk,c.newTransportationCtrl.currentStop=c.newTransportationCtrl.rebookTransportationOption.stop);var d=!1;c.$watch("newTransportationCtrl.data",function(a,b){var g=_.find(c.newTransportationCtrl.rebookTransportationOptions,
function(b,c){return b.route.pk===a.route&&b.stop.pk===a.stop}),g=g||e;g!==c.newTransportationCtrl.rebookTransportationOption&&(c.newTransportationCtrl.rebookTransportationOption=g,d=!0,c.$evalAsync(function(){d=!1}))},!0);c.$watch("newTransportationCtrl.rebookTransportationOption",function(a,b){a&&a!==b&&!d&&(a.route&&(c.newTransportationCtrl.data.route=a.route.pk,c.newTransportationCtrl.currentRoute=a.route),c.$evalAsync(function(){c.newTransportationCtrl.data.stop=a.stop?a.stop.pk:"";c.newTransportationCtrl.currentStop=
a.stop||null}))})};c.availability||(c.availability={company:c.company,startAt:moment()});c.newTransportationCtrl={canOverrideTransportation:n.permissions.can("overrideTransportation",e.Booking,c.availability.company),needsTransportation:void 0,rebookingTransportation:!1,rebookingTransportationOptions:[],rebookingTransportationOption:null,data:{lodging:"",lodgingRoomNumber:"",selfLodgingAddress:"",route:"",stop:""},status:"loading"};c.newTransportationCtrl.needsTransportation=c.customFieldPricing.visibility.isRequired?
!0:c.newTransportationCtrl.canOverrideTransportation?!1:void 0;var l=function(){return c.newTransportationCtrl.canOverrideTransportation&&!c.booking&&!c.availability.defaultRoute};c.newTransportationCtrl.showSelfTransportation=function(){return l()||!c.newTransportationCtrl.currentLodging?!1:!c.newTransportationCtrl.isTransportationAvailable()||!1===c.newTransportationCtrl.needsTransportation};c.newTransportationCtrl.isTransportationAvailable=function(){if(l()||!c.newTransportationCtrl.routes.length||
!c.newTransportationCtrl.currentLodging)return!1;var a;if(a=!c.newTransportationCtrl.canOverrideTransportation)if(a=!c.customFieldPricing.visibility.isRequired)a=N(),a=!u(a);return a?!1:!0};c.newTransportationCtrl.showRoutes=function(){return 1>=c.newTransportationCtrl.routes.length?!1:c.newTransportationCtrl.canOverrideTransportation};c.newTransportationCtrl.showStops=function(){return 0>=c.newTransportationCtrl.stops.length?!1:c.newTransportationCtrl.canOverrideTransportation?!0:!u(c.newTransportationCtrl.currentRoute)};
c.newTransportationCtrl.showNeedsTransportation=function(){return c.customFieldPricing.visibility.isRequired?!1:c.newTransportationCtrl.isTransportationAvailable()};c.newTransportationCtrl.showTransportationPrice=function(){return!c.customField.isPricingHidden&&(e.PriceLine.showOffset(c.customFieldPricing)||e.PriceLine.showRate(c.customFieldPricing))};var p=function(){c.newTransportationCtrl.stops=c.newTransportationCtrl.currentRoute?c.newTransportationCtrl.currentRoute.stops:[]},N=function(){return 1===
c.newTransportationCtrl.routes.length?c.newTransportationCtrl.routes[0]:c.availability.defaultRoute?c.availability.defaultRoute:null},w=function(){var a=N();a?(c.newTransportationCtrl.data.route=a.pk,c.newTransportationCtrl.currentRoute=a):(c.newTransportationCtrl.data.route="",c.newTransportationCtrl.currentRoute=null)},u=function(a){if(c.newTransportationCtrl.currentLodging&&a)return 1===c.newTransportationCtrl.stops.length&&(c.newTransportationCtrl.canOverrideTransportation||c.customFieldPricing.visibility.isRequired)?
c.newTransportationCtrl.stops[0]:_.chooseFirst(c.newTransportationCtrl.currentLodging.preferredPickups,function(b){return _.chooseFirst(a.stops,function(a){if(a.pickup===b.pickup)return a})})},J=function(){var a=u(c.newTransportationCtrl.currentRoute);if(a)return c.newTransportationCtrl.data.stop=a.pk,c.newTransportationCtrl.currentStop=a,!0;c.newTransportationCtrl.data.stop="";c.newTransportationCtrl.currentStop=null;!c.newTransportationCtrl.canOverrideTransportation&&!c.customFieldPricing.visibility.isRequired&&
(c.newTransportationCtrl.data.route="",c.newTransportationCtrl.currentRoute=null);return!1},x=function(a){return{route:a,run:{capacity:a.capacity,customerCount:0,bookingCount:0},pk:a.pk}};c.newTransportationCtrl.routeSelectionText=function(a){var b=a.route;a=a.run;if(!c.newTransportationCtrl.canOverrideTransportation||!a.customerCount)return b.name;var e=a.customerCount.toString();null!==a.capacity&&(e+=" "+T("of")+" "+a.capacity.toString());e=interpolate(nT("(%(count)s people booked so far)","(%(count)s people booked so far)",
e),{count:e});return b.name+" "+e};var t,B,M,Q=function(){t=g.lodgings({shortname:c.availability.company.shortname},null,null,null,{tagAlong:!0});B=c.newTransportationCtrl.canOverrideTransportation?g.routes({shortname:c.availability.company.shortname},null,null,null,{tagAlong:!0}):c.availability.defaultRoute?g.route({shortname:c.availability.company.shortname,routePk:c.availability.defaultRoute.pk},null,null,null,{tagAlong:!0}):[];M=c.newTransportationCtrl.canOverrideTransportation?g.runs.searchByDate({shortname:c.availability.company.shortname,
date:c.availability.startAt.format("YYYY-MM-DD")},null,null,null,{tagAlong:!0}):[];a.dataController(c,{promises:[t.$promise,B.$promise,M.$promises],successCallback:H,errorCallback:function(){c.newTransportationCtrl.status="error"}})},H=function(){c.newTransportationCtrl.status="success";c.newTransportationCtrl.lodgings=t;c.newTransportationCtrl.routes=_.isArray(B)?B:[B];c.newTransportationCtrl.routeSelections=_.map(c.newTransportationCtrl.routes,x);_.forEach(M,function(a){var b=_.find(c.newTransportationCtrl.routeSelections,
function(b){return b.route===a.route});b&&(b.run=a)});C&&s(C);c.$watch("customFieldPricing.visibility.isRequired",function(a){a&&(c.newTransportationCtrl.needsTransportation=!0)});c.$watch("newTransportationCtrl.currentLodging",function(a,b){a&&c.newTransportationCtrl.needsTransportation&&(c.newTransportationCtrl.currentRoute||w(),a!==b&&J(),a===b&&(!c.newTransportationCtrl.canOverrideTransportation&&!c.newTransportationCtrl.currentStop)&&(p(),J()))});c.$watch("newTransportationCtrl.currentRoute",
function(a,b){p();a!==b&&a&&J()});c.$watch("newTransportationCtrl.needsTransportation",function(a,b){a!==b&&(a?(c.newTransportationCtrl.currentRoute||w(),J()):(c.newTransportationCtrl.data.route="",c.newTransportationCtrl.currentRoute=null,c.newTransportationCtrl.data.stop="",c.newTransportationCtrl.currentStop=null))});c.$watch("newTransportationCtrl.data",function(){c.newTransportationCtrl.data.lodging?r.assign(c,_.stringifyJSON(q.clientRequest(c.newTransportationCtrl.data))):r.assign(c,"")},!0)};
c.availability.pk&&_.isUndefined(c.availability.defaultRoute)?g.availability({shortname:c.availability.company.shortname,itemPk:c.availability.item.pk,availabilityPk:c.availability.pk}).$promise.then(function(){Q()}):Q()}])})();
(function(){var m=angular.module("lib.factories",[]);m.factory("dataController",["$q","cache","db",function(c,k,d){var h={};return function(f,n){n=n||{};var a=n.successCallback||_.ignore,q=n.errorCallback||_.ignore;f.dataCtrl={STALE:h,status:n.isManual?"manual":"loading",isStale:!1};var g=!1;f.$on("$destroy",function(){_.forEach(n.promises,function(a){a&&a.cancel&&a.cancel()});g=!0});var b=function(a){f.dataCtrl.status=a;f.dataCtrl.isStale=!1},e=function(a){if(a){var c=d.errorStatus(a.status);c&&
(q(a),b(c))}},m=function(c){if(!g){var d=a(c);d&&_.isFunction(d.then)?d.then(function(){b("success")},e):b("success");return c}},v=function(){if(_.isFunction(n.loadCallback)){var b=n.loadCallback();_.isObject(b)&&(_.extend(n,b),a=n.successCallback||_.ignore,q=n.errorCallback||_.ignore)}f.dataCtrl.status="loading";b=_.choose(n.promises||[]);if(!b.length)return m();n.stale&&_.every(n.stale,function(a){return!_.isUndefined(a)&&!k.fresh(a)})&&(a(f.dataCtrl.STALE),f.dataCtrl.isStale=!0,f.dataCtrl.status=
"success");return c.all(b).then(m,e)};f.dataCtrl.showLoading=function(){f.dataCtrl.status="loading"};f.dataCtrl.showComplete=function(){f.dataCtrl.status="success"};n.retry&&(f.dataCtrl.retry=function(){v()});n.isManual?f.dataCtrl.load=function(){return v()}:v();return f}}]);m.factory("navigationController",["navigation",function(c){return function(k,d){k.navigationCtrl={entries:d.entries||[]};_.forEach(k.navigationCtrl.entries,function(d){_.isUndefined(d.isCurrent)&&(d.isCurrent=function(){var f=
d.navigationUrl||d.url;return!f?!1:(d.equals?c.pathEquals:c.pathStartsWith)(f)})});k.navigationCtrl.isVisible=function(c){return _.isUndefined(c.isVisible)?!0:_.isFunction(c.isVisible)?c.isVisible():c.isVisible};return k}}]);m.factory("headerController",["$timeout","auth","models","navigation","navigationController","urls",function(c,k,d,h,f,n){return function(a,q){a.headerCtrl={};a.headerCtrl.logout=function(){a.headerCtrl.company?h.navigate(a.headerCtrl.company.$url(n.company.login)):h.navigate(n.index);
c(function(){k.logout()})};k.currentUser.isAuthenticated&&(a.headerCtrl.relatedCompanies=k.relatedCompanies());a.$watch(q.companyFn,function(c){a.headerCtrl.company=c;f(a,{entries:[{text:"Admin",url:c.$url(n.dashboard.admin.index),isVisible:function(){return c.isAdmin&&k.permissions.can("viewAdminSection",c)},shortcut:"shift+a",shortcutDescription:"Show Admin."},{text:"Bookings",url:c.$url(n.dashboard.bookings.index),isVisible:function(){return(c.isCharter||c.isAffiliate)&&k.permissions.can("viewBookingsSection",
c)},shortcut:"shift+b",shortcutDescription:"Show Bookings calendar."},{text:"Manifest",url:c.$url(n.dashboard.manifest.index),isVisible:function(){return c.isCharter&&k.permissions.can("viewManifestSection",c)},shortcut:"shift+m",shortcutDescription:"Show Manifest."},{text:"Reports",url:c.$url(n.dashboard.reports.index),isVisible:function(){return k.permissions.canList(d.Report,c)},shortcut:"shift+r",shortcutDescription:"Show Reports."},{text:"Items",url:c.$url(n.dashboard.items.index),isVisible:function(){return c.isCharter&&
k.permissions.can("viewItemsSection",c)},shortcut:"shift+i",shortcutDescription:"Show Items.",isCurrent:function(){return h.pathStartsWith(n.dashboard.items.index)||h.pathStartsWith(n.dashboard.resources.index)}},{text:"Settings",url:c.$url(n.dashboard.settings.index),shortcut:"shift+s|shift+e",shortcutDescription:"Show Settings."},{text:"Website Admin",url:"https://content.fareharbor.me/wp-admin/",isVisible:_.getter(c,"isAdmin"),isOutbound:!0},{text:"Help",url:"https://fareharbor.com/help/",isOutbound:!0}]})});
a.headerCtrl.turnOffSnowstorm=k.storage.get("turnOffSnowstorm");a.$watch("headerCtrl.turnOffSnowstorm",function(a){a?k.storage.set("turnOffSnowstorm",!0):k.storage.del("turnOffSnowstorm")});return a}}]);m.factory("emailSubjectsController",["$q","db","models","require",function(c,k,d,h){var f=[d.Booking.cls,d.Order.cls,d.Availability.cls];return function(n,a){h.defined(a,"modelKey");h.defined(a,"target","emailSubjectsCtrl: target must be provided");h.assert(_.contains(f,a.target.cls),"emailSubjectsCtrl: target must be an availability, booking, or an order");
var q={};n[a.controllerAs||"emailSubjectsCtrl"]=q;var g=a.target.company,b=a.prefix||"",e=b+"type",m=b+"subject",v=b+"language",r=function(b,c){c||(c=_.getDotted(n,a.modelKey));return _.isObject(c)?_.getDotted(c,b):void 0},C=function(b,c){_.getDotted(n,a.modelKey)[b]=c};q.resetToDefault=function(){var b=r(e),c="";n.isSubjectEditable=d.Notification.isSubjectEditable(b);b===d.Notification.DISPUTE_TYPE&&(c=d.Notification.subjectForDisputeType(a.target));a.subjectKeys?_.forEach(a.subjectKeys,function(a,
b){C(b,c||n.subjects[a]||n.subjects[g.language])}):(b=r(v),C(m,c||n.subjects[b]))};var s=!1,D=c.defer();q.promises=[D.promise];n.$watchCollection(function(){return _.getDotted(n,a.modelKey)},function(b,c){var f=r(e,b),h=r(e,c),m=r(v,b),z=r(v,c);if(!s&&f)if(f===d.Notification.DISPUTE_TYPE)q.resetToDefault();else{if(a.target.cls===d.Availability.cls){if(n.subjects&&f===h)return;h=_.values(a.subjectKeys).join(",");n.subjects=k.subjects.availability({shortname:g.shortname,type:f,availabilityPk:a.target.pk,
languages:h})}else{if(!m||n.subjects&&f===h&&m===z)return;n.subjects=a.target.cls===d.Order.cls?k.subjects.order({shortname:g.shortname,type:f,orderUuid:a.target.uuid,language:m}):k.subjects.booking({shortname:g.shortname,type:f,bookingUuid:a.target.uuid,language:m})}s=!0;n.subjects.$promise.then(function(){q.resetToDefault();s=!1;D.resolve()}).catch(function(){D.reject()})}});return q}}]);m.factory("cannedMessagesController",["$q","auth","db","flash","models","navigation","require","toggles",function(c,
k,d,h,f,n,a,q){return function(g,b){a.defined(b,"modelKey");a.defined(b,"noteField");b.cannedField=b.cannedField||"message";var e={};g.cannedMessagesCtrl=e;e.toggleKey="canned-message-"+g.$id;e.useDefaultMessage=!b.languageKey&&!b.onTranslationsLoad&&!b.languageOverride;var m=function(a,b){var c=f.SupportedLanguage.rootLanguage(b),e=_.find(a,{language:b});return(e=(e=e||_.find(a,{language:c}))||_.find(a,function(a){return f.SupportedLanguage.shareRootLanguage(a.language,b)}))?e.fieldValue:null};e.onTranslationsLoad=
b.onTranslationsLoad||function(a,c){var d=c[b.cannedField],k=b.languageOverride||g[b.modelKey][b.languageKey],n=a(k);n?d=n:f.SupportedLanguage.shareRootLanguage(c.company.language,k)||h.warn(interpolate(T("Selected canned message is missing translation for %(language)s, using original message instead."),{language:f.SupportedLanguage.display(k)}));e.addMessageToNote(d)};e.select=function(a){var c=k.permissions.canView(f.SupportedLanguage,a.company),n=a.company.companyFeatures.isContentTranslationEnabled;
if(e.useDefaultMessage||!n||!c){e.addMessageToNote(a[b.cannedField]);var s=f.SupportedLanguage.shareRootLanguage(b.languageOverride||g[b.modelKey][b.languageKey],a.company.language);n&&(!c&&!s)&&h.warn(interpolate(T("You do not have permission to view translated content for %(companyName)s. Please contact your administrator."),{companyName:a.company.name}));q.toggle(e.toggleKey,!1)}else{e.loadingCannedMessagePk=a.pk;var D=d.translationsForField({shortname:a.company.shortname,objectType:a.cls,objectId:a.pk,
objectField:b.cannedField});return D.$promise.then(function(){var b=_.filter(D.translationsForField,function(a){return a.supportedLanguage.isLive}),b=_.bind(m,null,b);e.onTranslationsLoad(b,a)}).finally(function(){e.loadingCannedMessagePk=!1;q.toggle(e.toggleKey,!1)})}};e.addMessageToNote=b.addMessageToNote||function(a){var c=g[b.modelKey][b.noteField]||"",c=c.replace(/\s+$/g,"");""!==c&&(c=c.concat("\n\n"));a=c.concat(a);g[b.modelKey][b.noteField]=b.formattingFn?b.formattingFn(a):a};e.TYPES=b.types||
f.CannedMessage.TYPES;e.displayType=f.CannedMessage.displayType;e.promises=[];b.cannedMessagesByType||(b.cannedMessagesByType={},_.forEach(e.TYPES,function(a){b.cannedMessagesByType[a]=[]}),_.forEach(_.unique([n.currentCompany,k.currentUser.company,b.company]),function(a){a&&k.permissions.canList(f.CannedMessage,a)&&(a=d.cannedMessages({shortname:a.shortname}),e.promises.push(a.$promise.catch(_.ignore)))}),c.all(e.promises).then(function(a){a=_.flatten(_.pluck(a,"primaryData"));_.forEach(a,function(a){_.contains(e.TYPES,
a.type)&&b.cannedMessagesByType[a.type].push(a)})}));e.cannedMessagesByType=b.cannedMessagesByType;e.isEmptyMessage=function(a){a=a[b.cannedField];return _.isString(a)?_.isEmpty(a):_.isNull(a)};e.hasEmptyMessages=function(a){return _.all(e.cannedMessagesByType[a],e.isEmptyMessage)};return g}}]);m.factory("imageUploadController",["$q","filepicker","require",function(c,k,d){return function(h,f){d.defined(f,"modelKey");var n=f.id||"image",a=f.field||"imageUrl",q=f.width||2560,g=f.height||2560,b=_.isUndefined(f.resetAfterSubmit)?
!0:f.resetAfterSubmit,e=function(){_.extend(h.imageUploadCtrl[n],{url:"",urls:{},initialUrls:{},isSelected:!1,isPristine:!0,isUploading:!1,isCropping:!1,isSavingCrop:!1,crop:{},unCroppedUrl:null})},m=function(a){var b=c.defer();k.store({url:a},{location:"S3"},function(a){console.log("imageUploadCtrl: stored image ",a.url);b.resolve(a)},function(a){console.error("imageUploadCtrl: unable to store image",a);b.reject(a)});return b.promise},v=function(a){var b=c.defer(),e={height:g,width:q,fit:"max"};
k.convert(a,e,function(a){h.$safeApply(function(){console.log("imageUploadCtrl: converted image",a.url,e);b.resolve(a)})},function(a){h.$safeApply(function(){console.error("imageUploadCtrl: unable to convert image",a);b.reject(a)})});return b.promise};if(!h.imageUploadCtrl||h.imageUploadCtrl.scope!==h)h.imageUploadCtrl={scope:h,ids:[]},h.imageUploadCtrl.isPristine=function(){return _.every(h.imageUploadCtrl.ids,function(a){return h.imageUploadCtrl[a].isPristine})},h.imageUploadCtrl.isUploading=function(){return _.some(h.imageUploadCtrl.ids,
function(a){return h.imageUploadCtrl[a].isUploading})};h.imageUploadCtrl.ids.push(n);h.imageUploadCtrl[n]={};h.imageUploadCtrl[n].clear=function(){h.imageUploadCtrl[n].urls[a]="";h[f.modelKey][a]="";_.extend(h.imageUploadCtrl[n],{url:"",isSelected:!1,isPristine:!1,crop:{},unCroppedUrl:null})};h.imageUploadCtrl[n].select=function(){h.imageUploadCtrl[n].isUploading=!0;k.pick({mimetypes:["image/*"],services:["COMPUTER","WEBCAM","FACEBOOK","INSTAGRAM","URL"]},function(b){h.$apply(function(){v(b).then(function(b){h.imageUploadCtrl[n].urls[a]=
b.url;h[f.modelKey][a]=b.url;_.extend(h.imageUploadCtrl[n],{url:b.url,isSelected:!0,isPristine:!1,isUploading:!1,crop:{},unCroppedUrl:null})},function(a){console.error("imageUploadCtrl.select: unable to convert image",a);h.imageUploadCtrl[n].isUploading=!1})})},function(a){h.$apply(function(){101!==a.code&&console.error("imageUploadCtrl.select: unable to pick image",a);h.imageUploadCtrl[n].isUploading=!1})})};h.imageUploadCtrl[n].edit=function(){d.defined(f,"elementKey");var b=h[f.elementKey][a];
h.imageUploadCtrl[n].urls[a]=b;h.imageUploadCtrl[n].initialUrls[a]=b;h[f.modelKey][a]=b;_.extend(h.imageUploadCtrl[n],{url:b,isSelected:!!b,crop:{},unCroppedUrl:null})};h.imageUploadCtrl[n].submit=function(){var d=h.imageUploadCtrl[n].urls[a],d=h.imageUploadCtrl[n].initialUrls[a]!==d&&d?m(d):c.reject();h.imageUploadCtrl[n].isPristine=!0;b&&e();return d};h.imageUploadCtrl[n].cancel=function(){e()};h.imageUploadCtrl[n].saveCrop=function(){h.imageUploadCtrl[n].isSavingCrop=!0;var b={fit:"crop",crop:[h.imageUploadCtrl[n].crop.x,
h.imageUploadCtrl[n].crop.y,h.imageUploadCtrl[n].crop.width,h.imageUploadCtrl[n].crop.height],format:"jpg",quality:90},c=h.imageUploadCtrl[n].url;k.stat({url:c},function(e){e.url=c;k.convert(e,b,function(b){h.$safeApply(function(){h[f.modelKey][a]=b.url;h.imageUploadCtrl[n].urls[a]=b.url;_.extend(h.imageUploadCtrl[n],{url:b.url,isPristine:!1,isCropping:!1,isSavingCrop:!1,unCroppedUrl:c})})},function(a){console.error("imageUploadCtrl.saveCrop: unable to crop image",a)})})};h.imageUploadCtrl[n].startCropping=
function(){h.imageUploadCtrl[n].unCroppedUrl&&(h.imageUploadCtrl[n].url=h.imageUploadCtrl[n].unCroppedUrl);h.imageUploadCtrl[n].isCropping=!0};h.imageUploadCtrl[n].cancelCrop=function(){h.imageUploadCtrl[n].isCropping=!1;h.imageUploadCtrl[n].url=h[f.modelKey][a]};e();return h}}]);m.factory("splitPaymentController",["require","toggles",function(c,k){return function(c,h){c.splitPaymentCtrl={customerCount:h.customerCount(),amount:h.amount(),divideByPeople:1,payForPeople:1,splitAmount:0};c.$watch(function(){return h.amount()},
function(f){c.splitPaymentCtrl.amount=f});c.$watch(h.customerCount,function(f){f=Math.max(1,f);c.splitPaymentCtrl.customerCount=f;c.splitPaymentCtrl.divideByPeople=f;c.splitPaymentCtrl.payForPeople=Math.min(c.splitPaymentCtrl.divideByPeople,c.splitPaymentCtrl.payForPeople)});c.$watch(function(){var f=_.roundHalfToEven(c.splitPaymentCtrl.amount*c.splitPaymentCtrl.payForPeople/c.splitPaymentCtrl.divideByPeople);isFinite(f)||(f=0);return f},function(f){c.splitPaymentCtrl.splitAmount=f});c.splitPaymentCtrl.useSplitAmount=
function(){var f=Math.min(c.splitPaymentCtrl.splitAmount,h.max());0>=f||(h.amount(f),k.toggle("splitPaymentCalc",!1))}}}]);m.factory("reorderController",["$window","db","flash",function(c,k,d){return function(h,f){var n=f.reorderCallback||_.ignore,a=f.reorderConfirm,q=f.reorderConfirmWhen||(a?_.always:_.never);h=h||{};h.reorderCtrl={};h.reorderCtrl.reorder=function(g,b,e){var m={},v=0;b&&(m.previousPk=b.pk,v=(b.sortableIndex||0)+0.1);!e&&f.alwaysLast&&(e=f.alwaysLast);e&&(m.nextPk=e.pk,v=(e.sortableIndex||
0)-0.1);var r;f.collectionKey?r=_.get(h,f.collectionKey):f.collectionFn&&(r=f.collectionFn(g));if(r){if(q(g,b,e)&&!c.confirm(a||T("Are you sure you want to reorder this list?")))return!1;g.sortableIndex=v;_.ref.reorder(r,g,b,e);g=k.reorder({shortname:(g.company?g.company:f.company).shortname,objectCls:g.cls?g.cls:f.cls,objectPk:g.pk},{},null,m);n(g);g.$promise.then(function(){d.success(T("Saved sort order"))},function(){d.error(T("Sort order not saved, please try again."))})}};return h}}]);m.factory("listController",
["reorderController","imageUploadController","urls","events",function(c,k,d,h){return function(f,n){var a=n.get,q=n.create||a&&a.create,g=n.remove,b=n.successCallback||_.ignore,e=n.errorCallback||_.ignore,m=n.submitCallback||_.ignore,v=n.removeCallback||_.ignore,r=_.isFunction(n.params)?n.params:_.constant(n.params||{}),C=d.extract,s=_.isUndefined(n.reset)?!0:n.reset,D=_.isUndefined(n.closeAfterSubmit)?!0:n.closeAfterSubmit,l=!!n.imageUpload,p=n.defaultModel||{};_.isFunction(p)||(p=_.constant(p));
f[n.modelKey]=_.extend({},p());l&&k(f,{modelKey:n.modelKey});a&&(n.collectionKey&&!_.isArray(_.get(f,n.collectionKey)))&&_.set(f,n.collectionKey,a(r()));f.listCtrl={};f.listCtrl.submit=function(a){var c=f[n.modelKey],d=m(a);d&&(c=_.extend({},c,d));var g=(n.createFn?n.createFn():q)(r(),c,a);g.$promise.then(function(c){if(n.collectionKey){var e=_.get(f,n.collectionKey);e&&(_.isArray(g)?n.overwrite?_.overwrite(e,g):_.ref.append(e,g):e.push(g))}f.listCtrl.cancel(a);n.refreshActivities&&h.broadcast("dashboard.shared.ActivitiesCtrl.refresh");
l&&f.imageUploadCtrl.image.submit();b(g,a,c)},function(b){e(b,a)})};f.listCtrl.adding=n.adding||!1;f.listCtrl.cancel=function(a){D&&(f.listCtrl.adding=!1);s&&(f[n.modelKey]=_.extend({},p()));a.$setPristine()};f.listCtrl.add=function(){f.listCtrl.adding=!0};f.listCtrl.toggle=function(){f.listCtrl.adding=!f.listCtrl.adding};f.listCtrl.close=function(a){f.listCtrl.adding=!1;a&&s&&(f[n.modelKey]=_.extend({},p()),a.$setPristine())};n.sortable&&n.collectionKey&&(f.listCtrl.reorder=c(f,{collectionKey:n.collectionKey,
reorderCallback:n.reorderCallback,reorderConfirm:n.reorderConfirm,reorderConfirmWhen:n.reorderConfirmWhen,alwaysLast:n.alwaysLast,company:n.company}).reorderCtrl.reorder);n.remove&&(f.listCtrl.remove=function(a,b){f.listCtrl.status="removing";g(C(a),{},b).$promise.then(function(){f.listCtrl.status="success";b&&_.overwrite(b,{});n.collectionKey&&_.overwriteWithout(_.get(f,n.collectionKey),_.isReferenceEqualTo(a));n.refreshActivities&&h.broadcast("dashboard.shared.ActivitiesCtrl.refresh");v(a)})});
return f}}]);m.factory("createController",["events",function(c){return function(k,d){var h=d.get||{},f=d.create||h.create,n=d.successCallback||_.ignore,a=d.errorCallback||_.ignore,q=d.submitCallback||_.ignore,g=_.isFunction(d.params)?d.params:_.constant(d.params||{}),b=_.isUndefined(d.reset)?!0:d.reset,e=d.defaultModel||{},m=function(a){return _.set(k,d.modelKey,a)};m(_.extend({},e));k.createCtrl={};k.createCtrl.creating=!1;k.createCtrl.submit=function(b){q(b);var e=f(g(),_.get(k,d.modelKey),b);e.$promise.then(function(){k.createCtrl.cancel(b);
d.refreshActivities&&c.broadcast("dashboard.shared.ActivitiesCtrl.refresh");n(e,b)},function(c){a(c,b)})};k.createCtrl.cancel=function(a){b&&m(_.extend({},e));a.$setPristine();k.createCtrl.creating=!1};return k}}]);m.factory("removeController",[function(){return function(c,k){var d=k.remove||k.get.remove,h=k.removeCallback||_.ignore,f=_.isFunction(k.params)?k.params:_.constant(k.params||{});c.removeCtrl={status:"success"};c.removeCtrl.remove=function(n){c.removeCtrl.status="removing";d(f(),{},n).$promise.then(function(){c.removeCtrl.status=
"success";n&&_.overwrite(n,{});k.collectionKey&&_.overwriteWithout(c[k.collectionKey],_.isReferenceEqualTo(c[k.elementKey]));h(c[k.elementKey],n)},function(){c.removeCtrl.status="error"})};return c}}]);m.factory("editController",["$injector","events","flash","imageUploadController","navigation",function(c,k,d,h,f){return function(c,a){var q=a.get||_.ignore,g=a.update||q.update,b=a.remove||q.remove,e=a.successCallback||_.ignore,m=a.errorCallback||_.ignore,v=a.editCallback||_.ignore,r=a.removeCallback||
_.ignore,C=a.cancelCallback||_.ignore,s=a.submitCallback||_.ignore,D=_.isFunction(a.params)?a.params:_.constant(a.params||{}),l=a.jsonFieldKeys||[],p=!!a.imageUpload;c.editCtrl={};c.editCtrl.editing=!1;c.editCtrl.status="success";p&&h(c,{modelKey:a.modelKey,elementKey:a.elementKey});if(!_.isUndefined(_.get(c,a.collectionKey))||a.remove)c.editCtrl.remove=function(e){c.editCtrl.status="removing";b(D(),{},e).$promise.then(function(){c.editCtrl.status="success";e&&_.overwrite(e,{});var b=_.get(c,a.collectionKey);
b&&_.overwriteWithout(b,_.isReferenceEqualTo(c[a.elementKey]));a.refreshActivities&&k.broadcast("dashboard.shared.ActivitiesCtrl.refresh");a.flashAfterRemove&&(b=_.isString(a.flashAfterRemove)?a.flashAfterRemove:"Deleted "+c[a.elementKey].unicode+".",d.success(b));a.navigateAfterRemove&&f.navigate(a.navigateAfterRemove);r(c[a.elementKey],e)},function(){c.editCtrl.status="error"})};var N=function(){var b={};_.forEach(c[a.elementKey],function(a,c){if(!_.isObject(a)||_.includes(l,c))b[c]=a});a.modelFields&&
(b=_.pick(b,a.modelFields));c[a.modelKey]=b};c.editCtrl.edit=function(a,b){b||N();c.editCtrl.editing=!0;p&&c.imageUploadCtrl.image.edit();v(a)};c.editCtrl.cancel=function(b){c.editCtrl.editing=!1;N();C(b);b&&b.$setPristine();a.editing&&c.editCtrl.edit(b)};c.editCtrl.submit=function(b){var d=c[a.modelKey],f=s(b);f&&(d=_.extend({},d,f));c.editCtrl.status="submitting";var h=g(D(),d,b);h.$promise.then(function(d){c.editCtrl.status="success";b.$setPristine();c.editCtrl.editing=!1;a.refreshActivities&&
k.broadcast("dashboard.shared.ActivitiesCtrl.refresh");p&&c.imageUploadCtrl.image.submit();e(h,b,d);a.editing&&c.editCtrl.edit(b)},function(e){c.editCtrl.status="error";m(e,b);a.editing&&c.editCtrl.edit(b,a.skipResetAfterError)})};a.editing&&c.editCtrl.edit();return c}}]);m.factory("calendarController",["$filter","$injector","auth","cache","db","events","localization","navigation","require","urls",function(c,k,d,h,f,n,a,q,g,b){return function(c,g){var m=k.get("flows"),r=b.calendarUrls(g.url),C=_.isFunction(g.params)?
g.params:_.constant(g.params||{}),s=_.isFunction(g.queryParams)?g.queryParams:_.constant(g.queryParams||{}),D=g.endpoint,l=g.beforeRequest||_.ignore,p=g.onSuccess||_.ignore,N=g.largeDaySelected||_.ignore,w=g.smallDaySelected||_.ignore,u=g.urlParams||_.ignore,J=g.preselectDate||null,x=_.isFunction(g.isSundayBased)?g.isSundayBased:_.isBoolean(g.isSundayBased)?_.constant(g.isSundayBased):_.constant(g.company?g.company.features.isSundayBased:!0);c.calendarCtrl={status:"uninitialized",company:g.company||
null,isSundayBased:x,calendar:{},isRetrieving:!1,isEmptyAllowed:g.isEmptyAllowed||!1,date:moment().startOf("day"),isCalendarEmpty:g.isCalendarEmpty||_.ignore,isWeekEmpty:g.isWeekEmpty||_.ignore,isDayEmpty:g.isDayEmpty||_.ignore,isDayUsed:g.isDayUsed||_.ignore,isEditable:g.isEditable||!1,editDay:g.editDay||_.ignore,showSelectedDay:_.isUndefined(g.showSelectedDay)?!0:g.showSelectedDay};var t=moment().startOf("day");c.calendarCtrl.dropdownMonths=_.map([T("January"),T("February"),cT("the month of March",
"March"),T("April"),cT("the month of May","May"),T("June"),T("July"),T("August"),T("September"),T("October"),T("November"),T("December")],function(a,b){return{value:b,text:a}});c.calendarCtrl.dropdownYears=_.map(_.range(t.year()-2,t.year()+5),function(a){return{value:a,text:a}});var B=!1,M,Q,H=c.calendarCtrl.refresh=function(a){B=!1;if(!1!==l()){var b=_.extend({year:c.calendarCtrl.date.format("YYYY"),month:c.calendarCtrl.date.format("MM")},C()),d=s();if(a||!angular.equals([b,d],[M,Q]))M=b,Q=d,c.calendarCtrl.status=
"loading",E={},c.calendarCtrl.calendar.$promise&&c.calendarCtrl.calendar.$promise.cancel(),c.calendarCtrl.calendar=D(_.extend({},b),{},null,d),h.fresh(c.calendarCtrl.calendar)?c.calendarCtrl.isRetrieving=!0:O(),c.calendarCtrl.calendar.$promise.then(function(a){a!==f.CANCELLED&&(O(),c.calendarCtrl.status="success",c.calendarCtrl.isRetrieving=!1,p(a))},function(){c.calendarCtrl.status="error";c.calendarCtrl.isRetrieving=!1})}},y=function(a,b){var c=t-a.at;return 0===c?b.current||"":0<c?b.past||"":b.future||
""};c.calendarCtrl.dayPastPresentFutureClass=function(a){return y(a,{past:"past-day",current:"current-day"})};c.calendarCtrl.anonymousDayClass=function(a){return 0===a.count?"empty":a.isBookable?"":"no-bookable"};c.calendarCtrl.isPastWeek=function(a){return y(_.last(a.days),{past:!0})};var E={},R=t.clone().startOf("month");c.calendarCtrl.showingPastWeek=function(a){return 0!==c.calendarCtrl.date.clone().startOf("month").diff(R)||E[a.number]};c.calendarCtrl.showPastWeek=function(a){E[a.number]=!0};
q.watch(c,function(a){if(q.pathEquals(r.index))q.redirect(b.populate(r.month,_.extend({year:c.calendarCtrl.date.format("YYYY"),month:c.calendarCtrl.date.format("MM")},u())));else{var d;(d=q.pathEquals(r.month))?(a=d.year,d=d.month-1,a=moment({year:a,month:d,day:1}),c.calendarCtrl.style="month",c.calendarCtrl.date=a,c.calendarCtrl.monthDropdown=a.month(),c.calendarCtrl.yearDropdown=a.year(),n.broadcast("lib.shared.CalendarCtrl.month",{date:c.calendarCtrl.date}),H()):console.warn("calendarController: invalid calendar url",
a)}});var X=c.calendarCtrl.monthUrl=function(a,c){return b.populate(r.month,_.extend({year:a.format("YYYY"),month:a.format("MM")},u(),c))};c.calendarCtrl.nextMonthUrl=function(){var a=c.calendarCtrl.date.clone();a.add(1,"months");return X(a)};c.calendarCtrl.currentMonthUrl=function(){return X(t)};c.calendarCtrl.previousMonthUrl=function(){var a=c.calendarCtrl.date.clone();a.add(-1,"months");return X(a)};c.$watch("calendarCtrl.yearDropdown",function(a,b){if(!_.isUndefined(b)&&a!==b){var d=c.calendarCtrl.date.clone();
d.year(a);d=X(d);q.pathEquals(d)||q.navigate(m.extendWithFlow(d))}});c.$watch("calendarCtrl.monthDropdown",function(a,b){if(!_.isUndefined(b)&&a!==b){var d=c.calendarCtrl.date.clone();d.month(a);d=X(d);q.pathEquals(d)||q.navigate(m.extendWithFlow(d))}});c.calendarCtrl.isCurrentMonth=function(){return c.calendarCtrl.date.year()===t.year()&&c.calendarCtrl.date.month()===t.month()};n.on(c,"lib.shared.CalendarCtrl.refresh",function(){H(!0)});var Y=c.calendarCtrl.dayForDate=function(a){if(a){var b=c.calendarCtrl.calendar.weeks;
if(!b)return null;var d=null;_.some(b,function(b){return _.some(b.days,function(b){return b.at.isSame(a,"day")?(d=b,!0):!1})});return d}};c.calendarCtrl.goToToday=function(){q.navigate(c.calendarCtrl.currentMonthUrl());c.calendarCtrl.selectedDay=Y(moment());E={}};c.calendarCtrl.selectLargeDay=function(a){c.calendarCtrl.selectedDay=a;N(a)};c.calendarCtrl.dayLabel=function(b,d){return d===c.calendarCtrl.calendar.weeks[0]&&b===d.days[0]?b.at.format(a.current().DATE_FORMATS.dayWithMonthAbbr):1===b.number?
b.at.format(a.current().DATE_FORMATS.dayWithMonthAbbr):b.number};c.calendarCtrl.selectSmallDay=function(a){a&&(c.calendarCtrl.selectedDay=a,w(a),B=!0)};var O=function(){if(J){var a=Y(J())||Y(c.calendarCtrl.date);c.calendarCtrl.selectedDay=a;w(a)}else a=B?c.calendarCtrl.selectedDay.at:d.currentUser.isAuthenticated?c.calendarCtrl.date.year()===t.year()&&c.calendarCtrl.date.month()===t.month()?t:c.calendarCtrl.date.clone().startOf("month"):null,c.calendarCtrl.selectedDay=Y(a)};c.calendarCtrl.debouncedRefresh=
_.debounce(function(a){c.$safeApply(function(){c.calendarCtrl.refresh(a)})},1E3,{leading:!0});c.calendarCtrl.effectiveRange=function(a,b){var c=a.startAt,d=a.endAt;c<b.at&&(c=b.at);d>b.at+864E5&&(d=b.at.clone().add(1,"day").startOf("day"));return{startAt:c,endAt:d}};return c}}]);m.factory("availabilityCalendarController",["$filter","calendarController","events","navigation",function(c,k,d,h){return function(f,n){var a=_.isFunction(n.params)?n.params:_.constant(n.params||{}),q=n.beforeRequest||_.ignore,
g=_.isUndefined(n.autoOpenItemGroups)?!0:n.autoOpenItemGroups,b=n.openLightframe?n.openLightframe:h.navigate,e=n.items||null,m=function(a){var d=a.availabilities,e=a.itemGroups||[];g&&(!d.length&&1===e.length)&&(a=c("itemGroupUrl")(e[0],a.at),b(a))};d.on(f,"dashboard.bookings.NavigationCtrl.calendarFilter.items",function(a,b){var c=b.items||[],d=_.difference(c,f.calendarCtrl.items).length;f.calendarCtrl.items=c;d&&f.calendarCtrl.debouncedRefresh(!0)});d.on(f,"dashboard.bookings.NavigationCtrl.filterChoicesUpdated",
function(a,b){b&&(f.calendarCtrl.items=b.filteredItems||[]);f.calendarCtrl.refresh()});_.extend(n,{isCalendarEmpty:function(){return!f.calendarCtrl.calendar.availabilityCount},isWeekEmpty:function(a){return!a.availabilityCount},isDayEmpty:function(a){var b=a.availabilities;a=a.itemGroups||[];return!b.length&&!a.length?!0:f.isCalendarFiltered?_.all(b,f.isCalendarFiltered)&&_.all(a,f.isCalendarFiltered):!1},isDayUsed:function(a){var b=a.availabilities;a=a.itemGroups||[];f.isCalendarFiltered&&(b=_.reject(b,
f.isCalendarFiltered),a=_.reject(a,f.isCalendarFiltered));b=_.sum(_.pluck(b,"customerCount"));a=_.sum(_.pluck(a,"customerCount"));return 0<b+a},smallDaySelected:n.smallDaySelected||m,beforeRequest:function(){return f.calendarCtrl.items&&!f.calendarCtrl.items.length?!1:q()},params:function(){var b=_.extend({},a());if(f.calendarCtrl.items){var c=_.pluck(f.calendarCtrl.items,"pk").join(",");b.itemPks=c}return b}});k(f,n);_.extend(f.calendarCtrl,{items:e,nextBookableMonthUrl:function(){var a=f.calendarCtrl.calendar.nextBookableStartAt;
if(a)return f.calendarCtrl.monthUrl(a)},alreadyRedirectedToNextBookableMonth:!1,redirectToNextBookableMonth:function(){f.calendarCtrl.alreadyRedirectedToNextBookableMonth||(f.calendarCtrl.alreadyRedirectedToNextBookableMonth=!0,h.redirect(f.calendarCtrl.nextBookableMonthUrl()))}});return f}}]);m.factory("emailPreviewController",["convert","models","navigation","urls",function(c,k,d,h){var f={type:"type",emails:"emails",subject:"subject",note:"note",language:"language"};return function(n,a){var q=
_.extend({},f,a.fields),g=_.isFunction(a.params)?a.params:_.constant(a.params||{}),b;a.data&&(b=_.isFunction(a.data)?a.data:function(){return a.data});n.emailPreviewCtrl={};n.emailPreviewCtrl.previewUrl=function(){var e={};_.forEach(q,function(b,c){b&&(e[c]=n[a.modelKey][b]||"")});a.languageOverride&&(e.language=a.languageOverride);b&&_.extend(e,c.clientRequest(b()));var f=h.populate(a.url,g(e.type));return d.compose(f,e)};var e=_.isFunction(a.isPreviewable)?a.isPreviewable:_.constant(a.isPreviewable);
n.emailPreviewCtrl.isPreviewable=function(){var b=n[a.modelKey][q.type],c=n[a.modelKey][q.emails],d=n[a.modelKey][q.subject];if(!b||!c||!d)return!1;c=e(b);return!_.isUndefined(c)?c:k.Notification.isPreviewable(b)};return n}}]);m.factory("affiliationController",["$q","auth","cache","db","editController","events","models",function(c,k,d,h,f,n,a){return function(q,g){var b=function(a){return(g.prefix?g.prefix+"-":"")+"voucher-"+a};q.affiliationCtrl={status:"success",substatus:"success",showDesks:!1};
q.affiliationCtrl.agentName=function(b){return b===a.Agent.OTHER_AGENT?b.name:b.name+" (#"+b.pk+")"};q[g.modelKey][b("agent")]="";q[g.modelKey][b("agentName")]="";q[g.modelKey][b("desk")]="";q[g.modelKey][b("deskName")]="";var e=function(b){q.affiliationCtrl.agents=[];q.affiliationCtrl.desks=[];q.affiliationCtrl.showDesks=!1;if(b){var e={agents:k.permissions.canCreate(a.Agent,b),desks:k.permissions.canCreate(a.Desk,b)},g={agents:a.Agent.OTHER_AGENT,desks:a.Desk.OTHER_DESK},f=function(a,b){_.overwrite(q.affiliationCtrl[a],
b);e[a]&&q.affiliationCtrl[a].push(g[a])},n=[];if(k.permissions.canList(a.Agent,b.affiliateCompany)){var l=h.agents({shortname:b.affiliateCompany.shortname}),p=l.$promise.then(function(){f("agents",l)});d.fresh(l)?n.push(p):f("agents",l)}if(k.permissions.canList(a.Desk,b.affiliateCompany)){var m=h.desks({shortname:b.affiliateCompany.shortname});b=m.$promise.then(function(){q.affiliationCtrl.showDesks=0<m.length;f("desks",m)});d.fresh(m)?n.push(b):(q.affiliationCtrl.showDesks=0<m.length,f("desks",
m))}n.length&&(q.affiliationCtrl.substatus="loading",c.all(n).then(function(){q.affiliationCtrl.substatus="success"}))}};q.$watch(g.affiliateModelKey+".currentAffiliation",function(a,c){e(a);if(a&&c&&a!==c||!a)q[g.modelKey][b("agent")]="",q[g.modelKey][b("agentName")]="",q[g.modelKey][b("desk")]="",q[g.modelKey][b("deskName")]=""});var m=function(b){var c=g.booking?g.booking.company:g.company;k.permissions.canList(a.Affiliation,c)?c.affiliatesCount>a.Affiliation.MAX_SELECTABLE_AFFILIATES?(q.affiliationCtrl.affiliatesNgDropdownEndpoint=
h.searchEndpoint(h.affiliates.pickable,{shortname:c.shortname}),q.affiliationCtrl.status="success"):(q.affiliationCtrl.affiliations=h.affiliates.pickable({shortname:c.shortname},null,null,null,{flashError:!!g.isEditingAffiliationOnBooking}),q.affiliationCtrl.status=d.fresh(q.affiliationCtrl.affiliations)?"loading":"stale",q.affiliationCtrl.affiliations.$promise.then(function(){q.affiliationCtrl.status="success";g.booking&&g.booking.affiliation&&!_.contains(q.affiliationCtrl.affiliations,g.booking.affiliation)&&
q.affiliationCtrl.affiliations.unshift(g.booking.affiliation)},function(){g.isEditingAffiliationOnBooking&&q.editCtrl.cancel(b)})):q.affiliationCtrl.status="success"};g.isEditingAffiliationOnBooking?f(q,{elementKey:"affiliation",modelKey:g.modelKey,update:h.booking.affiliation.update,editCallback:function(a){m(a);q[g.modelKey].isBlockable=g.booking.isBlockable;q[g.modelKey].affiliation=g.booking.affiliation?g.booking.affiliation.pk:"";q[g.modelKey][b("agent")]=g.booking.agent?g.booking.agent.pk:"";
q[g.modelKey][b("desk")]=g.booking.desk?g.booking.desk.pk:"";q[g.modelKey][b("voucherNumber")]=g.booking.voucherNumber;q[g.affiliateModelKey].currentAffiliation=g.booking.affiliation||null},successCallback:function(a){var c=-1==q[g.modelKey][b("agent")],d=-1==q[g.modelKey][b("desk")];(c||d)&&e(a.booking.affiliation);n.broadcast("dashboard.shared.ActivitiesCtrl.refresh")},params:function(){return{shortname:g.booking.company.shortname,bookingUuid:g.booking.uuid}}}):m()}}]);m.factory("controllers",["affiliationController",
"calendarController","cannedMessagesController","createController","dataController","editController","emailPreviewController","emailSubjectsController","headerController","imageUploadController","listController","navigationController","removeController","reorderController","splitPaymentController",function(c,k,d,h,f,n,a,q,g,b,e,m,v,r,C){return{affiliationController:c,calendarController:k,cannedMessagesController:d,createController:h,dataController:f,editController:n,emailPreviewController:a,emailSubjectsController:q,
headerController:g,imageUploadController:b,listController:e,navigationController:m,removeController:v,reorderController:r,splitPaymentController:C}}])})();
(function(){var m=angular.module("lib.models",[]);m.factory("models",["$filter","$injector","convert","require",function(c,k,d,h){var f=c("orderBy"),n=c("pluralize"),a=c("name"),q=[["US",cT('"USA" acronym for United States of America',"USA")],["AF",T("Afghanistan")],["AL",T("Albania")],["DZ",T("Algeria")],["AS",T("American Samoa")],["AD",T("Andorra")],["AO",T("Angola")],["AI",T("Anguilla")],["AQ",T("Antarctica")],["AG",T("Antigua & Barbuda")],["AR",T("Argentina")],["AM",T("Armenia")],["AW",T("Aruba")],
["AU",T("Australia")],["AT",T("Austria")],["AZ",T("Azerbaijan")],["BS",T("Bahamas")],["BH",T("Bahrain")],["BD",T("Bangladesh")],["BB",T("Barbados")],["BY",T("Belarus")],["BE",T("Belgium")],["BZ",T("Belize")],["BJ",T("Benin")],["BM",T("Bermuda")],["BT",T("Bhutan")],["BO",T("Bolivia")],["BA",T("Bosnia and Herzegovina")],["BW",T("Botswana")],["BV",T("Bouvet Island")],["BR",T("Brazil")],["IO",T("British Indian Ocean Territory")],["VG",T("British Virgin Islands")],["BN",T("Brunei Darussalam")],["BG",T("Bulgaria")],
["BF",T("Burkina Faso")],["BI",T("Burundi")],["KH",T("Cambodia")],["CM",T("Cameroon")],["CA",T("Canada")],["CV",T("Cape Verde")],["KY",T("Cayman Islands")],["CF",T("Central African Republic")],["TD",T("Chad")],["CL",T("Chile")],["CN",T("China")],["CX",T("Christmas Island")],["CC",T("Cocos (Keeling) Islands")],["CO",T("Colombia")],["KM",T("Comoros")],["CG",T("Congo")],["CK",T("Cook Iislands")],["CR",T("Costa Rica")],["HR",T("Croatia")],["CU",T("Cuba")],["CY",T("Cyprus")],["CZ",T("Czech Republic")],
["DK",T("Denmark")],["DJ",T("Djibouti")],["DM",T("Dominica")],["DO",T("Dominican Republic")],["TP",T("East Timor")],["EC",T("Ecuador")],["EG",T("Egypt")],["SV",T("El Salvador")],["GQ",T("Equatorial Guinea")],["ER",T("Eritrea")],["EE",T("Estonia")],["ET",T("Ethiopia")],["FK",T("Falkland Islands (Malvinas)")],["FO",T("Faroe Islands")],["FJ",T("Fiji")],["FI",T("Finland")],["FR",T("France")],["FX",T("France, Metropolitan")],["GF",T("French Guiana")],["PF",T("French Polynesia")],["TF",T("French Southern Territories")],
["GA",T("Gabon")],["GM",T("Gambia")],["GE",T("Georgia")],["DE",T("Germany")],["GH",T("Ghana")],["GI",T("Gibraltar")],["GR",T("Greece")],["GL",T("Greenland")],["GD",T("Grenada")],["GP",T("Guadeloupe")],["GU",T("Guam")],["GT",T("Guatemala")],["GN",T("Guinea")],["GW",T("Guinea-Bissau")],["GY",T("Guyana")],["HT",T("Haiti")],["HM",T("Heard & McDonald Islands")],["HN",T("Honduras")],["HK",T("Hong Kong")],["HU",T("Hungary")],["IS",T("Iceland")],["IN",T("India")],["ID",T("Indonesia")],["IQ",T("Iraq")],["IE",
T("Ireland")],["IR",T("Islamic Republic of Iran")],["IL",T("Israel")],["IT",T("Italy")],["CI",T("Ivory Coast")],["JM",T("Jamaica")],["JP",T("Japan")],["JO",T("Jordan")],["KZ",T("Kazakhstan")],["KE",T("Kenya")],["KI",T("Kiribati")],["KP",T("Korea, Democratic People's Republic of")],["KR",T("Korea, Republic of")],["KW",T("Kuwait")],["KG",T("Kyrgyzstan")],["LA",T("Lao People's Democratic Republic")],["LV",T("Latvia")],["LB",T("Lebanon")],["LS",T("Lesotho")],["LR",T("Liberia")],["LY",T("Libyan Arab Jamahiriya")],
["LI",T("Liechtenstein")],["LT",T("Lithuania")],["LU",T("Luxembourg")],["MO",T("Macau")],["MG",T("Madagascar")],["MW",T("Malawi")],["MY",T("Malaysia")],["MV",T("Maldives")],["ML",T("Mali")],["MT",T("Malta")],["MH",T("Marshall Islands")],["MQ",T("Martinique")],["MR",T("Mauritania")],["MU",T("Mauritius")],["YT",T("Mayotte")],["MX",T("Mexico")],["FM",T("Micronesia")],["MD",T("Moldova, Republic of")],["MC",T("Monaco")],["MN",T("Mongolia")],["MS",T("Monserrat")],["MA",T("Morocco")],["MZ",T("Mozambique")],
["MM",T("Myanmar")],["NA",T("Namibia")],["NR",T("Nauru")],["NP",T("Nepal")],["NL",T("Netherlands")],["AN",T("Netherlands Antilles")],["NC",T("New Caledonia")],["NZ",T("New Zealand")],["NI",T("Nicaragua")],["NE",T("Niger")],["NG",T("Nigeria")],["NU",T("Niue")],["NF",T("Norfolk Island")],["MP",T("Northern Mariana Islands")],["NO",T("Norway")],["OM",T("Oman")],["PK",T("Pakistan")],["PW",T("Palau")],["PA",T("Panama")],["PG",T("Papua New Guinea")],["PY",T("Paraguay")],["PE",T("Peru")],["PH",T("Philippines")],
["PN",T("Pitcairn")],["PL",T("Poland")],["PT",T("Portugal")],["PR",T("Puerto Rico")],["QA",T("Qatar")],["RE",T("Reunion")],["RO",T("Romania")],["RU",T("Russian Federation")],["RW",T("Rwanda")],["LC",T("Saint Lucia")],["WS",T("Samoa")],["SM",T("San Marino")],["ST",T("Sao Tome & Principe")],["SA",T("Saudi Arabia")],["SN",T("Senegal")],["RS",T("Serbia")],["SC",T("Seychelles")],["SL",T("Sierra Leone")],["SG",T("Singapore")],["SK",T("Slovakia")],["SI",T("Slovenia")],["SB",T("Solomon Islands")],["SO",T("Somalia")],
["ZA",T("South Africa")],["GS",T("South Georgia and the South Sandwich Islands")],["ES",T("Spain")],["LK",T("Sri Lanka")],["SH",T("St. Helena")],["KN",T("St. Kitts and Nevis")],["PM",T("St. Pierre & Miquelon")],["VC",T("St. Vincent & the Grenadines")],["SD",T("Sudan")],["SR",T("Suriname")],["SJ",T("Svalbard & Jan Mayen Islands")],["SZ",T("Swaziland")],["SE",T("Sweden")],["CH",T("Switzerland")],["SY",T("Syrian Arab Republic")],["TW",T("Taiwan")],["TJ",T("Tajikistan")],["TZ",T("Tanzania, United Republic of")],
["TH",T("Thailand")],["TG",T("Togo")],["TK",T("Tokelau")],["TO",T("Tonga")],["TT",T("Trinidad & Tobago")],["TN",T("Tunisia")],["TR",T("Turkey")],["TM",T("Turkmenistan")],["TC",T("Turks & Caicos Islands")],["TV",T("Tuvalu")],["UG",T("Uganda")],["UA",T("Ukraine")],["AE",T("United Arab Emirates")],["GB",T("United Kingdom (Great Britain)")],["UM",T("United States Minor Outlying Islands")],["VI",T("United States Virgin Islands")],["US",cT('"USA" acronym for United States of America',"USA")],["ZZ",T("Unknown or unspecified country")],
["UY",T("Uruguay")],["UZ",T("Uzbekistan")],["VU",T("Vanuatu")],["VA",T("Vatican City State (Holy See)")],["VE",T("Venezuela")],["VN",T("Viet Nam")],["WF",T("Wallis & Futuna Islands")],["EH",T("Western Sahara")],["YE",T("Yemen")],["YU",T("Yugoslavia")],["ZR",T("Zaire")],["ZM",T("Zambia")],["ZW",T("Zimbabwe")]],g=_.map(q,function(a){return a[0]}),b=function(a){var b=k.get("db").slipstream("currencyChoices");return _.isUndefined(b)?(console.warn("getCurrencyChoices: currency choices undefined"),[]):
!a?b:_.filter(b,function(b){return _.contains(a,b[0])})},e={NETWORK_FILTER:"#network",COMPANY_FILTER:"#company",ADMIN_FILTER:{},filterUrl:function(a){return a===e.COMPANY_FILTER?"":a===e.ADMIN_FILTER?"admin/":a===e.NETWORK_FILTER?"network/":"network/"+a.shortname+"/"}},m=function(a,b,c,d){return function(e){return e[a]===b?e[c]:d}},v={US_COUNTRY_CODE:"US",ADMIN_TYPE:"admin",CHARTER_TYPE:"charter",AFFILIATE_TYPE:"affiliate",CALL_CENTER_SHORTNAME:"fhcallcenter",NO_FEE_TYPE:"no-fee",PERCENTAGE_FEE_TYPE:"percentage-fee",
FLAT_FEE_TYPE:"flat-fee",TIERED_FEE_TYPE:"tiered-fee",WATERFALL_FEE_TYPE:"waterfall-fee",ROLLING_WINDOW_PERIOD_TYPE:"rolling-window-period",IMMEDIATE_PERIOD_TYPE:"immediate-period",REFUND_RESERVE_AMOUNT_FORMAT:"fixed",REFUND_RESERVE_PERCENT_FORMAT:"percent",US_PROCESSOR_COUNTRY:"US",ADMIN_SHORTNAME:"admin",isAdmin:function(a){return a&&a.shortname===v.ADMIN_SHORTNAME},MONTH_VIEW:"month",DAY_VIEW:"day",AGENDA_VIEW:"agenda",GRID_VIEW:"grid",TIMELINE_VIEW:"timeline",AVAILABILITY_TIMELINE:"availability",
RESOURCE_TIMELINE:"resource",MANIFEST_AVAILABILITIES_VIEW:"availabilities",MANIFEST_ITEMS_VIEW:"items",MANIFEST_BOOKINGS_VIEW:"bookings",MANIFEST_RUNS_VIEW:"runs",MANIFEST_RESOURCES_VIEW:"resources",TAKE_PAYMENT_PREFERENCE:"take",INFO_PAYMENT_PREFERENCE:"info",SKIP_PAYMENT_PREFERENCE:"skip",FH_BLUE:"#0a6ece",DEFAULT_TIERED_FEE_SCHEDULE:[{cutoff:0,rate:"0.06"}],DEFAULT_PRE_LOCATION_HEADING:T("Before we begin:"),DEFAULT_START_LOCATION_HEADING:T("Please meet us at:"),DEFAULT_PRIMARY_LOCATION_HEADING:T("We're headed to:"),
DEFAULT_END_LOCATION_HEADING:T("We will end at:"),forObject:function(a){if(a)return a.cls===v.cls?a:a.cls===U.cls?a.payment.company:a.company},INVOICE_FEE_RATE:1.9,INVOICE_FLAT_FEE:30,COUNTRIES:q,COUNTRY_CODES:g,getCountryDefaults:function(a){var b=k.get("db").slipstream("countryDefaults");return _.isUndefined(b)?(console.warn("getCountryDefaults: country defaults data undefined"),[]):b[a]},getCurrencyChoices:b,getCurrencyCodes:function(){var a=k.get("db").slipstream("currencies");return _.isUndefined(a)?
(console.warn("getCurrencyCodes: currency data undefined"),[]):_.keys(a)},DEFAULT_LANGUAGE:"en-us",DEFAULT_INCLUDED_TAX_PERCENTAGE_BY_COUNTRY:{AU:10},DEFAULT_TAX_DISPLAY_NAME:T("Taxes"),DEFAULT_TAX_DISPLAY_NAMES:{AU:"GST"},IDEAL_COUNTRY_CODES:["NL"],IDEAL_CURRENCIES:["eur"],SOFORT_COUNTRY_CODES:"AT BE DE IT NL ES".split(" "),SOFORT_CURRENCIES:["eur"],taxDisplayName:function(a){return a.features.taxDisplayName?a.features.taxDisplayName:v.DEFAULT_TAX_DISPLAY_NAMES[a.processorCountry]||v.DEFAULT_TAX_DISPLAY_NAME},
COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE:"company_locale_default",ANONYMOUS_USER_LOCALE_DEFAULT_TIME_FORMAT_TYPE:"user_locale_default",TWELVE_HOUR_TIME_FORMAT_TYPE:"12_hour",TWENTY_FOUR_HOUR_TIME_FORMAT_TYPE:"24_hour",FALLBACK_SERVER_EXACT_TWELVE_HOUR_TIME_FORMAT:"g:iA",FALLBACK_SERVER_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:"H:i",FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT:"h:mma",FALLBACK_CLIENT_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:"HH:mm",FALLBACK_CLIENT_TOP_OF_HOUR_TWELVE_HOUR_TIME_FORMAT:"ha",FALLBACK_CLIENT_TOP_OF_HOUR_TWENTY_FOUR_HOUR_TIME_FORMAT:"HH:mm",
FAST_PAYOUT_TIMEZONES:["US/Eastern","US/Central","US/Mountain","US/Arizona","US/Pacific"],isFastPayoutsAvailable:function(a){return!1},isSofortPaymentSupported:function(a){return _.contains(v.SOFORT_CURRENCIES,a.processorCurrency)},hasMultipleProcessorsEnabled:function(a){return 1<a.enabledProcessorTypes.length}},r=_.map([v.MONTH_VIEW,v.DAY_VIEW,v.AGENDA_VIEW,v.GRID_VIEW,v.TIMELINE_VIEW],function(a){return[a,_.capitalize(a)]}),C=_.filter(r,function(a){return a[0]!==v.DAY_VIEW});v.dashboardBookingsViewChoices=
function(a){return a?r:C};v.rollingWindowDays=m("payoutPeriodType",v.ROLLING_WINDOW_PERIOD_TYPE,"rollingWindowDays",0);v.flatFee=m("feeType",v.FLAT_FEE_TYPE,"flatFee",0);v.percentageFeeRate=m("feeType",v.PERCENTAGE_FEE_TYPE,"percentageFeeRate",0);var s={downtimeAlert:"2019-12-02T02:45-07:00"},g={verboseName:T("resource"),verboseNamePlural:T("resources"),NONE_GRANULARITY:"none",bookingResources:function(a){return _.sortBy(_.unique(_.flatten(_.map(a.customers,function(a){return _.pluck(a.resourceUses,
"resourceRequirement.resource")}))),"name")},displayName:function(a){return a.name+(a.isArchived?" "+T("(archived)"):"")}},m={verboseName:T("resource requirement"),verboseNamePlural:T("resource requirements"),name:function(a){return a.isItemLevel?a.shortName+" ("+a.item.name+")":a.shortName}},D={BOOKING_TYPE:"booking",CUSTOMERS_TYPE:"customers",FOR_ALL_CUSTOMER_PROTOTYPES:T("Every customer"),isApplicable:function(a,b){b=!_.isArray(b)?[b]:b;if(a.type!==D.CUSTOMERS_TYPE)return!1;if(a.requirementGroup.isItemLevel){var c=
_.pluck(a.customerPrototypeRequirements,"customerPrototype");return!c.length?!0:0<_.intersection(c,_.pluck(b,"customerPrototype")).length}c=_.pluck(a.customerTypeRequirements,"customerType");return!c.length?!0:0<_.intersection(c,_.pluck(b,"customerPrototype.customerType")).length},forCustomerPrototypes:function(a){return a.type===D.BOOKING_TYPE?T("Whole booking"):!a.customerPrototypeRequirements.length&&!a.customerTypeRequirements.length?D.FOR_ALL_CUSTOMER_PROTOTYPES:a.requirementGroup.isItemLevel?
_.map(a.customerPrototypeRequirements,function(a){a=a.customerPrototype;return a.name||c("name")(a.customerType)}).join(", "):_.map(a.customerTypeRequirements,function(a){a=a.customerType;return c("name")(a)}).join(", ")}},l={START_TIMING:"start-timing",END_TIMING:"end-timing",DATE_TIMING:"date-timing",PADDING_END_AT_KIND:"padding-kind",LENGTH_END_AT_KIND:"length-kind",SEATING_LABELS:{isSingleSeatGroupRequired:T("don\u2019t allow split parties across groups"),isEmptySeatGroupRequired:T("make groups exclusive"),
isEntireSeatMapRequired:T("fill all seats once booked")},times:function(a,b){var c,d,e=a.timing;e===l.START_TIMING?c=b.startAt.clone():e===l.END_TIMING?c=b.endAt.clone():e===l.DATE_TIMING?c=b.startAt.clone().startOf("day"):console.error("ResourceRequirement.times: invalid timing "+e);c.subtract(a.startAtHours,"hours");var e=a.endAtKind,g=a.endAtHours;e===l.PADDING_END_AT_KIND?d=b.endAt.clone().add(g,"hours"):e===l.LENGTH_END_AT_KIND?d=c.clone().add(a.hours,"hours"):console.error("ResourceRequirement.times: invalid endAtKind "+
e);return{startAt:c,endAt:d}},allowedZones:function(a){var b=a.resource.settings.seatZones;a=a.settings.seatZones;a.length&&(b=_.intersection(b,a));return _.toTrueKeys(b)},displayableSeatingSettings:function(a){return _.reduce(a.settings,function(a,b,c){(c=l.SEATING_LABELS[c])&&b&&a.push(_.capitalize(c));return a},[])}},p={displayOption:function(a){return a?a.isIgnoreOveruse?T("Create uses, don't check overuse"):a.isSkipResourceUseCreation?T("Don't create uses, check overuse"):T("Create uses, check overuse"):
""},equals:function(a,b){return _.isUndefined(a.customerTypeRate)||_.isUndefined(b.customerTypeRate)?a.booking.pk===b.booking.pk&&a.resourceRequirement.pk===b.resourceRequirement.pk&&a.useCount===b.useCount:a.customerTypeRate.pk===b.customerTypeRate.pk&&a.resourceRequirement.pk===b.resourceRequirement.pk&&a.useCount===b.useCount},resourceUseSummaries:function(a,b){b=b||[];return _.reduce(function(a){return _.reduce(a,function(a,b){var c=b.resourceRequirement.resource;a[c.pk]=a[c.pk]||[];a[c.pk].push(b);
return a},{})}(a),function(a,c,d){a[d]=a[d]||{};a[d].totalUseCount=parseFloat(_.sum(c,"useCount").toFixed(2));a[d].totalSeatCount=_.filter(c,"seat").length;a[d].resourcePk=d;a[d].resourceName=c[0].resourceRequirement.resource.name;a[d].isResourceArchived=c[0].resourceRequirement.resource.isArchived;a[d].isOverused=-1<_.map(b,"pk").indexOf(parseInt(d));return a},{})},resourceUseSummaryKey:function(a,b){return a+"-"+b},isSeatResource:function(a){return!a.company.features.isSeatingEnabled?!1:a.seat?
!0:!!a.resourceRequirement.resource.seatMapPk},isAnySeatableResourceUses:function(a){return!a.company.features.isSeatingEnabled?!1:_.any(a.customers,function(a){return _.any(a.resourceUses,p.isSeatResource)})},seatableResourceUses:function(a){return _.filter(_.flatten(_.pluck(a.customers,"resourceUses")),p.isSeatResource)},seatedResourceUses:function(a){return _.filter(_.flatten(_.pluck(a.customers,"resourceUses")),"seat")},newResourceUseKey:function(a){return["seat",a.requirementPk,a.customerTypeRatePk,
a.customerIndex,a.seatIndex].join("-")},isNewResourceUseKey:function(a){return _.isString(a)&&_.startsWith(a,"seat")},isNewResourceUseKeyForCustomerTypeRate:function(a,b){return p.isNewResourceUseKey(a)&&_.int(_.split(a,"-")[2])===b.pk},setNewResourceUseKeySeatIndexToZero:function(a){a=_.split(a,"-");return p.newResourceUseKey({requirementPk:a[1],customerTypeRatePk:a[2],customerIndex:a[3],seatIndex:0})},useCountsTotal:function(a){return _.sum(a,"useCount")},displayArchivedResource:function(a){return a.resourceRequirement.resource.isArchived?
T("(archived)"):""}},N={RELATED_FEATURE_FLAG:"isSeatingEnabled",DEFAULT_SEAT_SIZE:28,MAX_SEAT_SIZE:40,MIN_SEAT_SIZE:20,style:function(a,b){b?(delete b.$center,delete b.$index):_.forEach(a.seats,function(a){a.seatGroup&&(delete a.seatGroup.$center,delete a.seatGroup.$index)});_.forEach(a.seats,function(a){b&&a.seatGroupPk!==b.pk||a.$style&&a.$style()})},maxZoom:function(a){return N.MAX_SEAT_SIZE-a.settings.seatSize},minZoom:function(a){return N.MIN_SEAT_SIZE-a.settings.seatSize}},w={verboseName:T("group"),
FORM_FIELDS:["rotation","xNudge","yNudge"],RELATED_FEATURE_FLAG:"isSeatingEnabled"},u={forBooking:function(a){return _.flatten(_.pluck(a.customers,"seatAssignments"))},isAnyForBooking:function(a){return _.any(u.forBooking(a))},sortBySeatMap:function(a){return _.sortBy(_.compact(u.forBooking(a)),"seat.seatMap.settings.displayName")},displayableSeatAssignment:function(a){var b=a.seatMap.settings,c=[];b.isSeatZoneVisible&&c.push(a.seatZone.name);b.isSeatGroupVisible&&c.push(a.seatGroup.name);b.isSeatNameVisible&&
c.push(a.name);return c.join(", ")}},J={UNLIMITED:"unlimited",CAPACITY_CHOICES:[[0,0],[1,1],["unlimited",T("Unlimited")]],FORM_FIELDS:"name isNameVisible width height rotation xNudge yNudge capacity seatZonePk seatGroupPk".split(" "),RELATED_FEATURE_FLAG:"isSeatingEnabled",verboseName:T("seat"),getOverlappingSeat:function(a,b){return _.find(b,function(b){return J.isOverlappingOtherSeat(a,b)?b:null})},isOverlappingOtherSeat:function(a,b){if(a===b)return!1;var c=a.yCoord+a.height-1;if(a.xCoord+a.width-
1<b.xCoord||c<b.yCoord)return!1;c=b.yCoord+b.height-1;return b.xCoord+b.width-1<a.xCoord||c<a.yCoord?!1:!0},newPositions:function(a,b,c){var d=0,e=0,g=_.min(a,function(a){return a.xCoord+a.yCoord});a=_.map(a,function(a){var f=b+(a.xCoord-g.xCoord);a=c+(a.yCoord-g.yCoord);d=f<d?f:d;e=a<e?a:e;return{xCoord:f,yCoord:a}});(0>d||0>e)&&_.forEach(a,function(a){a.xCoord-=d;a.yCoord-=e});return a},defaultSeat:function(a,b,c,d){return{name:"",isNameVisible:!1,width:1,height:1,capacity:1,rotation:0,xNudge:0,
yNudge:0,seatZonePk:c,seatGroupPk:d,xCoord:a,yCoord:b}},commonSeatGroup:function(a,b){var c=_.unique(_.pluck(a,"seatGroupPk"));return 1!==c.length?null:_.findWhere(b,{pk:c[0]})},isBookable:function(a){return _.filter(a,function(a){return 0!==a.capacity})}},x={verboseName:T("zone"),RELATED_FEATURE_FLAG:"isSeatingEnabled"},t={MAX_COLOR:12,DEFAULT_RECEIPT_FOOTER:cT('"order" as in sales order',"Thanks for your order!"),isValidColor:function(a){return _.isNumber(a)&&0<=a&&a<=t.MAX_COLOR},images:function(a,
b){var c=[];a.images.length?c=[].concat(a.images):a.imageCdnUrl&&(c=[{croppedUrl:a.imageCdnUrl,imageCdnUrl:a.imageCdnUrl}]);b&&(b.availabilityHeadline&&b.availabilityHeadline.imageCdnUrl)&&c.unshift({croppedUrl:b.availabilityHeadline.imageCdnUrl,imageCdnUrl:b.availabilityHeadline.imageCdnUrl});return c},checklistName:function(a){var b=a.name;a.isPrivate?b="<span class='badge badge-lock ghost'>"+T("Private")+"</span> "+b:a.isUnlisted&&(b="<span class='badge'>"+T("Unlisted")+"</span> "+b);a.shortName&&
(b=b+" <span class='fh-grey'>("+a.shortName+")</span>");return b},isSeatingConfirmationsEnabled:function(a){return a.company.features.isSeatingEnabled&&a.settings.isSeatingConfirmationsEnabled},verboseName:T("item"),verboseNamePlural:T("items")},B={NO_FLOW:{pk:!1,name:T("None")},PAGE_TYPE:"page",LINK_TYPE:"link",ITEM_TYPE:"item",FLOW_QUERY:"flow",IS_FROM_CART_QUERY:"from-cart",WIDTH_ONE_THIRD:"1-3",WIDTH_HALF:"1-2",WIDTH_TWO_THIRDS:"2-3",WIDTH_FULL:"1-1",HEIGHT_1:1,HEIGHT_2:2,HEIGHT_3:3,singleItemRedirect:function(a){return a&&
a!==B.NO_FLOW&&B.isAllItems(a)&&a.emptyPageChildren&&1===a.emptyPageChildren.length?a.emptyPageChildren[0].item:null},effectiveChildren:function(a){var b=a.children;B.isAllItems(a)&&(b=a.emptyPageChildren);return b||[]},childItems:function(a){return _.compact(_.pluck(B.effectiveChildren(a),"item"))},childPages:function(a){return _.filter(a.children,{type:B.PAGE_TYPE})},isCalendarIncluded:function(a){if(!a.isCalendarIncluded)return!1;a=B.effectiveChildren(a);return _.any(a,function(a){return a.type===
B.PAGE_TYPE||a.type===B.ITEM_TYPE&&!a.item.isRetail})},breadcrumbName:function(a){return a.shortName||a.name},isAllItems:function(a){return 0===a.childrenCount},isSingleLevelFlow:function(a){h.assert(a.children&&a.breadcrumbs,"Flow node must be fully loaded");return 0<a.breadcrumbs.length||0<B.childPages(a).length?!1:!0},gridColumnCount:function(a){a=B.effectiveChildren(a).length;return 6<=a||3===a?3:4<=a||2===a?2:1},defaultBlockWidth:function(a){if(!B.isAllItems(a))return B.WIDTH_ONE_THIRD;a=B.gridColumnCount(a);
return 3===a?B.WIDTH_ONE_THIRD:2===a?B.WIDTH_HALF:B.WIDTH_FULL},emptyGridBlockCount:function(a){if(!B.isAllItems(a))return 0;var b=B.gridColumnCount(a);return(a=B.effectiveChildren(a).length%b)?b-a:0},heading:function(a){return a.properties.heading||(a.item?a.item.name:a.name)},subheading:function(a){return a.properties.subheading?a.properties.subheading:a.item?a.item.headline:""},imageUrl:function(a){return a.imageCdnUrl?a.imageCdnUrl:a.item?a.item.imageCdnUrl||(a.item.images.length?a.item.images[0].croppedCdnUrl:
null):null},imageMaxWidth:function(a){return!a.properties.width?550:B.isTallBlock(a)?null:B.imageMinWidth(a)},imageMaxHeight:function(a){return!a.properties.width?null:B.isTallBlock(a)?B.imageMinHeight(a):null},imageMinWidth:function(a){switch(a.properties.width){case B.WIDTH_ONE_THIRD:return 604;case B.WIDTH_HALF:return 920;case B.WIDTH_TWO_THIRDS:return 1236;case B.WIDTH_FULL:return 1868;default:return 0}},imageMinHeight:function(a){switch(a.properties.height){case B.HEIGHT_1:return 332;case B.HEIGHT_2:return 692;
case B.HEIGHT_3:return 1052;default:return 0}},isTallBlock:function(a){return a.properties.height>B.HEIGHT_1&&(a.properties.width===B.WIDTH_ONE_THIRD||a.properties.width===B.WIDTH_HALF)||a.properties.width===B.WIDTH_TWO_THIRDS&&a.properties.height===B.HEIGHT_3},WIDTH_LABELS:{}};B.WIDTH_LABELS[B.WIDTH_ONE_THIRD]="one-third";B.WIDTH_LABELS[B.WIDTH_HALF]="half";B.WIDTH_LABELS[B.WIDTH_TWO_THIRDS]="two-thirds";B.WIDTH_LABELS[B.WIDTH_FULL]="full";var M={effectiveMinimumPartySize:function(a){return null!==
a.minimumPartySize?a.minimumPartySize:a.customerPrototype.minimumPartySize},effectiveMaximumPartySize:function(a){return null!=a.maximumPartySize?a.maximumPartySize:a.customerPrototype.maximumPartySize},find:function(a,b,c){var d;c||(d=_.find(a,function(a){return a.customerPrototype===b.customerPrototype}));d||(d=_.find(a,function(a){return a.customerPrototype.customerType===b.customerPrototype.customerType}));return d}},Q={ANY_CONDITIONS_TYPE:"any",ALL_CONDITIONS_TYPE:"all",isVisibleWhenBooking:function(a,
b,c){return a.isHidden?!1:!a.customFieldInstanceConditions.length?!0:(a.conditionsType===Q.ANY_CONDITIONS_TYPE?_.any:_.all)(a.customFieldInstanceConditions,function(a){return H.isMatch(a,b,c)})},find:function(a,b){return _.contains(a,b)?b:_.find(a,{customField:b.customField})}},H={SELECTED_TYPE:"selected",NOT_SELECTED_TYPE:"not-selected",EXACT_TYPE:"exact",NOT_EXACT_TYPE:"not-exact",SELECTED_NOT_EXACT_TYPE:"selected-ne",RANGE_TYPE:"range",SELECTED_OPTIONS:[{name:T("is not empty"),value:"selected"},
{name:T("is empty"),value:"not-selected"}],EXACT_OPTIONS:[{name:T("is not empty"),value:"selected"},{name:T("is empty"),value:"not-selected"},{name:T("is:"),value:"exact"},{name:T("is not:"),value:"selected-ne"},{name:T("is empty or not:"),value:"not-exact"}],RANGE_OPTIONS:[{name:T("is in range:"),value:"range"}],isValidParent:function(a){return _.contains([F.SHORT_TYPE,F.YES_NO_TYPE,F.CODE_GENERATOR_TYPE,F.EXTENDED_OPTION_TYPE,F.MULTI_CAMPAIGN_TYPE,F.COUNT_TYPE],a.customField.type)},types:function(a){if(H.needsExactValue(a)){var b=
H.EXACT_OPTIONS;a.customField.type===F.COUNT_TYPE&&(b=b.concat(H.RANGE_OPTIONS));return b}return H.SELECTED_OPTIONS},needsExactValue:function(a){return _.contains([F.SHORT_TYPE,F.EXTENDED_OPTION_TYPE,F.COUNT_TYPE],a.customField.type)},needsCustomField:function(a){return _.contains([H.EXACT_TYPE,H.NOT_EXACT_TYPE,H.SELECTED_NOT_EXACT_TYPE,H.RANGE_TYPE],a.type)},isMatch:function(a,b,c){c=c||{};var d=c[a.uri];if(!_.isUndefined(d))return d;c[a.uri]=!1;var e=a.parentCustomFieldInstance;if(!e||e.isHidden||
!Q.isVisibleWhenBooking(e,b,c))return!1;d=a.type;b=b(e);d===H.SELECTED_TYPE?d=!!b:d===H.NOT_SELECTED_TYPE?d=!b:d===H.EXACT_TYPE?d=a.exactValue===b:d===H.NOT_EXACT_TYPE?d=!b||a.exactValue!==b:d===H.SELECTED_NOT_EXACT_TYPE?d=!!b&&a.exactValue!==b:d===H.RANGE_TYPE?(d=a.properties,d=d.rangeStart<=b&&b<=d.rangeEnd):d=!1;return c[a.uri]=d},rawValue:function(a){return a.type===H.RANGE_TYPE?a.properties:a.exactValue}},y={CHECKED_IN_TYPE:"checked-in",NO_SHOW_TYPE:"no-show",MIXED_CHECKIN_STATUS:{pk:"mixed",
name:T("Set check-in per customer..."),type:"mixed"},EMPTY_CHECKIN_STATUS:{pk:"",name:T("Not yet checked in")},RELATED_FEATURE_FLAG:"isCheckinEnabled",isCheckedIn:function(a){return a&&a.type===y.CHECKED_IN_TYPE},isNoShow:function(a){return a&&a.type===y.NO_SHOW_TYPE},isMixed:function(a){return a===y.MIXED_CHECKIN_STATUS},bookingCheckinStatus:function(a){if(a&&a.customers&&a.customers.length){var b=a.customers[0]?a.customers[0].checkinStatus:null;return _.every(a.customers,{checkinStatus:b})?b:y.MIXED_CHECKIN_STATUS}},
bookingCheckinStatusObject:function(a){return y.bookingCheckinStatus(a)||y.EMPTY_CHECKIN_STATUS},bookingCheckinBreakdown:function(a){var b={};_.forEach(a.customers,function(a){var c=a.customerTypeRate.customerPrototype.customerType,d=a.checkinStatus||null;a=c.uri+":"+(d?d.uri:"");c=b[a]||{count:0,customerType:c,checkinStatus:d};c.count+=1;b[a]=c});a=f(_.values(b),function(a){return!a.checkinStatus?[1,2,0,a.customerType.sortableIndex]:[0,a.checkinStatus.type===P.CheckinStatus.NOT_CHECKED_IN_TYPE?1:
0,a.checkinStatus.sortableIndex,a.customerType.sortableIndex]});return _.map(a,function(a){var b=a.customerType.shortName||n(a.count,a.customerType.singular,a.customerType.plural),c=a.checkinStatus?a.checkinStatus.name:T("not checked in");return a.count.toString()+"\u00a0"+b+"\u00a0"+c}).join(", ")},checkinStatusClass:function(a){return a?a.type:"not-checked-in"},checkinStatusSort:function(a){return[!!a,y.isCheckedIn(a),y.isMixed(a),y.isNoShow(a),a?a.sortableIndex:0]}},E=function(a){return function(b){return R.effectiveBookingRestriction(b,
a)}},R={AUTO_STATUS:"auto",OPEN_STATUS:"open",CALL_STATUS:"call",CLOSED_STATUS:"closed",DISPLAY_STATUS_BY_STATUS:{auto:T("Auto close"),open:T("Open"),call:T("Closed & Call to book"),closed:T("Closed & hidden")},displayStatus:function(a){return R.DISPLAY_STATUS_BY_STATUS[a]},cutoffReachedStart:function(a){var b=R.cutoffReachedKind(a),c=R.cutoffReachedHours(a);return sa.cutoffStart(b,c,a.utcStartAt)},cutoffUnreachedStart:function(a){var b=R.cutoffUnreachedKind(a),c=R.cutoffUnreachedHours(a);return sa.cutoffStart(b,
c,a.utcStartAt)},effectiveBookingRestriction:function(a,b){return a.bookingRestriction?a.bookingRestriction[b]:a.item.bookingRestriction?a.item.bookingRestriction[b]:a.item[b]},soldOutText:E("soldOutText"),isBookableEverByPhone:E("isBookableEverByPhone"),cutoffReachedKind:E("cutoffReachedKind"),cutoffReachedHours:E("cutoffReachedHours"),cutoffUnreachedKind:E("cutoffUnreachedKind"),cutoffUnreachedHours:E("cutoffUnreachedHours"),isInPast:function(a){var b=a.utcEndAt;a=a.customerCount?R.cutoffReachedStart(a):
R.cutoffUnreachedStart(a);b=Math.max(b.unix(),a.unix());a=moment().unix();return b<a},minimumPartySize:function(a){return a.customerCount?R.effectiveBookingRestriction(a,"minimumSubsequentPartySize"):R.effectiveBookingRestriction(a,"minimumInitialPartySize")},maximumPartySize:function(a){return a.customerCount?R.effectiveBookingRestriction(a,"maximumSubsequentPartySize"):R.effectiveBookingRestriction(a,"maximumInitialPartySize")},blockedCustomerCount:function(a){return _.sum(a.blocks,"customerCount")},
reservedCapacity:function(a){return _.sum(a.blocks,"reservedCapacity")},AFFILIATE_SORT_ORDER:"affiliate",BOOKED_AT_SORT_ORDER:"bookedAt",BOOKED_BY_SORT_ORDER:"bookedBy",CONTACT_NAME_SORT_ORDER:"name",PAID_STATUS_SORT_ORDER:"status",PAX_COUNT_SORT_ORDER:"paxCount"},X={COMPLETED_TYPE:"completed",PENDING_TYPE:"pending",items:function(a){return Y.uniqueItems(a.allBookings)},isNoTax:function(a){return _.all(a.contributingBookings,"availability.item.isNoTax")},receiptFooter:function(a){a=_.uniq(_.map(X.items(a),
"receiptFooter"));return 1===a.length&&a[0]?a[0]:t.DEFAULT_RECEIPT_FOOTER},showTaxByType:function(a){return a.company.features.isTaxTypeBreakdownEnabled&&!(ga.LEGACY_TAX_TYPE_PK in a.contributingBookingCosts.totalCost.taxByType)}},E={COUNTRIES:q},Y={CANCELLED_STATUS:"cancelled",UNCANCELLED_STATUS:"uncancelled",PAID_PAID_STATUS:"paid",UNPAID_PAID_STATUS:"unpaid",OVERPAID_PAID_STATUS:"overpaid",UNDERPAID_PAID_STATUS:"underpaid",COMPLETED_TYPE:"completed",PENDING_TYPE:"pending",paymentsAndRefunds:function(a){var b=
_.append.apply(null,_.map(_.reject(a.payments,"isHold"),"refunds"));_.ref.append(b,a.payments);return _.sortBy(b,"createdAt")},adjustBookingFee:function(a,b,c,d){b+=c;return!b||!d?a:d<b?_.roundHalfToEven(a*((b-d)/b)):0},affiliateCompany:function(a){return a.affiliation?a.affiliation.affiliateCompany:void 0},newTransportation:function(a){if(a.customFieldValues)return _.find(a.customFieldValues,function(a){return a.customFieldInstance.customField.type===F.NEW_TRANSPORTATION_TYPE});console.warn("models.Booking.newTransportation: booking has no custom field values")},
waiverCustomFields:function(a){var b=[],c=function(a){return a.customFieldInstance.customField.type===F.WAIVER_TYPE},d=function(a){return a.customFieldInstance.customField},e=_.map(_.filter(a.customFieldValues,c),d),g=[];_.forEach(a.customers,function(a){g.push(_.map(_.filter(a.customFieldValues,c),d))});g=_.flatten(g);b=b.concat(g,e);if(b.length)return _.uniq(b,"pk");console.warn("models.Booking.waivers: booking has no waiver custom fields")},generatedCustomFields:function(a){var b={};_.forEach(a.generatedCodes,
function(a){var c=a.generatingCampaign,d=c.customField,e=b[d.uri]||{customField:d,generatedCampaigns:{}};b[d.uri]=e;d=e.generatedCampaigns[c.uri]||{generatingCampaign:c,generatedCodes:[]};e.generatedCampaigns[c.uri]=d;d.generatedCodes.push(a)});a=_.sortBy(_.values(b,function(a){return a.customField.name}));_.forEach(a,function(a){a.generatedCampaigns=_.sortBy(_.values(a.generatedCampaigns,function(a){return a.generatingCampaign.campaign.name}))});return a},isEligibleForAutoFollowUpEmail:function(a){return a.item.isFollowUpEnabled&&
a.contact.email},isEligibleForAutoReminderEmail:function(a){return a.item.isReminderEnabled&&a.contact.email},isEligibleForAutoReminderSms:function(a){return a.company.isSmsEnabled&&a.item.isSmsReminderEnabled&&a.isSmsEnabled&&ra.isEligiblePhoneNumber(a.contact.phone,a.contact.phoneCountry,a.contact.company)},isEligibleForReviewExpress:function(a){return a.item.isReviewExpressEnabled&&a.contact.email},isEligibleForOnlineCancellation:function(a){var b="paid"===a.paidStatus,c=_.filter(a.payments,function(a){return!a.isRefunded&&
!a.isProcessorBasedType});return!R.isInPast(a.availability)&&!a.isCancelled&&a.company.features.isCancellationPoliciesEnabled&&a.company.features.isOnlineCancellationEnabled&&!!a.effectiveCancellationRule&&a.effectiveCancellationRule.isCancellationAllowed&&b&&!c.length},charterInvoiceRevenue:function(a){return!a.affiliation?null:a.invoicedToCharter+a.invoiceableToCharter},charterInvoiceOwed:function(a){return!a.affiliation?null:a.invoicedToAffiliate+a.invoiceableToAffiliate},isEligibleForCancellation:function(a,
b){if(!a.company.features.isCancellationPoliciesEnabled||!a.effectiveCancellationRule||!a.effectiveCancellationRule.isCancellationAllowed)return!1;var c=b?b.company:null;return a.affiliation&&a.affiliation.affiliateCompany===c&&_.any(a.payments,function(a){return!a.isDeferred&&!a.isCollectedByAffiliate})?!1:!0},isEligibleForRebook:function(a,b){return Y.isEligibleForCancellation(a,b)},itemsInOrder:function(a){return a.isOrder?_.uniq(_.pluck(a.order.allBookings,"item")):[a.item]},hasEmailableDisputes:function(a){return _.some(a.payments,
function(a){return L.isOpenDisputeStatus(a)})},customerTypeRateCountKey:function(a){return"customerTypeRate"+a.pk+"-count"},customFieldInstanceKey:function(a,b,c){b=_.isObject(b)?b.cls===M.cls?b.pk.toString()+"-"+c.toString():b.key:_.isString(b)?b:"Booking";return"customFieldInstance"+a.pk+"For"+b+"-value"},uniqueItems:function(a){return _.uniq(_.map(a,"item"))},effectivePrimaryLocation:function(a){var b=a.availability.item,c=b.startLocation,d=b.primaryLocation;!d&&!b.isCustomPrimaryLocation&&(d=
a.company.defaultItemPrimaryLocation);d&&(c&&d.pk===c.pk)&&(d=null);return d},showTaxByType:function(a){return a.company.features.isTaxTypeBreakdownEnabled&&null===a.explicitGross&&!(ga.LEGACY_TAX_TYPE_PK in a.costs.totalCost.taxByType)}},O={OTHER_AGENT:{name:T("Add new agent"),pk:-1}},fa={OTHER_DESK:{name:T("Add new desk"),pk:-1}},cb={PERCENTAGE_COMMISSION_TYPE:"percentage",FLAT_COMMISSION_TYPE:"flat",AFFILIATE_TAKE_PAYMENT_PREFERENCE:"affiliate-take",CARD_ON_FILE_PAYMENT_PREFERENCE:"card-on-file",
TAKE_PAYMENT_PREFERENCE:v.TAKE_PAYMENT_PREFERENCE,INFO_PAYMENT_PREFERENCE:v.INFO_PAYMENT_PREFERENCE,SKIP_PAYMENT_PREFERENCE:v.SKIP_PAYMENT_PREFERENCE,MAX_SELECTABLE_AFFILIATES:400,isOnlineBookingEnabled:function(a){return(a=a.affiliateGroup&&a.affiliateGroup.groupPermissions)&&a.canCreateBookings},verboseName:T("affiliate"),verboseNamePlural:T("affiliates"),name:function(a){return!a?"":!a.affiliateCompany?a.unicode:a.affiliateCompany.name}},A={NEW_STATUS:"new",PENDING_STATUS:"pending",RUNNING_STATUS:"running",
FAILED_STATUS:"failed",SUCCEEDED_STATUS:"succeeded",CANCELLED_STATUS:"cancelled",ALL_PARTNER_FILTER_OPTION:"all",DIRECT_PARTNER_FILTER_OPTION:"direct",ALL_AFFILIATE_FILTER_OPTION:"all",DIRECT_AFFILIATE_FILTER_OPTION:"direct",ALL_ITEM_FILTER_OPTION:"all",ALL_USER_FILTER_OPTION:"all",ONLINE_USER_FILTER_OPTION:"online",ORIGINAL_USER_TYPE_FILTER_OPTION:"original",CURRENT_USER_TYPE_FILTER_OPTION:"current",ALL_CANCELLED_BOOKINGS_FILTER_OPTION:"all",NO_CANCELLED_BOOKINGS_FILTER_OPTION:"none",NON_REFUNDED_CANCELLED_BOOKINGS_FILTER_OPTION:"non-refunded",
ONLY_CANCELLED_BOOKINGS_FILTER_OPTION:"only",AVAILABILITY_DATE_TYPE:"availability",BOOKING_DATE_TYPE:"booking",BOOKING_ORIGINAL_DATE_TYPE:"booking-original",DISPUTE_DATE_TYPE:"dispute",PAYMENT_DATE_TYPE:"payment",PAYMENT_OR_REFUND_DATE_TYPE:"payment-or-refund",PAYMENT_OR_REFUND_ACCRUAL_DATE_TYPE:"payment-or-refund-accrual",LINE_ITEM_DATE_TYPE:"line-item",STORED_VALUE_CARD_DATE_TYPE:"stored-value-card",ALL_TRANSACTION_TAG_FILTER_OPTION:"all",ALL_SALESPERSON_FILTER_OPTION:"all",ALL_DISPUTE_STATUS_FILTER_OPTION:"all",
ALL_CLOSED_DISPUTE_STATUS_FILTER_OPTION:"all-closed",ALL_OPEN_DISPUTE_STATUS_FILTER_OPTION:"all-open",ALL_CURRENCY_FILTER_OPTION:"all",UNCANCELLED_FILTER_OPTION:"uncancelled",REFUNDED_CANCELLED_FILTER_OPTION:"refunded",UNREFUNDED_CANCELLED_FILTER_OPTION:"unrefunded",ADVANCED_TYPE:"advanced",emptyFilters:function(){return _.mapValues(P.Report.MODELS,function(){return[]})},emptyColumns:function(){return _.mapValues(P.Report.MODELS,function(){return{}})},emptyCompanyOptions:function(a){return _.keyBy(a,
"pk",function(a){var b={};a.isCharter&&(b.filters=A.emptyFilters());a.isAffiliate&&(b.selectedAllPartners=void 0,b.allPartnerFilters=A.emptyFilters(),b.partners={},b.selectedPartners={});return b})},emptyReportOptions:function(a){return{modelName:"",presetDateRange:"",startDate:"",endDate:"",dateType:"",filters:A.emptyFilters(),companies:A.emptyCompanyOptions(a),selectedCharters:{},selectedAffiliates:{},groups:[],isDetailed:"",columns:A.emptyColumns(),isOpened:!1,customFieldValueModel:""}},defaultGroups:function(){return[A.ITEM_GROUP]},
defaultBookingCancelledStatusFilter:function(){return{type:A.CANCELLED_STATUS_FILTER_TYPE,data:{value:[A.UNCANCELLED_FILTER_OPTION,A.UNREFUNDED_CANCELLED_FILTER_OPTION]}}},defaultFilters:function(){return _.extend(A.emptyFilters(),{Booking:[A.defaultBookingCancelledStatusFilter()]})},defaultBookingColumns:function(){return _.toTrueKeys([A.BOOKING_COUNT_COLUMN,A.BOOKING_ID_COLUMN,A.BOOKING_BOOKED_BY_COLUMN,A.CREATED_AT_COLUMN,A.AVAILABILITY_DATETIME_COLUMN,A.TOTAL_COST_PRICE_COLUMN,A.TOTAL_COST_TAX_COLUMN,
A.TOTAL_COST_TOTAL_COLUMN,A.CONTACT_NAME_COLUMN,A.CUSTOMER_COUNT_COLUMN,A.AFFILIATE_COLUMN,A.VOUCHER_NUMBER_COLUMN,A.INVOICEABLE_TO_CHARTER_COLUMN,A.INVOICEABLE_TO_AFFILIATE_COLUMN,A.RECEIPT_PROCESSING_FEE_COLUMN,A.COLLECTED_TOTAL_COST_TOTAL_COLUMN,A.RECEIPT_NET_COLUMN])},defaultCustomerColumns:function(){return _.toTrueKeys([A.CUSTOMER_COUNT_COLUMN,A.TOTAL_COST_PRICE_COLUMN,A.TOTAL_COST_TAX_COLUMN,A.TOTAL_COST_TOTAL_COLUMN,A.COLLECTED_TOTAL_COST_PRICE_COLOUMN,A.COLLECTED_TOTAL_COST_TAX_COLOUMN,A.COLLECTED_TOTAL_COST_TOTAL_COLUMN])},
defaultCustomFieldValueColumns:function(){return _.toTrueKeys([A.USE_COUNT_COLUMN,A.TOTAL_COST_PRICE_COLUMN,A.TOTAL_COST_TAX_COLUMN,A.TOTAL_COST_TOTAL_COLUMN,A.COLLECTED_TOTAL_COST_PRICE_COLOUMN,A.COLLECTED_TOTAL_COST_TAX_COLOUMN,A.COLLECTED_TOTAL_COST_TOTAL_COLUMN])},defaultLineItemColumns:function(){return _.toTrueKeys([A.CREATED_AT_COLUMN,A.TOTAL_COST_PRICE_COLUMN,A.TOTAL_COST_TAX_COLUMN,A.TOTAL_COST_TOTAL_COLUMN,A.LINE_ITEM_DESCRIPTION_COLUMN])},defaultStoredValueCardColumns:function(){return _.toTrueKeys([A.CREATED_AT_COLUMN,
A.STORED_VALUE_CARD_TYPE_COLUMN,A.STORED_VALUE_CARD_NUMBER_COLUMN])},defaultPaymentColumns:function(){return _.toTrueKeys([A.CREATED_AT_COLUMN,A.PAYMENT_OR_REFUND_COLUMN,A.PAYMENT_OR_REFUND_ID_COLUMN,A.PAYMENT_TYPE_COLUMN,A.PAYMENT_AND_REFUND_GROSS_COLUMN,A.PAYMENT_AND_REFUND_PROCESSING_FEE_COLUMN,A.PAYMENT_AND_REFUND_NET_COLUMN,A.PAYMENT_COUNT_COLUMN,A.REFUND_COUNT_COLUMN,A.PAYMENT_TOTAL_TAX_COLUMN,A.REFUND_TOTAL_PRICE_COLUMN])},defaultPaymentColumnsWithTax:function(){return _.extend(A.defaultPaymentColumns(),
_.toTrueKeys([A.PAYMENT_AND_REFUND_TOTAL_TAX_COLUMN]))},defaultCustomerReportColumns:function(){return _.extend(A.emptyColumns(),{Customer:A.defaultCustomerColumns(),Booking:_.toTrueKeys([A.BOOKING_ID_COLUMN,A.BOOKING_COUNT_COLUMN,A.CUSTOMER_COUNT_COLUMN,A.TOTAL_COST_TOTAL_COLUMN])})},defaultColumns:function(){return _.extend(A.emptyColumns(),{Booking:A.defaultBookingColumns(),Customer:A.defaultCustomerColumns(),CustomFieldValue:A.defaultCustomFieldValueColumns(),LineItem:A.defaultLineItemColumns(),
StoredValueCard:A.defaultStoredValueCardColumns()})},paymentTypeChoicesForCompany:function(a,b){return _.filter(a,function(a){return a.value===L.IDEAL_PROCESSOR_BASED_TYPE?b.features.isIdealPaymentsEnabled:a.value===L.SOFORT_PROCESSOR_BASED_TYPE?b.features.isSofortPaymentsEnabled:!0})},defaultReportOptions:function(a){var b=_.defaults({dateType:A.AVAILABILITY_DATE_TYPE,presetDateRange:A.YESTERDAY_DATE_RANGE,isDetailed:!1,groups:A.defaultGroups(),columns:A.defaultColumns(),filters:A.defaultFilters(),
customFieldValueModel:Sa.cls},A.emptyReportOptions(a));a=a[0];b.selectedCharters[a.pk]=a.isCharter;b.selectedAffiliates[a.pk]=!a.isCharter&&a.isAffiliate;return b}},F={STACK_PRICING_TYPE:"stack",CURRENT_PRICING_TYPE:"current",INITIAL_PRICING_TYPE:"initial",ZERO_PRICING_TYPE:"zero",SHORT_TYPE:"short",LONG_TYPE:"long",YES_NO_TYPE:"yes-no",EXTENDED_OPTION_TYPE:"extended-option",HEADER_TYPE:"header",NOTE_TYPE:"note",TRANSPORTATION_TYPE:"transportation",NEW_TRANSPORTATION_TYPE:"new-transportation",CODE_TYPE:"code",
MULTI_CAMPAIGN_TYPE:"multi-campaign",CODE_GENERATOR_TYPE:"code-generator",CARD_GENERATOR_TYPE:"card-generator",COUNT_TYPE:"count",WAIVER_TYPE:"waiver",DISPLAY_ONLY_TYPES:["note","header"],suggestedAmounts:function(a){if(a.type!==F.CARD_GENERATOR_TYPE)return[];a=a.cardSuggestedAmount||2500;return[a,2*a,4*a]},isDisplayOnly:function(a){return _.contains(F.DISPLAY_ONLY_TYPES,a.type)},isManifestField:function(a){return F.isDisplayOnly(a)?!1:!_.contains([F.NEW_TRANSPORTATION_TYPE,F.CODE_GENERATOR_TYPE,
F.WAIVER_TYPE],a.type)},isAggregatable:function(a){return _.contains([P.CustomField.EXTENDED_OPTION_TYPE,P.CustomField.CODE_TYPE,P.CustomField.MULTI_CAMPAIGN_TYPE,P.CustomField.YES_NO_TYPE,P.CustomField.TRANSPORTATION_TYPE,P.CustomField.COUNT_TYPE],a.type)},usesCheckbox:function(a){return _.contains([F.YES_NO_TYPE,F.CODE_GENERATOR_TYPE],a.type)},needsRequired:function(a){return F.isDisplayOnly(a)?!1:!_.contains([F.TRANSPORTATION_TYPE,F.COUNT_TYPE],a.type)},needsPricing:function(a){return _.contains([F.YES_NO_TYPE,
F.CODE_TYPE,F.CODE_GENERATOR_TYPE,F.CARD_GENERATOR_TYPE,F.NEW_TRANSPORTATION_TYPE,F.COUNT_TYPE],a.type)},needsAlwaysPerCustomer:function(a){return F.needsPricing(a)||_.contains([F.EXTENDED_OPTION_TYPE],a.type)},pricedByValue:function(a){return a.type===F.CARD_GENERATOR_TYPE},pricedByOptions:function(a){return _.contains([F.EXTENDED_OPTION_TYPE,F.MULTI_CAMPAIGN_TYPE],a.type)},needsBookingNotes:function(a){return _.contains([F.CODE_TYPE,F.CODE_GENERATOR_TYPE,F.CARD_GENERATOR_TYPE,F.MULTI_CAMPAIGN_TYPE,
F.YES_NO_TYPE,F.TRANSPORTATION_TYPE,F.NEW_TRANSPORTATION_TYPE,F.EXTENDED_OPTION_TYPE,F.COUNT_TYPE],a.type)},needsHint:function(a){return _.contains([F.SHORT_TYPE,F.LONG_TYPE,F.CODE_TYPE,F.NEW_TRANSPORTATION_TYPE,F.MULTI_CAMPAIGN_TYPE],a.type)},hasExtraOptions:function(a){return _.contains([F.EXTENDED_OPTION_TYPE,F.TRANSPORTATION_TYPE,F.MULTI_CAMPAIGN_TYPE],a.type)},isDefaultValueAllowed:function(a){return _.contains(F.DEFAULT_VALUE_TYPES,a.type)},isValidRawValue:function(a,b,c){return a.type===F.EXTENDED_OPTION_TYPE?
""===b?!0:_.isNumber(b)&&_.find(a.extendedOptions,{pk:b}):a.type===F.COUNT_TYPE?c===H.RANGE_TYPE?!(b.rangeStart>a.countMax||b.rangeEnd<a.countMin):_.isNumber(b)&&b>=a.countMin&&b<=a.countMax:!0},displayForRawValue:function(b,c,d){return b.type===F.EXTENDED_OPTION_TYPE?""===c?"":(b=_.find(b.extendedOptions,{pk:c}))?a(b):"Deleted option":b.type===F.YES_NO_TYPE?c?"Yes":"No":d===H.RANGE_TYPE?c.rangeStart+" \u2014 "+c.rangeEnd:_.isUndefined(c)||null===c?"":c.toString()},isOptionAvailable:function(a,b){if(""===
b)return!0;var c=a.type;return c===F.EXTENDED_OPTION_TYPE?_.some(a.extendedOptions,function(a){return a.pk===b}):c===F.TRANSPORTATION_TYPE?_.some(a.transportationOptions,function(a){return a.pk===b}):c===F.COUNT_TYPE?b>=a.countMin&&b<=a.countMax:!0},autofillValue:function(a,b,c){if(!_.isUndefined(b)&&(a=a.customField,F.isOptionAvailable(a,b)))return c&&a.type===F.NEW_TRANSPORTATION_TYPE&&(b=void 0),_.clone(b)},verboseName:T("custom field"),verboseNamePlural:T("custom fields"),dropdownName:function(a){return"["+
a.shortDisplayType+"] "+a.name}};_.extend(F,{GROUPED_TYPES:{text:[F.SHORT_TYPE,F.LONG_TYPE],checkbox:[F.YES_NO_TYPE,F.CODE_GENERATOR_TYPE],dropdown:[F.EXTENDED_OPTION_TYPE],quantity:[F.COUNT_TYPE],transportation:[F.NEW_TRANSPORTATION_TYPE,F.TRANSPORTATION_TYPE],code:[F.MULTI_CAMPAIGN_TYPE,F.CODE_TYPE],label:[F.HEADER_TYPE],waiver:[F.WAIVER_TYPE],"gift-card":[F.CARD_GENERATOR_TYPE]},groupedType:function(a){return _.findKey(F.GROUPED_TYPES,function(b){return _.contains(b,a)})},DEFAULT_VALUE_TYPES:[F.SHORT_TYPE,
F.YES_NO_TYPE,F.CODE_GENERATOR_TYPE,F.EXTENDED_OPTION_TYPE,F.COUNT_TYPE],DEPRECATED_TYPES:[F.NOTE_TYPE,F.CODE_TYPE,F.TRANSPORTATION_TYPE],disabledTypes:function(a){var b=[].concat(F.DEPRECATED_TYPES);a.features.isTransportationEnabled||b.push(P.CustomField.NEW_TRANSPORTATION_TYPE);return b},enabledTypesForCompany:function(a){var b=k.get("db").slipstream("customFieldChoices");return b=_.filter(b,function(b){return!_.includes(F.disabledTypes(a),b[0])})},group:function(a){return a.isArchived?T("Archived"):
a.isHidden?T("Deleted"):""}});var La=function(a){return _.some(a.payments,function(a){return a.type===L.AFFILIATE_TYPE?!1:!a.isDeferred&&!a.isRefunded})},Ma=function(a){return _.some(a.payments,function(a){return a.type===L.AFFILIATE_TYPE?!1:!a.isDeferred&&!!a.refundCount})},G={AVAILABILITY_MANIFEST_TYPE:"availability-manifest",ORDER_CONFIRMATION_TYPE:"order-confirmation",ORDER_CANCELLATION_TYPE:"order-cancellation",ORDER_RECEIPT_TYPE:"order-receipt",ORDER_REFUNDED_TYPE:"order-refunded",ORDER_SHARE_TYPE:"order-share",
BANK_ACCOUNT_CHANGE_TYPE:"bank-account-change",BOOKING_CANCELLATION_TYPE:"booking-cancellation",BOOKING_CONFIRMATION_TYPE:"booking-confirmation",BOOKING_FOLLOW_UP_TYPE:"booking-follow-up",BOOKING_MESSAGE_TYPE:"booking-message",BOOKING_RECEIPT_TYPE:"booking-receipt",BOOKING_REBOOKED_TYPE:"booking-rebooked",BOOKING_REFUNDED_TYPE:"booking-refunded",BOOKING_REMINDER_TYPE:"booking-reminder",BOOKING_SHARE_TYPE:"booking-share",NOTIFICATION_FAILURE_TYPE:"notification-failure",CREW_CHANGE_TYPE:"crew-change",
CREW_REMINDER_TYPE:"crew-reminder",DAILY_MANIFEST_TYPE:"daily-manifest",DISPUTE_TYPE:"dispute",INVOICE_PAYMENT_REQUEST_TYPE:"invoice-payment-request",INVOICE_UPLOAD_STATUS_UPDATE_TYPE:"invoice-upload-status-update",STORED_VALUE_CARD_TYPE:"stored-value-card",FAILED_SOFORT_PAYMENTS_TYPE:"failed-sofort-payments",displayType:function(a){a=a.replace("booking-","").replace("order-","");return _.capitalize(a)},notificationTypesForOrder:function(a){var b=[];a.contributingBookingCount&&b.push(G.ORDER_CONFIRMATION_TYPE);
_.any(a.allBookings,La)&&b.push(G.ORDER_RECEIPT_TYPE);_.any(a.allBookings,Ma)&&b.push(G.ORDER_REFUNDED_TYPE);_.any(a.allBookings,"isCancelled")&&b.push(G.ORDER_CANCELLATION_TYPE);return b},notificationTypesForBooking:function(a){if(a.rebookedTo)return[];var b=[];a.isCancelled?b.push(G.BOOKING_CANCELLATION_TYPE):a.rebookedFrom?(b.push(G.BOOKING_REBOOKED_TYPE),b.push(G.BOOKING_REMINDER_TYPE),b.push(G.BOOKING_CONFIRMATION_TYPE)):(b.push(G.BOOKING_CONFIRMATION_TYPE),b.push(G.BOOKING_REMINDER_TYPE));La(a)&&
b.push(G.BOOKING_RECEIPT_TYPE);Ma(a)&&b.push(G.BOOKING_REFUNDED_TYPE);b.push(G.BOOKING_MESSAGE_TYPE);b.push(G.BOOKING_FOLLOW_UP_TYPE);return b},isPreviewable:function(a){return _.contains([G.ORDER_CANCELLATION_TYPE,G.ORDER_CONFIRMATION_TYPE,G.BOOKING_CANCELLATION_TYPE,G.BOOKING_CONFIRMATION_TYPE,G.BOOKING_FOLLOW_UP_TYPE,G.BOOKING_MESSAGE_TYPE,G.BOOKING_REMINDER_TYPE,G.INVOICE_PAYMENT_REQUEST_TYPE],a)},isSubjectEditable:function(a){return _.contains([G.BOOKING_CANCELLATION_TYPE,G.BOOKING_FOLLOW_UP_TYPE,
G.BOOKING_MESSAGE_TYPE,G.BOOKING_REBOOKED_TYPE,G.BOOKING_RECEIPT_TYPE,G.BOOKING_REFUNDED_TYPE,G.ORDER_RECEIPT_TYPE,G.ORDER_REFUNDED_TYPE],a)},filterByType:function(a,b){return _.filter(a,function(a){return a.type===b})},bookingConfirmationNotifications:function(a){return G.filterByType(a,G.BOOKING_CONFIRMATION_TYPE)},bookingFollowUpNotifications:function(a){return G.filterByType(a,G.BOOKING_FOLLOW_UP_TYPE)},bookingRebookedNotifications:function(a){return G.filterByType(a,G.BOOKING_REBOOKED_TYPE)},
bookingReminderNotifications:function(a){return G.filterByType(a,G.BOOKING_REMINDER_TYPE)},invoicePaymentRequestNotifications:function(a){return G.filterByType(a,G.INVOICE_PAYMENT_REQUEST_TYPE)},UNKNOWN_STATUS:"unknown",PROCESSED_STATUS:"processed",DEFERRED_STATUS:"deferred",DELIVERED_STATUS:"delivered",USER_OPENED_STATUS:"open",USER_CLICKED_URL_STATUS:"click",BOUNCE_STATUS:"bounce",DROPPED_STATUS:"dropped",USER_REPORTED_SPAM_STATUS:"spamreport",USER_UNSUBSCRIBED_STATUS:"unsubscribe",isOpened:function(a){return _.contains([G.USER_OPENED_STATUS,
G.USER_CLICKED_URL_STATUS,G.USER_REPORTED_SPAM_STATUS,G.USER_UNSUBSCRIBED_STATUS],a)},isFailed:function(a){return _.contains([G.BOUNCE_STATUS,G.DROPPED_STATUS],a)},subjectForDisputeType:function(a){return interpolate(T("[Response Needed] New Dispute for Booking #%(bookingId)s (%(personName)s)"),{bookingId:a.pk,personName:a.contact.name})}},ra={US_COUNTRY_CODE:"US",INTERNATIONAL_ENABLED_COUNTRIES:q,INTERNATIONAL_DISABLED_COUNTRIES:[["US","USA"]],TEST_NUMBERS:"+15005550001 +15005550002 +15005550003 +15005550004 +15005550006 +15005550009".split(" "),
INTERNATIONAL_ENABLED_NUMBER_REGEX:/^\+?\d{5,15}$/,INTERNATIONAL_DISABLED_NUMBER_REGEX:/^(\+1|1)?\d{10}$/,INTERNATIONAL_ENABLED_NUMBER_MAX_LENGTH:16,INTERNATIONAL_DISABLED_NUMBER_MAX_LENGTH:12,isTestNumber:function(a){a="+"+k.get("phoneNumbers").digits(a);return _.contains(ra.TEST_NUMBERS,a)},isTestNumberAllowed:function(){return window.slipstream&&"production"!=window.slipstream.configuration&&window.slipstream.isTwilioTestAccountEnabled},isEligiblePhoneNumber:function(a,b,c){if(ra.isTestNumberAllowed()&&
ra.isTestNumber(a))return!0;var d=k.get("phoneNumbers");return!d.isPossiblyValid(a)?!1:b?"US"===b?d.parseUsPhoneNumber(a).isUsPhoneNumber:!c?(console.warn("SmsNotification.isEligiblePhoneNumber: company not provided"),!1):c.features.isInternationalSmsEnabled:d.parseUsPhoneNumber(a).isUsPhoneNumber?!0:!c?(console.warn("SmsNotification.isEligiblePhoneNumber: company not provided"),!1):c.features.isInternationalSmsEnabled},groupByStatus:function(a){var b=_.groupBy(a,"status"),c=[];_.forEach("delivered sent pending queued sending rejected undelivered failed invalid".split(" "),
function(a){var d=b[a];d&&d.length&&c.push({status:a,displayStatus:d[0].displayStatus,items:d})});return c}},I={AVAILABILITY_MANIFEST_TYPE:G.AVAILABILITY_MANIFEST_TYPE,BANK_ACCOUNT_CHANGE_TYPE:G.BANK_ACCOUNT_CHANGE_TYPE,BOOKING_CONFIRMATION_TYPE:G.BOOKING_CONFIRMATION_TYPE,BOOKING_CANCELLATION_TYPE:G.BOOKING_CANCELLATION_TYPE,NOTIFICATION_FAILURE_TYPE:G.NOTIFICATION_FAILURE_TYPE,CREW_CHANGE_TYPE:G.CREW_CHANGE_TYPE,CREW_REMINDER_TYPE:G.CREW_REMINDER_TYPE,DAILY_MANIFEST_TYPE:G.DAILY_MANIFEST_TYPE,DISPUTE_TYPE:G.DISPUTE_TYPE,
INVOICE_UPLOAD_STATUS_UPDATE_TYPE:G.INVOICE_UPLOAD_STATUS_UPDATE_TYPE,FAILED_SOFORT_PAYMENTS_TYPE:G.FAILED_SOFORT_PAYMENTS_TYPE,DIRECT_BOOKING_OPTION:"isDirect",ONLINE_BOOKING_OPTION:"isOnline",AFFILIATE_BOOKING_OPTION:"isAffiliate",REBOOKED_BOOKING_OPTION:"isRebooked",isTypeSupported:function(a,b){return b===I.BANK_ACCOUNT_CHANGE_TYPE?a.isAffiliate||a.isCharter:b===I.INVOICE_UPLOAD_STATUS_UPDATE_TYPE?(a.isAffiliate||a.isCharter)&&a.isInvoicingEnabled:b===I.FAILED_SOFORT_PAYMENTS_TYPE?!0===a.features.isSofortPaymentsEnabled:
a.isCharter},isAnyTypeSupported:function(a){return _.some(I.TYPES,function(b){return I.isTypeSupported(a,b)})},isUserSubscribed:function(a,b,c){return _.some(a,function(a){return a.user===b&&a.type===c})}};I.TYPES=[I.AVAILABILITY_MANIFEST_TYPE,I.BANK_ACCOUNT_CHANGE_TYPE,I.BOOKING_CANCELLATION_TYPE,I.BOOKING_CONFIRMATION_TYPE,I.NOTIFICATION_FAILURE_TYPE,I.CREW_CHANGE_TYPE,I.CREW_REMINDER_TYPE,I.DAILY_MANIFEST_TYPE,I.DISPUTE_TYPE,I.INVOICE_UPLOAD_STATUS_UPDATE_TYPE];I.ITEM_SUBSCRIPTION_TYPES=[I.AVAILABILITY_MANIFEST_TYPE,
I.BOOKING_CONFIRMATION_TYPE,I.BOOKING_CANCELLATION_TYPE,I.NOTIFICATION_FAILURE_TYPE,I.CREW_CHANGE_TYPE,I.CREW_REMINDER_TYPE];I.HOURS_BEFORE_SUBSCRIPTION_TYPES=[I.AVAILABILITY_MANIFEST_TYPE,I.CREW_REMINDER_TYPE,I.DAILY_MANIFEST_TYPE];I.HOURS_BEFORE_DEFAULTS={};I.HOURS_BEFORE_DEFAULTS[I.AVAILABILITY_MANIFEST_TYPE]=24;I.HOURS_BEFORE_DEFAULTS[I.CREW_REMINDER_TYPE]=24;I.HOURS_BEFORE_DEFAULTS[I.DAILY_MANIFEST_TYPE]=-6;I.CREW_AVAILABILITIES_ONLY_TYPES=[I.AVAILABILITY_MANIFEST_TYPE,I.BOOKING_CONFIRMATION_TYPE];
I.BOOKING_OPTION_TYPES=[I.BOOKING_CANCELLATION_TYPE,I.BOOKING_CONFIRMATION_TYPE];I.BOOKING_OPTIONS=[I.DIRECT_BOOKING_OPTION,I.ONLINE_BOOKING_OPTION,I.AFFILIATE_BOOKING_OPTION,I.REBOOKED_BOOKING_OPTION];I.BOOKING_OPTIONS_BY_TYPE={};I.BOOKING_OPTIONS_BY_TYPE[I.BOOKING_CANCELLATION_TYPE]=[I.DIRECT_BOOKING_OPTION,I.ONLINE_BOOKING_OPTION,I.AFFILIATE_BOOKING_OPTION];I.BOOKING_OPTIONS_BY_TYPE[I.BOOKING_CONFIRMATION_TYPE]=[I.DIRECT_BOOKING_OPTION,I.ONLINE_BOOKING_OPTION,I.AFFILIATE_BOOKING_OPTION,I.REBOOKED_BOOKING_OPTION];
var Na={verboseName:T("public headline"),verboseNamePlural:T("public headlines"),CUSTOM:{name:T("Custom"),pk:-1},NONE:{name:T("None"),pk:null},group:function(a){return a.pk&&a.pk!==Na.CUSTOM.pk?T("Public Headlines"):void 0}},q={CUSTOM:{pk:-1,name:T("Custom"),type:"custom",displayType:T("Other")},ORDER_CONFIRMATION_TYPE:G.ORDER_CONFIRMATION_TYPE,CANCELLATION_TYPE:G.BOOKING_CANCELLATION_TYPE,CONFIRMATION_TYPE:G.BOOKING_CONFIRMATION_TYPE,FOLLOW_UP_TYPE:G.BOOKING_FOLLOW_UP_TYPE,MESSAGE_TYPE:G.BOOKING_MESSAGE_TYPE,
RECEIPT_TYPE:G.BOOKING_RECEIPT_TYPE,REBOOKED_TYPE:G.BOOKING_REBOOKED_TYPE,REFUNDED_TYPE:G.BOOKING_REFUNDED_TYPE,CUSTOM_TYPE:"custom",INVOICE_PAYMENT_REQUEST_TYPE:G.INVOICE_PAYMENT_REQUEST_TYPE,TYPES:[G.BOOKING_CANCELLATION_TYPE,G.BOOKING_CONFIRMATION_TYPE,G.BOOKING_FOLLOW_UP_TYPE,G.BOOKING_MESSAGE_TYPE,G.BOOKING_RECEIPT_TYPE,G.BOOKING_REBOOKED_TYPE,G.BOOKING_REFUNDED_TYPE,G.INVOICE_PAYMENT_REQUEST_TYPE,"CUSTOM"],BOOKING_TYPES:[G.BOOKING_CANCELLATION_TYPE,G.BOOKING_CONFIRMATION_TYPE,G.BOOKING_FOLLOW_UP_TYPE,
G.BOOKING_MESSAGE_TYPE,G.BOOKING_RECEIPT_TYPE,G.BOOKING_REBOOKED_TYPE,G.BOOKING_REFUNDED_TYPE],ORDER_TYPES:[G.BOOKING_CANCELLATION_TYPE,G.BOOKING_CONFIRMATION_TYPE,G.BOOKING_MESSAGE_TYPE,G.BOOKING_RECEIPT_TYPE,G.BOOKING_REFUNDED_TYPE],displayType:G.displayType},ma={OFFLINE_STATUS:"offline",ONLINE_STATUS:"online",STRIPE_ERRORS:{reader_error:T("Device error."),canceled:T("Payment cancelled."),no_established_connection:T("Device not connected."),no_active_collect_payment_method_attempt:T("Unable to cancel payment."),
cancelable_already_completed:T("Unable to cancel payment."),network_error:T("Error connecting to device."),card_declined:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),requires_payment_method:T("Card declined, try a different card (or try again with the same card)."),requires_confirmation:T("Temporary connectivity problem, please try again."),already_connected:T("Connect to reader failed because the reader is already connected."),
cancelable_already_canceled:T("Cancellation failed because the operation has already been cancelled."),discovery_too_many_readers:T("Please try again, or contact FareHarbor Support. (S-READERS)"),failed_fetch_connection_token:T("Could not fetch a connection token."),invalid_reader_version:T("Please update the EMV card reader."),network_timeout:T("Network timeout."),no_active_read_reusable_card_attempt:T("An error occurred, please try again."),payment_intent_is_null:T("Request timed out, please try again.")},
ADYEN_ERRORS:{Aborted:T("Payment cancelled."),Busy:T("Device is currently in use."),Cancel:T("Payment cancelled."),DeviceOut:T("Device unexpectedly disconnected, or battery level is too low."),InvalidCard:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),NotAllowed:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),Refusal:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),
UnreachableHost:T("Network timeout, please try again"),WrongPIN:T("Card declined due to invalid PIN.")},CONNECT_READER_ERROR_CODE:"reader_error",READER_IN_USE_ERROR_MESSAGE:"Reader is currently in use.",UNKNOWN_ERROR:T("Unknown error. Please refresh the page and try again."),CANCELLED_ERROR:T("Payment cancelled")},V={PENDING_STATUS:"pending",DISPUTED_STATUS:"disputed",WON_STATUS:"won",LOST_STATUS:"lost",REFUNDED_STATUS:"refunded",displayStatus:function(a){return _.capitalize(a)}};V.OPEN_STATUSES=
[V.PENDING_STATUS,V.DISPUTED_STATUS];V.CLOSED_STATUSES=[V.WON_STATUS,V.LOST_STATUS,V.REFUNDED_STATUS];V.STATUSES=V.OPEN_STATUSES.concat(V.CLOSED_STATUSES);var L={CC_TYPE:"balanced-cc",LEGACY_CC_TYPE:"cc",IN_STORE_TYPE:"in-store",AFFILIATE_TYPE:"affiliate",STORED_VALUE_CARD_TYPE:"stored-value-card",PENDING_DISPUTE_STATUS:"pending",DISPUTED_DISPUTE_STATUS:"disputed",WON_DISPUTE_STATUS:"won",LOST_DISPUTE_STATUS:"lost",REFUNDED_DISPUTE_STATUS:"refunded",PENDING_PAYMENT_STATUS:"pending",FAILED_PAYMENT_STATUS:"failed",
SUCCEEDED_PAYMENT_STATUS:"succeeded",IDEAL_PROCESSOR_BASED_TYPE:"ideal",SOFORT_PROCESSOR_BASED_TYPE:"sofort",AFFILIATE_PAYMENT_TYPE:"affiliate",AFFILIATE_PAYMENT_DISPLAY_TEXT:T("Collected by affiliate"),IDEAL_BANK_TYPE_CHOICES:[["abn_amro","ABN AMRO"],["asn_bank","ASN Bank"],["bunq","bunq"],["handelsbanken","Handelsbanken"],["ing","ING"],["knab","Knab"],["moneyou","Moneyou"],["rabobank","Rabobank"],["regiobank","RegioBank"],["sns_bank","De Volksbank (SNS Bank)"],["triodos_bank","Triodos Bank"],["van_lanschot",
"Van Lanschot"]],SOFORT_COUNTRY_CHOICES:[["AT",T("Austria")],["BE",T("Belgium")],["DE",T("Germany")],["IT",T("Italy")],["NL",T("Netherlands")],["ES",T("Spain")]],isOpenDisputeStatus:function(a){return _.contains(L.OPEN_DISPUTE_STATUES,a.disputeStatus)},isClosedDisputeStatus:function(a){return _.contains(L.CLOSED_DISPUTE_STATUSES,a.disputeStatus)},isDisputedAndNonRefundable:function(a){return a.disputeStatus===L.DISPUTED_DISPUTE_STATUS||a.disputeStatus===L.LOST_DISPUTE_STATUS||a.disputeStatus===L.REFUNDED_DISPUTE_STATUS},
isAsynchronous:function(a){return _.contains(L.ASYNCHRONOUS_PROCESSOR_BASED_TYPES,a.processorBasedType)},paymentStatus:function(a){return L.isAsynchronous(a)?a.metadata.chargeStatus:L.SUCCEEDED_PAYMENT_STATUS},isPaymentSucceeded:function(a){return L.paymentStatus(a)===L.SUCCEEDED_PAYMENT_STATUS},isPaymentPending:function(a){return L.paymentStatus(a)===L.PENDING_PAYMENT_STATUS},isPaymentFailed:function(a){return L.paymentStatus(a)===L.FAILED_PAYMENT_STATUS},isEmv:function(a){return a.type===L.CC_TYPE&&
a.metadata&&a.metadata.isEmv},isEmvSignatureRequired:function(a){return L.isEmv(a)&&a.metadata.isEmvSignatureRequired},emvDetails:function(a){if(!L.isEmv(a))return[];var b=_.toTrueKeys("Date;Time;Amount;Description;Name;Address;Zip;City;Country;Contact;Additional Information;Account".split(";"));return _.filter(a.metadata.emvDetails,function(a){return!b[a.key]})},isPartialRefundAllowed:function(a){return!a.receipt.gross?!1:!a.isProcessorBasedType||!a.isDisputed||a.disputeStatus===L.WON_DISPUTE_STATUS||
a.disputeStatus===L.PENDING_DISPUTE_STATUS},COUNTRIES_WITH_POSTAL_CODES:["US"],DEMO_CARD_NUMBERS:["4111111111111111","5105105105105100","341111111111111","4242424242424242"],isNotCardOnFileProcessorBasedType:function(a){return L.isProcessorBasedType(a)&&!a.isCardOnFile},isProcessorBasedType:function(a){return a.type===L.CC_TYPE||a.type===L.LEGACY_CC_TYPE},isDemoCardNumber:function(a){return _.contains(L.DEMO_CARD_NUMBERS,a)},needsPostalCode:function(a){return _.contains(L.COUNTRIES_WITH_POSTAL_CODES,
a)},cardPayments:function(a,b){var c={};_.forEach(a,function(a){if(!b&&a.type===L.CC_TYPE||b&&a.isProcessorBasedType){var d=a.processorBasedType+"-"+a.processorBasedIdentifier;c[d]||(c[d]=a)}});return _.values(c)},relatedCardPayments:function(a,b){return _.union.apply(null,_.map(a.contact.relatedBookings,function(a){return L.cardPayments(a.payments,b)}))},isGratuityEnabled:function(a){return _.any(_.map(a.bookings?a.bookings:[a.booking],"item"),{isGratuityEnabled:!0})},receiptFooters:function(a){return _.filter(_.map(L.items(a),
"receiptFooter"))},order:function(a){return a.bookings&&a.bookings.length?a.bookings[0].order:null},hasMultipleVisibleContributingBookings:function(a){return!a.bookings?!1:1<a.bookings.length+ +!!a.invisibleBookingCount},items:function(a){return a.booking?[a.booking.item]:Y.uniqueItems(a.bookings)},sortByCreatedAt:function(a){return _.sortByOrder(a,function(a){return moment.isMoment(a.createdAt)?a.createdAt.unix():0},!1)},printablePayments:function(a){a=_.map(a,function(a){return a.aggregatedPayment&&
a.aggregatedPayment.isAggregated?a.aggregatedPayment:a});return _.filter(a,function(a){return!a.isDeferred&&a.type!==L.AFFILIATE_TYPE})},taxByType:function(a,b){if(!a.company.features.isTaxTypeBreakdownEnabled)return null;var c,d=b?"initialCosts":"costs";c=_.isArray(a.payments)?_.reduce(a.payments,function(a,b){return _.sumObjectValues(a,b[d].totalCost.taxByType)},{}):a[d].totalCost.taxByType;return ga.LEGACY_TAX_TYPE_PK in c?null:c},holds:function(a){return _.filter(a,function(a){return a.isHold||
a.holdReleasedOn})},nonHoldPayments:function(a){return _.reject(a,function(a){return a.isHold||a.holdReleasedOn})}};L.OPEN_DISPUTE_STATUES=[L.PENDING_DISPUTE_STATUS,L.DISPUTED_DISPUTE_STATUS];L.CLOSED_DISPUTE_STATUSES=[L.WON_DISPUTE_STATUS,L.LOST_DISPUTE_STATUS,L.REFUNDED_DISPUTE_STATUS];L.ASYNCHRONOUS_PROCESSOR_BASED_TYPES=[L.SOFORT_PROCESSOR_BASED_TYPE];var U={FAILED_TRANSFER_STATUS:"failed",SUCCEEDED_TRANSFER_STATUS:"succeeded",taxByType:function(a){if(!a.payment.company.features.isTaxTypeBreakdownEnabled)return null;
a=a.costs.totalCost.taxByType;return ga.LEGACY_TAX_TYPE_PK in a?null:a}},Z={NO_REPEAT:"none",WEEKLY_REPEAT:"weekly",MONTHLY_REPEAT:"monthly",ALL_DAY_PERIOD:"all-day",TIME_RANGE_PERIOD:"time-range",DAY_RANGE_PERIOD:"day-range",FAILED_STATUS:"failed",SUCCEEDED_STATUS:"succeeded",WEEK_DAYS_KEYS:"sunday monday tuesday wednesday thursday friday saturday".split(" "),WEEK_DAYS:{sunday:T("Sunday"),monday:T("Monday"),tuesday:T("Tuesday"),wednesday:T("Wednesday"),thursday:T("Thursday"),friday:T("Friday"),saturday:T("Saturday")},
WEEK_DAYS_SHORT:{sunday:cT("Abbreviation of Sunday","Su"),monday:cT("Abbreviation of Monday","M"),tuesday:cT("Abbreviation of Tuesday","T"),wednesday:cT("Abbreviation of Wednesday","W"),thursday:cT("Abbreviation of Thursday","Th"),friday:cT("Abbreviation of Friday","F"),saturday:cT("Abbreviation of Saturday","S")},weekDays:function(a){var b=_.clone(Z.WEEK_DAYS_KEYS);a.features.isSundayBased||b.push(b.shift());return b},weekDayShort:function(a){return Z.WEEK_DAYS_SHORT[a]},weekDaysDefaultModel:function(){var a=
{};_.forEach(Z.WEEK_DAYS_KEYS,function(b){a[b]=!0});return a},defaultRule:function(){var a={period:Z.TIME_RANGE_PERIOD,repeat:Z.NO_REPEAT,hours:"",time:"",startOn:null,endOn:null};_.extend(a,Z.weekDaysDefaultModel());return a}},S={ADJUSTMENT_TAG:"adjustment",FUND_BOOKING_FEE_PROCESSING_FEE_TAG:"fund-booking-fee",FUND_PROCESSING_FEE_TAG:"fund-processing-fee",OTHER_TAG:"other",PAYMENT_BOOKING_FEE_TAG:"payment-booking-fee",PAYMENT_BOOKING_FEE_PROCESSING_FEE_TAG:"payment-booking-fee-processing-fee",PAYMENT_GROSS_TAG:"payment-gross",
PAYMENT_PROCESSING_FEE_TAG:"payment-processing-fee",PAYOUT_TAG:"payout",REFUND_GROSS_TAG:"refund-gross",REFUND_BOOKING_FEE_TAG:"refund-booking-fee",REFUND_BOOKING_FEE_PROCESSING_FEE_TAG:"refund-booking-fee-processing-fee",REFUND_PROCESSING_FEE_TAG:"refund-processing-fee",TRANSFER_TAG:"transfer",UPLOAD_TAG:"upload",UNKNOWN_TAG:"",displayTag:function(a){return a===S.UNKNOWN_TAG?"Unknown":_.capitalize(a.split("-").join(" "))}};S.TAGS=[S.ADJUSTMENT_TAG,S.FUND_BOOKING_FEE_PROCESSING_FEE_TAG,S.FUND_PROCESSING_FEE_TAG,
S.OTHER_TAG,S.PAYMENT_BOOKING_FEE_TAG,S.PAYMENT_BOOKING_FEE_PROCESSING_FEE_TAG,S.PAYMENT_GROSS_TAG,S.PAYMENT_PROCESSING_FEE_TAG,S.PAYOUT_TAG,S.REFUND_GROSS_TAG,S.REFUND_BOOKING_FEE_TAG,S.REFUND_BOOKING_FEE_PROCESSING_FEE_TAG,S.REFUND_PROCESSING_FEE_TAG,S.TRANSFER_TAG,S.UPLOAD_TAG,S.UNKNOWN_TAG];var Oa=function(a,b,c){if(!b)return!1;var d=k.get("db").slipstream(c);if(!d[a])return!1;a=d[a];return!_.isArray(a)?(console.warn("isCountryApplicable: invalid value",a,c),!1):_.contains(a,b)},b={getCurrencyChoices:b},
da={VALID_VALIDITY:"valid",INVALID_VALIDITY:"invalid",DATE_RANGE_FOR_AVAILABILITY_TYPE:"range-for-booking",DATE_RANGE_FOR_BOOKING_TYPE:"range-for-availability",displayDayPattern:function(a){if(!_.contains([da.DATE_RANGE_FOR_AVAILABILITY_TYPE,da.DATE_RANGE_FOR_BOOKING_TYPE],a.type))return"";a=a.dayPattern||[];return!a.length||a.length===Z.WEEK_DAYS_KEYS.length?"":_.map(a,function(a){return Z.WEEK_DAYS_SHORT[a]}).join(", ")}},ca={FLAT_FEE_RULE_TYPE:"flat",MAXIMUM_FEE_RULE_TYPE:"maximum",calculateFeeableForFee:function(a,
b){return _.roundHalfToEven(a/b)},calculateFeeableForRule:function(a,b,c){if(a.feeType!==v.PERCENTAGE_FEE_TYPE||!a.percentageFeeRate)return 0;a=a.percentageFeeRate;if(c.type===ca.FLAT_FEE_RULE_TYPE)return ca.calculateFeeableForFee(c.amount,a);if(c.type===ca.MAXIMUM_FEE_RULE_TYPE){var d=_.roundHalfToEven(b*a);c=c.amount;return d>c?ca.calculateFeeableForFee(c,a):b}console.warn("StoredValueCard.calculateFeeableForRule: invalid rule type",c.type);return 0},calculateFeeable:function(a,b){if(!a.features.isStoredValueCardBookingFeesEnabled)return 0;
var c=k.get("db").slipstream("storedValueCardFeeableRules");if(_.isUndefined(c))return console.warn("StoredValueCard.calculateFeeable: rules are not defined"),0;var d=a.primaryLocation,c=c[_.get(d,"country")];if(!c)return 0;if(c.isUnrestricted)return b;d=_.get(d,"province");if(_.contains(c.unrestrictedProvinces,d))return b;d=c.provinceRules[d];return!d?0:ca.calculateFeeableForRule(a,b,d)},NUMBER_REGEX:/^[a-zA-Z0-9\-_\#\%$]+$/,isNumberValid:function(a){return ca.NUMBER_REGEX.test(a)}},ia={MIN_QR_CODE_SIZE:1,
MAX_QR_CODE_SIZE:1.3,STANDARD:{name:"Standard",settings:{isCompanyInformationIncluded:!0,isRotated:!1,len:5.5,height:2,marginTop:0.125,marginRight:0.125,marginBottom:0.125,marginLeft:0.125,hasLeadingStub:!0,leadingStubLength:1,leadingStubMarginTop:0.125,leadingStubMarginBottom:0.125,hasTrailingStub:!1,trailingStubLength:1,trailingStubMarginTop:0.125,trailingStubMarginBottom:0.125,hasCustomFields:!1,hasStubCustomFields:!1}},BLANK:{name:"",settings:{isCompanyInformationIncluded:!0,isRotated:!1,len:5.5,
height:2,marginTop:0.125,marginRight:0.125,marginBottom:0.125,marginLeft:0.125,hasLeadingStub:!0,leadingStubLength:1,leadingStubMarginTop:0.125,leadingStubMarginBottom:0.125,hasTrailingStub:!1,trailingStubLength:1,trailingStubMarginTop:0.125,trailingStubMarginBottom:0.125,hasCustomFields:!1,hasStubCustomFields:!1}},mainLeft:function(a){var b=a.settings.marginLeft;a.settings.hasTrailingStub&&(b+=a.settings.trailingStubLength);return b},mainRight:function(a){var b=a.settings.marginRight;a.settings.hasLeadingStub&&
(b+=a.settings.leadingStubLength);return b},qrCodeSize:function(a){a=a.settings.height-a.settings.marginTop-a.settings.marginBottom;a<ia.MIN_QR_CODE_SIZE&&(a=ia.MIN_QR_CODE_SIZE);a>ia.MAX_QR_CODE_SIZE&&(a=ia.MAX_QR_CODE_SIZE);return a},BOCA_PRINT_FORMAT:"boca",RECEIPT_PRINT_FORMAT:"receipt"},ta={ADMIN_ONLY_TYPE:"admin",ADMIN_ONLY_TYPES:"admin admin-charge-disputed admin-dispute-closed duplicated-x-companies duplicated-x-companies-single generated-report ran-report rejected-sms updated-sms-notification-status card-error processor-webhook-error transferred-payment was-transferred-payment webhook-request-failed webhook-request-succeeded".split(" "),
CHANGED_TYPES:["changed","changed-company-admin-notes","changed-booking-note","changed-customer-checkin-status"],isAdminOnly:function(a){return _.contains(ta.ADMIN_ONLY_TYPES,a.type)},isChangedType:function(a){return _.contains(ta.CHANGED_TYPES,a)},objectUrl:function(a){var b;a.object&&(b=a.object.$url());b||(b=a.company.$url());return b},_changesByFieldName:{},changesByFieldName:function(a){var b=ta._changesByFieldName[a.uri];if(b)return b;b={};_.forEach(a.context.changes,function(a){b[d.camelKey(a.field)]=
a});return ta._changesByFieldName[a.uri]=b}},K={NO_CUSTOM_TAX:"no",ONLY_TAXED_CUSTOM_TAX:"only-taxed",ALL_CUSTOM_TAX:"all",ALWAYS_CUSTOM_TAX:"always",INHERIT_TAX_INCLUSION:"inherit",INCLUDED_TAX_INCLUSION:"included",NOT_INCLUDED_TAX_INCLUSION:"not-included",INHERIT_PRICE_TYPE:"inherit",CHANGE_PRICE_TYPE:"change",INHERIT_SHEET_RATE_TYPE:"inherit",CHANGE_SHEET_RATE_TYPE:"change",OFFSET_MODIFIER_KIND:"offset",PERCENTAGE_MODIFIER_KIND:"percentage",ADJUST_MODIFIER_TYPE:"adjust",SET_MODIFIER_TYPE:"set",
NONE_MODIFIER_TYPE:"none",INHERIT_IS_TAXABLE:"",INHERIT_IS_TAXABLE_LABEL:T("Inherit"),ON_IS_TAXABLE:!0,ON_IS_TAXABLE_LABEL:T("On"),OFF_IS_TAXABLE:!1,OFF_IS_TAXABLE_LABEL:T("Off"),displayTaxInclusion:function(a){var b={};b[K.INHERIT_TAX_INCLUSION]=T("Inherit");b[K.INCLUDED_TAX_INCLUSION]=T("Tax included");b[K.NOT_INCLUDED_TAX_INCLUSION]=T("Tax not included");return b[a]},displayCustomTax:function(a){var b={};b[K.NO_CUSTOM_TAX]=T("Standard tax");b[K.ONLY_TAXED_CUSTOM_TAX]=T("Custom tax");b[K.ALL_CUSTOM_TAX]=
T("Custom tax (include untaxed)");b[K.ALWAYS_CUSTOM_TAX]=T("Custom tax (include untaxed, even on untaxed sheets)");return b[a]||b[K.NO_CUSTOM_TAX]},isInheritTaxability:function(a){return a.isTaxable!==K.OFF_IS_TAXABLE&&a.isTaxable!==K.ON_IS_TAXABLE&&!_.any(a.taxTypes,_.isBoolean)},isCustomTaxAllowed:function(a,b){return b.features.isCustomTaxEnabled&&!b.features.isAggregateTaxEnabled&&a.modifierType!==K.NONE_MODIFIER_TYPE},isTaxInclusionAllowed:function(a,b){return b.features.isTaxInclusionEnabled&&
a.modifierType!==K.NONE_MODIFIER_TYPE&&a.customTax===K.NO_CUSTOM_TAX&&a.modifierKind!==K.PERCENTAGE_MODIFIER_KIND},displayTaxable:function(a){return a===K.ON_IS_TAXABLE?K.ON_IS_TAXABLE_LABEL:a===K.OFF_IS_TAXABLE?K.OFF_IS_TAXABLE_LABEL:K.INHERIT_IS_TAXABLE_LABEL},isAggregateTaxableObject:function(a){return _.contains([R.cls,t.cls,v.cls],a.cls)},isTaxTypesAllowed:function(a,b,c){return a.isTaxable===K.OFF_IS_TAXABLE||a.isTaxable===K.INHERIT_IS_TAXABLE&&b.cls!==t.cls?!1:!c.company.features.isAggregateTaxEnabled||
K.isAggregateTaxableObject(b)},showOffset:function(a){return a.price.customTax!==K.NO_CUSTOM_TAX||a.price.modifierType===K.NONE_MODIFIER_TYPE?!1:a.price.modifierKind===K.OFFSET_MODIFIER_KIND&&(!!a.price.offset||a.price.modifierType===K.SET_MODIFIER_TYPE)},showRate:function(a){return a.price.customTax!==K.NO_CUSTOM_TAX||a.price.modifierType===K.NONE_MODIFIER_TYPE?!1:a.price.modifierKind===K.PERCENTAGE_MODIFIER_KIND&&(!!a.price.rate||a.price.modifierType===K.SET_MODIFIER_TYPE)},effectiveOffset:function(a,
b){if(a.price.modifierType===K.NONE_MODIFIER_TYPE)return 0;b=_.isUndefined(b)?1:b;return _.roundHalfToEven(a.price.offset*a.sheetRate.sheetRate*b)},effectiveRate:function(a,b){if(a.price.modifierType===K.NONE_MODIFIER_TYPE)return 0;b=_.isUndefined(b)?1:b;return a.price.rate*b},modifierKindChoices:function(a){var b,c=k.get("db").slipstream("currencies");if(c){var d=_.resolveCurrency(a);if(c=c[d])b=c.symbol}b||(console.warn("modifierKindChoices: unable to determine currency symbol",a),b="$");return[[K.PERCENTAGE_MODIFIER_KIND,
"%"],[K.OFFSET_MODIFIER_KIND,b]]},isTaxIncluded:function(a){return a.price.taxInclusion===P.PriceLine.INCLUDED_TAX_INCLUSION&&a.taxes.taxability!==P.PriceSheet.NONE_TAXABILITY&&a.price.customTax===P.PriceLine.NO_CUSTOM_TAX&&a.price.modifierKind!==P.PriceLine.PERCENTAGE_MODIFIER_KIND},isCompanyBaseLine:function(a,b){return b.isBase&&a.cls===v.cls},effectiveTaxTypes:function(a){return _.unique(_.append(_.keys(a.taxes.ratesByType),_.keys(a.taxes.offsetsByType)))}};K.IS_TAXABLE_CHOICES=[{label:K.INHERIT_IS_TAXABLE_LABEL,
value:K.INHERIT_IS_TAXABLE},{label:K.ON_IS_TAXABLE_LABEL,value:K.ON_IS_TAXABLE},{label:K.OFF_IS_TAXABLE_LABEL,value:K.OFF_IS_TAXABLE}];K.isTaxableChoices=function(a,b){return K.isCompanyBaseLine(a,b)?_.slice(K.IS_TAXABLE_CHOICES,1):K.IS_TAXABLE_CHOICES};var ja=_.property("isOnline"),Ta=_.property("isBase"),eb=_.property("isTotalBase"),fb=_.property("isInvoiceBase"),Ga=function(a){return!a.isBase&&!a.isTotalBase&&!a.isInvoiceBase},ea={NONE_TAXABILITY:"none",PRO_RATE_TAXABILITY:"pro-rate",FULL_TAXABILITY:"full",
OFFSET_MODIFIER_KIND:"offset",PERCENTAGE_MODIFIER_KIND:"percentage",ADJUST_MODIFIER_TYPE:"adjust",SET_MODIFIER_TYPE:"set",baseSheet:function(a){return _.find(a,Ta)},nonBaseSheets:function(a){return _.filter(a,Ga)},sheetRateToModel:function(a){return _.roundHalfToEven(100*a,7)},sheetRateFromModel:function(a){return a/100},isInvoiceSheet:function(a){return a.cls===P.InvoiceSheet.cls},taxable:function(a){if(a.price.modifierType===K.NONE_MODIFIER_TYPE)return 0;var b=a.taxes.taxability;if(b===ea.NONE_TAXABILITY)return 0;
if(b===ea.PRO_RATE_TAXABILITY)return K.effectiveOffset(a);if(b===ea.FULL_TAXABILITY)return a.price.offset;console.warn("invalid taxability",b);return 0},isNonBase:Ga,dropdownLabel:function(a){var b=a.displayName;a.cls.endsWith("Schedule")&&(b+=" "+T("(schedule)"));a.isArchived&&(b+=" "+T("(archived)"));return b},displayName:function(a){return a.displayName+(a.isArchived?" "+T("(archived)"):"")}};K.NONE_PRICING={visibility:{isVisible:!0,isHiddenWhenBooking:!1,isHiddenOnReceipts:!1,isRequired:!1},price:{modifierType:K.NONE_MODIFIER_TYPE,
customTax:K.NO_CUSTOM_TAX},taxes:{taxability:ea.PRO_RATE_TAXABILITY},sheetRate:{sheetRate:1}};var Ua=_.extend({baseSheet:ea.baseSheet,totalBaseSheet:function(a){return _.find(a,eb)},nonBaseSheets:ea.nonBaseSheets,onlineSheets:function(a){return _.filter(a,ja)},displaySheetRate:function(a){return a-1},fromDisplaySheetRate:function(a){return a+1},isOnlineDefault:function(a){return!a||!a.pk?!1:a==a.company.defaultOnlineTotalSheet||a.company.defaultOnlineTotalSchedule&&a==a.company.defaultOnlineTotalSchedule.fallback}},
ea),gb=_.extend({INHERIT_VISIBILITY:"inherit",VISIBLE_VISIBILITY:"visible",HIDDEN_VISIBILITY:"hidden"},K),ka=_.extend({AFFILIATE_RELATIONSHIP:"affiliate",CHARTER_RELATIONSHIP:"charter",invoiceBaseSheet:function(a){return _.find(a,fb)},nonBaseSheets:ea.nonBaseSheets,displaySheetRate:function(a,b){if(b===ka.CHARTER_RELATIONSHIP)return 1-a;if(b===ka.AFFILIATE_RELATIONSHIP)return a},fromDisplaySheetRate:function(a,b){if(b===ka.CHARTER_RELATIONSHIP)return 1-a;if(b===ka.AFFILIATE_RELATIONSHIP)return a},
displayRelationship:function(a){return a===ka.CHARTER_RELATIONSHIP?"reseller":a===ka.AFFILIATE_RELATIONSHIP?"referral":"none"}},ea),hb=_.extend({},K),Va={isOnlineFallback:function(a){return a.fallback&&a.fallback.isOnline},verboseName:T("schedule"),verboseNamePlural:T("schedules")},ib={verboseName:T("schedule"),verboseNamePlural:T("schedules")},na={groupRules:function(a,b){var c={};_.forEach(na.RULE_TYPES,function(a){c[a]=[]});_.forEach(a,function(a){c[a.type].push(a)});b&&this.sortDayOfWeekType(c,
b);return c},sortDayOfWeekType:function(a,b){var c=Z.weekDays(b);_.forEach(a,function(b,d){_.contains(na.DAY_OF_WEEK_TYPES,d)&&(a[d]=_.sortBy(b,function(a){return c.indexOf(a.dayPattern[0])}))})},displayType:function(a){return na.TYPE_CHOICES[a.type]},isDateType:function(a){return _.contains(na.DATE_TYPES,a.type)},isDayOfWeekType:function(a){return _.contains(na.DAY_OF_WEEK_TYPES,a.type)},combinedDayPattern:function(a){var b=_.flatten(_.pluck(a,"dayPattern")),c=[];_.forEach(Z.WEEK_DAYS_KEYS,function(a){_.contains(b,
a)&&c.push(Z.weekDayShort(a))});return c}},ua={aggregationKey:function(a){return a.customFieldInstance.customField.type===P.CustomField.TRANSPORTATION_TYPE?a.transportationOption&&!a.transportationOption.isSelfTransportation?a.transportationOption.value:T("Self transportation"):a.value?a.value.toString():""},displayValue:function(a){return a.customFieldInstance.customField.type===P.CustomField.COUNT_TYPE&&!a.value?"":a.displayValue},aggregationDisplayValue:function(a){return _.contains([P.CustomField.TRANSPORTATION_TYPE,
P.CustomField.COUNT_TYPE],a.customFieldInstance.customField.type)?"":a.displayValue},aggregationCount:function(a){return a.customFieldInstance.customField.type===P.CustomField.TRANSPORTATION_TYPE?a.transportationOption&&!a.transportationOption.isSelfTransportation?a.booking.customerCount:0:a.customFieldInstance.customField.type===P.CustomField.COUNT_TYPE?a.value:a.value?1:0},annotate:function(a,b,d){var e=c("time"),g={},f=[],h=[],k=function(a,b){h.push(a);var c=ua.aggregationKey(a),e=ua.aggregationCount(a),
k=P.CustomField.isAggregatable(a.customFieldInstance.customField),l=a.customer?a.customer.pk:a.pk;b||!k||d?(k=ua.displayValue(a),""!==k&&f.push({customFieldValue:a,key:c,count:e,displayValue:k,transportationOption:a.transportationOption||null,isAggregated:!1,sortableIndex:l})):(l=g[c]||{customFieldValue:a,key:c,count:0,displayValue:ua.aggregationDisplayValue(a),transportationOption:null,isAggregated:!0,sortableIndex:l},e&&(l.count+=e,g[c]=l))};_.forEach(b.customers,function(b){_.forEach(b.customFieldValues,
function(b){b.customFieldInstance.customField===a&&k(b,!1)})});_.forEach(b.customFieldValues,function(c){c.customFieldInstance.customField===a&&k(c,b.cls===Y.cls)});var l=_.append(_.values(g),f),l=_.sortBy(l,"sortableIndex");_.forEach(l,function(a){var b="",b=a.customFieldValue,c=b.transportationOption;if(c){var d=b.booking.availability.startAt.clone();d.subtract(c.minutesBeforeStart,"minutes");b=interpolate(T("%(time)s at %(name)s"),{time:e(d),name:b.displayValue})}else b=a.isAggregated&&a.count?
a.displayValue?a.count.toString()+" "+a.displayValue:a.count.toString():a.displayValue;a.renderedValue=b});return{annotatedCustomFieldValues:l,customFieldValues:h}}},ga={LEGACY_TAX_TYPE_PK:-1,RATE_TYPE:"rate",OFFSET_TYPE:"offset",displayName:function(a){return interpolate(T("%(name)s (%(rate)s)"),{name:c("name")(a),rate:ga.displayRate(a)})},displayRate:function(a){if(a.type===ga.RATE_TYPE)return c("percentage")(a.rate,"hideplus");if(a.type===ga.OFFSET_TYPE)return c("amount")(a.offset,a.company)}},
Sa={},Ba=function(){var a={GOOGLE_ANALYTICS_TYPE:"google-analytics",FACEBOOK_TYPE:"facebook",ADROLL_TYPE:"adroll",OPTIMIZELY_TYPE:"optimizely",CUSTOM_CODE_TYPE:"custom-code",IDENTIFIERS_BY_TYPE:{},IDENTIFIER_LABELS:{googleAnalyticsUa:"UA Code",facebookPixel:"Pixel ID",adrollAdvertiser:"Advertiser ID",adrollPixel:"Pixel ID",optimizelyAccount:"Account ID",optimizelyProject:"Project ID",optimizelyEventKey:"Goal Event",optimizelyGoals:"Goal ID(s)",customCode:"Code",customIdentifiers:"Identifiers"},needsCrossDomainField:function(b){return _.includes([a.GOOGLE_ANALYTICS_TYPE,
a.FACEBOOK_TYPE,a.ADROLL_TYPE,a.OPTIMIZELY_TYPE],b)},displayIdentifier:function(b){return a.IDENTIFIER_LABELS[b]}},b=a.IDENTIFIERS_BY_TYPE;b[a.GOOGLE_ANALYTICS_TYPE]=["googleAnalyticsUa"];b[a.FACEBOOK_TYPE]=["facebookPixel"];b[a.ADROLL_TYPE]=["adrollAdvertiser","adrollPixel"];b[a.OPTIMIZELY_TYPE]=["optimizelyAccount","optimizelyProject","optimizelyEventKey","optimizelyGoals"];b[a.CUSTOM_CODE_TYPE]=["customCode","customIdentifiers"];return a}(),pa=function(a,b){if(!a)return console.warn("supported language: invalid empty language code"),
"";var c=a.split("-")[0];return(c=oa.DISPLAY_LANGUAGES[a]||oa.DISPLAY_LANGUAGES[c])?c[b]:""},oa={isRecognizedLanguage:function(a){return _.contains(oa.LANGUAGE_CODES_SORTED,a)},rootLanguage:function(a){return a.split("-")[0]},display:function(a){return pa(a,"name")},displayLocal:function(a){return pa(a,"nameLocal")},shareRootLanguage:function(a,b){return a&&b&&oa.rootLanguage(a)===oa.rootLanguage(b)},SCROLL_TO_LANGUAGE_PARAM:"highlight-language"},sa={BEFORE_MIDNIGHT_CUTOFF_KIND:"before-midnight",
BEFORE_START_CUTOFF_KIND:"before-start",RESTRICTION_FIELDS:"minimumInitialPartySize minimumSubsequentPartySize maximumInitialPartySize maximumSubsequentPartySize isBookableEverByPhone soldOutText cutoffUnreachedKind cutoffUnreachedHours isCutoffUnreachedCallToBook cutoffReachedKind cutoffReachedHours isCutoffReachedCallToBook autoOpenHours autoOpenKind".split(" "),DEFAULT_AUTO_OPEN_HOURS:720,cutoffStart:function(a,b,c){if(a===sa.BEFORE_START_CUTOFF_KIND)return c.clone().subtract(b,"hours");if(a===
sa.BEFORE_MIDNIGHT_CUTOFF_KIND)return c.clone().startOf("day").subtract(b,"hours");console.error("BookingRestriction.cutoffStart: invalid kind "+a)}},P={Order:X,Contact:E,Booking:Y,Customer:{},LineItem:{},ItemGroup:{},Availability:R,Company:v,User:{OWNER_TYPE:"owner",ADMIN_TYPE:"admin",EMPLOYEE_TYPE:"employee",ICS_RESELLER_KEY_NAME:"ICS Calendar",showNag:function(a,b,c){a=a.nags[b];if(!a||!c&&a.isDismissed)return!1;b=s[b];return!b?!0:moment().isBefore(b)},getActive:function(a){return _.filter(a,"isInactive",
!1)},sortActiveFirst:function(a){return _.sortBy(a,function(a){return[a.isInactive,a.name.toLowerCase()]})},displayName:function(a){return a.isInactive?a.name+" "+T("(deactivated)"):a.name}},TagGroup:{},Tag:{},TagInstance:{},Item:t,FlowNode:B,CustomFieldInstanceGroup:{},CustomFieldInstanceCondition:H,CustomFieldInstance:Q,CustomerType:{includeArchivedOnRequirement:function(a,b){if(!b)return a;var c=_.reject(_.pluck(b.customerTypeRequirements,"customerType"),"isHidden");return _.union(a,c)}},CustomerPrototype:{name:function(a){return a.displayName},
customerTypeSuffix:function(a){var b=a.isExclusive?T("exclusive"):"",c=a.customerType.isArchived?T("archived"):"";(a=_.compact([a.name?a.customerType.shortName||a.customerType.plural:"",b,c]).join(", "))&&(a="("+a+")");return a},group:function(a){return a.customerType.isArchived?T("Archived"):a.isHidden?T("Deleted"):""}},CustomerTypeRate:M,CheckinStatus:y,Image:{CAROUSEL_GALLERY:"carousel"},CustomField:F,ExtendedOption:{},TransportationOption:{},ConnectedCampaign:{},GeneratingCampaign:{},CannedMessage:q,
AvailabilityHeadline:Na,Notification:G,SmsNotification:ra,ReviewExpressNotification:{},Subscription:I,Payment:L,Dispute:V,InStorePaymentType:{isUsable:function(a,b){var c=b.isCharter&&a.isVisibleWhenCollectedByCharter;return b.isAffiliate&&a.isVisibleWhenCollectedByAffiliate||c},isVisibleWhenCollectedByCharter:function(a){return _.filter(a,"isVisibleWhenCollectedByCharter")},isVisibleWhenCollectedByAffiliate:function(a){return _.filter(a,"isVisibleWhenCollectedByAffiliate")}},EmvDevice:ma,Refund:U,
Receipt:{ALL_PAYMENT_RECEIPTS:"all",printedAt:function(){return moment()}},Rule:Z,Payout:{SUCCEEDED_STATUS:"succeeded",PAID_STATUS:"paid",PENDING_STATUS:"pending",FAILED_STATUS:"failed",PROCESSED_STATUS:"processed"},Fund:{},Transfer:{},Upload:{SUCCEEDED_STATUS:"succeeded",PENDING_STATUS:"pending",FAILED_STATUS:"failed"},Transaction:S,Account:{BANK_TYPE:"bank",DEPOSIT_TYPE:"deposit",ESCROW_TYPE:"escrow"},Adjustment:b,Campaign:{},CampaignValidityRule:da,Code:{},StoredValueType:{},StoredValueCard:ca,
StoredValueAdjustment:{},TicketLayout:ia,CustomCalendar:{},CustomManifest:{},CustomReport:{QUERY_PARAM:"saved",QUERY_PARAM_KEY:"pk"},SuggestedReport:{QUERY_PARAM:"suggested",QUERY_PARAM_KEY:"slug",DEFAULT_SLUG:"default"},Activity:ta,Block:{},Agent:O,Desk:fa,Affiliation:cb,CrewMember:{},Role:{},Hotel:{},Lodging:{RELATED_FEATURE_FLAG:"isTransportationEnabled"},PreferredPickup:{},Pickup:{RELATED_FEATURE_FLAG:"isTransportationEnabled"},Route:{RELATED_FEATURE_FLAG:"isTransportationEnabled"},Stop:{},Run:{},
Report:A,Invoice:{PAID_STATUS:"paid",PENDING_STATUS:"pending",UNPAID_STATUS:"unpaid",OVERDUE_STATUS:"overdue",isInvoicedToCharter:function(a){return 0<a}},InvoiceEntry:{},Location:{RELATED_FEATURE_FLAG:"isLocationsEnabled"},SupportedLanguage:oa,Translation:{displayNameForInstance:function(a){return a.name||a.displayName||a.title||a.unicode},fieldDisplayValue:function(a,b,c){a=_.camelCase(a.fieldName);return c?b[a][c]:b[a]},modelNameForUrl:function(a){return _.kebabCase(a)},modelNameFromUrl:function(a){return _.startCase(a).replace(/ /g,
"")},fieldNameForUrl:function(a){return _.kebabCase(a)},fieldNameFromUrl:function(a){return _.snakeCase(a)}},Waiver:{RELATED_FEATURE_FLAG:"isSmartwaiverEnabled"},ConnectedWaiver:{},WaiverInstance:{},Group:{AFFILIATE_TYPE:"affiliate",COMPANY_TYPE:"company",PARTNER_TYPE:"partner"},GroupOverride:{companyLevelOverrides:function(a){return _.filter(a,function(a){return null===a.relatedUser})}},PriceSheet:ea,PriceLine:K,TotalSheet:Ua,TotalLine:gb,InvoiceSheet:ka,InvoiceLine:hb,TotalSchedule:Va,InvoiceSchedule:ib,
TotalScheduleEntry:{},InvoiceScheduleEntry:{},ScheduleEntryRule:na,TotalScheduleEntryRule:{},InvoiceScheduleEntryRule:{},TaxType:ga,BankAccount:{INDIVIDUAL_ACCOUNT_HOLDER_TYPE:"individual",COMPANY_ACCOUNT_HOLDER_TYPE:"company",ROUTING_NUMBER_REGEX_BY_COUNTRY:{AU:/^[\d]{6}$/,CA:/^0?[\d]{5}-?[\d]{3}$/,GB:/^[\d]{2}-?[\d]{2}-?[\d]{2}$/,NZ:/^[\d]{6}$/,US:/^[\d]{9}$/},isIbanRequired:function(a,b){return Oa(a,b,"processorIbanBankAccountCountries")},isRoutingNumberRequired:function(a,b){return!Oa(a,b,"processorIgnoreRoutingNumberCountries")}},
Ledger:{RELATED_FEATURE_FLAG:"isLedgersEnabled"},Card:{},CardAffiliation:{},CustomFieldValue:ua,BookingCustomFieldValue:Sa,CustomerCustomFieldValue:{},Resource:g,RequirementGroup:m,Requirement:D,CustomerPrototypeRequirement:{},CustomerTypeRequirement:{},ResourceRequirement:l,ResourceUse:p,ResourceOverride:{},SeatMap:N,SeatGroup:w,Seat:J,SeatAssignment:u,SeatZone:x,Calendar:e,ResellerCompany:{},ResellerCompanyMapping:{},ResellerItem:{},ResellerItemMapping:{},ResellerCustomerType:{},ResellerCustomerTypeMapping:{},
ResellerOption:{},ResellerOptionMapping:{},ResellerKey:{SEND_BOOKINGS_SCHEMA:"send_bookings",SEND_BOOKINGS_WITH_PAYMENTS_SCHEMA:"send_booking_with_payments"},ResellerApp:{},ResellerAppRequest:{PENDING_STATUS:"pending",CONNECTED_STATUS:"connected"},ResellerAppCompany:{},AnalyticsService:Ba,CancellationPolicy:{},CancellationRule:{ALWAYS_TYPE:"always",HOURS_BEFORE_AVAILABILITY_START_TYPE:"hours-before-start",HOURS_BEFORE_AVAILABILITY_MIDNIGHT_TYPE:"hours-before-midnight",HOURS_BEFORE_PSEUDO_TYPE:"hours-before"},
BookingRestriction:sa},Ha=_.keys(P);_.forEach(Ha,function(a){P[a].cls=a});P.models=_.sortBy(_.values(P),"cls");P.inject=function(a){_.forEach(Ha,function(b){a[b]=P[b]})};return P}]);m.run(["$filter","$rootScope","db","emv","models","navigation","processors","urls",function(c,k,d,h,f,n,a,q){f.inject(k);k.nullModel={};k=d.slipstream("models.verboseNames");_.forEach(k,function(a,b){_.defaults(f[b],a)});f.Company.taxDisplayRate=function(a){return a.features.includedTaxRate?c("percentage")(a.features.includedTaxRate,
!0):""};f.Rule.WEEK_DAYS_DISPLAY=_.map(f.Rule.WEEK_DAYS_KEYS,function(a){return f.Rule.WEEK_DAYS[a]});f.Availability.manifestUrl=function(a){return n.compose(q.populate(q.dashboard.manifest.availabilities,{shortname:a.company.shortname,date:a.startAt?a.startAt.format("YYYY-MM-DD"):void 0}),{items:a.item.pk,availabilities:a.pk})};f.Run.manifestUrl=function(a){return n.compose(q.populate(q.dashboard.manifest.runs,{shortname:a.route.company.shortname,date:a.startAt?a.startAt.format("YYYY-MM-DD"):void 0}),
{routes:a.route.pk})};f.Item.manifestUrl=function(a,b){return n.compose(q.populate(q.dashboard.manifest.availabilities,{shortname:a.company.shortname,date:b}),{items:a.pk})};f.Resource.manifestUrl=function(a,b){return n.compose(q.populate(q.dashboard.manifest.resources,{shortname:a.company.shortname,date:b}),{resources:a.pk})};f.Booking.processorTypes=function(a){a=a||[];return _.filter(_.sortBy(_.uniq(_.pluck(a,"processorType"))))};f.Booking.statementText=function(b,c){var d=f.Booking.processorTypes(c);
return _.map(d,function(c){c=a.get(c);return'"'+c.STATEMENT_TEXT_PREFIX+c.statementText(b)+'"'}).join(" or ")};f.Booking.pendingStatementText=function(b){b=f.Booking.processorTypes([b]);return _.map(b,function(b){return'"'+a.get(b).PENDING_STATEMENT_TEXT+'"'}).join(" or ")};f.Payment.isDefaultProcessorBasedType=function(b){return b.type===f.Payment.CC_TYPE&&b.processorType===a.DEFAULT_PROCESSOR_TYPE};f.Payment.isLegacyProcessorBasedType=function(b){return f.Payment.isProcessorBasedType(b)&&_.contains(a.LEGACY_PROCESSOR_TYPES,
b.processorType)};f.Payment.minimumChargeAmounts=function(b,c){var g=d.slipstream("processorMinimumChargeAmounts");return _.get(g[c],b,g[c][a.DEFAULT_CURRENCY])};var g=f.Report;g.MODELS={};g.MODELS[f.StoredValueCard.cls]={name:T("Gift Cards"),singular:T("Gift Card"),slug:"stored-value-cards",model:f.StoredValueCard,submodels:[]};g.MODELS[f.Booking.cls]={name:T("Bookings"),singular:T("Booking"),slug:"bookings",model:f.Booking,submodels:[]};g.MODELS[f.Customer.cls]={name:T("Customers"),singular:T("Customer"),
slug:"customers",model:f.Customer,submodels:[f.Booking]};g.MODELS[f.LineItem.cls]={name:T("Expenses and Discounts"),singular:T("Expense and discount"),slug:"expenses-and-discounts",model:f.LineItem,submodels:[f.Booking]};g.MODELS[f.CustomFieldValue.cls]={name:T("Custom Field Answers"),singular:T("Custom field answer"),slug:"custom-field-answers",model:f.CustomFieldValue,submodels:[f.Customer,f.Booking]};g.MODELS[f.Payment.cls]={name:T("Sales"),singular:T("Sales"),slug:"payments-and-refunds",model:f.Payment,
submodels:[f.Booking]};g.ORDERED_MODELS=[f.Payment,f.Booking,f.Customer,f.CustomFieldValue,f.LineItem,f.StoredValueCard];g.UNSOUND_AGGREGATES={Payment:[f.Booking],Booking:[],Customer:[f.Booking],CustomFieldValue:[f.Booking,f.Customer],LineItem:[f.Booking]};g.advancedUrl=function(a,b){return q.populate(q.dashboard.reports.advanced.index,{shortname:a.shortname,modelSlug:g.MODELS[b].slug})};g.SWITCH_QUERY_PARAM_KEY="switch";g.advancedSwitchUrl=function(a,b){var c={};c[g.SWITCH_QUERY_PARAM_KEY]=!0;return n.compose(g.advancedUrl(a,
b),c)};g.VALID_COLUMNS=d.slipstream("reports.validColumns");g.VALID_GROUPS=d.slipstream("reports.validGroups");g.VALID_FILTERS=d.slipstream("reports.validFilters");g.PROHIBITED_GROUPS=d.slipstream("reports.prohibitedGroups");g.PROHIBITED_HIGHER_GROUPS=d.slipstream("reports.prohibitedHigherGroups");g.ALWAYS_UNSOUND_GROUPINGS=d.slipstream("reports.alwaysUnsoundGroupings");_.extend(g,d.slipstream("reports.allColumns"));_.extend(g,d.slipstream("reports.allGroups"));_.extend(g,d.slipstream("reports.allFilters"));
_.extend(g,d.slipstream("reports.allDateRanges"));g.MODELS_BY_GROUP={};_.forEach(g.VALID_GROUPS,function(a,b){_.forEach(a,function(a){g.MODELS_BY_GROUP[a]=g.MODELS_BY_GROUP[a]||[];g.MODELS_BY_GROUP[a].push(f[b])})});f.ResourceOverride.collapseSeatOverrides=function(a){var b={};_.forEach(_.filter(a,"seat"),function(c){var d=c.startAt.format()+"-"+c.endAt.format()+"-"+c.resource.pk;b[d]=b[d]||[];b[d].push(c);_.ref.remove(a,c)});_.forEach(b,function(b){a.push({startAt:b[0].startAt,endAt:b[0].endAt,resource:b[0].resource,
seatCount:b.length})});return a};k=f.ScheduleEntryRule;k.TYPE_CHOICES=_.reduce(d.slipstream("scheduleEntryRule.typeChoices"),function(a,b){a[b[0]]=b[1];return a},{});k.DATE_BASED_ON_BOOKING="booking";k.DATE_BASED_ON_AVAILABILITY="availability";k.DAY_OF_WEEK_BASED_ON_BOOKING="dow-booking";k.DAY_OF_WEEK_BASED_ON_AVAILABILITY="dow-availability";k.RULE_TYPES=[k.DATE_BASED_ON_BOOKING,k.DATE_BASED_ON_AVAILABILITY,k.DAY_OF_WEEK_BASED_ON_BOOKING,k.DAY_OF_WEEK_BASED_ON_AVAILABILITY];k.DATE_TYPES=[k.DATE_BASED_ON_BOOKING,
k.DATE_BASED_ON_AVAILABILITY];k.DAY_OF_WEEK_TYPES=[k.DAY_OF_WEEK_BASED_ON_BOOKING,k.DAY_OF_WEEK_BASED_ON_AVAILABILITY];f.ResourceUse.OPTIONS=d.slipstream("resourceUse.options");f.ResourceUse.OPTIONS_VALUES_KEYS_MAP=_.reduce(f.ResourceUse.OPTIONS,function(a,b){a[b.value]=b.key;return a},{});f.ResourceUse.OPTIONS_KEYS_DISPLAY_TEXT_MAP=_.reduce(f.ResourceUse.OPTIONS,function(a,b){a[b.key]=b.displayText;return a},{});f.ResourceUse.getUseSettings=function(a){var b;a.cls===f.ResourceRequirement.cls?b=[String(a.isSkipCreation),
String(a.isIgnoreResourceOveruse)].join("-"):a.cls===f.Resource.cls?b=[String(a.isSkipResourceUseCreation),String(a.isIgnoreOveruse)].join("-"):console.error("invalid object passed to ResourceUse.getUseSettings");return f.ResourceUse.OPTIONS_VALUES_KEYS_MAP[b]};f.ResourceUse.getDisplayText=function(a){a=f.ResourceUse.getUseSettings(a);return f.ResourceUse.OPTIONS_KEYS_DISPLAY_TEXT_MAP[a]};f.CustomReport.url=function(a){var b=g.advancedUrl(a.company,a.options.modelName),c={};c[f.CustomReport.QUERY_PARAM]=
a[f.CustomReport.QUERY_PARAM_KEY];return n.compose(b,c)};f.SuggestedReport.url=function(a,b){var c=g.advancedUrl(b,a.options.modelName),d={};d[f.SuggestedReport.QUERY_PARAM]=a.slug;return n.compose(c,d)};f.Item.frontendUrl=function(a,b){return b&&!a.isRetail?q.populate(q.company.item.month,{shortname:a.company.shortname,itemPk:a.pk,year:b.format("YYYY"),month:b.format("MM")}):a.$url(q.company.item.index)};f.FlowNode.frontendUrl=function(a,b){var c="";return c=a.externalUrl?a.externalUrl:a.item?f.Item.frontendUrl(a.item,
b):a.$url(q.company.flowNode.index)};f.FlowNode.suggestedItemUrl=function(a,b,c){b=a.item&&a.item.externalUrl&&!a.externalUrl?a.item.externalUrl:f.FlowNode.frontendUrl(a,b);var d={};a.type!==f.FlowNode.PAGE_TYPE&&(d[f.FlowNode.FLOW_QUERY]=a.parent.pk);d[f.FlowNode.IS_FROM_CART_QUERY]=c;return n.compose(b,d,!0)};_.extend(f.CampaignValidityRule,d.slipstream("campaignValidityRules.allTypes"));if(h.isDebugging){f.Payment.isEmv=function(a){return a.type===f.Payment.CC_TYPE};f.Payment.isEmvSignatureRequired=
function(a){return 0===a.pk%2};var b=f.Payment.emvDetails;f.Payment.emvDetails=function(a){a.metadata||(a.metadata={});a.metadata.emvDetails=h.debugDetails;return b(a)}}f.SupportedLanguage.DISPLAY_LANGUAGES=d.slipstream("displayLanguages");f.SupportedLanguage.LANGUAGE_CODES_SORTED=d.slipstream("languageCodesSorted");f.Translation.translationOverlayUrl=function(a,b,c,d,g){b={shortname:c,objectType:b.cls,objectId:b.pk,objectField:f.Translation.fieldNameForUrl(a)};a="";g?(b.subfield=f.Translation.fieldNameForUrl(g),
a=q.populate(q.dashboard.translationsOverlay.forSubfield,b)):a=q.populate(q.dashboard.translationsOverlay.forField,b);g={};g[f.SupportedLanguage.SCROLL_TO_LANGUAGE_PARAM]=d;return n.compose(a,g)};f.Seat.editUrl=function(a,b){return q.populate(q.dashboard.settings.seating.seatMap.layout.seats,{shortname:b.company.shortname,seatMapPk:b.pk,seatPks:_.isString(a)?a:_.pluck(a,"pk").join(",")})};f.Seat.duplicateUrl=function(a,b){return q.populate(q.dashboard.settings.seating.seatMap.layout.duplicate,{shortname:b.company.shortname,
seatMapPk:b.pk,seatPks:_.isString(a)?a:_.pluck(a,"pk").join(",")})};f.Seat.createUrl=function(a,b,c){return q.populate(q.dashboard.settings.seating.seatMap.layout.new,{shortname:c.company.shortname,seatMapPk:c.seatMap.pk,seatGroupPk:c.pk,xCoord:a,yCoord:b})}}])})();
(function(){var m=angular.module("lib.processors",["auth.services","db.services","lib.services","navigation.services"]),c={UNSUPPORTED:T("Unsupported processor. Please refresh the page and try again. If you continue to have trouble please contact support@fareharbor.com."),SCRIPT:T("Could not contact processor. Please refresh the page and try again."),TIMEOUT:T("Connection error. Please check your internet connection and try again."),WAIT:T("Please wait a few moments and try again."),TRY_AGAIN:T("Please try again."),
REFRESH:T("Please refresh the page and try again."),UNKNOWN:T("Unknown error. Please refresh the page and try again."),GENERIC_BANK_ACCOUNT:T("Could not update bank account. Please make sure all details have been entered correctly and try again."),REFRESH_BANK_ACCOUNT:T("Could not update bank account. Please refresh the page and try again."),TRY_AGAIN_BANK_ACCOUNT:T("Could not update bank account. Please try again."),GENERIC_CARD:T("Could not process payment. Please refresh the page and try again ensuring all card details have been entered correctly. If you continue to have trouble please contact support@fareharbor.com."),
REFRESH_CARD:T("Could not process payment. Please refresh the page and try again."),BAD_CARD:T("Could not process payment. Please make sure all card details have been entered correctly. If you are still unsuccessful you may need to call the card issuer or try a different card."),INVALID_ROUTING_NUMBER:T("Invalid routing number."),INVALID_CARD_NUMBER:T("Invalid card number. Please check that you have entered your card number correctly and try again."),BAD_CARD_NUMBER:T("Incorrect card number. Please check that you have entered your card number correctly and try again."),
INVALID_DEMO_CARD_NUMBER:T("Only demo card numbers can be used while demo mode is enabled."),INVALID_EXPIRATION:T("Invalid card expiration date. Please check that you've selected the correct expiration date for your card and try again."),BAD_EXPIRATION:T("Expired card. Please enter a valid card."),INVALID_SECURITY_CODE:T("Invalid CVC (card security code). Please check that you've entered your card's security code correctly and try again."),BAD_SECURITY_CODE:T("Incorrect CVC (card security code). Please check that you've entered your card's security code correctly and try again."),
INVALID_COUNTRY_CODE:T("Invalid country. Plesae check that your billing country is correct and try again."),INVALID_POSTAL_CODE:T("Invalid postal (zip) code. Please check that your billing postal code is correct and try again."),BAD_POSTAL_CODE:T("Incorrect postal (zip) code. Please check that your billing postal code is correct and try again.")},k={pending:T("Verification Pending"),failed:T("Verification Failed"),submitted:T("Information submitted. Awaiting reply.")};m.factory("processors",["$injector",
"auth","convert","db",function(d,h,f,n){var a={INDIVIDUAL_ENTITY_TYPE:"individual",COMPANY_ENTITY_TYPE:"company",DEFAULT_PROCESSOR_TYPE:"stripe",DEFAULT_CURRENCY:"usd",ADYEN_PROCESSOR_TYPE:"adyen",STRIPE_PROCESSOR_TYPE:"stripe",BALANCED_PROCESSOR_TYPE:"balanced",PAYPAL_PROCESSOR_TYPE:"paypal",PROCESSOR_TYPES:["stripe","paypal"],LEGACY_PROCESSOR_TYPES:["balanced"],ACCOUNT_CREATION_REQUIREMENTS:n.slipstream("accountCreationRequirements"),ACCOUNT_CREATION_REQUIREMENT_TO_FORM_FIELD:n.slipstream("processorAccountCreationFormField",
{doNotConvert:!0}),SUPPORTED_BANK_ACCOUNT_COUNTRIES:n.slipstream("processorSupportedBankAccountCountries"),BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES:n.slipstream("processorBankAccountVerificationEnabledCountries"),BANK_ACCOUNT_ADDITIONAL_REQUIRED_FORM_FIELDS:n.slipstream("processorBankAccountAdditionalRequiredFields"),SUPPORTED_CURRENCIES:n.slipstream("processorSupportedCurrencies"),PROCESSOR_CHOICES:n.slipstream("processorChoices"),COUNTRY_CHOICES:n.slipstream("countryChoices"),UNVERIFIED_VERIFICATION_STATUS:"unverified",
SUBMITTED_VERIFICATION_STATUS:"submitted",PENDING_VERIFICATION_STATUS:"pending",VERIFIED_VERIFICATION_STATUS:"verified",FAILED_VERIFICATION_STATUS:"failed",TO_BE_REVERIFIED_VERIFICATION_STATUS:"to_be_reverified",ERRORS:c,ONBOARDING_MESSAGES:k,SECRET_FIELD:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",secretField:function(c){return Array(Math.max((c||"").length,a.SECRET_FIELD.length)+1).join(a.SECRET_FIELD[0])},cardType:function(a){if(!a)return"";a=a.toString().trim();var c={};c["2"]=c["51"]=
c["52"]=c["53"]=c["54"]=c["55"]="mastercard";c["34"]=c["37"]="american express";c["4"]="visa";c["6"]="discover";c["35"]="jcb";c["30"]=c["36"]=c["38"]="diners club";var b=_.find(_.keys(c),function(b){return 0===a.indexOf(b)});return b?c[b]:"unknown"},cardTypeAbbreviation:function(a){return{visa:"visa",mastercard:"mc","american express":"amex",discover:"discover","diners club":"diners",jcb:"jcb",unknown:"unknown"}[a]||""},cardLast4:function(a){return a.substr(a.length-4)},accountCreationRequirements:function(c,
d,b,e){if(a.ACCOUNT_CREATION_REQUIREMENTS){var f=[c,b].join("."),f=_.get(a.ACCOUNT_CREATION_REQUIREMENTS,f);e&&(f=f.filter(function(a){return"legal_entity.business_name"!==a}));if(f)return f}console.error("processors: account creation requirements not identified for "+c+" "+d+" "+b)},requiredAccountCreationFields:function(c,d){try{if(!d)throw Error("missing account creation requirements");if(!a.ACCOUNT_CREATION_REQUIREMENT_TO_FORM_FIELD)throw Error("missing account creation requirements");var b=a.ACCOUNT_CREATION_REQUIREMENT_TO_FORM_FIELD[c];
if(!b)throw Error("missing account creation mapping for processor type");var e={};_.each(d,function(a){(a=b[a])&&(e[f.camelKey(a)]=!0)});if(_.isEmpty(e))throw Error("no required fields");return e}catch(h){console.warn("processors: account creation fields not identified for "+c+": "+h.message)}},bankAccountAdditionalRequiredFields:function(c,d){if(a.BANK_ACCOUNT_ADDITIONAL_REQUIRED_FORM_FIELDS){var b=[c,d].join(".");return _.get(a.BANK_ACCOUNT_ADDITIONAL_REQUIRED_FORM_FIELDS,b,{})}console.error("processors: bank account additional required form fields not identified for "+
c+" "+d)},supportedBankAccountCountries:function(c,d,b){if(a.SUPPORTED_BANK_ACCOUNT_COUNTRIES){var e=[c,d,b].join(".");if(e=_.get(a.SUPPORTED_BANK_ACCOUNT_COUNTRIES,e))return e}console.error("processors: supported bank account countries not identified for "+c+" "+d+" "+b)},verificationEnabledBankAccountCountries:function(c,d){if(a.BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES){var b=[c,d].join(".");if(b=_.get(a.BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES,b))return b}console.error("processors: unable to identify verification enabled bank account countries for "+
c+" "+d)},isVerificationEnabledForBankAccountCountry:function(c,d,b){var e=a.verificationEnabledBankAccountCountries(c,d);if(e)return _.contains(e,b);console.error("processors: unable to identify whether bank account verification is enabled for "+c+" "+d+" "+b)},isBankAccountVerificationEnabled:function(c,d,b){var e=a.verificationEnabledBankAccountCountries(c,d);if(e){if(!e.length)return!1;var f=a.supportedBankAccountCountries(c,d,b);if(f)return!!_.intersection(f,e).length}console.error("processors: unable to identify whether bank account verification is enabled for "+
c+" "+d+" "+b)},supportedCurrencies:function(c,d){var b;if(a.SUPPORTED_CURRENCIES)if(null!==c){var e=[c,d].join(".");if(b=_.get(a.SUPPORTED_CURRENCIES,e))return b}else return b={},_.forOwn(a.SUPPORTED_CURRENCIES,function(a){_.transform(a[d],function(a,b){a[b]=!0},b)}),_.keys(b);console.error("processors: unable to determine supported currencies for "+c+" "+d)},INFO:"info",ERROR:"error",log:function(c,d,b,e){d=d||{};b=b||{};e=e||a.INFO;e=_.get(console,e,console.info);_.isFunction(e)&&e("processors: "+
c,d,b)},get:function(a){return d.get(a||"stripe")},isProcessorEnabled:function(a,c){return _.contains(a.enabledProcessorTypes,c)},_isProcessor:function(a,c,b){a="is"+_.capitalize(b)+"Processor"+_.capitalize(a);return _.get(c,a)},isProcessorBankAccountConnected:function(c,d){return a._isProcessor("bankAccountConnected",c,d)},isProcessorConnected:function(c,d){return a._isProcessor("connected",c,d)},isProcessorTosAccepted:function(c,d){return a._isProcessor("tosAccepted",c,d)},processorVerificationStatus:function(a,
c){return _.get(a,c+"ProcessorVerificationStatus")},processorVerificationStatusDetails:function(a,c){return _.get(a,c+"ProcessorVerificationStatusDetails")},isProcessorVerificationFailed:function(c,d){return a.processorVerificationStatus(c,d)===a.FAILED_VERIFICATION_STATUS},isProcessorVerificationPending:function(c,d){return a.processorVerificationStatus(c,d)===a.PENDING_VERIFICATION_STATUS},isProcessorVerificationSubmitted:function(c,d){var b=a.processorVerificationStatus(c,d);return _.contains([a.SUBMITTED_VERIFICATION_STATUS,
a.PENDING_VERIFICATION_STATUS],b)},isProcessorVerified:function(c,d){var b=a.processorVerificationStatus(c,d);return a.VERIFIED_VERIFICATION_STATUS===b},isProcessorPaymentSetupComplete:function(c,d){return a._isProcessor("paymentSetupComplete",c,d)},processorIdentifier:function(a,c){return _.get(a,c+"ProcessorIdentifier")},isProcessorDefaultBankAccountReadyForUpload:function(c,d){return a._isProcessor("defaultBankAccountReadyForUpload",c,d)},isProcessorDefaultBankAccountReadyForPayout:function(c,
d){return a._isProcessor("defaultBankAccountReadyForPayout",c,d)},isProcessorDefaultBankAccountVerificationEnabled:function(c,d){return a._isProcessor("defaultBankAccountVerificationEnabled",c,d)},isProcessorAccountInformationSubmitted:function(c,d){return a._isProcessor("accountInformationSubmitted",c,d)},isPaymentSetupCompleteForAllEnabledProcessors:function(c){return _.all(c.enabledProcessorTypes,function(d){return a.isProcessorPaymentSetupComplete(c,d)})},applicableProcessorTypes:function(c,d,
b){var e=[];a.SUPPORTED_CURRENCIES&&_.forOwn(a.SUPPORTED_CURRENCIES,function(a,b){_.contains(a[c],d)&&e.push(b)});return _.union(e,b)},getProcessorChoices:function(c){return _.filter(a.PROCESSOR_CHOICES,function(a){return _.contains(c,a[0])})},getCountryChoices:function(c){return _.get(a.COUNTRY_CHOICES,c,[])},isCapabilityEnabledForAnyEnabledProcessor:function(c,d){return _.any(c.enabledProcessorTypes,function(b){var c=a.get(b),c=_.get(c,d,null);return null===c?(console.error("processors.isCapabilityEnabledForAnyEnabledProcessor: service is missing capability flag:",
b,d),!1):c})},processorTypesForCapability:function(c){return _.filter(a.PROCESSOR_TYPES,function(d){var b=a.get(d),b=_.get(b,c,null);return null===b?(console.error("processors.isCapabilityEnabledForAnyEnabledProcessor: service is missing capability flag:",d,c),!1):b})}};return a}]);m.factory("stripe",["$q","$rootScope","db","models","processors","Stripe",function(d,h,f,n,a,q){var g={invalid_number:a.ERRORS.INVALID_CARD_NUMBER,incorrect_number:a.ERRORS.BAD_CARD_NUMBER,invalid_expiry_month:a.ERRORS.INVALID_EXPIRATION,
invalid_expiry_year:a.ERRORS.INVALID_EXPIRATION,expired_card:a.ERRORS.BAD_EXPIRATION,invalid_cvc:a.ERRORS.INVALID_SECURITY_CODE,incorrect_cvc:a.ERRORS.BAD_SECURITY_CODE,incorrect_zip:a.ERRORS.BAD_POSTAL_CODE,card_declined:a.ERRORS.BAD_CARD,processing_error:a.ERRORS.TRY_AGAIN,rate_limit:a.ERRORS.WAIT},b=[{regex:/^Expired API Key provided/i,message:a.ERRORS.REFRESH}],e=f.slipstream("stripeLivePublishableKey"),m=f.slipstream("stripeTestPublishableKey"),v=function(b,c,f){var k=d.defer();q.setPublishableKey(e);
b={currency:b.processorCurrency,country:c.processorCountry,account_number:c.accountNumber,account_holder_name:c.accountHolderName,account_holder_type:c.accountHolderType};c.routingNumber&&(b.routing_number=c.routingNumber);q.bankAccount.createToken(b,function(b,c){h.$safeApply(function(){if(c.error){a.log("Stripe client-side error ("+(c.status||"unknown error")+")",_.extend({stripeResponse:c},f));var b=c.error.message+".";c.error.code&&(b=g[c.error.code]||b);return k.reject([b])}return k.resolve({processorType:"stripe",
stripeBankAccountToken:c.id})})});return k.promise},r=function(c,f,k,n){var r=d.defer();if(!q)return a.log("Stripe: unable to load stripe.js"),r.reject([a.ERRORS.SCRIPT]),r.promise;q.setPublishableKey(k?m:e);c={number:f.number,exp_month:f.expirationMonth,exp_year:f.expirationYear};f.cvc&&(c.cvc=f.cvc);c.name=f.name||"";c.address_zip=f.postalCode||"";c.address_country=f.countryCode||"";q.card.createToken(c,function(c,d){h.$safeApply(function(){if(!d)return r.reject([a.ERRORS.TIMEOUT]);if(d.error){var c;
d.error.code?c=g[d.error.code]:d.error.message&&_.forEach(b,function(a){if(d.error.message.match(a.regex))return c=a.message,!1});c||(c=a.ERRORS.GENERIC_CARD);var e="card_error"===d.error.type?a.INFO:a.ERROR,f="Stripe client-side "+(d.status||"")+" error",f=f+(" ("+(d.error.type||"unknown error")+")");d.error.message&&(f+=" - "+d.error.message);a.log(f,_.extend({stripeResponse:d,error:c},n),{type:d.error.type},e);return r.reject([c])}return r.resolve({processorType:"stripe",stripeToken:d.id})})});
return r.promise},C=function(a,b,c){b=q(b?m:e);return(c?b.handleCardSetup:b.handleCardAction)(a)};return{ERRORS:c,ONBOARDING_MESSAGES:k,HELP_DOC_URL:"https://fareharbor.com/help/getting-started/setup/payment-setup-checklist/",DISPUTE_LEARN_MORE_URL:"https://fareharbor.com/help/payments/disputes/refunding-a-disputed-charge/",NAME:"Stripe",PROCESSOR_TYPE:"stripe",PENDING_STATEMENT_TEXT:"STRIPE",STATEMENT_TEXT_PREFIX:"FH* ",STATEMENT_TEXT_REGEX:"/^[a-zA-Z0-9\\.\\(\\)\\{\\}\\[\\]&!\\$;\\-%_\\?:\\#@\\~=\\^\\+| ]+$/",
tokenizeBankAccount:function(b,c,e){if(!q){var f=d.defer();a.log("Stripe: unable to load stripe.js");f.reject([a.ERRORS.SCRIPT]);return f.promise}f=v(b,c,e);b=v(b,c,e);return d.all([f,b]).then(function(a){return{processorType:"stripe",stripeAccountBankAccountToken:a[0].stripeBankAccountToken,stripeCustomerBankAccountToken:a[1].stripeBankAccountToken}},function(a){return d.reject(_.unique(_.append(a)))})},tokenizeCard:r,tokenizedCard:function(a){return{processorType:"stripe",stripeToken:a}},testToken:function(a,
b){var c={number:"4242424242424242",expirationMonth:1,expirationYear:moment().year()+1,cvc:"123"};b=_.extend(b,{testing:!0});return r(a,c,a.isDemoModeEnabled,b).then(function(a){a=a.stripeToken;console.info("stripe: test token",a);return a})},chargedCard:function(a){var b={processorType:"stripe",stripePaymentIntentId:a.processorId};_.extend(b,a);return b},completeClientAction:function(a,b,c,e,f){var g=d.defer();C(b,e,c).then(function(a){if(a.error)g.reject(T("Authorization failed"));else{var b={processorType:"stripe",
stripeToken:null};c?b.stripeSetupIntentId=a.setupIntent.id:b.stripePaymentIntentId=a.paymentIntent.id;g.resolve(b)}},function(){g.reject(T("Authorization failed"))});return g.promise},isAdjustmentValid:function(a,b){return a.isProcessable&&"from-company"===a.direction?!b.isAdmin:!0},minimumChargeAmount:function(a){return n.Payment.minimumChargeAmounts(a,"stripe")},isAutomaticCreationOfAccountsEnabled:!0,isBankAccountsEnabled:!0,isRefundReserveEnabled:!0,isBankAccountCreationEnabled:_.constant(!0),
isBankAccountTokenizationNeeded:!0,isBankAccountVerificationDoneViaDeposits:!0,isBookingFeeProratedForRefunds:!1,isCardsEnabled:!0,isCardOnFileEnabled:!0,isConnectedAfterOnboarding:!1,isCreditCardsEnabled:!0,isDeferredChargesEnabled:!0,isDemoCardNumberCheckSupported:!0,isDisputesEnabled:!0,isEmvEnabled:!0,isFileChargesEnabled:!0,isHoldsEnabled:!0,isSofortEnabled:!0,isIdealEnabled:!0,isPaypalEnabled:!1,isPayoutsEnabled:!0,isTosEnabled:!0,isTransactionsEnabled:!0,isAccountIdentifierVisibleToCompanyUsersWithPermission:!1,
statementText:function(a){return a.features.stripeStatementText||a.statementText}}}]);m.factory("balanced",["$rootScope","$timeout","$q","processors",function(d,h,f,n){d=function(){var a=f.defer();a.reject([n.ERRORS.UNSUPPORTED]);return a.promise};return{ERRORS:c,ONBOARDING_MESSAGES:k,HELP_DOC_URL:"https://fareharbor.com/help/getting-started/setup/payment-setup-checklist/",DISPUTE_LEARN_MORE_URL:"https://fareharbor.com/help/payments/disputes/refunding-a-disputed-charge/",NAME:"Balanced",PROCESSOR_TYPE:"balanced",
PENDING_STATEMENT_TEXT:"BALANCED",STATEMENT_TEXT_PREFIX:"BAL*",STATEMENT_TEXT_REGEX:"/^.*$/",tokenizeBankAccount:d,tokenizeCard:d,isAutomaticCreationOfAccountsEnabled:!1,isBankAccountsEnabled:!1,isRefundReserveEnabled:!1,isBankAccountCreationEnabled:_.constant(!0),isBankAccountTokenizationNeeded:!1,isBankAccountVerificationDoneViaDeposits:!1,isCardsEnabled:!1,isCardOnFileEnabled:!1,isConnectedAfterOnboarding:!1,isCreditCardsEnabled:!1,isDemoCardNumberCheckSupported:!0,isDisputesEnabled:!1,isSofortEnabled:!1,
isIdealEnabled:!1,isPaypalEnabled:!1,isPayoutsEnabled:!0,isTosEnabled:!1,isTransactionsEnabled:!0,isAccountIdentifierVisibleToCompanyUsersWithPermission:!1,statementText:function(a){return a.statementText}}}]);m.factory("cardflight",function(){return{isTestToken:function(c){return/^test_/.test(c)}}});m.factory("Stripe",function(){return window.Stripe||null});m.factory("stripeEmv",_.optional(["$q","$filter","$rootScope","$window","auth","db","events","flash","models","?native",function(c,h,f,k,a,q,
g,b,e,m){if(!k.StripeTerminal||!k.StripeTerminal.PaymentStatus)return null;var v=h("amount"),r={};r[k.StripeTerminal.PaymentStatus.READY]=T("Waiting...");r[k.StripeTerminal.PaymentStatus.COLLECTING_PAYMENT_METHOD]=T("Waiting for card...");r[k.StripeTerminal.PaymentStatus.CONFIRMING_PAYMENT_INTENT]=T("Charging card...");r.DISCONNECTED=T("Not connected.");r.UNKNOWN=T("Not connected.");r.NATIVE=T("Waiting for card reader...");var C=function(a){return function(){return new k.Promise(function(b,c){q.emvDevice.authenticate({shortname:a.shortname},
null,null,{}).$promise.then(function(a){b(a.data.connectionToken)},function(a){console.error("stripeEmv: failed to retrieve connection token",a);c(Error("failed to retrieve activation token from Stripe."))})})}},s=function(){f.$safeApply()},D=function(){f.$safeApply(function(){b.error(T("Reader has been disconnected unexpectedly."))})},l=function(){f.$safeApply()},p,N=m&&m.isNative,w=!1,u,J;N&&(g.on(f,"fareharbor.native.emv.createConnection",function(){J?(console.info("stripeEmv: native: requesting connection token",
J.shortname),q.emvDevice.authenticate({shortname:J.shortname},null,null,{}).$promise.then(function(a){console.info("stripeEmv: native: created connection token");m.broadcast("fareharbor.native.emv.connectionCreated",{token:a.data.connectionToken,location:J.stripeEmvLocationId})},function(a){console.error("stripeEmv: native: failed to connect",a.data);m.broadcast("fareharbor.native.emv.connectionCreated",{token:"",location:""})})):(console.error("stripeEmv: native: no current company"),m.broadcast("fareharbor.native.emv.connectionCreated",
{token:"",location:""}))}),g.on(f,"fareharbor.native.emv.connected",function(){console.info("stripeEmv: native: connected");w=!0;u=null}),g.on(f,"fareharbor.native.emv.disconnected",function(){console.info("stripeEmv: native: disconnected");w=!1}),g.on(f,"fareharbor.native.emv.completed",function(a,b){console.info("stripeEmv: native: completed",b);u?(b.stripePaymentIntentId?u.resolve({processorId:b.stripePaymentIntentId}):u.reject(e.EmvDevice.STRIPE_ERRORS[b.code||e.EmvDevice.UNKNOWN_ERROR]||e.EmvDevice.STRIPE_ERRORS[e.EmvDevice.UNKNOWN_ERROR]),
u=null):console.error("stripeEmv: attempting to complete EMV without a current deferred",b)}));var x={STORAGE_KEY:"stripeEmvDevicePk",providerType:"stripe",selectDevice:function(a){if(w||!a||!a.reader)return c.reject();p||x.connect(a.emvDevice.company);return p.connectReader(a.reader,{fail_if_in_use:!0}).then(function(b){if(b.error)return b.error.code!==e.EmvDevice.CONNECT_READER_ERROR_CODE&&console.error("stripeEmv: failed to connect",b),c.reject(b.error);a.status=e.EmvDevice.ONLINE_STATUS;return c.when(a)})},
discoverEmvDevices:function(a,b){if(w)return c.when([]);p||x.connect(a);return p.discoverReaders().then(function(a){if(a.error)return console.warn("stripeEmv: failed to discover",a.error),c.reject(a.error);console.log("stripeEmv: successfully discovered readers",a.discoveredReaders);var f=_.map(b,function(b){var c=_.find(a.discoveredReaders,{id:b.identifier});return{emvDevice:b,status:c&&c.status===e.EmvDevice.ONLINE_STATUS?e.EmvDevice.ONLINE_STATUS:e.EmvDevice.OFFLINE_STATUS,reader:c}});return c.when(f)},
function(a){console.warn("stripeEmv: failed reader discovery",a);return c.reject()})},connect:function(b){a.permissions.canList(e.EmvDevice,b)&&(N&&(J=b,console.info("stripeEmv: native: requesting the native application connect"),m.broadcast("fareharbor.native.emv.connect")),p=k.StripeTerminal.create({onFetchConnectionToken:C(b),onCheckoutStatusChanged:s,onUnexpectedReaderDisconnect:D,onConnectionStatusChange:l}))},disconnect:function(){N&&(console.info("stripeEmv: native: requesting the native application disconnect"),
m.broadcast("fareharbor.native.emv.disconnect"),J=null,w=!1);p&&(p.disconnectReader(),p=null)},isConnected:function(){return w?!0:p&&"connected"===p.getConnectionStatus()},charge:function(a,b,g,h,k){if(w){var l=c.defer();if(u)return console.warn("stripeEmv: native: already charging natively"),l.reject(e.EmvDevice.STRIPE_ERRORS[e.EmvDevice.UNKNOWN_ERROR]),l.promise;console.info("stripeEmv: native: creating interaction token");q.emvDevice.createInteractionToken({shortname:a.shortname},{description:b.unicode,
bookingGrosses:h}).$promise.then(function(a){console.info("stripeEmv: native: created interaction token");m.broadcast("fareharbor.native.emv.begin",{clientSecret:a.primaryData,amount:g,formattedAmount:v(g,J.processorCurrency)})},function(a){console.error("stripeEmv: native: failed to create interaction token",a.primaryData);l.reject(e.EmvDevice.STRIPE_ERRORS[e.EmvDevice.UNKNOWN_ERROR])});u=l;return l.promise}return!p?c.reject(e.EmvDevice.STRIPE_ERRORS[e.EmvDevice.UNKNOWN_ERROR]):p.setReaderDisplay({type:"cart",
cart:{line_items:[{description:b.unicode,amount:g,quantity:1}],tax:0,total:g,currency:a.processorCurrency}}).then(function(){f.$apply();return q.emvDevice.createInteractionToken({shortname:a.shortname},{description:b.unicode,bookingGrosses:h}).$promise}).then(function(a){f.$apply();return p.collectPaymentMethod(a.primaryData)}).then(function(a){f.$apply();return a.error?c.reject(a.error):null===a.paymentIntent?c.reject({code:"payment_intent_is_null"}):p.processPayment(a.paymentIntent).then(function(a){f.$apply();
return a.error?c.reject(a.error):c.when({processorId:a.paymentIntent.id})})}).catch(function(a){f.$apply();var b=e.EmvDevice.UNKNOWN_ERROR;a.code&&(b=e.EmvDevice.STRIPE_ERRORS[a.code]||b);a.data&&a.data.createEmvInteractionTokenForm&&(b=a.data.createEmvInteractionTokenForm.all[0]);console.error("stripeEmv: unhandled error",a,b);return c.reject(b)})},cancel:function(){w?m.broadcast("fareharbor.native.emv.cancel"):p&&p.cancelCollectPaymentMethod()},information:function(){return w?r[u?"NATIVE":k.StripeTerminal.PaymentStatus.READY]:
p?r[p.getPaymentStatus()]||r.UNKNOWN:r.DISCONNECTED},lastDecline:function(){return null}};return x}]));m.factory("adyenEmv",["$q","db","models","poller",function(c,h,f,k){var a={providerType:"adyen",STORAGE_KEY:"adyenEmvDevicePk",currentDevice:null,currentTransactionId:null,connect:_.noop,disconnect:function(){a.currentDevice=null},isConnected:function(){return!_.isNull(a.currentDevice)},charge:function(q,g,b,e,m){var v=a.currentDevice.identifier,r;console.info("adyenEmv: creating interaction token");
return h.emvDevice.createInteractionToken({shortname:q.shortname},{description:g.unicode,bookingGrosses:e,emvDeviceId:v}).$promise.then(function(b){console.info("adyenEmv: created interaction token: ",b.primaryData);a.currentTransactionId=r=b.primaryData;return k({endpoint:h.emvDevice.checkChargeStatus,params:{shortname:q.shortname},payload:{emvDeviceId:v,tokenId:r},pollIntervals:[15,15,10,10,10,10,10,10,10,10,10,10,5],errorMessage:f.EmvDevice.UNKNOWN_ERROR}).poll().$promise.then(function(b){console.log("adyenEmv: processed result of long polling: ",
b);if(b.errorCode)return c.reject(f.EmvDevice.ADYEN_ERRORS[b.errorCode]||f.EmvDevice.UNKNOWN_ERROR);a.currentTransactionId=null;return c.when({emvDeviceId:v,processorId:r})},function(b){console.error("adyenEmv: failed to retrieve charge status",b.data);a.cancel();return c.reject(f.EmvDevice.UNKNOWN_ERROR)})},function(a){console.error("adyenEmv: failed to create interaction token",a.primaryData);return c.reject(f.EmvDevice.UNKNOWN_ERROR)})},information:_.noop,cancel:function(){var c=a.currentDevice,
d=c.identifier,b=a.currentTransactionId;_.isNull(b)?console.warn("adyenEmv: no EMV transaction is in progress"):(console.log("adyenEmv: attempting to cancel EMV transaction for device",d," transactionId",b),h.emvDevice.cancelCharge({shortname:c.company.shortname},{emvDeviceId:d,tokenId:b}).$promise.then(function(){a.currentTransactionId=null}))},lastDecline:_.noop,discoverEmvDevices:function(a,g){return h.emvDevice.checkConnections({shortname:a.shortname},null,null,null).$promise.then(function(a){var e=
_.map(g,function(c){return{emvDevice:c,status:a.primaryData[c.identifier]?f.EmvDevice.ONLINE_STATUS:f.EmvDevice.OFFLINE_STATUS}});return c.when(e)})},selectDevice:function(k){if(!k)return c.reject("no discovered emv device");var g=k.emvDevice;return h.emvDevice.checkConnection({shortname:g.company.shortname,emvDevicePk:g.pk},null,null,null).$promise.then(function(b){b=b.primaryData[g.identifier]?f.EmvDevice.ONLINE_STATUS:f.EmvDevice.OFFLINE_STATUS;k.status=b;return b===f.EmvDevice.ONLINE_STATUS?(a.currentDevice=
g,c.when(k)):c.reject("emv device is offline")})}};return a}]);m.factory("loginProviders",[function(){return{NAMES_BY_TYPE:{google:"Google",marriott:"Marriott",auth0:"Auth0"}}}]);m.factory("emv",["$q","$rootScope","auth","db","events","models","stripeEmv","adyenEmv","storage",function(c,h,f,k,a,q,g,b,e){var m=null,v=null,r=_.map(k.slipstream("emvProviderChoices"),"0"),C={};C.adyen=b;C.stripe=g;var s=_.filter([g,b]),D=_.filter(s,function(a){return _.find(r,function(b){return a&&a.providerType===b})}),
l=function(a){return _.find(D,function(b){if(b.providerType===a)return b})},p={ADYEN_PROVIDER:b,STRIPE_PROVIDER:g,SUPPORTED_PROVIDERS:D,currentDevice:null,setProvider:function(a){v=l(a.features.emvProvider)},getDefaultProviderForProcessorType:function(a){return C[a]},disconnect:function(){if(v)return v.disconnect()},isConnectedToDevice:function(a){return p.isConnected()&&a===p.currentDevice},isConnected:function(){if(v)return v.isConnected()},storeDeviceSelection:function(a){v&&m&&e.set(!v||!m?"":
v.STORAGE_KEY+":"+m.shortname,a.pk)},selectDevice:function(a){if(!v||!a)return c.reject();p.currentDevice!==a.emvDevice&&p.disconnect();return v.selectDevice(a).then(function(a){p.currentDevice=a.emvDevice;p.storeDeviceSelection(p.currentDevice)})},previouslySelectedDevicePk:function(){if(v&&m)return e.get(!v||!m?"":v.STORAGE_KEY+":"+m.shortname)},connect:function(a){a&&a.features.isEmvEnabled&&(v=l(a.features.emvProvider))&&v.connect(a)},charge:function(a,b,e,f,g){return!v?c.reject():v.charge(a,
b,e,f,g)},discoverEmvDevices:function(a){if(!f.permissions.canList(q.EmvDevice,a)||!a||!a.features.isEmvEnabled)return c.when([]);var b=k.emvDevices({shortname:a.shortname},null,null,null,{flashError:!1}),e=function(a){return _.map(a,function(a){return{emvDevice:a,status:q.EmvDevice.OFFLINE_STATUS}})};p.isConnected()||(p.disconnect(),p.connect(a));return b.$promise.then(function(){return!v?c.when(e(b)):!b.length?(console.log("emv: no emv devices registered yet"),c.when([])):v.discoverEmvDevices(a,
b).then(function(a){return c.when(a)}).catch(function(a){console.warn("emv: failed to discover emv devices",a);return c.when(e(b))})})},information:function(){return!v?"":v.information()},lastDecline:function(){return!v?null:p.isDebugging?p.debugDecline:v.isConnected()?v.lastDecline():null},cancel:function(){if(v)return v.cancel()}};a.on(h,"auth.logout",function(){v&&v.disconnect()});a.on(h,"navigation.company.updated",function(a,b){var c=b.company;if(!m||c)if(!c||!(m===c&&v&&v.isConnected()))m=c,
v&&v.disconnect(),c.features.isEmvEnabled&&(v=l(c.features.emvProvider))&&f.currentUser.isAuthenticated&&p.discoverEmvDevices(c).then(function(a){a=_.filter(a,function(a){return"online"===a.status});var b,c=p.previouslySelectedDevicePk();c&&(b=_.find(a,function(a){return a.emvDevice.pk===c})||_.first(a));p.selectDevice(b).catch(function(){console.warn("Unable to connect to device.")})}).catch(function(){console.warn("Unable to connect to device: EMV provider not loaded.")})});p.isDebugging=!1;p.debugDecline=
{customerReceipt:[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"}],merchantReceipt:[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"}]};p.debugDetails=[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},
{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"},{key:"Name",value:"Adeventure Extremer"},{key:"Address",value:"12:32pm"},{key:"Zip",value:"12321"},{key:"City",value:"Aina Haina"},{key:"Country",value:"USA"},{key:"Contact",value:"4155551212"},{key:"Transaction",value:"ch_1BLzcrL4FOCDmmKvrGbjEG2t"},{key:"Authorization",value:"123212321"},{key:"Scheme",value:"super sweet VISA"},{key:"Account",value:"**** **** **** 4242"},{key:"AID",value:"A0000000031010"},
{key:"Entry Mode",value:"Chip"},{key:"Verification",value:"Signature"}];return p}]);m.factory("paypal",["db","models",function(d,h){var f=d.slipstream("paypalLiveClientId"),n=d.slipstream("paypalLivePlatformFeesPayeeMerchantId");return{ERRORS:_.extend({},c,{"country-mismatch":T("PayPal account country invalid."),"onboard-incomplete":T("PayPal onboard not completed."),"permissions-mismatch":T("PayPal permissions not granted."),"email-unconfirmed":T("Please confirm your email address in order to receive payments."),
"payments-unreceivable":T("You currently cannot receive payments due to a restriction on your PayPal account.")}),ONBOARDING_MESSAGES:k,HELP_DOC_URL:"https://fareharbor.com/help/getting-started/setup/payment-setup-checklist/paypal/",DISPUTE_LEARN_MORE_URL:"https://fareharbor.com/help/payments/disputes/paypal",NAME:"PayPal",PROCESSOR_TYPE:"paypal",PENDING_STATEMENT_TEXT:"PAYPAL * ",STATEMENT_TEXT_PREFIX:"PAYPAL * ",STATEMENT_TEXT_REGEX:"/^[a-zA-Z0-9\\.\\-\\* ]+$/",LIVE_CLIENT_ID:f,LIVE_PLATFORM_FEES_PAYEE_MERCHANT_ID:n,
isAutomaticCreationOfAccountsEnabled:!1,isBankAccountsEnabled:!1,isRefundReserveEnabled:!1,isBankAccountCreationEnabled:_.constant(!0),isBankAccountTokenizationNeeded:!1,isBankAccountVerificationDoneViaDeposits:!1,isBookingFeeProratedForRefunds:!0,isCardsEnabled:!1,isCardOnFileEnabled:!1,isConnectedAfterOnboarding:!0,isCreditCardsEnabled:!1,isDeferredChargesEnabled:!1,isDemoCardNumberCheckSupported:!1,isDisputesEnabled:!0,isEmvEnabled:!1,isFileChargesEnabled:!1,isHoldsEnabled:!1,isSofortEnabled:!1,
isIdealEnabled:!1,isPaypalEnabled:!0,isPayoutsEnabled:!1,isTosEnabled:!1,isTransactionsEnabled:!1,minimumChargeAmount:function(a){return h.Payment.minimumChargeAmounts(a,"paypal")},isAccountIdentifierVisibleToCompanyUsersWithPermission:!0,statementText:function(a){return a.features.paypalStatementText||a.statementText.slice(0,14)}}}]);m.directive("ngPaypalCheckout",["$document","$filter","$window","db","navigation","paypal","processors",function(c,h,f,k,a,m,g){var b={},e=function(a){return(a/100).toFixed(2)},
z=function(a){if(a.defaultProcessorType===m.PROCESSOR_TYPE)return"credit";var b=g.get(a.defaultProcessorType),c={isCreditCardsEnabled:null,isIdealEnabled:"isIdealPaymentsEnabled",isSofortEnabled:"isSofortPaymentsEnabled"},d=["credit"];_.forEach({isCreditCardsEnabled:"card",isIdealEnabled:"ideal",isSofortEnabled:"sofort"},function(e,f){var g=_.get(b,f,null);null===g&&console.error("ngPaypalCheckout.fundingSourcesToDisable: service is missing capability flag:",b.PROCESSOR_TYPE,f);var h,k=c[f];h=k?_.get(a.features,
k,null):!0;null===h&&console.error("ngPaypalCheckout.fundingSourcesToDisable: feature is missing for commpany:",a,k);g&&h&&d.push(e)});return!d.length?null:d.join()};return{restrict:"A",templateUrl:"ng-paypal-checkout",controllerAs:"paypalCtrl",controller:["$scope",function(f){var h=this;h.status="loading";var C=f.paymentCtrl.company;if(C.paypalMerchantId){var s=null;f.bookForm?(s=f.bookForm,f.submit=f.bookCtrl.submit):f.orderForm&&(s=f.orderForm,f.submit=f.cartCtrl.submit);var D=g.get("paypal").statementText(C),
l=function(){w.Buttons({createOrder:function(a,b){return b.order.create({intent:"CAPTURE",purchase_units:[{amount:{currency_code:C.processorCurrency.toUpperCase(),value:e(f.paymentCtrl.amount()),breakdown:{item_total:{currency_code:C.processorCurrency.toUpperCase(),value:e(f.paymentCtrl.amount())}}},payee:{merchant_id:C.paypalMerchantId},payment_instruction:{disbursement_mode:"INSTANT",platform_fees:[{amount:{currency_code:C.processorCurrency.toUpperCase(),value:e(f.paymentCtrl.bookingFee())},payee:{merchant_id:m.LIVE_PLATFORM_FEES_PAYEE_MERCHANT_ID}}]},
soft_descriptor:D}],application_context:{brand_name:C.name,shipping_preference:"NO_SHIPPING"}})},onApprove:function(a){f.$apply(function(){f.paymentCtrl.processorType(m.PROCESSOR_TYPE);f.paymentCtrl.paypalOrderId(a.orderID);f.submit(s)})},onCancel:function(){f.$apply(function(){console.info("PayPal checkout cancelled")})},onError:function(a){f.$apply(function(){console.error("PayPal checkout error",a);f.paymentCtrl.addErrorMessage(s,g.ERRORS.UNKNOWN)})}}).render("#ng-paypal-checkout-button");h.status=
"success"},p=function(){h.status="error"},N="PayPal-"+C.shortname,w=b[N];if(w)l();else{var u={"client-id":m.LIVE_CLIENT_ID,"merchant-id":C.paypalMerchantId,currency:C.processorCurrency.toUpperCase(),"integration-date":"2020-03-10",debug:k.slipstream("isDebug")?"true":"false"},J=z(C);J&&(u["disable-funding"]=J);u=a.compose("https://www.paypal.com/sdk/js",u);J=document.createElement("script");J.setAttribute("data-namespace",N);J.src=u;J.onload=function(){f.$apply(function(){w=b[N]=window[N];l()})};
J.onerror=p;c[0].body.appendChild(J)}}else h.status="error"}]}}]);m.factory("adyen",["$q","models","processors",function(d,h,f){var n=_.extend({},k,{failed:T("More information required")});return{ERRORS:c,ONBOARDING_MESSAGES:n,HELP_DOC_URL:"https://fareharbor.com/help/getting-started/setup/payment-setup-checklist/",DISPUTE_LEARN_MORE_URL:"https://fareharbor.com/help/payments/disputes/refunding-a-disputed-charge/",NAME:"Adyen",PROCESSOR_TYPE:"adyen",PENDING_STATEMENT_TEXT:"ADYEN",STATEMENT_TEXT_PREFIX:"FAREHARBOR B.V.*",
isAdjustmentValid:function(a,c){return a.isProcessable&&"from-company"===a.direction?!c.isAdmin:!0},STATEMENT_TEXT_REGEX:"/^.*$/",isAutomaticCreationOfAccountsEnabled:!1,isBankAccountsEnabled:!0,isRefundReserveEnabled:!0,isBankAccountCreationEnabled:function(a){return f.isProcessorVerified(a,"adyen")},isBankAccountTokenizationNeeded:!1,isBankAccountVerificationDoneViaDeposits:!1,isBookingFeeProratedForRefunds:!1,isCardsEnabled:!1,isCardOnFileEnabled:!1,isCreditCardsEnabled:!0,isConnectedAfterOnboarding:!1,
isDeferredChargesEnabled:!0,isDemoCardNumberCheckSupported:!1,isDisputesEnabled:!1,isEmvEnabled:!0,isFileChargesEnabled:!0,isHoldsEnabled:!1,isSofortEnabled:!1,isIdealEnabled:!1,isPaypalEnabled:!1,isPayoutsEnabled:!0,isTosEnabled:!0,isTransactionsEnabled:!0,isAccountIdentifierVisibleToCompanyUsersWithPermission:!1,minimumChargeAmount:function(a){return h.Payment.minimumChargeAmounts(a,"adyen")},tokenizeCard:function(){var a=d.defer();a.resolve({processorType:"adyen"});return a.promise},chargedCard:function(a){var c=
{processorType:"adyen",adyenEmvDeviceId:a.emvDeviceId,adyenTransactionId:a.processorId};_.extend(c,a);return c},statementText:function(a){return(a.statementText||"").slice(0,7)+" AMSTERDAM"},handleRedirect:function(a){(new AdyenCheckout).createFromAction(a).mount("#adyen-redirect-component-container")},updateCompanyFieldForBankAccountVerification:function(a,c){a.isAdyenProcessorDefaultBankAccountReadyForPayout=c.isVerified}}}]);m.directive("ngAdyenCheckout",["db",function(c){var h=c.slipstream("adyenCheckoutLiveOriginKey"),
f=c.slipstream("adyenCheckoutTestOriginKey"),k=c.slipstream("targetLanguage"),a=c.slipstream("configuration");c={"en-us":"en-US","en-au":"en-US","en-ca":"en-US","en-gb":"en-US","zh-cn":"zh-CN",da:"da-DK",nl:"nl-NL",fi:"fi-FI",fr:"fr-FR","fr-ca":"fr-FR",de:"de-DE",it:"it-IT",ja:"ja-JP",ko:"ko-KR",no:"no-NO",pl:"pl-PL",pt:"pt-BR",ru:"ru-RU",es:"es-ES",sv:"sv-SE"};var m={"creditCard.numberField.placeholder":"","creditCard.cvcField.placeholder":"","creditCard.expiryDateField.placeholder":""},g={};_.forEach("en-US zh-CN da-DK nl-NL fi-FI fr-FR de-DE it-IT ja-JP ko-KR no-NO pl-PL pt-BR ru-RU es-ES sv-SE".split(" "),
function(a){g[a]=m});var b=c[k]?c[k]:"en-US";return{restrict:"A",controller:["$scope",function(c){c.adyenCheckoutClasses={encryptedCardNumber:{focus:!1,valid:!1,touched:!1,brand:"card"},encryptedExpiryDate:{focus:!1,valid:!1,touched:!1},encryptedSecurityCode:{focus:!1,valid:!1,touched:!1}};var d={brands:"mc visa discover amex jcb diners cup".split(" "),locale:b,translations:g,environment:"production"===a&&!c.paymentCtrl.company.isDemoModeEnabled?"live":"test",originKey:!c.paymentCtrl.company.isDemoModeEnabled?
h:f,onChange:function(a){var b="",d="";if(c.paymentCtrl.isAdyenCheckoutDataValid=a.isValid)b=_.stringifyJSON(a.data.paymentMethod),d=_.stringifyJSON(a.data.browserInfo),c.paymentCtrl.cardCvc(a.data.paymentMethod.encryptedSecurityCode),c.paymentCtrl.cardNumber(a.data.paymentMethod.encryptedCardNumber);c.paymentCtrl.adyenPaymentMethod(b);c.paymentCtrl.adyenBrowserInfo(d);c.$apply()},onFocus:function(a){c.adyenCheckoutClasses[a.fieldType].focus=a.focus;c.$apply()},onBrand:function(a){c.adyenCheckoutClasses.encryptedCardNumber.brand=
a.brand;c.adyenCheckoutClasses.encryptedCardNumber.touched=!0;c.$apply()},onFieldValid:function(a){c.adyenCheckoutClasses[a.fieldType].valid=a.valid;c.adyenCheckoutClasses[a.fieldType].touched=!0;c.$apply()}},k={fontWeight:"normal",padding:"0 12px"};window.matchMedia("(min-width: 680px)").matches&&(k={fontSize:"13px",fontWeight:"normal",padding:"0 12px"});(new AdyenCheckout(d)).create("securedfields",{hasHolderName:!0,holderNameRequired:!0,autoFocus:!1,styles:{base:k,placeholder:{fontWeight:"normal",
color:"#768593"}}}).mount("#adyen-checkout-component-container")}]}}]);m.run(["$rootScope","emv","loginProviders","processors",function(c,h,f,k){c.emv=h;c.loginProviders=f;c.processors=k}])})();angular.module("auth",["auth.controllers","auth.directives","auth.services"]);
(function(){var m=angular.module("auth.controllers",["lib","navigation"]);m.controller("auth.LoginProviderErrorCtrl",["$scope","navigation",function(c,k){var d=k.get("status")||"",h=k.get("message")||T("Unable to log in via single sign-on.");k.clear("status",!0);k.clear("message",!0);c.errorMessage="";"error"===d&&(c.errorMessage=h)}]);m.controller("auth.LoginCtrl",["$scope","navigation","urls",function(c,k,d){var h=k.get("shortname")||"";c.credentials={shortname:h};var f=k.get("next");c.submit=function(h){c.credentials.shortname&&
(h=d.populate(d.company.login,{shortname:c.credentials.shortname.replace(/\s+/g,"").toLowerCase()}),f&&(h=k.compose(h,{next:f})),k.navigate(h))}}]);m.controller("auth.CompanyLoginCtrl",["$scope","auth","db","navigation","urls",function(c,k,d,h,f){var n=h.currentCompany?h.currentCompany.shortname:"",a=h.get("username")||"";h.clear("username",!0);c.credentials={shortname:n,username:a,password:""};c.isForceReloadingAfterSuccess=!1;var m=h.get("next"),a="yes"===h.get("require");!a&&k.currentUser.isAuthenticated&&
n===k.currentUser.company.shortname?(h.redirect(m||k.currentUser.company.$url(f.dashboard.index),"replace"),c.isForceReloadingAfterSuccess=!0):(c.differentCompanyLoginUrl=f.root.login,m&&(n={next:m},a&&(n.require="yes"),c.differentCompanyLoginUrl=h.compose(c.differentCompanyLoginUrl,n)),c.submit=function(a){k.login(c.credentials,a).then(function(){var a=m||k.currentUser.company.$url(f.dashboard.index);c.isForceReloadingAfterSuccess=(d.slipstream("targetLanguage")||"")!==c.company.language;h.navigate(a,
null,c.isForceReloadingAfterSuccess)},function(){c.credentials.password=""})},c.providerLogin=function(){c.isForceReloadingAfterSuccess=!0;var a=h.currentCompany.$url(f.api.providerLogin);m&&(a=h.compose(a,{next:m}));h.navigate(a,"extend",!0)},c.LOGIN_PROVIDER_OPTION="login-provider",c.FAREHARBOR_OPTION="fareharbor",c.isShowingLoginOptions=h.currentCompany.features.isLoginProviderEnabled&&!h.currentCompany.features.isLoginProviderRequired,c.currentLoginOption=c.isShowingLoginOptions?"":!h.currentCompany.features.isLoginProviderEnabled?
c.FAREHARBOR_OPTION:c.LOGIN_PROVIDER_OPTION,c.selectLoginOption=function(a){c.currentLoginOption=a||""})}]);m.controller("auth.ForgotPasswordCtrl",["$scope","db","flash","navigation","urls",function(c,k,d,h,f){var n=h.get("shortname")||"";h.clear("shortname",!0);var a=h.get("username")||"";h.clear("username",!0);c.alreadyHasCompany=!!n;c.credentials={shortname:n,username:a};c.submit=function(a){k.forgot.password({},c.credentials,a).$promise.then(function(){d.success(T("An email has been sent to the address associated with this account."));
h.navigate(f.root.login)})}}]);m.controller("auth.ResetPasswordCtrl",["$scope","db","flash","navigation","urls",function(c,k,d,h,f){var n=h.get("shortname")||"";h.clear("shortname",!0);var a=h.get("username")||"";h.clear("username",!0);var m=h.get("token")||"";h.clear("token",!0);!n||!a||!m?(d.error(T("Bad password reset link")),h.navigate(f.root.login)):(c.credentials={token:m,username:a,shortname:n,password:""},c.submit=function(a){k.forgot.password.reset({},c.credentials,a).$promise.then(function(){d.success(T("Your password has been changed. Please log in."));
var a=f.populate(f.company.login,{shortname:n}),a=a+("?username="+c.credentials.username);h.navigate(a)})})}]);m.controller("auth.ForgotCredentialsCtrl",["$scope","db","flash","navigation","urls",function(c,k,d,h,f){c.credentials={email:""};c.submit=function(n){var a=c.credentials.email;k.forgot.credentials({},c.credentials,n).$promise.then(function(){d.success(T("We emailed you at")+" <b>"+a+"</b>.");h.navigate(f.root.login)})}}])})();
(function(){angular.module("auth.directives",[]).config(["$compileProvider","d",function(m,c){var k=function(d,f){if(!f.parse||!f.permission)throw Error("auth: "+d+": invalid directive definition");return m.directive(d,c.conditionalDirective({name:d,watch:["$injector","$parse","auth",function(k,a,m){var g=c.safeInvoke(k,f.permission),b=c.safeInvoke(k,f.parse);return function(c,f,k){var n=b(k),m=k.ngCanOnlyWhen?a(k.ngCanOnlyWhen):_.always,q=k.ngCanAlsoWhen?a(k.ngCanAlsoWhen):_.never,D=!k.ngCanOnce||
c.$eval(k.ngCanOnce),l,p=!0;return function(){try{if(q(c))return!0;if(!m(c))return!1;var a;D&&!p?a=l:(a=l=g(n(c)),p=!1);return a}catch(b){throw console.error("auth: "+d+": error checking permission for arguments: "+k[d]),b;}}}}],once:function(c,a,d){return!d.ngCanOnlyWhen&&!d.ngCanAlsoWhen&&(!d.ngCanOnce||c.$eval(d.ngCanOnce))},operator:function(c,a,d){return function(a){d.ngThen&&(c[d.ngThen]=a);return a}}}))},d=function(c,d){return k(c,{parse:["$parse",function(d){return function(a){return d(a[c])}}],
permission:["auth",function(c){return function(a){return c.permissions.can(d.permission,a)}}]})};d("ngCanView",{permission:"view"});d("ngCanUpdate",{permission:"update"});d("ngCanRemove",{permission:"remove"});d("ngCanAdminView",{permission:"adminView"});d("ngCanAdminUpdate",{permission:"adminUpdate"});d("ngCanViewAmounts",{permission:"viewAmounts"});d("ngCanViewDashboardSection",{permission:"viewDashboardSection"});d("ngCanViewAdminSection",{permission:"viewAdminSection"});d("ngCanViewManifestSection",
{permission:"viewManifestSection"});d("ngCanViewInvoiceAmounts",{permission:"viewInvoiceAmounts"});d=function(c,d){return k(c,{parse:["$parse",function(d){return function(a){a=a[c].match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s*$/);if(!a)throw Error("auth: "+c+": expected expression of the form '_type_ on _object_'");var f=a[1],g=d(a[2]);return function(a){return{cls:f,owner:g(a)}}}}],permission:["auth",function(c){return function(a){return c.permissions.can(d.permission,a.cls,a.owner)}}]})};d("ngCanCreate",
{permission:"create"});d("ngCanList",{permission:"list"});d("ngCanClear",{permission:"update"});d("ngCanAdminCreate",{permission:"adminCreate"});d("ngCanAdminList",{permission:"adminList"});k("ngCan",{parse:["$parse",function(c){return function(d){var k=d.ngCan.match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s*$/);d=d.ngCan.match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s+with\s+([\s\S]+)\s*$/);if(!k&&!d)throw Error("auth: ng-can: expected expression of the form '_type_ on _object_' or '_type_ on _model_ with _object_'");
var a=k[1],m=_.never,g=_.never;d?(m=c(d[2]),g=c(d[3])):g=c(k[2]);return function(b){return{permission:a,object:g(b),cls:m(b)}}}}],permission:["auth",function(c){return function(d){return!d.cls?c.permissions.can(d.permission,d.object):c.permissions.can(d.permission,d.cls,d.object)}}]});k("ngCanAny",{parse:["$parse",function(c){return function(d){var k=c(d.ngCanAny),a,m;d.ngCanAnyWith?(a=c(d.ngCanAnyOn),m=c(d.ngCanAnyWith)):(a=_.never,m=c(d.ngCanAnyOn));return function(c){return{permissions:k(c),object:m(c),
cls:a(c)}}}}],permission:["auth",function(c){return function(d){return!d.cls?_.any(d.permissions,function(k){return c.permissions.can(k,d.object)}):_.any(d.permissions,function(k){return c.permissions.can(k,d.cls,d.object)})}}]})}])})();
(function(){var m=angular.module("auth.services",["db.services","lib.services","urls.services"]);m.factory("auth",["$http","$injector","$rootScope","convert","db","events","models","sessionStorage","storage","urls",function(c,k,d,h,f,n,a,m,g,b){var e=["canUpdateOnlyFutureBookings","canViewOnlyCrewedAvailabilities"],z=["canView","canList"],v=f.slipstream("isReadonlyEnabled"),r={isAuthenticated:!1};k={};var C=function(a){var b=y.currentUser;return(a=a||b.company)&&b.isAuthenticated&&b.company&&b.company===
a},s=function(){var a=y.currentUser;return a.isAuthenticated&&a.company&&a.company.isAdmin},D=function(a){return a.affiliation&&a.affiliation.affiliateCompany===y.currentUser.company},l=function(a,b){var c=a.conditions.maxCompanyTier;if(_.isNumber(c)){var d=b.features?b.features.tier:null;if(_.isNumber(d)&&d>c)return!1}return!0},p={},N={},w=function(a,b){if(y.currentUser.isAuthenticated){var c=b.uri,d=N[c];if(!_.isUndefined(d))return d;d=u(a,b);return N[c]=d}};h=function(){N={}};n.on(d,"auth.login",
h);n.on(d,"auth.logout",h);n.on(d,"auth.clearEffectiveGroupCache",h);var u=function(a,b){var c,d;if(y.currentUser.company===b)c=y.currentUser.group;else if(y.currentUser.company.isAdmin)(c=y.currentUser.adminGroup)&&!l(c,b)&&(c=null);else if(y.currentUser.company.isAffiliate){var f=_.findWhere(y.currentUser.company.partners,{company:b});y.currentUser.partnerGroup&&(f&&f.affiliateGroup)&&(d={groupPermissions:_.omit(f.affiliateGroup.groupPermissions,function(a,b){return!(a&&_.get(y.currentUser.partnerGroup.groupPermissions,
b,!1))})},_.forEach(e,function(a){if(f.affiliateGroup.groupPermissions[a]||y.currentUser.partnerGroup.groupPermissions[a])d.groupPermissions[a]=!0}))}if(!c){var g=_.findWhere(y.currentUser.relatedGroupOverrides,{company:b});g||(g=_.findWhere(y.currentUser.company.relatedGroupOverrides,{company:b,relatedUser:null}));g&&(c=g.group||y.currentUser.group)}if(c=c||d)return c;console.warn("auth: user with no effective group",y.currentUser,a,b)},J=function(a){if(!a)throw console.error("auth: invalid permission",
this,a,this.cls),Error("auth: invalid permission");a="can"+_.capitalize(a);if(Q.call(this,a)){var b=p[this.cls][a];return!b?(console.error("auth: invalid permission configuration",this,a,p,b),!1):M.call(this,b)}return!1},x=function(b){var c,d,e;if(2===arguments.length)d=(c=arguments[1])?c.cls:"",e=a.Company.forObject(c);else if(3===arguments.length){c=null;if((d=arguments[1])&&!_.isString(d))d=d.cls;e=arguments[2]}else console.error("auth: invalid arguments when checking permission",arguments);if(_.isUndefined(c))throw console.error("auth: invalid object when checking permission",
b,c),Error("auth: invalid object when checking permission "+b);if(!d)throw console.error("auth: invalid class when checking permission",b,d,e),Error("auth: invalid class when checking permission "+b);if(!e)throw console.error("auth: invalid owner when checking permission",b,d,e),Error("auth: invalid owner when checking permission "+b);var f=a.Company.forObject(e);if(!f)throw console.error("auth: invalid company when checking permission",b,d,e,c),Error("auth: invalid company when checking permission "+
b);var g=w(c,f);c={company:f,instance:c,owner:e,cls:d,group:g,permissions:g?g.groupPermissions:{},can:J};f!==e&&(c[_.uncapitalize(e.cls)]=e);(d=p[d].init)&&d.call(c);return J.call(c,b)};d=function(a){return function(){var b=_.toArray(arguments);b.unshift(a);return x.apply(this,b)}};k.canView=d("view");k.canUpdate=d("update");k.canRemove=d("remove");k.canAdminView=d("adminView");k.canAdminUpdate=d("adminUpdate");k.canCreate=d("create");k.canList=d("list");k.canAdminCreate=d("adminCreate");k.canAdminList=
d("adminList");k.can=x;var t=function(a,b,c){b=b||!1;c=_.isUndefined(c)?b:c;a=_.capitalize(a);var d="canView"+a,e="canEdit"+a,f="canEditPrivateProperties"+a;a="canViewPrivateProperties"+a;return{canView:function(){return b?!0:this.permissions[d]},canList:function(){return c?!0:this.permissions[d]},canCreate:e,canUpdate:e,canRemove:e,canClear:e,canAdminUpdate:f,canAdminCreate:f,canAdminView:a,canAdminList:a}},B=function(b,c){if(!this||!this.permissions)throw console.error("auth: this context needed to check canUpdatePastBooking",
this),Error("auth: this context needed");b=b||this.booking;if(!b)throw console.error("auth: booking reference needed to check canUpdatePastBooking",this),Error("auth: booking reference needed");return c&&b.availability.company.features.isLimitedPastBookingUpdatesEnabled||!this.permissions.canUpdateOnlyFutureBookings||!a.Availability.isInPast(b.availability)};d=function(a,b){b=b||{};var c=b.field||"booking";a=_.capitalize(a);var d=b.permissionOverrides||{},e=_.isUndefined(b.checkPastBooking)?!0:b.checkPastBooking,
f=b.isLimitedPastBookingUpdate||!1,g=d.canView||"canView"+a,k=d.canList||"canView"+a,h=d.canCreate||"canEdit"+a,l=d.canUpdate||"canEdit"+a,n=d.canRemove||"canEdit"+a;return _.extend(t(a,b.canAlwaysView,b.canAlwaysList),{init:function(){this.instance&&(this.booking=_.getDotted(this.instance,c))},canView:function(){return!this.group?!0:!x("view",this.booking)?!1:this.permissions[g]},canList:function(){return!this.group?!0:!x("view",this.booking)?!1:this.permissions[k]},canCreate:function(){return!x("update",
this.booking)||this.booking&&e&&!B.call(this,this.booking,f)?!1:this.permissions[h]},canUpdate:function(){return!x("update",this.booking)||e&&!B.call(this,this.booking,f)?!1:this.permissions[l]},canRemove:function(){return!x("update",this.booking)||e&&!B.call(this,this.booking,f)?!1:this.permissions[n]}})};var M=function(a){if(_.isFunction(a))return a.apply(this);if(_.isString(a))return this.permissions[a]||!1},Q=function(a){return v&&!_.find(z,function(b){return 0===a.indexOf(b)})?!1:!0};h=function(a,
b){return function(){a=_.isArray(a)?a:[a];var c=!0,d=_.clone(this);d.cls=d.company.cls;if(!Q.call(this,b))return!1;_.forEach(a,function(a){if(!d.can(a)||!Q.call(this,a))return c=!1});return c&&M.call(this,b)}};p[a.Company.cls]=t("company",!0);p[a.Company.cls].canCreate=function(){return!s()?!1:this.permissions.canEditCompanies};p[a.Company.cls].canRemove=function(){return this.instance===y.currentUser.company?!1:this.can("create")};p[a.Company.cls].canUpdateCompanyWebsite="canEditCompany";p[a.Company.cls].canUpdateCompanyPayments=
h("viewAmounts","canEditAccounting");p[a.Company.cls].canEditAccounting=h("viewAmounts","canEditAccounting");p[a.Company.cls].canEditTransportation="canEditTransportation";p[a.Company.cls].canDuplicateAcrossCompanies=function(){return y.currentUser.company.isAdmin&&this.permissions.canEditTransportation};p[a.Company.cls].canViewAmounts=function(){return!this.group&&!y.currentUser.isAuthenticated?!0:this.permissions.canViewAmounts};p[a.Company.cls].canViewInvoiceAmounts="canViewInvoiceAmounts";p[a.Company.cls].canViewPricing=
h("viewAmounts","canViewSheets");p[a.Company.cls].canUpdatePricing=h("viewAmounts","canEditPricing");p[a.Company.cls].canViewAdminSection=function(){return!y.currentUser.isAuthenticated?!1:y.currentUser.company.isAdmin&&this.permissions.canViewAdminSection};p[a.Company.cls].canViewDashboardSection="canViewDashboardSection";p[a.Company.cls].canViewItemsSection="canViewItemsSection";p[a.Company.cls].canViewSettingsSection="canViewSettingsSection";p[a.Company.cls].canViewBookingsSection="canViewBookingsSection";
p[a.Company.cls].canViewManifestSection="canViewManifestSection";p[a.Company.cls].canViewReports="canViewReports";p[a.Company.cls].canViewNetworkSettings="canViewNetworkSettings";p[a.Company.cls].canCancel=function(){return this.permissions.canCancelBookings};p[a.Company.cls].canCancelEligible=function(){return this.permissions.canCancelEligibleBookings};p[a.Company.cls].canAdminUpdatePaymentSettings=function(){return s()&&this.can("update")&&this.permissions.canEditPrivatePropertiesCompanyPayments};
p[a.Company.cls].canEditSheets="canEditSheets";p[a.TagGroup.cls]=t("tags",!0);var H=function(){return!s()||!this.company.isAdmin?!1:this.permissions.canEditTags};p[a.TagGroup.cls].canCreate=H;p[a.TagGroup.cls].canUpdate=H;p[a.TagGroup.cls].canRemove=H;p[a.Tag.cls]=p[a.TagGroup.cls];p[a.TagInstance.cls]=t("tagInstances",!0);H=function(){return!s()||!x("update",this.owner)?!1:this.permissions.canEditTagInstances};p[a.TagInstance.cls].canCreate=H;p[a.TagInstance.cls].canUpdate=H;p[a.TagInstance.cls].canRemove=
H;p[a.CustomManifest.cls]=t("customManifests");p[a.CustomCalendar.cls]=t("customCalendars");p[a.CustomReport.cls]=t("customReports");p[a.Role.cls]=t("roles");p[a.CrewMember.cls]=t("crewMembers");p[a.CrewMember.cls].canCreateSelfAssignable="canEditCrewMembersSelfAssignable";p[a.CrewMember.cls].canUpdate=function(){return this.permissions.canEditCrewMembers?!0:this.instance.user===y.currentUser?this.permissions.canEditCrewMembersSelfAssignable:!1};p[a.CrewMember.cls].canRemove=function(){return this.permissions.canEditCrewMembers?
!0:this.instance.user===y.currentUser?this.permissions.canEditCrewMembersSelfAssignable:!1};p[a.CrewMember.cls].canCreate=function(){return this.permissions.canEditCrewMembers};p[a.Group.cls]=t("groups");p[a.GroupOverride.cls]=t("groups");p[a.User.cls]=t("users",!0);p[a.User.cls].canUpdate=function(){return this.instance===y.currentUser?!0:this.permissions.canEditUsers};p[a.User.cls].canRemove=function(){return this.instance==y.currentUser?!1:this.permissions.canEditUsers};p[a.Agent.cls]=t("agents",
!0);p[a.Agent.cls].canCreate=function(){return this.permissions.canEditAgents?!0:!this.affiliation?!1:C(this.affiliation.affiliateCompany)?x("create",a.Agent,this.affiliation.affiliateCompany):!1};p[a.Desk.cls]=t("desks",!0);p[a.Desk.cls].canCreate=function(){if(this.permissions.canEditDesks)return!0;if(!this.affiliation)return!1;if(C(this.affiliation.affiliateCompany))return x("create",a.Desk,this.affiliation.affiliateCompany)};p[a.Affiliation.cls]=t("network");p[a.Affiliation.cls].canView=function(){return this.permissions.canViewNetwork?
!0:!this.instance?!1:x("view",a.Affiliation,this.instance.affiliateCompany)};p[a.Affiliation.cls].canRemove=function(){return this.permissions.canEditNetwork?!0:!this.instance?!1:x("remove",a.Affiliation,this.instance.affiliateCompany)};p[a.AvailabilityHeadline.cls]=t("items",!0);p[a.AvailabilityHeadline.cls].canListAssociatedItems="canListAssociatedItems";p[a.CannedMessage.cls]=t("cannedMessages");p[a.CannedMessage.cls].canListAssociatedItems="canListAssociatedItems";p[a.Item.cls]=t("items",!0);
p[a.Item.cls].canView=function(){return!this.instance.isPrivate||this.permissions.canViewItems};p[a.Item.cls].canViewPrivate="canViewPrivateItems";p[a.Item.cls].canUpdateLedger=function(){return this.can("update")&&this.permissions.canViewAccounting&&this.permissions.canEditAccounting};p[a.FlowNode.cls]=t("flowNodes",!0);p[a.Image.cls]=t("images",!0);p[a.CustomField.cls]=t("customFields",!0);p[a.CustomField.cls].canListAssociatedItems="canListAssociatedItems";p[a.CustomField.cls].canViewPrivate="canViewPrivateCustomFields";
p[a.ExtendedOption.cls]=t("customFields",!0);p[a.TransportationOption.cls]=t("customFields",!0);p[a.ConnectedCampaign.cls]=t("customFields",!0,!1);p[a.ConnectedWaiver.cls]=t("customFields",!0,!1);p[a.GeneratingCampaign.cls]=t("customFields",!0);p[a.CustomFieldInstance.cls]=t("customFields",!0);p[a.CustomFieldInstanceCondition.cls]=t("customFields",!0);p[a.CustomFieldInstanceGroup.cls]=t("customFields",!0);p[a.Availability.cls]=t("availabilities",!0);p[a.Availability.cls].canCreate=function(){return this.permissions.canViewOnlyCrewedAvailabilities?
!1:this.permissions.canCreateAvailabilities};p[a.Availability.cls].canOveruseResources="canOveruseResources";p[a.Availability.cls].canBookClosed="canBookClosedAvailabilities";p[a.Availability.cls].canOverbook="canOverbookAvailabilities";p[a.Availability.cls].canBookUnbookable=function(){return this.permissions.canOveruseResources||this.permissions.canBookClosed||this.permissions.canOverbook};p[a.Availability.cls].canUpdateMultiple=function(){return this.permissions.canViewOnlyCrewedAvailabilities?
!1:this.permissions.canEditMultipleAvailabilities};p[a.Availability.cls].canViewCapacities="canViewAvailabilityCapacities";p[a.Availability.cls].canReportOn="canViewAvailabilities";p[a.Availability.cls].canViewOnlyCrewed="canViewOnlyCrewedAvailabilities";p[a.Availability.cls].canUpdateLedger=function(){return this.can("update")&&this.permissions.canViewAccounting&&this.permissions.canEditAccounting};p[a.CustomerType.cls]=t("customerTypes",!0);p[a.CustomerType.cls].canListAssociatedItems="canListAssociatedItems";
p[a.CheckinStatus.cls]=t("checkinStatuses");p[a.Campaign.cls]=t("campaigns",!0);p[a.Code.cls]=t("codes");p[a.CampaignValidityRule.cls]=t("campaigns",!0);p[a.StoredValueType.cls]=t("storedValueCards");p[a.StoredValueCard.cls]=t("storedValueCards",!0,!1);p[a.StoredValueCard.cls].canReportOn=function(){return this.permissions.canViewStoredValueCards};p[a.StoredValueCard.cls].canIssue=function(){return this.permissions.canIssueStoredValueCards};p[a.StoredValueAdjustment.cls]=t("storedValueCards",!0);
p[a.Fund.cls]=function(a){a="canView"+_.capitalize(a);return{canView:a,canList:a,canCreate:_.never,canUpdate:_.never,canRemove:_.never}}("accounting");p[a.Fund.cls].canView=p[a.Fund.cls].canList=function(){return!s()?!1:this.permissions.canViewAccounting};p[a.Transaction.cls]=p[a.Fund.cls];p[a.Contact.cls]=t("contacts",!0);p[a.InStorePaymentType.cls]=t("inStorePaymentTypes");p[a.EmvDevice.cls]=t("emvDevices");p[a.EmvDevice.cls].canView=p[a.EmvDevice.cls].canList=function(){return this.permissions.canCreateCreditCardPayments};
p[a.EmvDevice.cls].canCreate=p[a.EmvDevice.cls].canRemove=p[a.EmvDevice.cls].canUpdate=function(){return this.permissions.canEditAccounting};p[a.Ledger.cls]=t("accounting");p[a.Ledger.cls].canCreate=function(){return this.permissions.canViewAccounting&&this.permissions.canEditAccounting};p[a.Ledger.cls].canRemove=function(){return this.permissions.canViewAccounting&&this.permissions.canEditAccounting};p[a.Ledger.cls].canUpdate=function(){return this.permissions.canViewAccounting&&this.permissions.canEditAccounting};
p[a.BankAccount.cls]=t("bankAccounts");p[a.BankAccount.cls].canCreate=function(){return this.permissions.canEditAccounting};p[a.BankAccount.cls].canRemove=function(){return this.permissions.canEditAccounting};p[a.BankAccount.cls].canUpdate=function(){return this.permissions.canEditAccounting};p[a.Card.cls]=t("cards",!0);p[a.Card.cls].canCreate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};p[a.Card.cls].canRemove=function(){return this.permissions.canViewCards&&
this.permissions.canEditAccounting};p[a.Card.cls].canUpdate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};p[a.CardAffiliation.cls]=t("cards",!0);p[a.CardAffiliation.cls].canCreate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};p[a.CardAffiliation.cls].canRemove=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};p[a.CardAffiliation.cls].canUpdate=function(){return this.permissions.canViewCards&&
this.permissions.canEditAccounting};p[a.Account.cls]=t("accounting");p[a.Payout.cls]=t("accounting");p[a.Payout.cls].canRetry=function(){return s()&&this.can("adminUpdate")};p[a.Transfer.cls]=t("accounting");p[a.Adjustment.cls]=t("accounting");p[a.Adjustment.cls].canCreate=function(){return!s()?!1:this.permissions.canEditAccounting};p[a.Adjustment.cls].canUpdate=_.never;p[a.Adjustment.cls].canRemove=_.never;p[a.Invoice.cls]=t("invoices");p[a.InvoiceEntry.cls]=t("invoices");p[a.Upload.cls]=t("accounting");
p[a.Upload.cls].canCreateDirectType=function(){return!this.permissions.canEditAccounting?!1:this.permissions.canCreateDirectUploads};p[a.Hotel.cls]=t("hotels",!0);p[a.Hotel.cls].canCreate=function(){return!s()?!1:this.permissions.canEditHotels};p[a.Hotel.cls].canUpdate=p[a.Hotel.cls].canCreate;p[a.Hotel.cls].canRemove=p[a.Hotel.cls].canCreate;p[a.Lodging.cls]=t("transportation",!0);p[a.Pickup.cls]=t("transportation",!0);p[a.PreferredPickup.cls]=t("transportation",!0);p[a.Route.cls]=t("transportation",
!0);p[a.Route.cls].canListAssociatedItems="canListAssociatedItems";p[a.Run.cls]=t("transportation",!0);p[a.Stop.cls]=t("transportation",!0);p[a.Activity.cls]=t("activities");p[a.Activity.cls].canCreate="canEditActivities";p[a.Activity.cls].canView=function(){return a.Activity.isAdminOnly(this.instance)?s():!0};p[a.Activity.cls].canToggleAdminOnlyStatus=function(){return!s()||this.instance.object&&this.instance.object.cls===a.Activity.cls||a.Activity.isAdminOnly(this.instance)&&!this.instance.context.adminOnlyOriginalType?
!1:this.can("update")};p[a.Activity.cls].canCreateNoteOnActivity=function(){return!s()||this.instance.object&&this.instance.object.cls===a.Activity.cls?!1:this.can("create")};p[a.Activity.cls].canList=function(){return this.permissions.canViewActivities||this.permissions.canViewActivitiesSelf};p[a.Activity.cls].canListFeed=function(){return this.permissions.canViewActivitiesFeed};p[a.Waiver.cls]=t("waivers",!0);p[a.WaiverInstance.cls]=d("waiverInstances");p[a.CustomerPrototype.cls]=t("customFields",
!0);p[a.CustomerPrototype.cls].canCreate=function(){return!x("updatePricing",this.company)?!1:this.permissions.canEditCustomFields};p[a.CustomerTypeRate.cls]=t("availabilities",!0);p[a.Block.cls]=t("blocks");p[a.TotalSchedule.cls]=t("sheets");p[a.InvoiceSchedule.cls]=t("sheets");p[a.TotalScheduleEntry.cls]=t("sheets");p[a.InvoiceScheduleEntry.cls]=t("sheets");p[a.TotalScheduleEntryRule.cls]=t("sheets");p[a.InvoiceScheduleEntryRule.cls]=t("sheets");p[a.TotalSheet.cls]=t("sheets");p[a.TotalSheet.cls].canView=
_.always;p[a.TotalSheet.cls].canReportOn=function(){return this.can("list")};p[a.InvoiceSheet.cls]=t("sheets");p[a.InvoiceSheet.cls].canView=_.always;p[a.InvoiceSheet.cls].canReportOn=function(){return this.can("list")};p[a.TotalLine.cls]=t("sheets");p[a.TotalLine.cls].canView=_.always;p[a.TotalLine.cls].canCreate="canEditPricing";p[a.TotalLine.cls].canUpdate="canEditPricing";p[a.TotalLine.cls].canRemove="canEditPricing";p[a.InvoiceLine.cls]=t("sheets");p[a.InvoiceLine.cls].canView=_.always;p[a.InvoiceLine.cls].canCreate=
"canEditPricing";p[a.InvoiceLine.cls].canUpdate="canEditPricing";p[a.InvoiceLine.cls].canRemove="canEditPricing";p[a.TaxType.cls]=t("accounting");p[a.Subscription.cls]=t("users");p[a.Notification.cls]=d("notifications",{checkPastBooking:!1});p[a.Notification.cls].canCreate=_.super(p[a.Notification.cls].canCreate,function(){return!this.booking?this.permissions.canEditNotifications:this.super()});p[a.Notification.cls].canCreateDisputeType=function(){return!s()?!1:this.can("create",this.booking)};p[a.SmsNotification.cls]=
d("smsNotifications",{checkPastBooking:!1});p[a.SmsNotification.cls].canCreate=function(){return this.company.isSmsEnabled&&this.permissions.canEditSmsNotifications&&(this.booking?x("update",this.booking):!0)};p[a.ReviewExpressNotification.cls]=d("reviewExpress",{checkPastBooking:!1});p[a.Order.cls]=t("orders");p[a.Booking.cls]=t("bookings");p[a.Booking.cls].canSkipPayment="canSkipPayment";p[a.Booking.cls].canBookHiddenFields="canBookHiddenFields";p[a.Booking.cls].canViewAffiliateBookings="canViewAffiliateBookings";
p[a.Booking.cls].canOverrideTransportation="canOverrideTransportation";p[a.Booking.cls].canUpdateOnlyFutureBookings="canUpdateOnlyFutureBookings";p[a.Booking.cls].canCreate=function(){return!this.group&&!y.currentUser.isAuthenticated?!0:this.permissions.canCreateBookings};p[a.Booking.cls].canUpdate=function(){return this.permissions.canEditBookings?!0:D(this.instance)};p[a.Booking.cls].canUpdateExplicitTotal=function(){return!this.permissions.canViewAmounts||this.instance&&!this.can("update")||this.instance&&
!B.call(this,this.instance)?!1:this.permissions.canEditBookingExplicitTotals};p[a.Booking.cls].canUpdateExplicitInvoicePrice=function(){return!this.permissions.canViewInvoiceAmounts||this.instance&&!this.can("update")||this.instance&&!B.call(this,this.instance)?!1:this.permissions.canEditBookingExplicitInvoicePrices};p[a.Booking.cls].canViewBookingNote="canViewBookingNotes";p[a.Booking.cls].canUpdateBookingNote=function(){return!this.can("viewBookingNote")||this.instance&&!B.call(this,this.instance)?
!1:this.permissions.canEditBookingNotes};p[a.Booking.cls].canUpdateBookingAffiliations=function(){return!this.can("update")||!B.call(this,this.instance)?!1:this.permissions.canEditBookingAffiliations};p[a.Booking.cls].canUpdateBookingAffiliationInfo=function(){return!this.can("update")||!B.call(this,this.instance)?!1:this.permissions.canEditBookingAffiliationInfo};p[a.Booking.cls].canView=function(){return!this.group||this.permissions.canViewBookings?!0:D(this.instance)};p[a.Booking.cls].canCancel=
function(){return this.can("update")&&this.permissions.canCancelBookings&&B.call(this,this.instance)};p[a.Booking.cls].canCancelEligible=function(){return!this.can("update")||!a.Booking.isEligibleForCancellation(this.instance,y.currentUser)||!B.call(this,this.instance)?!1:this.permissions.canCancelEligibleBookings};p[a.Booking.cls].canRebook=function(){return!this.can("cancel")?!1:this.can("create")};p[a.Booking.cls].canRebookEligible=function(){return!this.can("cancelEligible")||!a.Booking.isEligibleForRebook(this.instance,
y.currentUser)?!1:this.can("create")};p[a.Booking.cls].canEditCustomFieldValues=function(){return this.can("update")&&this.permissions.canEditCustomFieldValues&&B.call(this,this.instance,!0)};p[a.Booking.cls].canChangePriceSheets=function(){return!this.permissions.canViewAmounts||this.instance&&!B.call(this,this.instance)?!1:this.permissions.canChangePriceSheets};p[a.Booking.cls].canReapplyResourceUses=function(){return!B.call(this,this.instance)?!1:this.permissions.canOveruseResources};p[a.Booking.cls].canCreateCustomRefunds=
function(){return!this.permissions.canViewAmounts||!B.call(this,this.instance,!0)?!1:this.permissions.canCreateCustomRefunds};p[a.Customer.cls]=d("customers");p[a.Customer.cls].canViewCheckinStatus=function(){return!this.booking?this.permissions.canViewCustomerCheckinStatus:this.can("view")&&this.permissions.canViewCustomerCheckinStatus};p[a.Customer.cls].canUpdateCheckinStatus=function(){return x("update",this.booking)&&this.permissions.canEditCustomerCheckinStatus&&B.call(this)};p[a.BookingCustomFieldValue.cls]=
d("customFieldValues",{isLimitedPastBookingUpdate:!0});p[a.CustomerCustomFieldValue.cls]=d("customFieldValues",{isLimitedPastBookingUpdate:!0});p[a.BookingCustomFieldValue.cls].canUpdate=function(){return this.permissions.canEditCustomFieldValues&&B.call(this,this.booking,!0)};p[a.CustomerCustomFieldValue.cls].canUpdate=function(){return this.permissions.canEditCustomFieldValues&&B.call(this,this.booking,!0)};p[a.Refund.cls]=d("refunds",{isLimitedPastBookingUpdate:!0});p[a.Refund.cls]=d("refunds",
{isLimitedPastBookingUpdate:!0});p[a.Refund.cls].canUpdate=h("viewAmounts",p[a.Refund.cls].canUpdate);p[a.Refund.cls].canCreate=h("viewAmounts",p[a.Refund.cls].canCreate);p[a.Refund.cls].canViewBookingFee=function(){return s()&&this.permissions.canViewAdminSection};p[a.LineItem.cls]=d("lineItems",{isLimitedPastBookingUpdate:!0});p[a.LineItem.cls].canUpdate=h("viewAmounts",p[a.LineItem.cls].canUpdate);p[a.LineItem.cls].canCreate=h("viewAmounts",p[a.LineItem.cls].canCreate);p[a.LineItem.cls].canRemove=
h("viewAmounts",p[a.LineItem.cls].canRemove);p[a.LineItem.cls].canReportOn=function(){return this.permissions.canViewLineItems};p[a.Payment.cls]=d("payments",{isLimitedPastBookingUpdate:!0});p[a.Payment.cls].canCreatePartial=h("viewAmounts","canSkipPayment");p[a.Payment.cls].canCreateWithoutCVC=function(){return s()||this.permissions.canCreateCreditCardPaymentsWithoutCvv};p[a.Payment.cls].canCreateWithoutCardholdersName="canSkipCardholderInfo";p[a.Payment.cls].canCreateWithoutPostalCode="canSkipPostalCode";
p[a.Payment.cls].canCreateWithoutCountryCode="canSkipPostalCode";p[a.Payment.cls].canCreateCreditCard=h("viewAmounts","canCreateCreditCardPayments");p[a.Payment.cls].canCreateInStore=h("viewAmounts","canCreateInStorePayments");p[a.Payment.cls].canCreateStoredValueCard=h("viewAmounts","canCreateStoredValueCardPayments");p[a.Payment.cls].canCreateDeferred="canCreateDeferredPayments";p[a.Payment.cls].canCreateAffiliate=function(){return this.permissions.canCreateAffiliatePayments?!0:this.booking?D(this.booking):
!1};p[a.Payment.cls].canViewBookingFee=function(){return s()&&this.permissions.canViewAdminSection};p[a.TicketLayout.cls]=t("ticketLayouts",!0);p[a.SupportedLanguage.cls]=t("supportedLanguages");p[a.Translation.cls]=t("translations");p[a.Location.cls]=t("locations");p[a.Location.cls].canView="canEditLocations";p[a.Location.cls].canViewSensitive="canEditLocations";p[a.Location.cls].canList="canEditLocations";p[a.Report.cls]=t("reports");p[a.Report.cls].canViewAccountsType="canViewAccounting";p[a.Report.cls].canViewEscrowType=
"canViewAccounting";p[a.Report.cls].canViewFundsType="canViewAccounting";p[a.Report.cls].canViewPayoutsType="canViewAccounting";p[a.Report.cls].canViewTransfersType="canViewAccounting";p[a.Report.cls].canViewInvoicesType="canViewInvoices";p[a.Report.cls].canViewInvoiceableBookingsType="canEditInvoices";p[a.Report.cls].canViewAdvancedType="canViewAdvancedReport";p[a.Report.cls].canViewAgentsSummaryType="canViewAgentsSummaryReport";p[a.Report.cls].canViewBookingTypesSummaryType="canViewBookingTypesSummaryReport";
p[a.Report.cls].canViewBookingsType="canViewBookingsReport";p[a.Report.cls].canViewCampaignsSummaryType="canViewCampaignsSummaryReport";p[a.Report.cls].canViewContactsType="canViewContactsReport";p[a.Report.cls].canViewCrewSummaryType="canViewCrewSummaryReport";p[a.Report.cls].canViewCustomFieldSummaryType="canViewCustomFieldSummaryReport";p[a.Report.cls].canViewCustomerTypesSummaryType="canViewCustomerTypesSummaryReport";p[a.Report.cls].canViewDesksSummaryType="canViewDesksSummaryReport";p[a.Report.cls].canViewItemsSummaryType=
"canViewItemsSummaryReport";p[a.Report.cls].canViewLineItemsSummaryType="canViewLineItemsSummaryReport";p[a.Report.cls].canViewLodgingsSummaryType="canViewLodgingsSummaryReport";p[a.Report.cls].canViewPaymentsType="canViewPaymentsReport";p[a.Report.cls].canViewDisputesType="canViewDisputesReport";p[a.Report.cls].canViewPickupLocationsSummaryType="canViewPickupLocationsSummaryReport";p[a.Report.cls].canViewRevenueSummaryType="canViewRevenueSummaryReport";p[a.Report.cls].canViewUsersSummaryType="canViewUsersSummaryReport";
p[a.Report.cls].canViewCompaniesType="canViewCompaniesReport";p[a.Report.cls].canViewInProgressReportsType="canViewInProgressReportsReport";p[a.Report.cls].canViewTransactionsType="canViewTransactionsReport";p[a.Report.cls].canViewVolumeType="canViewVolumeReport";p[a.Report.cls].canReport=function(){return!!this.group};f.slipstream("isReadonlyEnabled")&&(p[a.Report.cls].canView=_.never,p[a.Report.cls].canList=_.never,p[a.Report.cls].canCreate=_.never,p[a.Report.cls].canUpdate=_.never,p[a.Report.cls].canRemove=
_.never,p[a.Report.cls].canViewBookingTypesSummaryType=_.never,p[a.Report.cls].canViewAdvancedType=_.never,p[a.Report.cls].canViewPayoutsType=_.never,p[a.Report.cls].canViewItemsSummaryType=_.never,p[a.Report.cls].canViewRevenueSummaryType=_.never,p[a.Report.cls].canReport=_.never);p[a.Resource.cls]=t("resources");p[a.Resource.cls].canListAssociatedItems="canListAssociatedItems";p[a.Requirement.cls]=t("resources");p[a.RequirementGroup.cls]=t("resources");p[a.RequirementGroup.cls].canListAssociatedItems=
"canListAssociatedItems";p[a.CustomerPrototypeRequirement.cls]=t("resources");p[a.CustomerTypeRequirement.cls]=t("resources");p[a.ResourceRequirement.cls]=t("resources");p[a.ResourceOverride.cls]=t("resourceUses",!0);p[a.SeatMap.cls]=t("seatMaps",!0);p[a.SeatGroup.cls]=t("seatMaps",!0);p[a.SeatZone.cls]=t("seatMaps",!0);p[a.ResourceUse.cls]=d("resources",{permissionOverrides:{canCreate:"canEditResourceUses",canUpdate:"canEditResourceUses",canRemove:"canEditResourceUses"}});p[a.ResourceUse.cls].canReapplyAcrossBookings=
function(){return this.permissions.canEditResourceUses};p[a.ResourceUse.cls].canList=_.super(p[a.ResourceUse.cls].canList,function(){return!this.booking?this.permissions.canViewResources:this.super()});p[a.AnalyticsService.cls]=t("analyticsServices",!0);p[a.CancellationPolicy.cls]=t("cancellationPolicies",!0);p[a.CancellationPolicy.cls].canListAssociatedItems="canListAssociatedItems";p[a.CancellationRule.cls]=t("cancellationPolicies",!0);p[a.BookingRestriction.cls]=t("bookingRestrictions",!0);p[a.BookingRestriction.cls].canListAssociatedItems=
"canListAssociatedItems";k.canBookWithNoFee=function(a,b){return y.currentUser.isAuthenticated};d=function(){return!s()?!1:this.permissions.canEditReseller};p[a.ResellerApp.cls]=t("reseller");p[a.ResellerApp.cls].canList=d;p[a.ResellerAppCompany.cls]=t("reseller");p[a.ResellerCompany.cls]=t("reseller");p[a.ResellerCompany.cls].canList=d;p[a.ResellerAppRequest.cls]=t("accounting");p[a.ResellerAppRequest.cls].canUpdate=d;p[a.ResellerAppRequest.cls].canRemove=d;p[a.ResellerCompanyMapping.cls]=t("reseller");
p[a.ResellerCompanyMapping.cls].canCreate=d;p[a.ResellerCompanyMapping.cls].canList=d;p[a.ResellerCompanyMapping.cls].canRemove=d;p[a.ResellerItem.cls]=t("reseller");p[a.ResellerItemMapping.cls]=t("reseller");p[a.ResellerCustomerType.cls]=t("reseller");p[a.ResellerCustomerTypeMapping.cls]=t("reseller");p[a.ResellerOption.cls]=t("reseller");p[a.ResellerOptionMapping.cls]=t("reseller");p[a.ResellerKey.cls]=t("resellerKeys");p[a.ResellerKey.cls].canCreate=function(){return this.permissions.canEditResellerKeys?
!0:C()};p[a.ResellerKey.cls].canCreateForAnyUser=function(){return this.permissions.canEditResellerKeys};p[a.Order.cls].canCancelEligible=function(){return this.permissions.canCancelEligibleBookings&&!this.can("cancel")};(d=f.slipstream("currentUser"))?d.isAuthenticated=!0:d=r;h=function(a){var b=function(){return y.currentUser.isAuthenticated?y.currentUser.username+"@"+y.currentUser.company.shortname:"anonymous"};return{get:function(c){return a.get(b()+":"+c)},set:function(c,d){return a.set(b()+
":"+c,d)},del:function(c){return a.del(b()+":"+c)},clear:function(){if(a.key&&a.length)for(var c=b(),d,e,f=0;f<a.length;f++)e=a.key(f),d=e.split(":",1)[0],d===c&&a.del(e);else a.clear()}}};var y={permissions:k,storage:h(g),sessionStorage:h(m),currentUser:d,isCompanyUser:function(a,b){b=b||y.currentUser;return!a||!b?!1:b.company===a},isAuthenticatedForAdminCompany:s,relatedCompanies:function(){return!y.currentUser.isAuthenticated?[]:_.sortBy(_.unique(_.append(_.pluck(a.GroupOverride.companyLevelOverrides(y.currentUser.company.relatedGroupOverrides),
"company"),_.pluck(y.currentUser.relatedGroupOverrides,"company"))),"name")},login:function(a,b){var c=f.login({},a,b);return c.$promise.then(function(){y.currentUser=c;y.currentUser.isAuthenticated=!0;n.broadcast("auth.login")})},logout:function(){y.storage.clear();y.sessionStorage.clear();y.currentUser=r;var a=c.post(b.api.logout);n.broadcast("auth.logout");return a},effectiveGroup:w};return window.$$auth=y}]);m.run(["$rootScope","$window","auth",function(c,k,d){c.auth=d;k.$$auth=d}])})();
angular.module("cache",["cache.services"]);
(function(){var m=angular.module("cache.services",["lib.services","urls.services"]);m.factory("cache",["moment","urls",function(c,k){var d=function(a,c){c=c||{};for(var d in a)a.hasOwnProperty(d)&&(c[d]=h(a[d]));return c},h=function(a){if(_.isArray(a)){for(var c=[],g=0,b=a.length;g<b;g++)c.push(h(a[g]));return c}return _.isModelObject(a)?f(a):_.isObject(a)?d(a):a},f=function(a,c){if(_.isUndefined(a)||null===a)return c&&delete n.cache[c],a;if(!_.isObject(a))return a;var f=a.uri;c=c||f;var b=n.cache[c];
f&&(c&&c!==f&&!_.isUndefined(b))&&(console.log("cache: overlapping uris",f,c),delete n.cache[c]);b=_.isUndefined(b)?{}:b;f&&(n.cache[f]=b,b.$url||(b.$url=k.populateForObject));f=d(a,b);f.$fresh=!1;return f},n={cache:{},read:function(a,c){if(_.isUndefined(a))throw Error("cache.read: invalid key");c&&(a="["+a+"]");var d=n.cache[a];_.isUndefined(d)&&(d=c?[]:{},d.uri=a,d.$fresh=!0,n.cache[a]=d);return d},update:f,clear:function(){n.cache={}},fresh:function(a){return!!a.$fresh},populate:h,reference:function(a){if(a.cls&&
a.uri)return{cls:a.cls,pk:a.pk,uri:a.uri}}};return window.$$cache=n}]);m.run(["$rootScope","cache","events",function(c,k,d){d.on(c,"auth.logout",function(){k.clear()})}])})();
(function(){var m=angular.module("cart",["cache","db","navigation"]);m.factory("cart",["$q","$rootScope","$timeout","cache","clientOptions","db","events","flows","navigation","require","persistentStorage","urls","xmessage",function(c,k,d,h,f,n,a,m,g,b,e,z,v){var r=function(a){return{company:a,entries:[],isNoTax:!1,isCardRequired:!0,totals:{price:0,tax:0,taxByType:{},total:0}}},C=function(){x.status="success";a.broadcast("cart.loaded")},s=function(a){a.totals.price=_.sum(a.entries,"totals.price");
a.totals.tax=_.sum(a.entries,"totals.tax");a.totals.bookingFee=_.sum(a.entries,"totals.bookingFee");var b=_.pluck(a.entries,"totals.taxByType");_.all(b)?a.totals.taxByType=_.reduce(b,_.sumObjectValues)||{}:a.totals.taxByType=void 0;a.isNoTax=_.all(a.entries,"availability.item.isNoTax");a.totals.isAnyBookingFeeOnly=_.any(a.entries,"availability.item.settings.isBookingFeeOnly");a.isCardRequired=_.any(a.entries,"isCardRequired")},D={},l=function(a,c,d,e,f,g){b.assert(!!c,"cart: expected availability");
b.assert(!!d,"cart: expected breakdown");b.defined(e,"price","cart: expected total price");b.defined(e,"tax","cart: expected total tax");b.defined(e,"bookingFee","cart: expected total total");b.assert(!!f,"cart: expected model");var k=a.company.shortname;D[k]=D[k]||{};var h=D[k][c.uri];h||(h={availability:c},D[k][c.uri]=h,a.entries.push(h));h.customerBreakdown=d;h.totals=e;h.isCardRequired=c.item.isCardRequired;h.model=f;h.newResourceUses=g;s(a)},p=function(a,b){_.overwriteWithout(a.entries,function(a){return a.availability===
b.availability});D[a.company.shortname]&&delete D[a.company.shortname][b.availability.uri];s(a)},N=function(a){_.clear(a.entries);D[a.company.shortname]={};s(a)},w=function(a,b){try{var d=_.map(b.entries,function(a){var b=n.availability(a.availability,null,null,null,{tagAlong:!0});return b.$promise.then(function(){return{availability:b,storedEntry:a}},function(){return null})});return c.all(d).then(function(b){N(a);_.forEach(b,function(b){if(b){var c=b.availability;b=b.storedEntry;var d=_.choose(b.customerBreakdown,
function(a){var b=h.read(a.customerTypeRate.uri);if(b)return{count:a.count,customerTypeRate:b}});l(a,c,d,b.totals,b.model,b.newResourceUses)}});console.info("cart: finished hydrating")})}catch(e){return console.warn("cart: unable to load cart",b,e),c.when(null)}},u=function(a){var b={};b.entries=_.map(a,function(a){var b=_.map(a.customerBreakdown,function(a){return{count:a.count,customerTypeRate:h.reference(a.customerTypeRate)}}),c=_.map(a.newResourceUses,function(a){return _.extend({},a,{seat:a.seat?
h.reference(a.seat):null,startAt:a.startAt.format("YYYY-MM-DDTHH:mm:ss"),endAt:a.endAt.format("YYYY-MM-DDTHH:mm:ss")})});return{availability:z.extract(a.availability),customerBreakdown:b,totals:a.totals,model:a.model,newResourceUses:c}});return b},J=function(a){if(x.company){var b=u(x.entries);b?(console.info("cart: storing",b),b=e.set("cart",b)):b=e.del("cart");a&&(b=b.then(function(){v.broadcast("fareharbor.cart.changed")}));return b}},x={status:"success",add:function(a,b,c,d,e){l(x,a,b,c,d,e);
return J(!0)},remove:function(a){p(x,a);J(!0)},clear:function(){N(x);J(!0)},search:function(a){return(D[x.company.shortname]||{})[a.uri]||null},keepShoppingUrl:function(a){return m.initialFlowNode?m.initialUrl():a.$url(z.company.index)},permalinkUrl:function(a){a=z.populate(z.company.cart.permalink,{shortname:a.shortname,cartUuid:f.userIdentifier});return m.extendWithFlow(a)},load:function(){if(x.company&&"loading"!==x.status)return x.status="loading",x.$promise=e.get("cart").then(function(a){if(a)return console.info("cart: hydrating...",
a),w(x,a)}).then(C,C),x.$promise},allCompanies:{status:"success",carts:{},load:function(){x.allCompanies.status="loading";x.allCompanies.$promise=e.getForAllCompanies("cart").then(function(a){delete x.allCompanies.$promise;_.clear(x.allCompanies.carts);D={};var b=[];_.forEach(a,function(a){if(a.cart){var c=a.company.shortname;x.allCompanies.carts[c]=r(a.company);console.info("cart: loading all...",a);b.push(w(x.allCompanies.carts[c],a.cart))}});return c.all(b).then(function(){x.company&&x.allCompanies.carts[x.company.shortname]?
_.extend(x,x.allCompanies.carts[x.company.shortname]):_.extend(x,r());x.allCompanies.status="success"},function(){x.allCompanies.status="success"})});return x.allCompanies.$promise}}};_.extend(x,r(null));var t=function(a){a&&x.company!==a&&(console.info("cart: loading for new company",a),J(),x.company=a,x.load())};t(g.currentCompany);a.on(k,"navigation.company.updated",function(a,b){t(b.company)});a.on(k,"persistentStorage.reIdentifiedUser",function(){g.currentCompany&&(x.company=g.currentCompany,
x.load(),console.info("cart: loading for new user"))});return x}]);m.controller("cart.CartCtrl",["$scope","clientOptions","controllers","db","navigation","require",function(c,k,d,h,f,n){k.reflect("userIdentifier")}]);m.controller("cart.ViewCartCtrl",["$scope","cart",function(c,k){k.load()}]);m.directive("ngCart",["analytics","cart","db","events","flows","lightframe","models","navigation","paymentController","queueToken","tracking","tracking.geo","urls",function(c,k,d,h,f,n,a,m,g,b,e,z,v){return{templateUrl:"cart.cart",
controller:["$scope","$attrs",function(r,C){d.slipstream("isDebug")&&(window.$$pop=function(a,b){r.$safeApply(function(){var c=a?a.replace(" ","-"):"z",d=_.capitalize(a||"zach");s.newOrder["contact-name"]=d;s.newOrder["contact-phone"]="4158881212";s.newOrder["contact-email"]=c+"@fareharbor.com";s.newOrder["payments-payment-cardNumber"]="4242424242424242";s.newOrder["payments-payment-cardholdersName"]=d;s.newOrder["payments-payment-cardExpiryMonth"]="12";s.newOrder["payments-payment-cardExpiryYear"]=
"2023";s.newOrder["payments-payment-cardCvc"]="123";s.newOrder["payments-payment-postalCode"]="12345";s.newOrder["payments-payment-countryCode"]="US";_.extend(s.newOrder,b)})});var s=this,D={};s.setEntryValidity=function(a,b){var c=a.availability.uri;_.isUndefined(b)?delete D[c]:D[c]=!!b};s.addEntryController=function(a){_.contains(s.entryCtrls,a)||s.entryCtrls.push(a)};s.removeEntryController=function(a){_.contains(s.entryCtrls,a)&&_.ref.remove(s.entryCtrls,a)};s.newOrder=r.newOrder={clientUuid:_.uuid()};
s.company=r.$eval(C.ngCart);s.attachControl=function(a,b){s[a]=b;b.cartCtrl=s};s.showCompleteButton=function(a){return!a.$invalid&&!a.$submitting&&0<k.entries.length&&_.all(D)&&s.paymentCtrl&&s.paymentCtrl.isCurrentOptionValid()&&s.paymentCtrl.isCurrentKindValid()&&!s.paymentCtrl.isAmountTooLow()};var l=!1;s.isNavigateAwayAllowed=function(a){return l?!0:!a.$pristine?!1:!0};var p=function(a,g){g=g||_.ignore;var u=_.extend({},s.newOrder);u.bookingCount=k.entries.length;_.forEach(k.entries,function(a,
b){var c="booking"+b.toString()+"-";_.extendWithPrefix(c,u,a.model);u[c+"availability"]=a.availability.pk});console.info("cart: creating order",u);var D={};_.forEach(b.tokens,function(a,b){D["X-QUEUING-TOKEN-"+b]=a.uuid});var x=d.orders.create({shortname:s.company.shortname},D,u,a);x.$promise.then(function(){if(x.clientAction)s.paymentCtrl.completeClientAction(a,x).then(function(){p(a,g)},function(){e.track(r,"failed-order",{company:s.company.shortname,isLightframe:n.isLightframe(),clientAction:!0});
s.paymentCtrl.restoreCard();a.$submitting=!1;g()});else{l=!0;var b=x.$url(v.company.order.index);1===x.contributingBookings.length?(b=x.contributingBookings[0],x.isPending?(b=b.$url(v.embeds.book.wait.booking),b=m.extendQuery(b,{status:"initial"})):b=b.$url(v.company.item.booking)):x.isPending&&(b=x.$url(v.embeds.book.wait.order),b=m.extendQuery(b,{status:"initial"}));b=f.extendWithFlow(b);x.isPending&&n.isLightframe()?(b=m.absoluteUrl(b),m.redirect(b)):m.navigate(b);k.clear();a.$submitting=!0;b=
{company:s.company.shortname,total:x.contributingBookingCosts.totalCost.total,bookingCount:x.bookingCount,items:_.unique(_.map(x.contributingBookings,"item.name")),isLightframe:n.isLightframe()};!1===z.isEU&&(b.order=x.uuid);e.track(r,"completed-order",b);c.trackOrder(x);g()}},function(c){e.track(r,"failed-order",{company:s.company.shortname,isLightframe:n.isLightframe()});s.paymentCtrl.restoreCard();a.$submitting=!1;_.isUndefined(c.data.tokens)||_.forEach(c.data.tokens,function(a){var c=_.find(k.entries,
function(b){if(b.availability.item.pk===a.itemPk)return b});c&&(b.replace(c.availability.item,a),h.broadcast("queuing.tokenIssued",a,parseInt(a.itemPk)))});g()})};s.submit=function(b){if(k.entries.length)if(b.$valid){b.$submitting=!0;s.paymentCtrl.saveCard();var c=s.paymentCtrl.isRedirectBasedPaymentOption();s.newOrder.type=c?a.Order.PENDING_TYPE:a.Order.COMPLETED_TYPE;_.forEach(k.entries,function(b){b.model.type=c?a.Booking.PENDING_TYPE:a.Booking.COMPLETED_TYPE});var d=s.paymentCtrl.option();if(d===
s.paymentCtrl.CHARGE_OPTION||d===s.paymentCtrl.DEFER_OPTION)s.tokenizingCard=!0;r.$asyncApply(function(a){s.paymentCtrl.createToken(b,function(){s.tokenizingCard=!1;p(b,a)},function(){s.tokenizingCard=!1;b.$submitting=!1;a()})})}else console.error("cart: attempting to submit invalid order form");else console.error("cart: attempting to submit empty order form")};g(r,{modelKey:"newOrder",fieldPrefix:"payments-payment",company:s.company,gross:function(){return!s.cartTotalsCtrl?0:s.cartTotalsCtrl.totals.isAnyBookingFeeOnly?
s.cartTotalsCtrl.totals.bookingFeeOnlyGross:s.cartTotalsCtrl.totals.preBookingFeeTotal},bookingFee:function(){return!s.cartTotalsCtrl?0:s.cartTotalsCtrl.totals.bookingFee},invoicePrice:0,isAnonymous:!0,isAffiliate:!1,isCompany:!1,isCardRequired:!!k.isCardRequired});s.attachControl("paymentCtrl",r.paymentCtrl)}],controllerAs:"cartCtrl"}}]);m.directive("ngCartEntry",["cart","db","navigation","urls",function(c,k,d,h){return{restrict:"A",require:"^ngCart",templateUrl:"cart.entry",controller:["$scope",
"$attrs",function(f,n){var a=this;a.status="loading";a.cartCtrl=f.cartCtrl;a.entry=f.$eval(n.ngCartEntry);a.total=_.sum([a.entry.totals.price,a.entry.totals.tax,a.entry.totals.bookingFee]);a.change=function(){var b=a.entry.availability.$url(h.company.item.book);d.navigate(b)};a.remove=function(b,d){delete b["booking"+d+"-all"];c.remove(a.entry)};var m={};_.forEach(a.entry.customerBreakdown,function(a){m[a.customerTypeRate.pk]=a.count});var g=k.availability.liveCapacity({shortname:a.entry.availability.item.company.shortname,
itemPk:a.entry.availability.item.pk,availabilityPk:a.entry.availability.pk},null,null,{customerTypeRateCounts:_.stringifyJSON(m),totalSheet:a.entry.model.totalSheet});g.$promise.then(function(){a.cartCtrl.setEntryValidity(a.entry,g.isBookable);a.status=a.entry.availability.isBookable&&g.isBookable?"success":"error";a.isPossiblyBookable=a.entry.availability.isBookable},function(){a.cartCtrl.setEntryValidity(a.entry,!0);a.status="success"});f.$on("$destroy",function(){a.cartCtrl.setEntryValidity(a.entry)})}],
controllerAs:"cartEntryCtrl"}}]);m.directive("ngCartTotals",["cart","models","redeemStoredValueCardsController",function(c,k,d){return{restrict:"A",require:"^ngCart",templateUrl:"cart.totals",controller:["$scope",function(h){var f=this;h.cartCtrl.attachControl("cartTotalsCtrl",f);f.cartCtrl=h.cartCtrl;f.totals=_.extend({},c.totals);f.currentPrice=function(){return f.totals.price};f.currentTax=function(){return f.totals.tax};var n=function(a){return a.availability.uri},a=function(a){return a.totals.price+
a.totals.tax},m=function(b){var d=h.redeemStoredValueCardsCtrl.storedValueCards;if(!d.length)return b;var f={};_.forEach(d,function(b){b=h.redeemStoredValueCardsCtrl.applied(b);b=_.prorate(b,c.entries,a,n);f=_.merge(f,b,_.add)});var g=0;_.forEach(c.entries,function(a){var b=n(a);g+=k.Booking.adjustBookingFee(a.totals.bookingFee,a.totals.price,a.totals.tax,f[b])});return g},g=function(){_.extend(f.totals,c.totals);f.totals.bookingFee=m(f.totals.bookingFee);f.totals.preBookingFeeTotal=f.totals.price+
f.totals.tax-h.redeemStoredValueCardsCtrl.totalApplied();f.totals.total=f.totals.preBookingFeeTotal+f.totals.bookingFee;f.totals.bookingFeeOnlyGross=_.sum(c.entries,function(a){return a.availability.item.settings.isBookingFeeOnly?0:a.totals.price+a.totals.tax})};h.$watchCollection("cart.entries",function(){g()});d(h,{company:f.cartCtrl.company,modelKey:"newOrder",price:f.currentPrice,tax:f.currentTax,toggleName:"applyStoredValueCard"});h.cartCtrl.attachControl("redeemStoredValueCardsCtrl",h.redeemStoredValueCardsCtrl);
h.$watch("redeemStoredValueCardsCtrl.storedValueCards.length",function(a){g()})}],controllerAs:"cartTotalsCtrl"}}]);m.directive("ngCartComplete",["cart",function(c){return{restrict:"A",require:"^ngCart",templateUrl:"cart.complete",controller:["$scope",function(c){}],controllerAs:"cartCompleteCtrl"}}]);m.directive("ngCartAdd",["cart","navigation","urls",function(c,k,d){return{restrict:"A",require:"^ngBook",templateUrl:"cart.add",controller:["$scope",function(d){var f=this;f.isAdding=!1;f.isAvailabilityInCart=
!!c.search(d.bookCtrl.availability);f.add=function(){f.isAdding=!0;var n={price:d.bookCtrl.bookTotalsCtrl.totals.price,tax:d.bookCtrl.bookTotalsCtrl.totals.tax,taxByType:d.bookCtrl.bookTotalsCtrl.totals.taxByType,bookingFee:d.bookCtrl.bookTotalsCtrl.totals.bookingFee};d.bookCtrl.reflectASN();d.bookCtrl.isAlreadyBooked=!0;c.add(d.bookCtrl.availability,d.bookCtrl.bookCountsCtrl.customerBreakdown(),n,d.bookCtrl.newBooking,_.get(d.bookCtrl,"bookCountsCtrl.liveCapacity.resourceUses")).then(function(){k.navigate(c.permalinkUrl(d.bookCtrl.item.company))},
function(){d.bookCtrl.restoreASN();f.isAdding=!1})}}],controllerAs:"cartAddCtrl"}}]);m.directive("ngCartSubmit",[function(){return{restrict:"A",require:"^ngCart",templateUrl:"cart.submit"}}]);m.run(["$rootScope","cart",function(c,k){c.cart=k;window.$$cart=k}])})();angular.module("db",["db.services"]);
(function(){var m=0;angular.module("db.services",["cache.services","lib.services"]).factory("db",["$http","$injector","$rootScope","$q","$window","cache","convert","flash","require","urls",function(c,k,d,h,f,n,a,q,g,b){var e=!1;angular.element(f).on("beforeunload",function(){e=!0});var z={},v=_.debounce(function(){e||q.warn("<b>"+T("Could not reach FareHarbor.")+"</b> "+T("Please check your internet connection."))},2E3,!0),r=function(a){_.isUndefined(a)&&(a="<b>"+T("That didn't work.")+"</b> "+T("Please try again."));
a&&q.error(a)},C=_.debounce(function(a){q.error("<b>"+interpolate(T("Too many %(errorType)s."),{errorType:a})+"</b> "+T("Please wait a few minutes and try again. If you continue to receive this message please contact")+' <a href="mailto:support@fareharbor.com" target="_blank">support@fareharbor.com</a>.')},2E3,!0),s=_.debounce(function(){q.error("<b>"+T("FareHarbor will be right back.")+"</b> "+T("Please wait a few minutes and try again."))},2E3,!0),D=function(a,b,c){return c?_.map(a,function(a){return n.update(a)}):
n.update(a,b)},l=function(d){var e={},f={isDelete404Success:!0},k=d.formName||d.key+"Form";return function(l,X,t,u,x,y){var w=_.extend({},f,d,x),Y=!1!==w.flashError,G=!1!==w.flash500Error,A,B;if(_.isString(l))A=l;else{var F={};_.extend(F,w.defaultParams||{},l);A=b.populate(w.url,F)}B=A;if(_.isUndefined(A))return console.warn("db: invalid endpoint",w.url,F),X=w.isArray?[]:{},X.$promise=h.reject(null),X.$promise.cancel=_.ignore,X;u&&(A+="?"+Ob(a.clientRequest(u)),u=null);w.ignoreQueryParamsInCacheUri||
(B=A);var E=m+=1;console.log("db: endpoint",A,E);if((l=e[A])&&!w.ignoreInFlight){if(w.tagAlong)return console.log("db: tagging along",A,E),l.value;"GET"===w.method&&"GET"===l.method&&(console.log("db: already in flight, cancelling",A,E),l.timeout.promise.cancelled=!0,l.timeout.resolve())}var O;O=w.ignoreCache?w.isArray?[]:{}:n.read(B,w.isArray);if(w.eagerCache&&!O.$fresh)return O;var I=function(a){a.data&&w.sideKeys&&_.forEach(w.sideKeys,function(b){var c=a.data[b];c&&(a[b]=D(c,null,_.isArray(c)))})},
fa=_.identity;w.key&&(fa=w.isArray?function(a){console.log("db: success",A,E);if(O.$requestId!==E)return console.log("db: out of order",A,O.$requestId,E),a;var b=_.isFunction(w.key)?w.key(a):w.key;_.overwrite(O,D(a.data[b],null,!0));O.$fresh=!1;a.data?(a.primaryData=a.data[b]=O,I(a)):a.primaryData=null;t&&N(t,k)(a,O);return a}:function(a){console.log("db: success",A,E);if(O.$requestId!==E)return console.warn("db: out of order",A,O.$requestId,E),a;var b=_.isFunction(w.key)?w.key(a):w.key,c=a.data[b],
c=w.ignoreCache?D(c):D(c,B);a.data?(a.primaryData=a.data[b]=c,I(a)):a.primaryData=null;t&&N(t,k)(a,c);return a});var H;t&&(H=p(t,k));l=function(a){return function(b){b=a(b);console.log("db: complete",A,E);w.ignoreInFlight||(e[A]=null);t&&(t.$submitting=!1);O.$requestId===E&&(delete O.$requestId,delete O.$promise);return b}};t&&(t.$submitting=!0);u=h.defer();var J=c({method:w.method,url:A,data:X||{},timeout:u.promise,headers:y}).then(l(fa),l(function(a){console.log("db: error",A,E,a);var b=a.status;
if(500===b)return G&&q.error("<b>"+T("Whoops, an internal error has occurred.")+"</b> "+T("FareHarbor has been notified. Please wait a few minutes and try again.")),h.reject(a);if(503===b)return s(),h.reject(a);if(403===b)return Y&&q.error("<b>"+T("Not allowed.")+"</b> "+interpolate(T("Please <a %(href)s>log in</a> as a different user or request permission from your administrator."),{href:'href="/login/"'})),h.reject(a);if(420===b)return C("connections"),h.reject(a);if(429===b)return C("requests"),
h.reject(a);if(324===b)return v(),h.reject(a);if(0===b){if(a.config.timeout&&a.config.timeout.cancelled)return z;v();return h.reject(a)}if(400===b)return H?H(a,b):Y&&r(a.data.errorMessage||w.errorMessage),h.reject(a);if(404===b){if(w.isDelete404Success&&"DELETE"===w.method)return console.log("db: treating 404 as success",A,E),fa(a)}else r(a.data.errorMessage||w.errorMessage),console.error("db: unknown error",a,b);return h.reject(a)}));g.assert(!J.success&&!J.error,"db: disallow $http promise interface");
w.ignoreInFlight||(e[A]={timeout:u,value:O,requestId:E,method:w.method,uri:A});O.$requestId=E;O.$promise=J;O.$promise.timeout=u;O.$promise.cancel=function(){J.timeout?(J.timeout.promise.cancelled=!0,J.timeout.resolve(),e[A]=null,console.log("db: cancelled",A,E)):console.warn("db: cancellation failed",A,E)};return O}},p=function(a,b){return function(c){var d=c.data[b];_.forEach(d,function(b,c){a[c]||(a[c]={$error:{}});var d=a[c];b&&b.length?d.$error.$server=b:d.$error={}});a.$errorCallbacks&&_.forEach(a.$errorCallbacks,
function(a){a(d)})}},N=function(a,b){return function(b,c){_.forEach(a,function(a,b){a&&a.$error&&delete a.$error.$server});a.$successCallbacks&&_.forEach(a.$successCallbacks,function(a){a(c)})}},w=function(a,c){c||(c=a+"s");var d=l({method:"GET",url:b.api[c],isArray:!0,key:c});d.create=l({method:"POST",url:b.api[c],key:a});return d},u=function(a){var c=l({method:"GET",url:b.api[a],key:a});c.update=l({method:"PUT",url:b.api[a],key:a});c.remove=l({method:"DELETE",url:b.api[a],formName:"disableForm"});
return c},J=function(a){return function(b,c,d,e,f,g){return l({method:a.method||null,url:a.url||null,key:a.key||null,formName:a.formName||null,flash500Error:a.flash500Error})(b,d,e,f,g,c)}},x=function(a,b,c){var d={};d[b]=_.isUndefined(c)?"yes":c;return function(b,c,e,f,g){f=_.extend({},d,f);return a(b,c,e,f,g)}},t=function(a){return x(a,"pickable")},B=l({method:"POST",url:b.api.login,key:"user",formName:"loginForm"}),M={};M.password=l({method:"POST",url:b.api.forgotPassword,formName:"forgotPasswordForm"});
M.password.reset=l({method:"POST",url:b.api.resetPassword,formName:"resetPasswordForm"});M.credentials=l({method:"POST",url:b.api.forgotCredentials,formName:"forgotCredentialsForm"});var Q=l({method:"GET",url:b.api.reportTest,key:"report"}),H=l({method:"GET",url:b.api.companies,isArray:!0,key:"companies"});H.pickable=t(H);H.jump=x(H,"jump");H.full=x(H,"full");H.create=l({method:"POST",url:b.api.companies,key:"company"});H.admin=l({method:"GET",url:b.api.company,key:"company",defaultParams:{shortname:"admin"}});
H.report=l({method:"GET",url:b.api.reportCompanies,key:"report"});var y=l({method:"GET",url:b.api.company,key:"company"});y.update=l({method:"PUT",url:b.api.company,key:"company"});y.remove=l({method:"DELETE",url:b.api.company,formName:"disableForm"});y.styles={};y.styles.update=l({method:"PUT",url:b.api.companyStyles,key:"styles",formName:"companyStylesForm"});y.adminNotes={};y.adminNotes.update=l({method:"PUT",url:b.api.companyAdminNotes,key:"adminNotes",formName:"companyAdminNotesForm"});y.accounts=
l({method:"GET",url:b.api.companyAccounts,isArray:!0,key:"accounts"});y.accounts.report=l({method:"GET",url:b.api.reportAccounts,key:"report"});y.nags={};y.nags.update=l({method:"PUT",url:b.api.companyNags,key:"companyNags",formName:"companyNagsForm"});y.companyFeatures={};y.companyFeatures.update=l({method:"PUT",url:b.api.companyFeatures,key:"companyFeatures",formName:"companyFeaturesForm"});y.refundReserve={};y.refundReserve.update=l({method:"PUT",url:b.api.refundReserve,key:"companyFeatures",formName:"refundReserveForm"});
y.itemColorsFeature={};y.itemColorsFeature.update=l({method:"PUT",url:b.api.companyItemColorsFeature,key:"companyItemColorsFeature",formName:"companyItemColorsFeatureForm"});y.contactInformation={};y.contactInformation.update=l({method:"PUT",url:b.api.companyContactInformation,key:"contactInformation",formName:"companyContactInformationForm"});y.processorAccount={};y.processorAccount.create=l({method:"POST",url:b.api.processorAccount,key:"processorAccount"});y.tosAcceptance={};y.tosAcceptance.update=
l({method:"PUT",url:b.api.companyTosAcceptance,key:"tosAcceptance",formName:"companyTosAcceptanceForm"});y.processorOnboard={};y.processorOnboard.update=l({method:"PUT",url:b.api.processorOnboard,key:"processorOnboard",formName:"processorOnboardForm"});y.escrowReport=l({method:"GET",url:b.api.reportEscrow,key:"report"});y.profile={};y.profile.update=l({method:"PUT",url:b.api.companyProfile,key:"profile",formName:"companyProfileForm"});y.payments={};y.payments.update=l({method:"PUT",url:b.api.companyPayments,
key:"payments",formName:"companyPaymentsForm"});y.manifestSettings={};y.manifestSettings.update=l({method:"PUT",url:b.api.companyManifestSettings,key:"manifestSettings",formName:"manifestSettingsForm"});y.images=l({method:"GET",url:b.api.companyImages,key:"images",isArray:!0});y.images.create=l({method:"POST",url:b.api.companyImages,key:"image"});y.image={};y.image.update=l({method:"PUT",url:b.api.companyImage,key:"image"});y.image.remove=l({method:"DELETE",url:b.api.companyImage});y.activities={};
y.activities.all=l({method:"GET",url:b.api.allActivities,isArray:!0,key:"activities"});y.activities.system=l({method:"GET",url:b.api.systemActivities,isArray:!0,key:"activities"});y.activities.admin=x(y.activities.system,"admin");y.calendar=l({method:"GET",url:b.api.companyCalendar,key:"calendar"});y.summaryReport={};y.summaryReport.items=l({method:"GET",url:b.api.reportItemsSummary,key:"report"});y.summaryReport.users=l({method:"GET",url:b.api.reportUsersSummary,key:"report"});y.summaryReport.bookingTypes=
l({method:"GET",url:b.api.reportBookingTypesSummary,key:"report"});y.summaryReport.customerTypes=l({method:"GET",url:b.api.reportCustomerTypesSummary,key:"report"});y.summaryReport.customField=l({method:"GET",url:b.api.reportCustomFieldSummary,key:"report"});y.summaryReport.lodgings=l({method:"GET",url:b.api.reportLodgingsSummary,key:"report"});y.summaryReport.pickups=l({method:"GET",url:b.api.reportPickupsSummary,key:"report"});y.summaryReport.crew=l({method:"GET",url:b.api.reportCrewSummary,key:"report"});
y.summaryReport.agents=l({method:"GET",url:b.api.reportAgentsSummary,key:"report"});y.summaryReport.desks=l({method:"GET",url:b.api.reportDesksSummary,key:"report"});y.summaryReport.campaigns=l({method:"GET",url:b.api.reportCampaignsSummary,key:"report"});y.summaryReport.revenue=l({method:"GET",url:b.api.reportRevenueSummary,key:"report"});y.advancedReport=l({method:"POST",url:b.api.reportAdvanced,key:"report"});var E=w("group"),R=u("group");R.duplicate=l({method:"POST",url:b.api.duplicateGroup,key:"group",
formName:"duplicateGroupForm"});R.remove=l({method:"DELETE",url:b.api.group,formName:"disableForm"});var X=w("groupOverride");X.related=l({method:"GET",url:b.api.relatedGroupOverrides,isArray:!0,key:"groupOverrides"});var Y=u("groupOverride");Y.activities=l({method:"GET",url:b.api.groupOverrideActivities,isArray:!0,key:"activities"});var O=w("bankAccount"),fa=u("bankAccount");fa.remove=l({method:"DELETE",url:b.api.bankAccount,key:"bankAccount",formName:"disableForm"});fa.verify=l({method:"PUT",url:b.api.verifyBankAccount,
key:"verifiedBankAccount",formName:"verifyBankAccountForm"});var cb=w("card"),A=u("card");A.remove=l({method:"DELETE",url:b.api.card,key:"disableForm"});var F=l({method:"GET",url:b.api.cardAffiliations,isArray:!0,key:"cardAffiliations"});F.create=l({method:"POST",url:b.api.cardAffiliations,isArray:!0,key:"cardAffiliations",form:"cardAffiliationsForm"});var La=w("customManifest"),Ma=u("customManifest"),G=w("customCalendar"),ra=u("customCalendar"),I=w("customReport"),Na=u("customReport"),ma=l({method:"GET",
url:b.api.users,isArray:!0,key:"users"});ma.pickable=t(ma);ma.all=l({method:"GET",url:b.api.allUsers,isArray:!0,key:"users"});ma.related=l({method:"GET",url:b.api.relatedUsers,isArray:!0,key:"users"});ma.create=l({method:"POST",url:b.api.users,key:"user",formName:"createUserForm"});var V=l({method:"GET",url:b.api.user,key:"user"});V.update=l({method:"PUT",url:b.api.user,key:"user",formName:"updateUserForm"});V.remove=l({method:"DELETE",url:b.api.user});V.activities=l({method:"GET",url:b.api.userActivities,
isArray:!0,key:"activities"});V.subscriptions=l({method:"GET",url:b.api.userSubscriptions,isArray:!0,key:"subscriptions"});V.itemSubscriptions=l({method:"GET",url:b.api.userItemSubscriptions,isArray:!0,key:"subscriptions"});V.itemSubscriptions.update=l({method:"POST",url:b.api.userItemSubscriptions,isArray:!0,key:"subscriptions"});V.overview=l({method:"GET",url:b.api.userOverview,key:"overview"});V.nags={};V.nags.update=l({method:"PUT",url:b.api.userNags,key:"userNags",formName:"userNagsForm"});var L=
w("item");L.pickable=t(L);L.public=x(L,"public");L.all=l({method:"GET",url:b.api.allItems,isArray:!0,key:"items"});L.calendar=l({method:"GET",url:b.api.itemsCalendar,key:"calendar"});var U=u("item");U.pricingOverview=l({method:"GET",url:b.api.itemPricingOverview,key:"pricingOverview"});U.color=l({method:"PUT",url:b.api.itemColor,key:"color",formName:"updateItemColorForm"});U.calendar=l({method:"GET",url:b.api.itemCalendar,key:"calendar"});U.duplicate=l({method:"POST",url:b.api.duplicateItem,key:"item"});
U.subscriptions=l({method:"GET",url:b.api.itemSubscriptions,isArray:!0,key:"subscriptions"});U.images=l({method:"GET",url:b.api.itemImages,key:"images",isArray:!0});U.images.create=l({method:"POST",url:b.api.itemImages,key:"image"});U.image={};U.image.update=l({method:"PUT",url:b.api.itemImage,key:"image"});U.image.remove=l({method:"DELETE",url:b.api.itemImage});U.reviewExpressSettings={};U.reviewExpressSettings.update=l({method:"PUT",url:b.api.reviewExpressSettings,key:"reviewExpressSettings",form:"reviewExpressSettingsForm"});
U.picthriveSettings={};U.picthriveSettings.update=l({method:"PUT",url:b.api.picthriveSettings,key:"picthriveSettings",formName:"picthriveSettingsForm"});U.ratings=l({method:"GET",url:b.api.itemRatings,key:"ratings"});U.flowPages=l({method:"GET",isArray:!0,url:b.api.itemFlowPages,key:"flowNodes"});U.flowPages.full=x(U.flowPages,"full");U.futureAvailabilityCount=l({method:"GET",url:b.api.futureAvailabilityCount,key:"futureAvailabilityCount"});U.isQueued=l({method:"GET",url:b.api.isItemQueued,key:"queuedStatus"});
var Z=u("flowNode"),S=function(){return k.get("flows").wrapEndpoint(Z).apply(null,arguments)};S.update=Z.update;S.remove=Z.remove;var Oa=l({method:"GET",url:b.api.defaultFlowPage,key:"defaultFlowPage"});S.withDescendants=x(l({method:"GET",url:b.api.flowNode,key:"flowNode",ignoreQueryParamsInCacheUri:!0}),"descendants");S.duplicate=l({method:"POST",url:b.api.duplicateFlowNode,key:"flowNode"});var da=w("flowNode");da.multi=l({method:"POST",url:b.api.flowNodes,isArray:!0,key:"flowNodes",formName:"flowNodeForm"});
da.root=x(da,"root");da.root.create=x(da.create,"root");da.pages=x(da,"pages");var ca=l({method:"GET",url:b.api.affiliates,isArray:!0,key:"affiliations"});ca.all=l({method:"GET",url:b.api.allAffiliates,isArray:!0,key:"affiliations"});ca.pickable=t(ca);ca.create=l({method:"POST",url:b.api.affiliates,key:"affiliation",formName:"createAffiliationForm"});var ia=l({method:"GET",url:b.api.affiliate,key:"affiliation"});ia.update=l({method:"PUT",url:b.api.affiliate,key:"affiliation",formName:"updateAffiliationForm"});
ia.remove=l({method:"DELETE",url:b.api.affiliate,formName:"disableForm"});var ta=l({method:"GET",url:b.api.affiliateCards,key:"cards",isArray:!0,flashError:!1}),K=l({method:"GET",url:b.api.affiliateCardAffiliations,key:"cardAffiliations",isArray:!0,flashError:!1}),ja=l({method:"GET",url:b.api.partners,isArray:!0,key:"affiliations"});ja.all=x(ja,"all");ja.pickable=t(ja);ja.minimal=x(ja,"minimal");var Ta=l({method:"GET",url:b.api.partner,key:"partner"});Ta.remove=l({method:"DELETE",url:b.api.partner,
formName:"disableForm"});var eb=l({method:"GET",url:b.api.partnerCards,key:"cards",isArray:!0,flashError:!1}),fb=l({method:"GET",url:b.api.partnerCardAffiliations,key:"cardAffiliations",isArray:!0,flashError:!1}),Ga=w("agent");Ga.all=l({method:"GET",url:b.api.allAgents,isArray:!0,key:"agents"});var ea=u("agent"),Ua=w("desk");Ua.all=l({method:"GET",url:b.api.allDesks,isArray:!0,key:"desks"});var gb=u("desk"),ka=w("hotel"),hb=u("hotel"),Va=w("lodging");Va.duplicate=l({method:"POST",url:b.api.duplicateLodgingsAcrossCompanies,
formName:"duplicateLodgingsAcrossCompaniesForm",key:"lodgings",isArray:!0});var ib=u("lodging"),na=w("preferredPickup"),ua=u("preferredPickup"),ga=w("pickup");ga.duplicate=l({method:"POST",url:b.api.duplicatePickupsAcrossCompanies,formName:"duplicatePickupsAcrossCompaniesForm",key:"pickups",isArray:!0});var Sa=u("pickup"),Ba=w("route");Ba.pickable=t(Ba);Ba.duplicate=l({method:"POST",url:b.api.duplicateRoutesAcrossCompanies,formName:"duplicateRoutesAcrossCompaniesForm",key:"routes",isArray:!0});var pa=
l({method:"GET",url:b.api.route,key:"route",ignoreQueryParamsInCacheUri:!0});pa.update=l({method:"PUT",url:b.api.route,key:"route"});pa.remove=l({method:"DELETE",url:b.api.route,formName:"disableForm"});pa.items=l({method:"GET",url:b.api.routeItems,isArray:!0,key:"items"});pa.duplicate=l({method:"POST",url:b.api.duplicateRoute,key:"route",formName:"duplicateRouteForm"});var oa=w("stop"),sa=u("stop"),P={};P.searchByDate=l({method:"GET",url:b.api.searchRunsByDate,isArray:!0,key:"runs"});P.manifest=
l({method:"GET",url:b.api.runsManifest,isArray:!0,key:"runs"});var Ha=l({method:"GET",url:b.api.campaigns,isArray:!0,key:"campaigns"});Ha.create=l({method:"POST",url:b.api.campaigns,key:"campaign"});var Pa=l({method:"GET",url:b.api.campaign,key:"campaign"});Pa.update=l({method:"PUT",url:b.api.campaign,key:"campaign"});Pa.remove=l({method:"DELETE",url:b.api.campaign,formName:"disableForm"});Pa.customFields=l({method:"GET",url:b.api.campaignCustomFields,isArray:!0,key:"customFields"});var Mb=l({method:"GET",
url:b.api.campaignValidityRules,isArray:!0,key:"campaignValidityRules"});Mb.create=l({method:"POST",url:b.api.campaignValidityRules,key:"campaignValidityRule",formName:"createCampaignValidityRuleForm"});var Nb=l({method:"GET",url:b.api.campaignValidityRule,key:"campaignValidityRule"});Nb.remove=l({method:"DELETE",url:b.api.campaignValidityRule,formName:"disableForm"});var Qa=l({method:"GET",url:b.api.codes,isArray:!0,key:"codes"});Qa.create=l({method:"POST",url:b.api.codes,key:"codes",isArray:!0,
formName:"createCodesForm"});Qa.byTag={};Qa.byTag.clear=l({method:"DELETE",url:b.api.codesByTag});var db=l({method:"GET",url:b.api.code,key:"code"});db.update=l({method:"PUT",url:b.api.code,key:"code",formName:"updateCodeForm"});db.remove=l({method:"DELETE",url:b.api.code});var Oc=w("storedValueType"),Pc=u("storedValueType"),Ra=l({method:"GET",url:b.api.storedValueCards,isArray:!0,key:"storedValueCards"});Ra.create=l({method:"POST",url:b.api.storedValueCards,key:"storedValueCards",isArray:!0,formName:"createStoredValueCardsForm"});
Ra.issue=l({method:"POST",url:b.api.issueStoredValueCard,key:"storedValueCard",formName:"issueStoredValueCardForm"});Ra.search=l({method:"GET",url:b.api.searchStoredValueCardsByNumber,key:"searchResult"});var Wa=u("storedValueCard");Wa.payments=l({method:"GET",url:b.api.storedValueCardPayments,isArray:!0,key:"payments"});Wa.notifications={};Wa.notifications.create=l({method:"POST",url:b.api.storedValueCardNotifications,isArray:!0,key:"notifications",formName:"storedValueCardNotificationForm"});var Qc=
w("storedValueAdjustment"),jb=u("storedValueAdjustment");delete jb.update;delete jb.remove;var Rc=w("resellerCompany","resellerCompanies"),Sc=u("resellerCompany"),Tc=w("resellerCompanyMapping"),Uc=u("resellerCompanyMapping"),Vc=w("resellerItem"),Wc=u("resellerItem"),Xc=w("resellerItemMapping"),Yc=u("resellerItemMapping"),Zc=w("resellerCustomerType"),$c=u("resellerCustomerType"),ad=w("resellerCustomerTypeMapping"),bd=u("resellerCustomerTypeMapping"),cd=w("resellerOption"),dd=u("resellerOption"),ed=
w("resellerOptionMapping"),fd=u("resellerOptionMapping"),gd=l({method:"GET",url:b.api.resellerUnmappedItems,isArray:!0,key:"items"}),hd=l({method:"GET",url:b.api.resellerUnmappedCustomerPrototypes,isArray:!0,key:"customerPrototypes"}),id=w("resellerKey"),jd=u("resellerKey"),kd=w("resellerApp"),ld=u("resellerApp"),kb=w("resellerAppRequest"),md=u("resellerAppRequest");kb.refresh=x(kb,"refresh");var nd=w("resellerAppCompany","resellerAppCompanies"),od=u("resellerAppCompany"),Ia=l({method:"GET",url:b.api.customFields,
isArray:!0,key:"customFields"});Ia.includeArchived=x(Ia,"include-archived");Ia.all=l({method:"GET",url:b.api.allCustomFields,isArray:!0,key:"customFields"});Ia.create=l({method:"POST",url:b.api.customFields,key:"customField",formName:"createCustomFieldForm"});var Ca=l({method:"GET",url:b.api.customField,key:"customField"});Ca.items=l({method:"GET",url:b.api.customFieldItems,key:"items",isArray:!0});Ca.duplicate=l({method:"POST",url:b.api.duplicateCustomField,key:"customField",formName:"duplicateCustomFieldForm"});
Ca.prevalidate=l({method:"POST",url:b.api.prevalidateCustomField,key:"prevalidity",formName:"prevalidateCustomFieldForm",flashError:!1});Ca.update=l({method:"PUT",url:b.api.customField,key:"customField",formName:"updateCustomFieldForm"});Ca.remove=l({method:"DELETE",url:b.api.customField,formName:"disableForm"});var Pb={};Pb.create=l({method:"POST",url:b.api.transportationOptions,key:"transportationOption"});var lb={};lb.update=l({method:"PUT",url:b.api.transportationOption,key:"transportationOption"});
lb.remove=l({method:"DELETE",url:b.api.transportationOption});var Qb={};Qb.create=l({method:"POST",url:b.api.extendedOptions,key:"extendedOption",formName:"createExtendedOptionForm"});var mb={};mb.update=l({method:"PUT",url:b.api.extendedOption,key:"extendedOption",formName:"updateExtendedOptionForm"});mb.remove=l({method:"DELETE",url:b.api.extendedOption,key:"extendedOption",formName:"disableForm"});var Rb={};Rb.create=l({method:"POST",url:b.api.connectedCampaigns,key:"connectedCampaign",formName:"createConnectedCampaignForm"});
var Sb={};Sb.remove=l({method:"DELETE",url:b.api.connectedCampaign});var Tb={};Tb.create=l({method:"POST",url:b.api.generatingCampaigns,key:"generatingCampaign",formName:"generatingCampaignForm"});var nb={};nb.update=l({method:"PUT",url:b.api.generatingCampaign,key:"generatingCampaign",formName:"generatingCampaignForm"});nb.remove=l({method:"DELETE",url:b.api.generatingCampaign});var ob=u("customFieldInstanceGroup"),Ub=w("customFieldInstanceGroup");Ub.multi=l({method:"POST",url:b.api.customFieldInstanceGroupsMulti,
isArray:!0,key:"customFieldInstanceGroups",formName:"customFieldInstanceGroupsForm"});ob.remove=l({method:"DELETE",url:b.api.customFieldInstanceGroup,key:"customFieldInstanceGroup",formName:"disableForm"});ob.duplicate=l({method:"POST",url:b.api.duplicateCustomFieldInstanceGroup,key:"customFieldInstanceGroup",formName:"duplicateForm"});var pd=u("customFieldInstance"),Vb=w("customFieldInstance");Vb.multi=l({method:"POST",url:b.api.customFieldInstancesMulti,isArray:!0,key:"customFieldInstances",formName:"customFieldInstancesForm"});
var qd=u("customFieldInstanceCondition"),rd=w("customFieldInstanceCondition"),sd=u("supportedLanguage"),td=w("supportedLanguage"),ud=l({method:"GET",url:b.api.translations,key:"translations"}),vd=l({method:"GET",url:b.api.translationsForModel,key:"translationsForModel",isArray:!0}),Wb=l({method:"GET",url:b.api.translationsForField,key:"translationsAndSourceField"});Wb.update=l({method:"POST",url:b.api.translationsForField,key:"updatedTranslations",formName:"translationsForFieldForm",isArray:!0});
var wd=l({method:"GET",url:b.api.understoodLanguages,key:"understoodLanguages"}),Xb=l({method:"GET",url:b.api.translationsForSubfield,key:"translationsAndSourceField"});Xb.update=l({method:"POST",url:b.api.translationsForSubfield,key:"updatedTranslations",formName:"translationsForFieldForm",isArray:!0});var Yb=l({method:"GET",url:b.api.roles,isArray:!0,key:"roles"});Yb.create=l({method:"POST",url:b.api.roles,key:"role"});var pb=l({method:"GET",url:b.api.role,key:"role"});pb.update=l({method:"PUT",
url:b.api.role,key:"role"});pb.remove=l({method:"DELETE",url:b.api.role});var Zb=l({method:"GET",url:b.api.crewMembers,isArray:!0,key:"crewMembers"});Zb.create=l({method:"POST",url:b.api.crewMembers,key:"crewMember"});var qb=l({method:"GET",url:b.api.crewMember,key:"crewMember"});qb.update=l({method:"PUT",url:b.api.crewMember,key:"crewMember"});qb.remove=l({method:"DELETE",url:b.api.crewMember,key:"crewMember"});var $b=u("customerType");$b.items=l({method:"GET",url:b.api.customerTypeItems,key:"items",
isArray:!0});var Xa=w("customerType");Xa.includeArchived=x(Xa,"include-archived");Xa.all=l({method:"GET",url:b.api.allCustomerTypes,isArray:!0,key:"customerTypes"});var ac=u("customerPrototype");ac.duplicate=l({method:"POST",url:b.api.duplicateCustomerPrototype,key:"customerPrototype",formName:"duplicateForm"});var rb=w("customerPrototype");rb.all=l({method:"GET",url:b.api.allCustomerPrototypes,isArray:!0,key:"customerPrototypes"});rb.multi=l({method:"POST",url:b.api.customerPrototypesMulti,isArray:!0,
key:"customerPrototypes",formName:"customerPrototypesForm"});var bc=u("checkinStatus","checkinStatuses"),xd=w("checkinStatus","checkinStatuses");bc.updateBookings=l({method:"PUT",url:b.api.checkinStatusForBookings,key:"bookings",isArray:!0,formName:"updateCheckinStatusForBookingsForm"});var yd=w("cannedMessage"),sb=u("cannedMessage");sb.items=l({method:"GET",url:b.api.cannedMessageItems,key:"items",isArray:!0});sb.availabilityHeadlines=l({method:"GET",url:b.api.cannedMessageAvailabilityHeadlines,
key:"availabilityHeadlines",isArray:!0});var zd=w("availabilityHeadline"),cc=u("availabilityHeadline");cc.items=l({method:"GET",url:b.api.availabilityHeadlineItems,key:"items",isArray:!0});var aa={};aa.next=l({method:"GET",url:b.api.nextAvailability,key:"availability"});aa.update=l({method:"POST",url:b.api.updateAvailabilities,formName:"updateAvailabilitiesForm",key:"updateAvailabilities"});aa.updateByItem=l({method:"POST",url:b.api.updateItemAvailabilities,formName:"updateAvailabilitiesForm",key:"updateAvailabilities"});
aa.byDate=l({method:"GET",url:b.api.availabilitiesByDate,isArray:!0,key:"availabilities"});aa.byTag={};aa.byTag.clear=l({method:"DELETE",url:b.api.availabilitiesByTag,formName:"disableForm"});aa.futureCount=l({method:"GET",url:b.api.futureAvailabilityCount,key:"futureAvailabilityCount"});aa.searchByDate=l({method:"GET",url:b.api.searchAvailabilitiesByDate,isArray:!0,key:"availabilities",sideKeys:["nextBookableStartAt"]});aa.searchAllByDate=l({method:"GET",url:b.api.searchAllAvailabilitiesByDate,isArray:!0,
key:"availabilities",sideKeys:["nextBookableStartAt"]});aa.searchByPk=l({method:"GET",url:b.api.searchAvailabilitiesByPk,isArray:!0,key:"availabilities"});aa.manifest=l({method:"GET",url:b.api.availabilitiesManifest,isArray:!0,key:"availabilities",sideKeys:["bookings","bookingCounts","crewMembers"]});aa.manifestSelectable=l({method:"GET",url:b.api.manifestSelectableAvailabilities,isArray:!0,key:"availabilities"});aa.searchByUpcoming=l({method:"GET",url:b.api.searchAvailabilitiesByUpcoming,isArray:!0,
key:"availabilities"});aa.rule=l({method:"POST",url:b.api.rule,key:"createdAvailabilities",formName:"ruleForm"});aa.withResourceRequirements=l({method:"GET",url:b.api.availabilitiesWithResourceRequirements,key:"availabilities",isArray:!0});var ba=l({method:"GET",url:b.api.availability,key:"availability"});ba.update=l({method:"PUT",url:b.api.availability,key:"availability",formName:"updateAvailabilityForm"});ba.status={};ba.status.update=l({method:"PUT",url:b.api.availabilityStatus,key:"availabilityStatus",
formName:"updateAvailabilityStatusForm"});ba.book=J({method:"POST",url:b.api.book,key:"booking",formName:"bookForm"});ba.liveCapacity=l({method:"GET",url:b.api.availabilityLiveCapacity,key:"liveCapacity",formName:"liveCapacityForm"});ba.resourceUses=l({method:"GET",url:b.api.availabilityResourceUses,key:"resourceUses",isArray:!0});ba.remove=l({method:"DELETE",url:b.api.availability,formName:"disableForm"});ba.notifications=l({method:"POST",url:b.api.notifications,formName:"notificationsForm"});ba.note=
{};ba.note=l({method:"PUT",url:b.api.availabilityNote,key:"note",formName:"updateAvailabilityNoteForm"});ba.smsNotifications={};ba.smsNotifications.create=l({method:"POST",url:b.api.smsNotifications,formName:"smsNotificationsForm"});ba.checkinStatuses=l({method:"GET",url:b.api.availabilityCheckinStatuses,isArray:!0,key:"bookings"});ba.seatRequirements=l({method:"GET",url:b.api.seatRequirements,isArray:!0,key:"requirements"});var dc={};dc.create=l({method:"POST",url:b.api.customerTypeRates,key:"customerTypeRate"});
var tb={};tb.remove=l({method:"DELETE",url:b.api.customerTypeRate,formName:"disableForm"});tb.update=l({method:"PUT",url:b.api.customerTypeRate,key:"customerTypeRate"});var Ad=w("block"),Bd=u("block"),Ya={};Ya.availability=l({method:"GET",url:b.api.subjectsAvailability,key:"subjects"});Ya.booking=l({method:"GET",url:b.api.subjectsBooking,key:"subjects"});Ya.order=l({method:"GET",url:b.api.subjectsOrder,key:"subjects"});var ub=u("contact");ub.bookings={};ub.bookings.update=l({method:"PUT",url:b.api.contactBookings,
key:"modified"});var ec={};ec.report=l({method:"GET",url:b.api.reportContacts,key:"report"});var Cd=l({method:"GET",url:b.api.contactPayments,isArray:!0,key:"payments"}),Ja=l({method:"GET",url:b.api.order,key:"order",sideKeys:["customersWithSeatAssignments"]}),Dd=l({method:"GET",url:b.api.order,key:"order",ignoreQueryParamsInCacheUri:!0});Ja.wait=x(Dd,"wait");Ja.notification=l({method:"POST",url:b.api.orderNotification,formName:"orderNotificationForm"});Ja.cancel=l({method:"POST",url:b.api.orderCancellation,
key:"order",formName:"cancelOrderBookingsForm"});Ja.customersWithSeatAssignments=l({method:"GET",url:b.api.orderCustomersWithSeatAssignments,key:"customersWithSeatAssignments"});var fc={};fc.create=J({method:"POST",url:b.api.orders,key:"order",formName:"orderForm"});var vb=l({method:"GET",url:b.api.orderPayments,isArray:!0,key:"payments"});vb.create=l({method:"POST",url:b.api.orderPayments,key:"payments"});vb.refund=l({method:"POST",url:b.api.orderRefunds,isArray:!0,key:"payments"});var qa=l({method:"GET",
url:b.api.bookings,isArray:!0,key:"bookings"});qa.byContact=l({method:"GET",url:b.api.bookingsByContact,isArray:!0,key:"bookings"});qa.searchByQuery=l({method:"GET",url:b.api.searchBookingsByQuery,isArray:!0,key:"bookings"});qa.searchByNew=l({method:"GET",url:b.api.searchBookingsByNew,isArray:!0,key:"bookings"});qa.report=l({method:"GET",url:b.api.reportBookings,key:"report"});qa.invoiceableReport=l({method:"GET",url:b.api.reportInvoiceableBookings,key:"report"});qa.manifest=l({method:"GET",url:b.api.bookingsManifest,
isArray:!0,key:"bookings"});qa.searchByUuid=l({method:"GET",url:b.api.searchBookingsByUuid,isArray:!0,key:"bookings"});var W=l({method:"GET",url:b.api.booking,key:"booking",sideKeys:["customersWithSeatAssignments"]});W.customersWithSeatAssignments=l({method:"GET",url:b.api.bookingCustomersWithSeatAssignments,key:"customersWithSeatAssignments"});var Ed=l({method:"GET",url:b.api.booking,key:"booking",ignoreQueryParamsInCacheUri:!0});W.wait=x(Ed,"wait");W.byPk=l({method:"GET",url:b.api.bookingByPk,key:"booking",
ignoreCache:!0});W.reprice=l({method:"PUT",url:b.api.repriceBooking,key:"repricing",formName:"repriceBookingForm"});W.notification=l({method:"POST",url:b.api.notification,formName:"notificationForm"});W.smsNotification=l({method:"POST",url:b.api.smsNotification,formName:"smsNotificationForm"});W.cancel=l({method:"DELETE",url:b.api.booking,key:"booking",formName:"cancelBookingForm"});W.note={};W.note.update=l({method:"PUT",url:b.api.bookingNote,key:"note",formName:"updateBookingNoteForm"});W.explicitGross=
{};W.explicitGross.update=l({method:"PUT",url:b.api.bookingExplicitGross,key:"explicitGross",formName:"updateBookingExplicitGrossForm"});W.explicitInvoicePrice={};W.explicitInvoicePrice.update=l({method:"PUT",url:b.api.bookingExplicitInvoicePrice,key:"explicitInvoicePrice",formName:"updateBookingExplicitInvoicePriceForm"});W.notificationOptions={};W.notificationOptions.update=l({method:"PUT",url:b.api.bookingNotificationOptions,key:"notificationOptions",formName:"updateBookingNotificationOptionsForm"});
W.affiliation={};W.affiliation.update=l({method:"PUT",url:b.api.affiliation,key:"affiliation"});W.checkinStatus={};W.checkinStatus.update=l({method:"PUT",url:b.api.bookingCheckinStatus,key:"bookingCheckinStatus",formName:"updateBookingCheckinStatusForm"});W.effectiveCancellationRule=l({method:"GET",url:b.api.bookingEffectiveCancellationRule,key:"cancellationRule"});var gc={checkinStatus:{}};gc.checkinStatus.update=l({method:"PUT",url:b.api.customerCheckinStatus,key:"customerCheckinStatus",formName:"updateCustomerCheckinStatusForm"});
var wb={};wb.find=l({method:"GET",url:b.api.searchCustomersByEncodedPk,key:"booking"});wb.withSeats=l({method:"GET",url:b.api.customersWithSeats,isArray:!0,key:"customers"});var hc={};hc.update=l({method:"PUT",url:b.api.bookingCustomFieldValue,key:"customFieldValue"});var ic={};ic.update=l({method:"PUT",url:b.api.customerCustomFieldValue,key:"customFieldValue"});var la=w("report");la.recent=l({method:"GET",url:b.api.recentReports,key:"reports",isArray:!0});la.inProgress=l({method:"GET",url:b.api.inProgressReports,
key:"reports",isArray:!0});la.volumeOverview=l({method:"GET",url:b.api.volumeOverviewReport,key:"volume"});la.dailyVolumeOverview=l({method:"GET",url:b.api.dailyVolumeOverviewReport,key:"dailyVolume"});la.paymentOverview=l({method:"GET",url:b.api.paymentOverviewReport,key:"paymentOverview"});la.itemsSummaryOverview=l({method:"GET",url:b.api.itemsSummaryOverviewReport,key:"itemsSummary"});la.nextPayoutOverview=l({method:"GET",url:b.api.nextPayoutOverviewReport,key:"nextPayouts",isArray:!0});la.report=
l({method:"GET",url:b.api.reportReports,key:"report"});var va=u("report");va.rerun=va.update;delete va.update;va.cancel=l({method:"DELETE",url:b.api.report,formName:"disableForm",key:"report"});delete va.remove;va.objects=l({method:"POST",url:b.api.reportObjects,key:"objects",isArray:!1});var xb=w("invoice");xb.report=l({method:"GET",url:b.api.reportInvoices,key:"report"});xb.partnerInvoice=l({method:"GET",url:b.api.partnerInvoice,key:"invoice"});var Da=u("invoice");Da.uploads=l({method:"GET",url:b.api.invoiceUploads,
isArray:!0,key:"uploads"});Da.uploads.create=l({method:"POST",url:b.api.invoiceUploads,key:"upload"});Da.notifications={};Da.notifications.create=l({method:"POST",url:b.api.invoiceNotifications,isArray:!0,key:"notifications",formName:"invoiceNotificationForm"});Da.uuid=l({method:"GET",url:b.api.uuidInvoice,key:"invoice"});var yb={};yb.create=l({method:"POST",url:b.api.lineItems,key:"lineItem"});yb.report=l({method:"GET",url:b.api.reportLineItems,key:"report"});var zb=l({method:"GET",url:b.api.lineItem,
key:"lineItem"});zb.remove=l({method:"DELETE",url:b.api.lineItem});zb.update=l({method:"PUT",url:b.api.lineItem,key:"lineItem"});var Fd=w("tagGroup"),Gd=u("tagGroup"),jc={};jc.create=l({method:"POST",url:b.api.tags,key:"tag"});var Ab={};Ab.update=l({method:"PUT",url:b.api.tag,key:"tag"});Ab.remove=l({method:"DELETE",url:b.api.tag,formName:"disableForm"});var kc=l({method:"GET",url:b.api.objectTags,key:"objectTags",isArray:!0});kc.update=l({method:"PUT",url:b.api.objectTags,key:"objectTags",isArray:!0});
var Ea=l({method:"GET",url:b.api.payments,isArray:!0,key:"payments"});Ea.related=l({method:"GET",url:b.api.relatedPayments,isArray:!0,key:"payments"});Ea.create=l({method:"POST",url:b.api.payments,key:"payment"});Ea.refund=l({method:"POST",url:b.api.refunds,isArray:!0,key:"payments"});Ea.report=l({method:"GET",url:b.api.reportPayments,key:"report"});Ea.volumeReport=l({method:"GET",url:b.api.reportVolume,key:"report"});var lc=l({method:"GET",url:b.api.authorizationHolds,isArray:!0,key:"authorizationHolds"});
lc.update=l({method:"PUT",url:b.api.authorizationHolds,isArray:!0,key:"authorizationHolds"});var mc=l({method:"GET",url:b.api.paymentFees,isArray:!0,key:"payments"});mc.update=l({method:"POST",url:b.api.paymentFees,key:"payments"});var nc=w("inStorePaymentType");nc.all=l({method:"GET",url:b.api.allInStorePaymentTypes,isArray:!0,key:"inStorePaymentTypes"});var oc=w("ledger");oc.all=l({method:"GET",url:b.api.allLedgers,isArray:!0,key:"ledgers"});var Hd=u("ledger"),Id=u("inStorePaymentType"),Jd=w("emvDevice"),
wa=u("emvDevice");wa.authenticate=l({method:"POST",url:b.api.retrieveConnectionToken,key:"activation",formName:"retrieve_connection_token_form",flashError:!1,ignoreCache:!0,ignoreInFlight:!0});wa.createInteractionToken=l({method:"POST",url:b.api.createInteractionToken,key:"tokenId",formName:"emv_device_create_payment_intent_form",flashError:!1});wa.checkConnections=l({method:"GET",url:b.api.checkEmvDeviceConnections,key:"connectedDevices",flashError:!1});wa.checkConnection=l({method:"GET",url:b.api.checkEmvDeviceConnection,
key:"connectedDevices"});wa.checkChargeStatus=l({method:"POST",url:b.api.checkEmvChargeStatus,key:"result",flashError:!1,flash500Error:!1});wa.cancelCharge=l({method:"POST",url:b.api.cancelEmvCharge});var pc={custom:{}};pc.custom.create=l({method:"POST",url:b.api.customRefunds,key:"refund",formName:"customRefundForm"});var qc={};qc.report=l({method:"GET",url:b.api.reportDisputes,key:"report"});var rc=l({method:"GET",url:b.api.payouts,isArray:!0,key:"payouts"});rc.report=l({method:"GET",url:b.api.reportPayouts,
key:"report"});var sc=l({method:"GET",url:b.api.payout,key:"payout"});sc.retry=l({method:"PUT",url:b.api.payoutRetry,key:"payoutRetry"});var tc=l({method:"GET",url:b.api.transfers,isArray:!0,key:"transfers"});tc.create=l({method:"POST",url:b.api.transfers,key:"transfer"});var Kd=l({method:"GET",url:b.api.transfer,key:"transfer"}),uc={};uc.create=l({method:"POST",url:b.api.oneTimeTransfer,formName:"transferAndUploadDelegateForm",key:"oneTimeTransfer"});var Ld=l({method:"GET",url:b.api.upcomingRefundReserveAmounts,
key:"upcomingRefundReserveAmounts"}),vc=l({method:"GET",url:b.api.uploads,isArray:!0,key:"uploads"});vc.create=l({method:"POST",url:b.api.uploads,key:"upload"});var Md=l({method:"GET",url:b.api.upload,key:"upload"}),wc=l({method:"GET",url:b.api.funds,isArray:!0,key:"funds"});wc.report=l({method:"GET",url:b.api.reportFunds,key:"report"});var Nd=l({method:"GET",url:b.api.fund,key:"fund"}),xc=l({method:"GET",url:b.api.adjustments,isArray:!0,key:"adjustments"});xc.create=l({method:"POST",url:b.api.adjustments,
key:"adjustment"});var Od=l({method:"GET",url:b.api.adjustment,key:"adjustment"}),yc={};yc.report=l({method:"GET",url:b.api.reportTransactions,key:"report"});var Bb=l({method:"GET",url:b.api.activities,isArray:!0,key:"activities"});Bb.notes={};Bb.notes.create=l({method:"POST",url:b.api.notes,key:"activity",formName:"noteForm"});var zc=l({method:"GET",url:b.api.activity,key:"activity"});zc.update=l({method:"PUT",url:b.api.activity,key:"activity"});var Pd=l({method:"PUT",url:b.api.reorder,key:"reorder"}),
Ac=l({method:"GET",url:b.api.waivers,isArray:!0,key:"waivers"});Ac.create=l({method:"POST",url:b.api.waivers,key:"waiver"});var Cb=l({method:"GET",url:b.api.waiver,key:"waiver"});Cb.update=l({method:"PUT",url:b.api.waiver,key:"waiver"});Cb.remove=l({method:"DELETE",url:b.api.waiver,formName:"disableForm"});var Bc={};Bc.create=l({method:"POST",url:b.api.connectedWaivers,key:"connectedWaiver",formName:"createConnectedWaiverForm"});var Cc={};Cc.remove=l({method:"DELETE",url:b.api.connectedWaiver});var Dc=
{};Dc.remove=l({method:"DELETE",url:b.api.waiverInstance,key:"waiverInstance"});var Ka=w("totalSchedule");Ka.online=x(Ka,"online");Ka.includeArchived=x(Ka,"include-archived");var Db=u("totalSchedule"),Qd=w("totalScheduleEntry","totalScheduleEntries"),Rd=u("totalScheduleEntry"),Sd=w("totalScheduleEntryRule"),Td=u("totalScheduleEntryRule"),Eb=w("invoiceSchedule");Eb.includeArchived=x(Eb,"include-archived");var Fb=u("invoiceSchedule"),Ud=w("invoiceScheduleEntry","invoiceScheduleEntries"),Vd=u("invoiceScheduleEntry"),
Wd=w("invoiceScheduleEntryRule"),Xd=u("invoiceScheduleEntryRule");Db.duplicate=l({method:"POST",url:b.api.duplicateTotalSchedule,key:"totalSchedule",formName:"duplicateTotalScheduleForm"});Db.affiliations=l({method:"GET",isArray:!0,url:b.api.totalScheduleAffiliations,key:"affiliations"});Fb.duplicate=l({method:"POST",url:b.api.duplicateInvoiceSchedule,key:"invoiceSchedule",formName:"duplicateInvoiceScheduleForm"});Fb.affiliations=l({method:"GET",isArray:!0,url:b.api.invoiceScheduleAffiliations,key:"affiliations"});
var Yd=l({method:"GET",url:b.api.effectiveSheets,key:"effectiveSheets"}),Zd=l({method:"GET",url:b.api.affiliationEffectiveSheets,key:"effectiveSheets"}),$d=l({method:"GET",url:b.api.rebookingEffectiveSheets,key:"effectiveSheets"}),ae=l({method:"GET",url:b.api.totalScheduleEffectiveSheet,key:"effectiveSheets"}),be=l({method:"GET",url:b.api.invoiceScheduleEffectiveSheet,key:"effectiveSheets"}),ha=w("totalSheet");ha.all=x(ha,"all");ha.includeArchived=x(ha,"include-archived");ha.nonBase=x(ha,"nonBase");
ha.online=x(ha,"online");ha.bases=x(ha,"bases");var xa=u("totalSheet");xa.duplicate=l({method:"POST",url:b.api.duplicateTotalSheet,key:"totalSheet",formName:"duplicateSheetForm"});xa.pricing=l({method:"GET",url:b.api.totalPricing,key:"effectivePricings",isArray:!0});xa.pricing.update=l({method:"PUT",url:b.api.totalPricing,key:"effectivePricings",isArray:!0,formName:"priceLineForm"});xa.pricing.stack=l({method:"GET",url:b.api.totalStack,key:"lines",isArray:!0});xa.schedules=l({method:"GET",isArray:!0,
url:b.api.totalSheetSchedules,key:"totalSchedules"});xa.affiliations=l({method:"GET",isArray:!0,url:b.api.totalSheetAffiliations,key:"affiliations"});var ya=w("invoiceSheet");ya.all=x(ya,"all");ya.includeArchived=x(ya,"include-archived");ya.nonBase=x(ya,"nonBase");var za=u("invoiceSheet");za.duplicate=l({method:"POST",url:b.api.duplicateInvoiceSheet,key:"invoiceSheet",formName:"duplicateSheetForm"});za.pricing=l({method:"GET",url:b.api.invoicePricing,key:"effectivePricings",isArray:!0});za.pricing.update=
l({method:"PUT",url:b.api.invoicePricing,key:"effectivePricings",isArray:!0,formName:"priceLineForm"});za.pricing.stack=l({method:"GET",url:b.api.invoiceStack,key:"lines",isArray:!0});za.schedules=l({method:"GET",isArray:!0,url:b.api.invoiceSheetSchedules,key:"invoiceSchedules"});za.affiliations=l({method:"GET",isArray:!0,url:b.api.invoiceSheetAffiliations,key:"affiliations"});var Gb={};Gb.channels=l({method:"GET",url:b.pusher.channels,key:"channels",isArray:!0});Gb.members=l({method:"POST",url:b.pusher.members,
key:"channels",isArray:!0});var Hb=w("taxType");Hb.all=x(Hb,"all");var ce=u("taxType"),Ec=u("location");Ec.items=l({method:"GET",url:b.api.locationItems,key:"items",isArray:!0});var Fc=w("location");Fc.createPrimary=l({method:"POST",url:b.api.primaryLocation,key:"location"});var Za=w("resource");Za.includeArchived=x(Za,"include-archived");Za.manifest=l({method:"GET",url:b.api.resourcesManifest,key:"resources",isArray:!0});var $a=u("resource");$a.items=l({method:"GET",url:b.api.resourceItems,key:"items",
isArray:!0});$a.requirementGroups=l({method:"GET",url:b.api.resourceRequirementGroups,key:"requirementGroups",isArray:!0});$a.availabilities=l({method:"GET",url:b.api.resourceAvailabilities,key:"availabilities",isArray:!0});var Fa={};Fa.byDate=l({method:"GET",url:b.api.resourceUsesByDate,key:"resourceUses",isArray:!0});Fa.calendar=l({method:"GET",url:b.api.resourceUsesCalendar,key:"calendar"});Fa.unassignSeats=l({method:"PUT",url:b.api.resourceUsesUnassignSeats,isArray:!0,key:"resourceUses",formName:"unassignSeatsForm"});
Fa.reapplyResourceUses=l({method:"POST",url:b.api.reapplyResourceUses,isArray:!0,key:"resourceUses",sideKeys:["unsatisfiableResources","bookings"],formName:"reapplyResourceUsesForm"});Fa.reapplyResourceUsesPoll=l({method:"GET",url:b.api.reapplyResourceUses,key:"taskState",sideKeys:["bookings","resourceUses"]});var Ib=l({method:"GET",url:b.api.itemRequirementGroups,isArray:!0,key:"requirementGroups"});Ib.create=l({method:"POST",url:b.api.itemRequirementGroups,key:"requirementGroup"});var Gc=w("requirementGroup"),
Jb=u("requirementGroup");Jb.duplicate=l({method:"POST",url:b.api.duplicateRequirementGroup,key:"requirementGroup",formName:"duplicateRequirementGroupForm"});Jb.items=l({method:"GET",url:b.api.requirementGroupItems,isArray:!0,key:"items"});var de=w("requirement"),ee=u("requirement"),fe=w("resourceRequirement"),Hc=u("resourceRequirement");Hc.update=l({method:"PUT",url:b.api.resourceRequirement,key:"resourceRequirement",sideKeys:["newResourceRequirement"]});var Ic=u("resourceUse");Ic.update=l({method:"PUT",
url:b.api.resourceUse,key:"resourceUse",sideKeys:["customer"],formName:"resourceUseForm",flashError:!1});var ab=l({method:"GET",url:b.api.resourceOverride,key:"resourceOverride"});ab.update=l({method:"PUT",url:b.api.resourceOverride,key:"resourceOverride",formName:"resourceOverrideForm"});ab.remove=l({method:"DELETE",url:b.api.resourceOverride,formName:"disableForm"});ab.rule=l({method:"POST",url:b.api.resourceOverrideRule,isArray:!0,key:"resourceOverrides",formName:"resourceOverrideRuleForm"});var bb=
{byTag:{}};bb.byTag.clear=l({method:"DELETE",url:b.api.resourceOverridesByTag,formName:"disableForm"});bb.byDate=l({method:"GET",url:b.api.resourceOverridesByDate,key:"resourceOverrides",isArray:!0});bb.forSeat=l({method:"POST",url:b.api.seatResourceOverrides,key:"resourceOverrides",isArray:!0,formName:"seatResourceOverridesForm"});var ge=w("seatMap"),Aa=u("seatMap");Aa.duplicate=l({method:"POST",url:b.api.duplicateSeatMap,key:"seatMap",formName:"duplicateSeatMapForm"});Aa.update=l({method:"PUT",
url:b.api.seatMap,key:"seatMap"});Aa.full=x(l({method:"GET",url:b.api.seatMap,key:"seatMap",sideKeys:["seatZones","seatGroups"],ignoreQueryParamsInCacheUri:!0}),"full");Aa.resourceUsesBySeat=l({method:"GET",url:b.api.seatMapResourceUsesBySeat,key:"resourceUsesBySeat",ignoreCache:!0});Aa.resourceOverridesBySeat=l({method:"GET",url:b.api.seatMapResourceOverridesBySeat,key:"resourceOverridesBySeat",sideKeys:["resourceOverrides"],ignoreCache:!0});Aa.resources=l({method:"GET",url:b.api.seatMapResources,
key:"resources",isArray:!0});var he=w("seatGroup"),ie=u("seatGroup"),je=w("seatZone"),ke=u("seatZone"),le=w("ticketLayout"),me=u("ticketLayout"),ne=w("analyticsService"),oe=u("analyticsService"),pe=w("cancellationPolicy","cancellationPolicies"),Kb=u("cancellationPolicy"),qe=w("cancellationRule"),re=u("cancellationRule");Kb.affiliations=l({method:"GET",isArray:!0,url:b.api.cancellationPolicyAffiliations,key:"affiliations"});Kb.items=l({method:"GET",isArray:!0,url:b.api.cancellationPolicyItems,key:"items"});
var se=w("bookingRestriction"),Jc=u("bookingRestriction");Jc.items=l({method:"GET",isArray:!0,url:b.api.bookingRestrictionItems,key:"items"});var Kc=l({method:"GET",isArray:!0,url:b.api.persistentStore,key:"persistentStores"});Kc.remove=l({method:"DELETE",url:b.api.persistentStore});var Lc=l({method:"GET",url:b.api.persistentStoreForCompany,key:"persistentStore"});Lc.remove=l({method:"DELETE",url:b.api.persistentStoreForCompany});var Lb=l({method:"GET",url:b.api.persistentStoreItem,key:"value"});
Lb.update=l({method:"PUT",url:b.api.persistentStoreItem,key:"value",formName:"persistentStoreForm"});Lb.remove=l({method:"DELETE",url:b.api.persistentStoreItem});var te=l({method:"GET",url:b.api.taskResult,key:"taskResult"}),ue=J({method:"POST",url:b.api.token,key:"tokens",flash500Error:!1}),ve=l({method:"GET",formName:"noForm",key:function(a){return _.keys(a.data)[0]}}),we=l({method:"GET",url:b.api.view,key:"view"}),xe=l({method:"GET",url:b.api.version,key:"version"}),Mc=function(a,b){return encodeURIComponent(a).replace(/%40/gi,
"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%2F/gi,"/").replace(/%20/g,b?"%20":"+")},Nc=function(a,b){b=_.isBoolean(b)?b?"yes":"no":b;return Mc(a,!0)+"="+Mc(b,!0)},Ob=function(a){var b=[];_.forEach(a,function(a,c){_.isArray(a)?_.forEach(a,function(a){b.push(Nc(c,a))}):b.push(Nc(c,a))});return b.join("&")};return{CANCELLED:z,toKeyValue:Ob,login:B,forgot:M,companies:H,company:y,users:ma,user:V,groups:E,group:R,groupOverrides:X,groupOverride:Y,contacts:ec,contact:ub,contactPayments:Cd,
customManifests:La,customManifest:Ma,customCalendars:G,customCalendar:ra,customReports:I,customReport:Na,items:L,item:U,flowNodes:da,flowNode:S,defaultFlowPage:function(){return k.get("flows").wrapEndpoint(Oa,!0).apply(null,arguments)},activities:Bb,activity:zc,affiliates:ca,affiliate:ia,affiliateCards:ta,affiliateCardAffiliations:K,partners:ja,partner:Ta,partnerCards:eb,partnerCardAffiliations:fb,agents:Ga,agent:ea,desks:Ua,desk:gb,cannedMessages:yd,cannedMessage:sb,availabilityHeadlines:zd,availabilityHeadline:cc,
customerPrototypes:rb,customerPrototype:ac,customerTypes:Xa,customerType:$b,checkinStatuses:xd,checkinStatus:bc,customFields:Ia,customField:Ca,transportationOptions:Pb,transportationOption:lb,extendedOptions:Qb,extendedOption:mb,connectedCampaigns:Rb,connectedCampaign:Sb,generatingCampaigns:Tb,generatingCampaign:nb,customFieldInstances:Vb,customFieldInstance:pd,customFieldInstanceConditions:rd,customFieldInstanceCondition:qd,customFieldInstanceGroups:Ub,customFieldInstanceGroup:ob,customerCustomFieldValue:ic,
bookingCustomFieldValue:hc,availabilities:aa,availability:ba,customerTypeRates:dc,customerTypeRate:tb,subjects:Ya,blocks:Ad,block:Bd,orders:fc,order:Ja,orderPayments:vb,bookings:qa,booking:W,customer:gc,customers:wb,lineItems:yb,lineItem:zb,payments:Ea,disputes:qc,refunds:pc,authorizationHolds:lc,paymentFees:mc,inStorePaymentTypes:nc,inStorePaymentType:Id,emvDevices:Jd,emvDevice:wa,bankAccounts:O,bankAccount:fa,cards:cb,card:A,cardAffiliations:F,supportedLanguages:td,supportedLanguage:sd,translations:ud,
translationsForModel:vd,translationsForField:Wb,understoodLanguages:wd,translationsForSubfield:Xb,reports:la,report:va,campaigns:Ha,campaign:Pa,campaignValidityRules:Mb,campaignValidityRule:Nb,codes:Qa,code:db,storedValueTypes:Oc,storedValueType:Pc,storedValueCards:Ra,storedValueCard:Wa,storedValueAdjustments:Qc,storedValueAdjustment:jb,resellerCompanies:Rc,resellerCompany:Sc,resellerCompanyMappings:Tc,resellerCompanyMapping:Uc,resellerItems:Vc,resellerItem:Wc,resellerItemMappings:Xc,resellerItemMapping:Yc,
resellerCustomerTypes:Zc,resellerCustomerType:$c,resellerCustomerTypeMappings:ad,resellerCustomerTypeMapping:bd,resellerOptions:cd,resellerOption:dd,resellerOptionMappings:ed,resellerOptionMapping:fd,resellerUnmappedItems:gd,resellerUnmappedCustomerPrototypes:hd,resellerKeys:id,resellerKey:jd,resellerApps:kd,resellerApp:ld,resellerAppRequest:md,resellerAppRequests:kb,resellerAppCompany:od,resellerAppCompanies:nd,reorder:Pd,refresh:function(a,b){g.assert(a,"db.refresh: expected uri");return ve(a,null,
null,null,b)},slipstream:function(b,c){c=c||{};if(window.slipstream&&window.slipstream[b]){var d=window.slipstream[b],e=c.doNotConvert||!1;return _.isObject(d)?(d=e?d:a.serverResponse(d),D(d,null,_.isArray(d))):d}},ledgers:oc,ledger:Hd,payouts:rc,payout:sc,transfers:tc,transfer:Kd,uploads:vc,upload:Md,oneTimeTransfer:uc,upcomingRefundReserveAmounts:Ld,adjustments:xc,adjustment:Od,transactions:yc,funds:wc,fund:Nd,roles:Yb,role:pb,crewMembers:Zb,crewMember:qb,hotels:ka,hotel:hb,lodgings:Va,lodging:ib,
pickups:ga,pickup:Sa,routes:Ba,route:pa,stops:oa,stop:sa,runs:P,preferredPickups:na,preferredPickup:ua,testReport:Q,invoices:xb,invoice:Da,totalSchedules:Ka,totalSchedule:Db,totalScheduleEntries:Qd,totalScheduleEntry:Rd,totalScheduleEntryRules:Sd,totalScheduleEntryRule:Td,invoiceScheduleEntryRules:Wd,invoiceScheduleEntryRule:Xd,invoiceSchedules:Eb,invoiceSchedule:Fb,invoiceScheduleEntries:Ud,invoiceScheduleEntry:Vd,effectiveSheets:Yd,affiliationEffectiveSheets:Zd,rebookingEffectiveSheets:$d,totalScheduleEffectiveSheet:ae,
invoiceScheduleEffectiveSheet:be,totalSheets:ha,totalSheet:xa,invoiceSheets:ya,invoiceSheet:za,taxTypes:Hb,taxType:ce,locations:Fc,location:Ec,waivers:Ac,waiver:Cb,connectedWaivers:Bc,connectedWaiver:Cc,waiverInstance:Dc,resources:Za,resource:$a,resourceUses:Fa,requirementGroups:function(a){var b=Ib(a),c=Gc(a);return h.all([b.$promise,c.$promise]).then(function(){return b.concat(c)})},requirementGroup:Jb,companyRequirementGroups:Gc,itemRequirementGroups:Ib,requirements:de,requirement:ee,resourceRequirements:fe,
resourceRequirement:Hc,resourceUse:Ic,resourceOverride:ab,resourceOverrides:bb,seatMaps:ge,seatMap:Aa,seatGroups:he,seatGroup:ie,seatZones:je,seatZone:ke,ticketLayouts:le,ticketLayout:me,analyticsServices:ne,analyticsService:oe,cancellationPolicies:pe,cancellationPolicy:Kb,cancellationRules:qe,cancellationRule:re,bookingRestrictions:se,bookingRestriction:Jc,persistentStore:Kc,persistentStoreForCompany:Lc,persistentStoreItem:Lb,tagGroups:Fd,tagGroup:Gd,tags:jc,tag:Ab,objectTags:kc,taskResult:te,tokens:ue,
version:xe,serverResponse:D,formErrorHandler:p,errorStatus:function(a){return 0===a&&!e?"disconnect":404===a?"not-found":403===a?"forbidden":"error"},pusher:Gb,searchEndpoint:function(a,b,c){c=c||{};return function(d){return a(b,null,null,_.defaults({q:d},c))}},view:we}}])})();angular.module("clientOptions",["clientOptions.services"]);
(function(){var m=angular.module("clientOptions.services",["db","lib","navigation"]);m.factory("clientOptions",["$rootScope","$sniffer","auth","db","events","models","navigation","storage","urls",function(c,k,d,h,f,n,a,m,g){g=/^(?:https?:\/\/)?(?:[a-z0-9\-_]+\.[a-z0-9\-_]+)+.*/i;var b=[{query:"u",key:"userIdentifier",reflect:!m.isPersistent(),reflectExternal:function(){return d.currentUser.isAuthenticated?!1:!0}},{query:"asn",key:"asnAffiliateCompany",reflect:!0},{query:"asn-ref",key:"asnVoucherNumber",
reflect:!0},{query:"sheet",key:"defaultTotalSheetPk",reflect:!0,type:"int"},{query:"schedule",key:"defaultTotalSchedulePk",reflect:!0,type:"int"},{query:"full-items",key:"isFullItemsEnabled",reflect:!0,type:"yes-no"},{query:"kiosk",key:"isKioskModeEnabled",isSlipstream:!0,type:"yes-no"},{query:"ref",key:"onlineBookingReference",reflect:!0},{query:"referrer",key:"referrerUrl",pattern:g},{query:"back",key:"backUrl",pattern:g,decode:!0},{query:"is-back-company-url",key:"isBackCompanyUrl",type:"yes-no"},
{query:"preview"},{query:"site-tags",key:"trackingSiteTags",onlyIfDefined:!0,decode:!0},{query:"page-tags",key:"trackingPageTags",onlyIfDefined:!0,decode:!0},{query:"button-tags",key:"trackingButtonTags",onlyIfDefined:!0,decode:!0},{query:"from-ssl",key:"trackingIsFromSsl",type:"yes-no",onlyIfDefined:!0},{query:"from-embed",key:"trackingFromEmbed",onlyIfDefined:!0},{query:n.FlowNode.FLOW_QUERY,key:"flowNode",reflect:!0,isUpdatedOnLocationChange:!0,isAuthenticatedAllowed:!0},{query:n.FlowNode.IS_FROM_CART_QUERY,
key:"isFromCart",reflect:!0,type:"yes-no",isUpdatedOnLocationChange:!0},{query:"bookable-only",key:"isBookableOnly",type:"yes-no"}],e=_.filter(b,"isUpdatedOnLocationChange"),z=function(a){a=a||_.always;var c={};_.forEach(b,function(b){if(a(b)&&b.key){var d=s[b.key];_.isUndefined(d)||("yes-no"===b.type?d&&(c[b.query]="yes"):"int"===b.type?_.isFinite(d)&&(c[b.query]=d):d&&(c[b.query]=d))}});return c},v=function(){return z(function(a){return!!a.reflect})},r=function(){var a=z(function(a){return _.isFunction(a.reflectExternal)?
a.reflectExternal():!!a.reflectExternal});return _.mapKeys(a,function(a,b){return"fh-"+b})};c.$on("$locationChangeSuccess",function(){_.forEach(e,D);var b=v();_.forEach(b,function(b,c){a.set(c,b,!0)})});f.on(c,"navigation.company.updated",function(){a.currentCompany&&(s.asnCharterCompany?s.asnCharterCompany!==a.currentCompany.shortname&&(s.asnCharterCompany="",s.asnAffiliateCompany="",s.asnVoucherNumber=""):s.asnCharterCompany=a.currentCompany.shortname)});c=h.slipstream("domain");var C=h.slipstream("protocol")+
"://"+c,s={reflect:function(c){var d=_.find(b,"key",c).query;a.set(d,s[c],!0)},extendUrl:function(b){return a.compose(b,z(),!0)},reflectUrl:function(b){var c;if("/"===b.charAt(0)||0===b.indexOf(C))c=v();else if(0===b.indexOf("http"))c=r();else return b;return a.compose(b,c,!0)},reflectUrlsInHrefs:function(a){a.on("mousedown","a",function(){var a=$(this);a.attr("href",s.reflectUrl(a.attr("href")))})}},D=function(b){var c=a.get(b.query)||"";!c&&b.isSlipstream&&(c=h.slipstream(b.query)||"");d.currentUser.isAuthenticated&&
!b.isAuthenticatedAllowed&&(c="");b.pattern&&!b.pattern.test(c)&&(c="");if(!b.onlyIfDefined||c)"int"===b.type?(c=parseInt(c,10),c=isNaN(c)?null:c):"yes-no"===b.type&&(c="yes"===c),k.history&&!b.isUpdatedOnLocationChange&&a.clear(b.query,!0),b.decode&&(c=decodeURIComponent(c)),b.key&&(s[b.key]=c)};_.forEach(b,D);d.currentUser.isAuthenticated||(s.asnAffiliateCompany=s.asnAffiliateCompany||h.slipstream("asnAffiliateCompany")||"");s.asnAffiliateCompany||(s.asnAffiliateCompany="",s.asnVoucherNumber="");
return s}]);m.run(["$rootScope","clientOptions",function(c,k){c.clientOptions=k}])})();(function(){angular.module("flash",["flash.services"]);angular.module("flash.services",[]).factory("flash",[function(){return{debug:_.ignore,info:_.ignore,warn:_.ignore,error:_.ignore,success:_.ignore}}])})();angular.module("lightframe",["lightframe.services"]);
(function(){var m=angular.module("lightframe.services",[]);m.factory("lightframe",["$browser","$sniffer","$window","clientOptions","navigation","xmessage",function(c,k,d,h,f,n){c="";var a=!1,m=!1,g=null,b={};k=function(a){try{a=decodeURIComponent(a),b=JSON.parse(a)||{},g=b.parentUrl||null}catch(c){}};/^fareharbor-embed:/.test(d.name)?(k(window.name.substr(17)),c=b.embedId||"",a=b.isLightframed||!1):/^fareharbor-lightframe/.test(d.name)&&(k(window.name.substr(22)),m=!0);var e={embedId:c,isLightframe:function(){return d.top!==
d&&m},isEmbed:function(){return d.top!==d&&e.embedId},isLightframed:function(){return e.isEmbed()&&a},parentUrl:function(){return g},broadcast:function(a,b){b=_.extend({embedId:e.embedId},b);n.broadcast(a,b)},updateHeight:function(a){e.isEmbed()&&a&&e.broadcast("fareharbor.height",{height:a})},open:function(a){a=h.extendUrl(a);e.isEmbed()?e.broadcast("fareharbor.open",{url:a}):d.top.location.href=d.location.protocol+"//"+d.location.hostname+(d.location.port?":"+d.location.port:"")+a},close:function(){e.broadcast("fareharbor.close")},
ready:function(){e.broadcast("fareharbor.ready")},isDirectAccess:function(){return d.top===d},listenForTouch:function(){var a=function(){e.broadcast("fareharbor.touchDetected")};window.addEventListener("touchstart",function r(){a();window.removeEventListener("touchstart",r)},!1);window.addEventListener("pointerdown",function C(b){"touch"==b.pointerType&&(a(),window.removeEventListener("pointerdown",C))},!1)}};return e}]);m.run(["$rootScope","lightframe",function(c,k){c.lightframe=k;c.isLightframe=
k.isLightframe();k.ready();k.listenForTouch()}])})();(function(){angular.module("tracking",[]).factory("analytics",[function(){return{trackView:_.ignore}}])})();angular.module("urls",["urls.services"]);
(function(){var m=angular.module("urls.services",["lib.services"]);m.factory("urls",["models","require",function(c,k){var d={},h=function(a,c,f){var b,e,k;for(k in c)if(c.hasOwnProperty(k)){var h=c[k];k&&void 0!==h&&(e=":"+k+"(?:\\([^\\)/]+\\))?",(b=d[e])||(b=d[e]=RegExp(e)),a=a.replace(b,h))}if(f||-1===a.indexOf(":"))return a},f={Company:function(a){return{shortname:a.shortname,canonical:{company:"company.index",dashboard:"dashboard.index"}}},Hotel:function(a){return{shortname:a.company.shortname,
hotelPk:a.pk,canonical:{dashboard:"dashboard.settings.hotels.hotel"}}},Lodging:function(a){return{shortname:a.company.shortname,lodgingPk:a.pk,canonical:{dashboard:"dashboard.settings.lodgings.lodging"}}},PreferredPickup:function(a){return{shortname:a.company.shortname,lodgingPk:a.lodging.pk,preferredPickupPk:a.pk,canonical:{dashboard:"dashboard.settings.lodgings.lodging"}}},Route:function(a){return{shortname:a.company.shortname,routePk:a.pk,canonical:{dashboard:"dashboard.settings.routes.route"}}},
Run:function(a){return{shortname:a.route.company.shortname,routePk:a.route.pk,runPk:a.pk,canonical:{dashboard:"dashboard.settings.routes.route"}}},Stop:function(a){return{shortname:a.company.shortname,routePk:a.route.pk,stopPk:a.pk,canonical:{dashboard:"dashboard.settings.routes.route"}}},Pickup:function(a){return{shortname:a.company.shortname,pickupPk:a.pk,canonical:{dashboard:"dashboard.settings.pickups.pickup"}}},User:function(a){return{username:a.username,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.user.index"}}},
CustomManifest:function(a){return{customManifestPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.index"}}},CustomCalendar:function(a){return{customCalendarPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.index"}}},CustomReport:function(a){return{customReportPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.index"}}},Image:function(a){return{imagePk:a.pk,itemPk:a.item?a.item.pk:void 0,shortname:a.company.shortname,canonical:{dashboard:"dashboard.items.item.index"}}},
Resource:function(a){return{resourcePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.resources.resource.index"}}},ResourceOverride:function(a){return{resourceOverridePk:a.pk,resourcePk:a.resource.pk,shortname:a.resource.company.shortname,canonical:{dashboard:"dashboard.resources.resource.uses.index"}}},SeatMap:function(a){return{seatMapPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.seating.seatMap.layout.index"}}},SeatGroup:function(a){return{seatGroupPk:a.pk,
seatMapPk:a.seatMap.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.seating.seatMap.layout.seatGroup"}}},SeatZone:function(a){return{seatZonePk:a.pk,seatMapPk:a.seatMap.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.seating.seatMap.seatZones.seatZone"}}},Seat:function(a){return{seatPks:a.pk,seatMapPk:a.seatMap.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.seating.seatMap.layout.seats"}}},TagGroup:function(a){return{tagGroupPk:a.pk,
shortname:a.company.shortname}},Tag:function(a){return{tagPk:a.pk,tagGroupPk:a.tagGroup.pk,shortname:a.tagGroup.company.shortname}},Item:function(a){return{itemPk:a.pk,shortname:a.company.shortname,canonical:{company:"company.item.index",dashboard:"dashboard.items.item.index"}}},FlowNode:function(a){return{flowNodePk:a.pk,shortname:a.company.shortname,canonical:{company:"company.flowNode.index",dashboard:"dashboard.settings.flows.flowNode.index"}}},CustomerPrototype:function(a){return{customerPrototypePk:a.pk,
itemPk:a.item.pk,shortname:a.item.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.customerTypes"}}},Availability:function(a){return{availabilityPk:a.pk,itemPk:a.item.pk,shortname:a.item.company.shortname,date:a.startAt?a.startAt.format("YYYY-MM-DD"):void 0,canonical:{company:"company.item.availability",dashboard:"dashboard.overlay.availability.index"}}},Block:function(a){return{blockPk:a.pk,availabilityPk:a.availability.pk,itemPk:a.availability.item.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.overlay.availability.index"}}},Contact:function(a){return{contactPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.index"}}},Order:function(a){return{contactPk:a.contact.pk,orderUuid:a.uuid,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.order",company:"company.order.index"}}},Booking:function(a){return{bookingUuid:a.uuid,itemPk:a.item.pk,contactPk:a.contact.pk,shortname:a.company.shortname,affiliateShortname:a.affiliation?
a.affiliation.affiliateCompany.shortname:void 0,canonical:{company:"company.item.booking",dashboard:"dashboard.overlay.contact.booking"}}},Campaign:function(a){return{campaignPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.index"}}},CampaignValidityRule:function(a){return{campaignValidityRulePk:a.pk,campaignPk:a.campaign.pk,shortname:a.campaign.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.settings"}}},Code:function(a){return{codePk:a.pk,
campaignPk:a.campaign.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.code"}}},StoredValueType:function(a){return{storedValueTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueType"}}},StoredValueCard:function(a){return{storedValueCardPk:a.pk,storedValueCardNumber:a.number,shortname:a.storedValueType.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueCard.index"}}},StoredValueAdjustment:function(a){return{storedValueAdjustmentPk:a.pk,
storedValueCardPk:a.storedValueCard.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueCard.storedValueAdjustment"}}},Customer:function(a){return{customerPk:a.pk,bookingUuid:a.booking.uuid,shortname:a.company.shortname,contactPk:_.get(a,"booking.contact.pk"),canonical:{dashboard:"dashboard.overlay.contact.booking"}}},CheckinStatus:function(a){return{checkinStatusPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.checkinStatuses"}}},
CustomerType:function(a){return{customerTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customerTypes.customerType"}}},CustomerTypeRate:function(a){return{customerTypeRatePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.availability.prices"}}},CannedMessage:function(a){return{cannedMessagePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.cannedMessages.cannedMessage"}}},AvailabilityHeadline:function(a){return{availabilityHeadlinePk:a.pk,
shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.availabilityHeadlines.availabilityHeadline"}}},InStorePaymentType:function(a){return{inStorePaymentTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.inStorePaymentTypes"}}},TaxType:function(a){return{taxTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.taxTypes.taxType"}}},Ledger:function(a){return{ledgerPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.ledgers.ledger"}}},
EmvDevice:function(a){return{inStorePaymentTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.emvDevices"}}},BankAccount:function(a){return{bankAccountPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.bankAccounts"}}},Card:function(a){return{cardPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.cards.card.index"}}},CardAffiliation:function(a){return{cardAffiliationPk:a.pk,cardPk:a.card.pk,
shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.cards.card.index"}}},Payment:function(a){return{paymentPk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Refund:function(a){return{refundPk:a.pk,paymentPk:a.payment.pk,contactPk:a.payment.booking.contact.pk,bookingUuid:a.payment.booking.uuid,itemPk:a.payment.booking.item.pk,shortname:a.payment.company.shortname,
canonical:{dashboard:"dashboard.overlay.contact.booking"}}},LegacyTransfer:function(a){return{transferPk:a.pk,shortname:a.company.shortname}},LegacyTransaction:function(a){return{transactionPk:a.pk}},Account:function(a){return{accountPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.transactions.index"}}},Payout:function(a){return{payoutPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.payouts.payout"}}},Transfer:function(a){return{transferPk:a.pk,
shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.accounts.transfer"}}},Upload:function(a){return{uploadPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.accounts.upload"}}},Adjustment:function(a){return{adjustmentPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.transactions.adjustment"}}},Transaction:function(a){return{transactionPk:a.pk,shortname:c.Company.ADMIN_SHORTNAME,canonical:{dashboard:"dashboard.reports.transactions.index"}}},
LineItem:function(a){return{lineItemPk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Agent:function(a){return{agentPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.agents.agent"}}},Desk:function(a){return{deskPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.desks.desk"}}},Role:function(a){return{rolePk:a.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.index"}}},CrewMember:function(a){return{crewMemberPk:a.pk,availabilityPk:a.availability.pk,itemPk:a.availability.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.availability.index"}}},CustomField:function(a){return{customFieldPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},TransportationOption:function(a){return{transportationOptionPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ExtendedOption:function(a){return{extendedOptionPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ConnectedCampaign:function(a){return{connectedCampaignPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ConnectedWaiver:function(a){return{connectedWaiverPk:a.pk,
customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},GeneratingCampaign:function(a){return{generatingCampaignPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},CustomFieldInstance:function(a){return{customFieldInstancePk:a.pk,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.index"}}},CustomFieldInstanceCondition:function(a){return{customFieldInstanceConditionPk:a.pk,
customFieldInstancePk:a.customFieldInstance.pk,itemPk:a.customFieldInstance.item.pk,shortname:a.customFieldInstance.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.index"}}},CustomFieldInstanceGroup:function(a){return{customFieldInstanceGroupPk:a.pk,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.fieldGroups"}}},RequirementGroup:function(a){return{requirementGroupPk:a.pk,shortname:a.company.shortname,itemPk:a.isItemLevel?a.item.pk:
null,canonical:{dashboard:a.isItemLevel?"dashboard.items.item.prices.resources":"dashboard.settings.requirementGroups.requirementGroup"}}},Requirement:function(a){return{requirementPk:a.pk,requirementGroupPk:a.requirementGroup.pk,itemPk:a.requirementGroup.isItemLevel?a.requirementGroup.item.pk:null,shortname:a.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},CustomerPrototypeRequirement:function(a){return{customerPrototypeRequirementPk:a.pk,requirementPk:a.requirement.pk,
requirementGroupPk:a.requirement.requirementGroup.pk,itemPk:a.requirement.requirementGroup.isItemLevel?a.requirement.requirementGroup.item.pk:null,shortname:a.requirement.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},ResourceRequirement:function(a){return{resourceRequirementPk:a.pk,requirementPk:a.requirement.pk,requirementGroupPk:a.requirement.requirementGroup.pk,itemPk:a.requirement.requirementGroup.isItemLevel?a.requirement.requirementGroup.item.pk:
null,shortname:a.requirement.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},CustomerCustomFieldValue:function(a){return{customerCustomFieldValuePk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},BookingCustomFieldValue:function(a){return{bookingCustomFieldValuePk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Group:function(a){return{groupPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.group"}}},GroupOverride:function(a){return{groupOverridePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.groupOverride"}}},ResourceUse:function(a){return{resourceUsePk:a.pk,customerPk:a.customer?a.customer.pk:void 0,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,shortname:a.booking.contact.company.shortname,
canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Affiliation:function(a){return{affiliationPk:a.pk,shortname:a.company.shortname,affiliateShortname:a.affiliateCompany.shortname,canonical:{dashboard:"dashboard.settings.network.affiliates.affiliate.index"}}},Activity:function(a){return{activityPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.activity.index"}}},Notification:function(a){return{notificationPk:a.pk,shortname:a.company.shortname,contactPk:a.booking?
a.booking.contact.pk:void 0,bookingUuid:a.booking?a.booking.uuid:void 0,availabilityPk:a.availability?a.availability.pk:void 0,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},SmsNotification:function(a){return{smsNotificationPk:a.pk,shortname:a.company.shortname,contactPk:a.booking?a.booking.contact.pk:void 0,bookingUuid:a.booking?a.booking.uuid:void 0,availabilityPk:a.availability?a.availability.pk:void 0,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Subscription:function(a){return{subscriptionPk:a.pk,
username:a.user.username,shortname:a.user.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.user.settings"}}},Invoice:function(a){return{invoicePk:a.pk,invoiceUuid:a.uuid,shortname:a.company.shortname,affiliateShortname:a.affiliation?a.affiliation.affiliateCompany.shortname:void 0,canonical:{dashboard:"dashboard.reports.invoices.invoice.index"}}},InvoiceEntry:function(a){return{invoiceEntryPk:a.pk,invoiceUuid:a.invoice.uuid,invoicePk:a.invoice.pk,shortname:a.invoice.company.shortname,
canonical:{dashboard:"dashboard.reports.invoices.invoice.index"}}},Report:function(a){return{reportPk:a.pk,shortname:a.company.shortname,modelSlug:a.type===c.Report.ADVANCED_TYPE?c.Report.MODELS[a.options.modelName].slug:void 0,canonical:{dashboard:"dashboard.reports.advanced.permalink"}}},Waiver:function(a){return{waiverPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.waivers.waiver.index"}}},WaiverInstance:function(a){return{waiverPk:a.waiver.pk,waiverInstancePk:a.pk,
bookingUuid:a.booking.uuid,contactPk:a.booking.contact.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},TotalSchedule:function(a){return{shortname:a.company.shortname,totalSchedulePk:a.pk,canonical:{dashboard:"dashboard.settings.pricing.totalSchedules.index"}}},TotalScheduleEntry:function(a){return{shortname:a.company.shortname,totalSchedulePk:a.schedule.pk,totalScheduleEntryPk:a.pk,canonical:{dashboard:"dashboard.settings.pricing.totalSchedules.entry.index"}}},
TotalScheduleEntryRule:function(a){return{shortname:a.company.shortname,totalSchedulePk:a.entry.schedule.pk,totalScheduleEntryPk:a.entry.pk,totalScheduleEntryRulePk:a.pk,canonical:{dashboard:"dashboard.settings.pricing.totalSchedules.entry.index"}}},InvoiceSchedule:function(a){return{shortname:a.company.shortname,invoiceSchedulePk:a.pk,canonical:{dashboard:"dashboard.settings.pricing.invoiceSchedules.index"}}},InvoiceScheduleEntry:function(a){return{shortname:a.company.shortname,invoiceSchedulePk:a.schedule.pk,
invoiceScheduleEntryPk:a.pk,canonical:{dashboard:"dashboard.settings.pricing.invoiceSchedules.entry.index"}}},InvoiceScheduleEntryRule:function(a){return{shortname:a.company.shortname,invoiceSchedulePk:a.entry.schedule.pk,invoiceScheduleEntryPk:a.entry.pk,invoiceScheduleEntryRulePk:a.pk,canonical:{dashboard:"dashboard.settings.pricing.invoiceSchedules.entry.index"}}},TotalSheet:function(a){return{totalSheetPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.totalSheet"}}},
TotalLine:function(a){return{totalSheetPk:a.sheet.pk,shortname:a.sheet.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.totalSheet"}}},InvoiceSheet:function(a){return{invoiceSheetPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.invoiceSheet"}}},InvoiceLine:function(a){return{invoiceSheetPk:a.sheet.pk,shortname:a.sheet.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.invoiceSheet"}}},SupportedLanguage:function(a){return{languagePk:a.pk,
shortname:a.company.shortname,modelName:c.Translation.modelNameForUrl(a.modelName),canonical:{dashboard:"dashboard.settings.translations.language.translations.index"}}},Translation:function(a){return{translationPk:a.pk,languagePk:a.supportedLanguage.pk,shortname:a.supportedLanguage.company.shortname,canonical:{dashboard:"dashboard.settings.translations.language.translations.index"}}},Location:function(a){return{locationPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.locations.location"}}},
ResellerCompany:function(a){return{resellerCompanyPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.company.index"}}},ResellerCompanyMapping:function(a){return{resellerCompanyMappingPk:a.pk,resellerCompanyPk:a.resellerCompany.pk,shortname:a.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.company.index"}}},ResellerItem:function(a){return{resellerItemPk:a.pk,resellerCompanyPk:a.resellerCompany.pk,shortname:a.resellerCompany.company.shortname,
canonical:{dashboard:"dashboard.settings.reseller.item.index"}}},ResellerItemMapping:function(a){return{resellerItemMappingPk:a.pk,resellerItemPk:a.resellerItem.pk,resellerCompanyPk:a.resellerItem.resellerCompany.pk,shortname:a.resellerItem.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.item.index"}}},ResellerCustomerType:function(a){return{resellerCustomerTypePk:a.pk,resellerItemPk:a.resellerItem.pk,resellerCompanyPk:a.resellerItem.resellerCompany.pk,shortname:a.resellerItem.resellerCompany.company.shortname,
canonical:{dashboard:"dashboard.settings.reseller.customerType.index"}}},ResellerCustomerTypeMapping:function(a){return{resellerCustomerTypeMappingPk:a.pk,resellerCustomerTypePk:a.resellerCustomerType.pk,resellerItemPk:a.resellerCustomerType.resellerItem.pk,resellerCompanyPk:a.resellerCustomerType.resellerItem.resellerCompany.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.customerType.index"}}},ResellerOption:function(a){return{resellerOptionPk:a.pk,resellerItemPk:a.resellerItem.pk,
resellerCompanyPk:a.resellerItem.resellerCompany.pk,shortname:a.resellerItem.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.option.index"}}},ResellerOptionMapping:function(a){return{resellerOptionMappingPk:a.pk,resellerOptionPk:a.resellerOption.pk,resellerItemPk:a.resellerOption.resellerItem.pk,resellerCompanyPk:a.resellerOption.resellerItem.resellerCompany.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.option.index"}}},ResellerKey:function(a){return{resellerKeyPk:a.pk,
username:a.user.username,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.user.apiKeys.apiKey"}}},ResellerApp:function(a){return{resellerAppPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.apps.app.index"}}},ResellerAppRequest:function(a){return{resellerAppRequestPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.connect"}}},ResellerAppCompany:function(a){return{resellerAppCompanyPk:a.pk,resellerAppPk:a.resellerApp.pk,
shortname:a.resellerApp.company.shortname}},AnalyticsService:function(a){return{analyticsServicePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.analyticsServices.analyticsService"}}},CancellationPolicy:function(a){return{cancellationPolicyPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.cancellationPolicy.index"}}},CancellationRule:function(a){return{cancellationPolicyPk:a.cancellationPolicy.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.cancellationPolicy.index"}}},
BookingRestriction:function(a){return{bookingRestrictionPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.bookingRestrictions.bookingRestriction"}}},TicketLayout:function(a){return{ticketLayoutPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.ticketLayouts.ticketLayout.index"}}}},n={populate:h,populateForObject:function(a){a=a||"";var c;if(this.$urls){if(c=this.$urls[a])return c}else this.$urls={},this.$params=n.extract(this);if(a)c=h(a,this.$params);
else{if(!this.$params.canonical)return"";c=this.$params.canonical.dashboard||this.$params.canonical.company;if(!c)return"";c=h(_.getDotted(n,c),this.$params)}return this.$urls[a]=c},extract:function(a){k.assert(a,"urls: unable to extract from object",a);k.defined(f,a.cls,"urls: unable to extract cls",a);try{return f[a.cls](a)}catch(c){return console.warn("urls: unable to extract",a,c),{}}},calendarUrls:function(a){return{index:a,month:a+":year/:month/",day:a+":year/:month/:day/",agenda:a+":year/:month/:day/",
grid:a+":year/:month/:day/",timeline:a+":year/:month/:day/"}},dayUrlForCompany:function(a,d){return h(a.features.isDayViewEnabled?n.dashboard.bookings.day.date:n.dashboard.bookings.timeline.date+"?timeline-type="+c.Company.AVAILABILITY_TIMELINE,{shortname:a.shortname,date:d.format("YYYY-MM-DD")})},legacyManifest:"/:shortname/manifest/",company:{index:"/:shortname/",login:"/:shortname/login/",about:"/:shortname/about/",faq:"/:shortname/faq/",policies:"/:shortname/policies/",items:{index:"/:shortname/items/",
calendar:"/:shortname/items/calendar/",date:{index:"/:shortname/items/date/",date:"/:shortname/items/date/:date/"}},item:{index:"/:shortname/items/:itemPk(pk)/",calendar:"/:shortname/items/:itemPk(pk)/calendar/",month:"/:shortname/items/:itemPk(pk)/calendar/:year/:month/",date:"/:shortname/items/:itemPk(pk)/date/:date/",availability:"/:shortname/items/:itemPk(pk)/availability/:availabilityPk/",book:"/:shortname/items/:itemPk(pk)/availability/:availabilityPk/book/",booking:"/:shortname/items/:itemPk(pk)/booking/:bookingUuid/"},
storedValueCard:{index:"/:shortname/gift-cards/:storedValueCardNumber/"},cart:{index:"/:shortname/cart/",permalink:"/:shortname/cart/?u=:cartUuid"},order:{index:"/:shortname/orders/:orderUuid/"},invoice:{index:"/:shortname/invoices/:invoiceUuid/"},flowNode:{index:"/:shortname/items/?flow=:flowNodePk",calendar:"/:shortname/items/calendar/?flow=:flowNodePk",date:{index:"/:shortname/items/date/?flow=:flowNodePk",date:"/:shortname/items/date/:date/?flow=:flowNodePk"}}},dashboard:{index:"/:shortname/dashboard/",
overlay:{index:"/:shortname/dashboard/@overlay=/",item:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/",date:"/:shortname/dashboard/@overlay=/items/:itemPk/date/:date/"},availability:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/",bookings:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/bookings/",cancelled:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/bookings/cancelled/"},message:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/message/",
settings:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/settings/",prices:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/prices/",integrations:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/integrations/"},contact:{index:"/:shortname/dashboard/@overlay=/contacts/:contactPk/",booking:"/:shortname/dashboard/@overlay=/contacts/:contactPk/bookings/:bookingUuid/",order:"/:shortname/dashboard/@overlay=/contacts/:contactPk/orders/:orderUuid/"},
deprecatedBooking:{index:"/:shortname/dashboard/@overlay=/bookings/:bookingUuid/"},activity:{index:"/:shortname/dashboard/@overlay=/activities/:activityPk/"},translation:{index:"/:shortname/dashboard/@overlayTop=/translations/:objectType/:objectId/:objectField/"},close:"/:shortname/dashboard/@overlay"},translationsOverlay:{index:"/:shortname/dashboard/@translations-overlay=/",forSubfield:"/:shortname/dashboard/@translations-overlay=/for-field/:objectType/:objectId/:objectField/:subfield/",forField:"/:shortname/dashboard/@translations-overlay=/for-field/:objectType/:objectId/:objectField/",
close:"/:shortname/dashboard/@translations-overlay"},admin:{index:"/:shortname/dashboard/admin/"},manifest:{index:"/:shortname/dashboard/manifest/",date:"/:shortname/dashboard/manifest/date/:date/",bookings:"/:shortname/dashboard/manifest/date/:date/bookings/",availabilities:"/:shortname/dashboard/manifest/date/:date/availabilities/",items:"/:shortname/dashboard/manifest/date/:date/items/",runs:"/:shortname/dashboard/manifest/date/:date/runs/",resources:"/:shortname/dashboard/manifest/date/:date/resources/"},
bookings:{index:"/:shortname/dashboard/bookings/",calendar:"/:shortname/dashboard/bookings/calendar/",day:{index:"/:shortname/dashboard/bookings/day/",date:"/:shortname/dashboard/bookings/day/:date/"},grid:{index:"/:shortname/dashboard/bookings/grid/",date:"/:shortname/dashboard/bookings/grid/:date/"},timeline:{index:"/:shortname/dashboard/bookings/timeline/",date:"/:shortname/dashboard/bookings/timeline/:date/"},agenda:{index:"/:shortname/dashboard/bookings/agenda/",date:"/:shortname/dashboard/bookings/agenda/:date/"},
booking:{deprecatedPermalink:"/:shortname/dashboard/bookings/:bookingUuid/view/",deprecatedAffiliatePermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/:bookingUuid/"},contact:{index:"/:shortname/dashboard/bookings/contacts/:contactPk/",order:"/:shortname/dashboard/bookings/contacts/:contactPk/orders/:orderUuid/view/",booking:"/:shortname/dashboard/bookings/contacts/:contactPk/bookings/:bookingUuid/view/",affiliateContactPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/",
affiliateBookingPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/bookings/:bookingUuid/",affiliateOrderPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/orders/:orderUuid/"}},reports:{index:"/:shortname/dashboard/reports/",type:"/:shortname/dashboard/reports/:type/",invoices:{index:"/:shortname/dashboard/reports/invoices/",create:{index:"/:shortname/dashboard/reports/invoices/create/",permalink:"/:shortname/dashboard/reports/invoices/create/report/:reportPk/"},
permalink:"/:shortname/dashboard/reports/invoices/report/:reportPk/",invoice:{index:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/",multi:"/:shortname/dashboard/reports/invoices/invoices/:invoicePks(pks)/",notification:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/notification/",upload:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/upload/"},partnerInvoice:{index:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/",notification:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/notification/",
upload:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/upload/"}},test:{index:"/:shortname/dashboard/reports/test/",permalink:"/:shortname/dashboard/reports/test/report/:reportPk/"},reports:{index:"/:shortname/dashboard/reports/reports/"},accounts:{index:"/:shortname/dashboard/reports/accounts/",permalink:"/:shortname/dashboard/reports/accounts/report/:reportPk/",transfer:"/:shortname/dashboard/reports/accounts/transfer/:transferPk/",upload:"/:shortname/dashboard/reports/accounts/upload/:uploadPk/"},
customersRedirect:{index:"/:shortname/dashboard/reports/customers/"},contacts:{index:"/:shortname/dashboard/reports/contacts/",permalink:"/:shortname/dashboard/reports/contacts/report/:reportPk/"},bookings:{index:"/:shortname/dashboard/reports/bookings/",permalink:"/:shortname/dashboard/reports/bookings/report/:reportPk/"},companies:{index:"/:shortname/dashboard/reports/companies/",permalink:"/:shortname/dashboard/reports/companies/report/:reportPk/"},payments:{index:"/:shortname/dashboard/reports/payments/",
permalink:"/:shortname/dashboard/reports/payments/report/:reportPk/"},disputes:{index:"/:shortname/dashboard/reports/disputes/",permalink:"/:shortname/dashboard/reports/disputes/report/:reportPk/"},lineItems:{index:"/:shortname/dashboard/reports/line-items/",permalink:"/:shortname/dashboard/reports/line-items/report/:reportPk/"},payouts:{index:"/:shortname/dashboard/reports/payouts/",permalink:"/:shortname/dashboard/reports/payouts/report/:reportPk/",payout:"/:shortname/dashboard/reports/payouts/payout/:payoutPk/"},
escrow:{index:"/:shortname/dashboard/reports/future-payouts/",permalink:"/:shortname/dashboard/reports/future-payouts/report/:reportPk/"},volume:{index:"/:shortname/dashboard/reports/volume/",permalink:"/:shortname/dashboard/reports/volume/report/:reportPk/"},transactions:{index:"/:shortname/dashboard/reports/transactions/",permalink:"/:shortname/dashboard/reports/transactions/report/:reportPk/",adjustment:"/:shortname/dashboard/reports/transactions/:adjustmentPk/"},bookingTypesSummary:{index:"/:shortname/dashboard/reports/booking-types-summary/",
permalink:"/:shortname/dashboard/reports/booking-types-summary/report/:reportPk/"},crewSummary:{index:"/:shortname/dashboard/reports/crew-summary/",permalink:"/:shortname/dashboard/reports/crew-summary/report/:reportPk/"},customerTypesSummary:{index:"/:shortname/dashboard/reports/customer-types-summary/",permalink:"/:shortname/dashboard/reports/customer-types-summary/report/:reportPk/"},customFieldSummary:{index:"/:shortname/dashboard/reports/custom-field-summary/",permalink:"/:shortname/dashboard/reports/custom-field-summary/report/:reportPk/"},
itemsSummary:{index:"/:shortname/dashboard/reports/items-summary/",permalink:"/:shortname/dashboard/reports/items-summary/report/:reportPk/"},lodgingsSummary:{index:"/:shortname/dashboard/reports/lodging-summary/",permalink:"/:shortname/dashboard/reports/lodging-summary/report/:reportPk/"},pickupsSummary:{index:"/:shortname/dashboard/reports/pickups-summary/",permalink:"/:shortname/dashboard/reports/pickups-summary/report/:reportPk/"},usersSummary:{index:"/:shortname/dashboard/reports/users-summary/",
permalink:"/:shortname/dashboard/reports/users-summary/report/:reportPk/"},agentsSummary:{index:"/:shortname/dashboard/reports/agents-summary/",permalink:"/:shortname/dashboard/reports/agents-summary/report/:reportPk/"},desksSummary:{index:"/:shortname/dashboard/reports/desks-summary/",permalink:"/:shortname/dashboard/reports/desks-summary/report/:reportPk/"},campaignsSummary:{index:"/:shortname/dashboard/reports/campaigns-summary/",permalink:"/:shortname/dashboard/reports/campaigns-summary/report/:reportPk/"},
revenueSummary:{index:"/:shortname/dashboard/reports/revenue-summary/",permalink:"/:shortname/dashboard/reports/revenue-summary/report/:reportPk/"},advanced:{redirect:"/:shortname/dashboard/reports/advanced/",index:"/:shortname/dashboard/reports/advanced/:modelSlug/",permalink:"/:shortname/dashboard/reports/advanced/:modelSlug/:reportPk/"}},items:{index:"/:shortname/dashboard/items/",grid:"/:shortname/dashboard/items/grid/",list:"/:shortname/dashboard/items/list/",item:{index:"/:shortname/dashboard/items/:itemPk/",
activity:"/:shortname/dashboard/items/:itemPk/activity/",calendar:"/:shortname/dashboard/items/:itemPk/calendar/",prices:{index:"/:shortname/dashboard/items/:itemPk/prices/",customerTypes:"/:shortname/dashboard/items/:itemPk/prices/customer-types/",fieldGroups:"/:shortname/dashboard/items/:itemPk/prices/field-groups/",resources:"/:shortname/dashboard/items/:itemPk/prices/resources/"},embeds:"/:shortname/dashboard/items/:itemPk/embeds/",onlineBooking:"/:shortname/dashboard/items/:itemPk/online-booking/",
suggestedItems:"/:shortname/dashboard/items/:itemPk/suggested-items/",seating:"/:shortname/dashboard/items/:itemPk/seating/",info:{index:"/:shortname/dashboard/items/:itemPk/info/",notes:"/:shortname/dashboard/items/:itemPk/info/notes/",basic:"/:shortname/dashboard/items/:itemPk/info/basic/",photos:"/:shortname/dashboard/items/:itemPk/info/photos/",advanced:"/:shortname/dashboard/items/:itemPk/info/advanced/",tags:"/:shortname/dashboard/items/:itemPk/info/tags/"},listing:{index:"/:shortname/dashboard/items/:itemPk/listing/",
basic:"/:shortname/dashboard/items/:itemPk/listing/basic/",photos:"/:shortname/dashboard/items/:itemPk/listing/photos/",facts:"/:shortname/dashboard/items/:itemPk/listing/facts/"},notifications:{index:"/:shortname/dashboard/items/:itemPk/notifications/",internal:"/:shortname/dashboard/items/:itemPk/notifications/internal/",external:"/:shortname/dashboard/items/:itemPk/notifications/external/"},integrations:{index:"/:shortname/dashboard/items/:itemPk/integrations/",subscribe:"/:shortname/dashboard/items/:itemPk/integrations/subscribe/",
reviewExpress:"/:shortname/dashboard/items/:itemPk/integrations/review-express/",picthrive:"/:shortname/dashboard/items/:itemPk/integrations/picthrive/"}}},resources:{index:"/:shortname/dashboard/resources/",resource:{index:"/:shortname/dashboard/resources/:resourcePk/",settings:"/:shortname/dashboard/resources/:resourcePk/settings/",uses:{index:"/:shortname/dashboard/resources/:resourcePk/uses/",overview:"/:shortname/dashboard/resources/:resourcePk/uses/overview/",day:"/:shortname/dashboard/resources/:resourcePk/uses/date/:date/"}}},
settings:{index:"/:shortname/dashboard/settings/",advanced:"/:shortname/dashboard/settings/advanced/",payments:{index:"/:shortname/dashboard/settings/payments/",cards:{index:"/:shortname/dashboard/settings/payments/cards/",card:{index:"/:shortname/dashboard/settings/payments/cards/:cardPk/",settings:"/:shortname/dashboard/settings/payments/cards/:cardPk/settings/"}},inStorePaymentTypes:"/:shortname/dashboard/settings/payments/payment-types/",taxTypes:{index:"/:shortname/dashboard/settings/payments/tax-types/",
taxType:"/:shortname/dashboard/settings/payments/tax-types/:taxTypePk"},emvDevices:"/:shortname/dashboard/settings/payments/emv-devices/",bankAccounts:"/:shortname/dashboard/settings/payments/bank-accounts/",refundReserve:"/:shortname/dashboard/settings/payments/refund-reserve/",ledgers:{index:"/:shortname/dashboard/settings/payments/ledgers/",ledger:"/:shortname/dashboard/settings/payments/ledgers/:ledgerPk"}},profile:{index:"/:shortname/dashboard/settings/profile/",style:"/:shortname/dashboard/settings/profile/style/",
slideshow:"/:shortname/dashboard/settings/profile/slideshow/",pages:"/:shortname/dashboard/settings/profile/pages/"},info:{index:"/:shortname/dashboard/settings/info/",notesAndPolicies:{index:"/:shortname/dashboard/settings/info/notes/",health:"/:shortname/dashboard/settings/info/notes/health/"},contact:"/:shortname/dashboard/settings/info/contact/",socialMedia:"/:shortname/dashboard/settings/info/social-media/",advanced:"/:shortname/dashboard/settings/info/advanced/",tags:"/:shortname/dashboard/settings/info/tags/",
facts:"/:shortname/dashboard/settings/info/facts/"},cancellationPolicies:"/:shortname/dashboard/settings/cancellation-policies/",cancellationPolicy:{index:"/:shortname/dashboard/settings/cancellation-policies/:cancellationPolicyPk/",settings:"/:shortname/dashboard/settings/cancellation-policies/:cancellationPolicyPk/settings/"},tagGroups:{index:"/:shortname/dashboard/settings/tag-groups/",tagGroup:{index:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/",settings:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/settings/",
tag:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/tags/:tagPk/"}},seating:{index:"/:shortname/dashboard/settings/seat-maps/",seatMap:{index:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/",layout:{index:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/",seatGroup:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/seat-groups/:seatGroupPk/",duplicate:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/seats/:seatPks(pks)/duplicate/",seats:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/seats/:seatPks(pks)/",
"new":"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/new/:seatGroupPk/:xCoord/:yCoord/"},seatZones:{index:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/seat-zones/",seatZone:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/seat-zones/:seatZonePk/"},settings:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/settings/",activity:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/activity/"}},permissions:{index:"/:shortname/dashboard/settings/permissions/",groups:"/:shortname/dashboard/settings/permissions/groups/",
group:"/:shortname/dashboard/settings/permissions/groups/:groupPk/",groupOverrides:"/:shortname/dashboard/settings/permissions/outside-users/",groupOverride:"/:shortname/dashboard/settings/permissions/outside-users/:groupOverridePk/",users:"/:shortname/dashboard/settings/permissions/users/",user:{index:"/:shortname/dashboard/settings/permissions/users/:username/",settings:"/:shortname/dashboard/settings/permissions/users/:username/settings/",apiKeys:{index:"/:shortname/dashboard/settings/permissions/users/:username/api-keys/",
apiKey:"/:shortname/dashboard/settings/permissions/users/:username/api-keys/:resellerKeyPk/"}}},agents:{index:"/:shortname/dashboard/settings/agents/",agent:"/:shortname/dashboard/settings/agents/:agentPk/"},desks:{index:"/:shortname/dashboard/settings/desks/",desk:"/:shortname/dashboard/settings/desks/:deskPk/"},campaigns:{index:"/:shortname/dashboard/settings/campaigns/",campaign:{index:"/:shortname/dashboard/settings/campaigns/:campaignPk/",settings:"/:shortname/dashboard/settings/campaigns/:campaignPk/settings/",
code:"/:shortname/dashboard/settings/campaigns/:campaignPk/codes/:codePk/"}},checkinStatuses:"/:shortname/dashboard/settings/check-in/",customerTypes:{index:"/:shortname/dashboard/settings/customer-types/",customerType:"/:shortname/dashboard/settings/customer-types/:customerTypePk/"},requirementGroups:{index:"/:shortname/dashboard/settings/requirement-groups/",requirementGroup:"/:shortname/dashboard/settings/requirement-groups/:requirementGroupPk"},customFields:{index:"/:shortname/dashboard/settings/custom-fields/",
type:"/:shortname/dashboard/settings/custom-fields/type/:type/",customField:"/:shortname/dashboard/settings/custom-fields/:customFieldPk(pk)/"},cannedMessages:{index:"/:shortname/dashboard/settings/canned-messages/",cannedMessage:"/:shortname/dashboard/settings/canned-messages/:cannedMessagePk/"},availabilityHeadlines:{index:"/:shortname/dashboard/settings/headlines/",availabilityHeadline:"/:shortname/dashboard/settings/headlines/:availabilityHeadlinePk/"},network:{index:"/:shortname/dashboard/settings/network/",
affiliates:{index:"/:shortname/dashboard/settings/network/affiliates/",affiliate:{index:"/:shortname/dashboard/settings/network/affiliates/:affiliationPk/",cards:"/:shortname/dashboard/settings/network/affiliates/:affiliationPk/cards/"}},partners:{index:"/:shortname/dashboard/settings/network/partners/",partner:{index:"/:affiliateShortname/dashboard/settings/network/partners/:affiliationPk/",cards:"/:affiliateShortname/dashboard/settings/network/partners/:affiliationPk/cards/"}}},hotels:{index:"/:shortname/dashboard/settings/hotels/",
hotel:"/:shortname/dashboard/settings/hotels/:hotelPk/"},lodgings:{index:"/:shortname/dashboard/settings/lodgings/",lodging:"/:shortname/dashboard/settings/lodgings/:lodgingPk/"},pickups:{index:"/:shortname/dashboard/settings/pickups/",pickup:"/:shortname/dashboard/settings/pickups/:pickupPk/"},routes:{index:"/:shortname/dashboard/settings/routes/",route:"/:shortname/dashboard/settings/routes/:routePk/"},translations:{index:"/:shortname/dashboard/settings/languages/",language:{index:"/:shortname/dashboard/settings/languages/:languagePk/",
settings:"/:shortname/dashboard/settings/languages/:languagePk/settings/",translations:{index:"/:shortname/dashboard/settings/languages/:languagePk/translations/",forModel:"/:shortname/dashboard/settings/languages/:languagePk/translations/:modelName/"}}},pricing:{index:"/:shortname/dashboard/settings/pricing/",sheets:"/:shortname/dashboard/settings/pricing/sheets/",totalSheet:"/:shortname/dashboard/settings/pricing/total-sheets/:totalSheetPk/",invoiceSheet:"/:shortname/dashboard/settings/pricing/invoice-sheets/:invoiceSheetPk/",
schedules:"/:shortname/dashboard/settings/pricing/schedules/",totalSchedules:{index:"/:shortname/dashboard/settings/pricing/total-schedules/:totalSchedulePk/",settings:"/:shortname/dashboard/settings/pricing/total-schedules/:totalSchedulePk/settings/",entry:{index:"/:shortname/dashboard/settings/pricing/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/",settings:"/:shortname/dashboard/settings/pricing/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/settings/"}},invoiceSchedules:{index:"/:shortname/dashboard/settings/pricing/invoice-schedules/:invoiceSchedulePk/",
settings:"/:shortname/dashboard/settings/pricing/invoice-schedules/:invoiceSchedulePk/settings/",entry:{index:"/:shortname/dashboard/settings/pricing/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/",settings:"/:shortname/dashboard/settings/pricing/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/settings/"}},overview:"/:shortname/dashboard/settings/pricing/overview/"},activity:{index:"/:shortname/dashboard/settings/activity/",company:"/:shortname/dashboard/settings/activity/company/"},
embeds:"/:shortname/dashboard/settings/embeds/",connect:"/:shortname/dashboard/settings/connect/",integrations:{index:"/:shortname/dashboard/settings/integrations/",subscribe:"/:shortname/dashboard/settings/integrations/subscribe/"},reseller:{index:"/:shortname/dashboard/settings/integrations/channels/",requests:"/:shortname/dashboard/settings/integrations/channels/requests/",company:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/settings/"},
item:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/settings/"},customerType:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/customer-types/:resellerCustomerTypePk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/customer-types/:resellerCustomerTypePk/settings/"},
option:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/options/:resellerOptionPk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/options/:resellerOptionPk/settings/"},apps:{index:"/:shortname/dashboard/settings/integrations/apps/",app:{index:"/:shortname/dashboard/settings/integrations/apps/:resellerAppPk/",settings:"/:shortname/dashboard/settings/integrations/apps/:resellerAppPk/settings/"}}},
waivers:{index:"/:shortname/dashboard/settings/waivers/",waiver:{index:"/:shortname/dashboard/settings/waivers/:waiverPk/"}},locations:{index:"/:shortname/dashboard/settings/locations/",settings:"/:shortname/dashboard/settings/locations/settings/",location:"/:shortname/dashboard/settings/locations/location/:locationPk/"},storedValue:{index:"/:shortname/dashboard/settings/gift-cards/",storedValueTypes:"/:shortname/dashboard/settings/gift-cards/types/",storedValueType:"/:shortname/dashboard/settings/gift-cards/types/:storedValueTypePk/",
storedValueCards:"/:shortname/dashboard/settings/gift-cards/cards/",storedValueCard:{index:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/",settings:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/settings/",storedValueAdjustment:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/adjustments/:storedValueAdjustmentPk/"}},analyticsServices:{index:"/:shortname/dashboard/settings/analytics/",analyticsService:"/:shortname/dashboard/settings/analytics/:analyticsServicePk/"},
flows:{index:"/:shortname/dashboard/settings/flows/",flowNode:{index:"/:shortname/dashboard/settings/flows/:flowNodePk/"}},ticketLayouts:{index:"/:shortname/dashboard/settings/ticket-layouts/",ticketLayout:{index:"/:shortname/dashboard/settings/ticket-layouts/:ticketLayoutPk/"}},suggestedItems:"/:shortname/dashboard/settings/suggested-items/",bookingRestrictions:{index:"/:shortname/dashboard/settings/booking-restrictions/",bookingRestriction:"/:shortname/dashboard/settings/booking-restrictions/:bookingRestrictionPk/"}}},
root:{index:"/",login:"/login/",forgot:{index:"/forgot/",password:"/forgot/password/",resetPassword:"/forgot/password/reset/",credentials:"/forgot/credentials/"},version:"/version/",help:"/help/",demo:"/demo/",about:"/about/",tour:"/tour/"},email:{bookingNotification:"/email/:type/:shortname/bookings/:bookingUuid/",orderNotification:"/email/:type/:shortname/orders/:orderUuid/",invoicePaymentRequest:"/email/:type/:shortname/invoice/:invoicePk/"},embeds:{calendar:{index:"/embeds/calendar/:shortname/",
all:"/embeds/calendar/:shortname/all/",items:"/embeds/calendar/:shortname/items/:itemPks(pks)/"},cart:{index:"/embeds/cart/"},checkin:{index:"/embeds/checkin/",company:{index:"/embeds/checkin/:shortname/",booking:{index:"/embeds/checkin/:shortname/bookings/:bookingUuid/",customer:"/embeds/checkin/:shortname/bookings/:bookingUuid/customers/:customerPk/"}},qr:"/:encodedCustomerPk"},book:{index:"/embeds/book/:shortname/",storedValueCard:{index:"/embeds/book/:shortname/gift-cards/:storedValueCardNumber/"},
items:{index:"/embeds/book/:shortname/items/",calendar:"/embeds/book/:shortname/items/calendar/",date:{index:"/embeds/book/:shortname/items/date/",date:"/embeds/book/:shortname/items/date/:date/"}},item:{index:"/embeds/book/:shortname/items/:itemPk(pk)/",calendar:"/embeds/book/:shortname/items/:itemPk(pk)/calendar/",month:"/embeds/book/:shortname/items/:itemPk(pk)/calendar/:year/:month/",date:"/embeds/book/:shortname/items/:itemPk(pk)/date/:date/",availability:"/embeds/book/:shortname/items/:itemPk(pk)/availability/:availabilityPk/",
book:"/embeds/book/:shortname/items/:itemPk(pk)/availability/:availabilityPk/book/",booking:"/embeds/book/:shortname/items/:itemPk(pk)/booking/:bookingUuid/"},cart:{index:"/embeds/book/:shortname/cart/",flowNode:"/embeds/book/:shortname/cart/?flow=:flowNodePk",permalink:"/embeds/book/:shortname/cart/?u=:cartUuid"},order:{index:"/embeds/book/:shortname/orders/:orderUuid/"},flowNode:{index:"/embeds/book/:shortname/items/?flow=:flowNodePk",calendar:"/embeds/book/:shortname/items/calendar/?flow=:flowNodePk",
date:{index:"/embeds/book/:shortname/items/date/?flow=:flowNodePk",date:"/embeds/book/:shortname/items/date/:date/?flow=:flowNodePk"}},wait:{index:"/embeds/book/:shortname/pending/",order:"/embeds/book/:shortname/pending/orders/:orderUuid/",booking:"/embeds/book/:shortname/pending/bookings/:bookingUuid/"}},partners:{index:"/embeds/partners/",company:"/embeds/partners/:shortname/"},items:{index:"/embeds/items/:shortname/"},analytics:{booking:"/embeds/a/:shortname/booking/:bookingUuid/"}},pusher:{auth:"/realtime/auth/",
channels:"/realtime/:shortname/channels/",members:"/realtime/:shortname/members/"},api:{login:"/api/v1/login/",logout:"/api/v1/logout/",forgotPassword:"/api/v1/forgot/password/",resetPassword:"/api/v1/forgot/password/reset/",forgotCredentials:"/api/v1/forgot/credentials/",companies:"/api/v1/companies/",company:"/api/v1/companies/:shortname/",providerLogin:"/api/v1/companies/:shortname/login/provider/",companyNags:"/api/v1/companies/:shortname/nags/",companyFeatures:"/api/v1/companies/:shortname/features/",
refundReserve:"/api/v1/companies/:shortname/refund-reserve/",companyItemColorsFeature:"/api/v1/companies/:shortname/item-colors-feature/",companyProfile:"/api/v1/companies/:shortname/profile/",companyContactInformation:"/api/v1/companies/:shortname/contact-information/",processorAccount:"/api/v1/companies/:shortname/processor-account/",processorOnboard:"/api/v1/companies/:shortname/tax-information/onboard/",companyTosAcceptance:"/api/v1/companies/:shortname/tos/",companyAccounts:"/api/v1/companies/:shortname/accounts/",
companyStyles:"/api/v1/companies/:shortname/styles/",companyAdminNotes:"/api/v1/companies/:shortname/admin-notes/",companyPayments:"/api/v1/companies/:shortname/payments/",companyManifestSettings:"/api/v1/companies/:shortname/manifest-settings/",companyCalendar:"/api/v1/companies/:shortname/calendar/:year/:month/",companyImages:"/api/v1/companies/:shortname/images/",companyImage:"/api/v1/companies/:shortname/images/:imagePk/",tagGroups:"/api/v1/companies/:shortname/tag-groups/",tagGroup:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/",
tags:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/tags/",tag:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/tags/:tagPk/",objectTags:"/api/v1/companies/:shortname/tags/:objectCls/:objectPk/",taxTypes:"/api/v1/companies/:shortname/tax-types/",taxType:"/api/v1/companies/:shortname/tax-types/:taxTypePk/",inStorePaymentTypes:"/api/v1/companies/:shortname/in-store-payment-types/",allInStorePaymentTypes:"/api/v1/companies/:shortname/in-store-payment-types/all/",ledgers:"/api/v1/companies/:shortname/ledgers/",
allLedgers:"/api/v1/companies/:shortname/ledgers/all/",ledger:"/api/v1/companies/:shortname/ledgers/:ledgerPk/",inStorePaymentType:"/api/v1/companies/:shortname/in-store-payment-types/:inStorePaymentTypePk/",emvDevices:"/api/v1/companies/:shortname/emv-devices/",emvDevice:"/api/v1/companies/:shortname/emv-devices/:emvDevicePk/",retrieveConnectionToken:"/api/v1/companies/:shortname/emv-devices/connection-token/",createInteractionToken:"/api/v1/companies/:shortname/emv-devices/emv-interaction-token/",
checkEmvDeviceConnections:"/api/v1/companies/:shortname/emv-devices/check-connection/",checkEmvDeviceConnection:"/api/v1/companies/:shortname/emv-devices/check-connection/:emvDevicePk/",checkEmvChargeStatus:"/api/v1/companies/:shortname/emv-devices/charge-status/",cancelEmvCharge:"/api/v1/companies/:shortname/emv-devices/cancel-charge/",bankAccounts:"/api/v1/companies/:shortname/bank-accounts/",bankAccount:"/api/v1/companies/:shortname/bank-accounts/:bankAccountPk/",cards:"/api/v1/companies/:shortname/cards/",
card:"/api/v1/companies/:shortname/cards/:cardPk/",cardAffiliations:"/api/v1/companies/:shortname/cards/:cardPk/card-affiliations/",verifyBankAccount:"/api/v1/companies/:shortname/bank-accounts/:bankAccountPk/verify/",hotels:"/api/v1/companies/:shortname/hotels/",hotel:"/api/v1/companies/:shortname/hotels/:hotelPk/",lodgings:"/api/v1/companies/:shortname/lodgings/",duplicateLodgingsAcrossCompanies:"/api/v1/companies/:shortname/lodgings/duplicate/",lodging:"/api/v1/companies/:shortname/lodgings/:lodgingPk/",
preferredPickups:"/api/v1/companies/:shortname/lodgings/:lodgingPk/preferred-pickups/",preferredPickup:"/api/v1/companies/:shortname/lodgings/:lodgingPk/preferred-pickups/:preferredPickupPk/",pickups:"/api/v1/companies/:shortname/pickups/",duplicatePickupsAcrossCompanies:"/api/v1/companies/:shortname/pickups/duplicate/",pickup:"/api/v1/companies/:shortname/pickups/:pickupPk/",routes:"/api/v1/companies/:shortname/routes/",duplicateRoutesAcrossCompanies:"/api/v1/companies/:shortname/routes/duplicate/",
route:"/api/v1/companies/:shortname/routes/:routePk/",routeItems:"/api/v1/companies/:shortname/routes/:routePk/items/",duplicateRoute:"/api/v1/companies/:shortname/routes/:routePk/duplicate/",stops:"/api/v1/companies/:shortname/routes/:routePk/stops/",stop:"/api/v1/companies/:shortname/routes/:routePk/stops/:stopPk/",customManifests:"/api/v1/companies/:shortname/custom-manifests/",customManifest:"/api/v1/companies/:shortname/custom-manifests/:customManifestPk/",customCalendars:"/api/v1/companies/:shortname/custom-calendars/",
customCalendar:"/api/v1/companies/:shortname/custom-calendars/:customCalendarPk/",customReports:"/api/v1/companies/:shortname/custom-reports/",customReport:"/api/v1/companies/:shortname/custom-reports/:customReportPk/",users:"/api/v1/companies/:shortname/users/",allUsers:"/api/v1/companies/:shortname/users/all/",relatedUsers:"/api/v1/companies/:shortname/users/related/",user:"/api/v1/companies/:shortname/users/:username/",userNags:"/api/v1/companies/:shortname/users/:username/nags/",userActivities:"/api/v1/companies/:shortname/users/:username/activities/",
userSubscriptions:"/api/v1/companies/:shortname/users/:username/subscriptions/",userItemSubscriptions:"/api/v1/companies/:shortname/users/:username/subscriptions/items/:itemPk/",userOverview:"/api/v1/companies/:shortname/users/:username/overview/",reorder:"/api/v1/companies/:shortname/reorder/:objectCls/:objectPk/",activities:"/api/v1/companies/:shortname/activities/:activityObjectCls/:activityObjectPks/",activity:"/api/v1/companies/:shortname/activities/:activityPk(pk)/",allActivities:"/api/v1/companies/:shortname/activities/all/",
systemActivities:"/api/v1/companies/:shortname/activities/system/",notes:"/api/v1/companies/:shortname/activities/:activityObjectCls/:activityObjectPk/notes/",items:"/api/v1/companies/:shortname/items/",allItems:"/api/v1/companies/:shortname/items/all/",item:"/api/v1/companies/:shortname/items/:itemPk/",itemColor:"/api/v1/companies/:shortname/items/:itemPk/color/",itemPricingOverview:"/api/v1/companies/:shortname/items/:itemPk/pricing-overview/",duplicateItem:"/api/v1/companies/:shortname/items/:itemPk/duplicate/",
itemCalendar:"/api/v1/companies/:shortname/items/:itemPk/calendar/:year/:month/",itemSubscriptions:"/api/v1/companies/:shortname/items/:itemPk/subscriptions/",itemImages:"/api/v1/companies/:shortname/items/:itemPk/images/",itemImage:"/api/v1/companies/:shortname/items/:itemPk/images/:imagePk/",itemRatings:"/api/v1/companies/:shortname/items/:itemPk/ratings/",itemFlowPages:"/api/v1/companies/:shortname/items/:itemPk/flow-nodes/",itemsCalendar:"/api/v1/companies/:shortname/items/:itemPks(pks)/calendar/:year/:month/",
flowNodes:"/api/v1/companies/:shortname/flow-nodes/",flowNode:"/api/v1/companies/:shortname/flow-nodes/:flowNodePk/",defaultFlowPage:"/api/v1/companies/:shortname/flow-nodes/default/",duplicateFlowNode:"/api/v1/companies/:shortname/flow-nodes/:flowNodePk/duplicate/",cannedMessages:"/api/v1/companies/:shortname/canned-messages/",cannedMessage:"/api/v1/companies/:shortname/canned-messages/:cannedMessagePk/",cannedMessageItems:"/api/v1/companies/:shortname/canned-messages/:cannedMessagePk/items/",cannedMessageAvailabilityHeadlines:"/api/v1/companies/:shortname/canned-messages/:cannedMessagePk/availability-headlines/",
availabilityHeadlines:"/api/v1/companies/:shortname/availability-headlines/",availabilityHeadline:"/api/v1/companies/:shortname/availability-headlines/:availabilityHeadlinePk/",availabilityHeadlineItems:"/api/v1/companies/:shortname/availability-headlines/:availabilityHeadlinePk/items/",allCustomerTypes:"/api/v1/companies/:shortname/customer-types/all/",customerTypes:"/api/v1/companies/:shortname/customer-types/",customerType:"/api/v1/companies/:shortname/customer-types/:customerTypePk/",customerTypeItems:"/api/v1/companies/:shortname/customer-types/:customerTypePk/items/",
customerPrototypes:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/",customerPrototype:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/:customerPrototypePk/",duplicateCustomerPrototype:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/:customerPrototypePk/duplicate/",allCustomerPrototypes:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/all/",customerPrototypesMulti:"/api/v1/companies/:shortname/items/customer-prototypes/multi/",checkinStatuses:"/api/v1/companies/:shortname/checkin-statuses/",
checkinStatus:"/api/v1/companies/:shortname/checkin-statuses/:checkinStatusPk/",checkinStatusForBookings:"/api/v1/companies/:shortname/checkin-statuses/bookings/",roles:"/api/v1/companies/:shortname/roles/",role:"/api/v1/companies/:shortname/roles/:rolePk/",crewMembers:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/crew-members/",crewMember:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/crew-members/:crewMemberPk/",customFields:"/api/v1/companies/:shortname/custom-fields/",
allCustomFields:"/api/v1/companies/:shortname/custom-fields/all/",customField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/",customFieldItems:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/items/",duplicateCustomField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/duplicate/",prevalidateCustomField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/prevalidate/total-sheets/:totalSheetPk/availabilities/:availabilityPk/",transportationOptions:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/transportation-options/",
transportationOption:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/transportation-options/:transportationOptionPk/",extendedOptions:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/extended-options/",extendedOption:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/extended-options/:extendedOptionPk/",connectedCampaigns:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-campaigns/",connectedCampaign:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-campaigns/:connectedCampaignPk/",
generatingCampaigns:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/generating-campaigns/",generatingCampaign:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/generating-campaigns/:generatingCampaignPk/",campaigns:"/api/v1/companies/:shortname/campaigns/",campaign:"/api/v1/companies/:shortname/campaigns/:campaignPk/",campaignValidityRules:"/api/v1/companies/:shortname/campaigns/:campaignPk/campaign-validity-rules/",campaignValidityRule:"/api/v1/companies/:shortname/campaigns/:campaignPk/campaign-validity-rules/:campaignValidityRulePk/",
campaignCustomFields:"/api/v1/companies/:shortname/campaigns/:campaignPk/custom-fields/",storedValueTypes:"/api/v1/companies/:shortname/stored-value-types/",storedValueType:"/api/v1/companies/:shortname/stored-value-types/:storedValueTypePk/",storedValueCards:"/api/v1/companies/:shortname/stored-value-cards/",issueStoredValueCard:"/api/v1/companies/:shortname/stored-value-cards/issue/",storedValueCard:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/",storedValueCardPayments:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/payments/",
storedValueCardNotifications:"/api/v1/companies/:shortname/stored-value-cards/notifications/?q=:storedValueCardNumber",searchStoredValueCardsByNumber:"/api/v1/companies/:shortname/stored-value-cards/search/",storedValueAdjustments:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/adjustments/",storedValueAdjustment:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/adjustments/:storedValueAdjustmentPk/",codes:"/api/v1/companies/:shortname/campaigns/:campaignPk/codes/",
code:"/api/v1/companies/:shortname/campaigns/:campaignPk/codes/:codePk/",codesByTag:"/api/v1/companies/:shortname/campaigns/:campaignPk/codes/:tag/",allAffiliates:"/api/v1/companies/:shortname/affiliates/all/",affiliates:"/api/v1/companies/:shortname/affiliates/",affiliate:"/api/v1/companies/:shortname/affiliates/:affiliationPk/",affiliateCards:"api/v1/companies/:shortname/affiliates/:affiliationPk/cards/",affiliateCardAffiliations:"/api/v1/companies/:shortname/affiliates/:affiliationPk/card-affiliations/",
partners:"/api/v1/companies/:shortname/partners/",partner:"/api/v1/companies/:affiliateShortname/partners/:affiliationPk/",partnerCards:"/api/v1/companies/:shortname/partners/:affiliationPk/cards/",partnerCardAffiliations:"/api/v1/companies/:shortname/partners/:affiliationPk/card-affiliations/",allAgents:"/api/v1/companies/:shortname/agents/all/",agents:"/api/v1/companies/:shortname/agents/",agent:"/api/v1/companies/:shortname/agents/:agentPk/",allDesks:"/api/v1/companies/:shortname/desks/all/",desks:"/api/v1/companies/:shortname/desks/",
desk:"/api/v1/companies/:shortname/desks/:deskPk/",customFieldInstances:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instances/",customFieldInstancesMulti:"/api/v1/companies/:shortname/items/custom-field-instances/multi/",customFieldInstance:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instances/:customFieldInstancePk/",customFieldInstanceConditions:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instances/:customFieldInstancePk/conditions/",customFieldInstanceCondition:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instances/:customFieldInstancePk/conditions/:customFieldInstanceConditionPk/",
customFieldInstanceGroups:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instance-groups/",customFieldInstanceGroup:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instance-groups/:customFieldInstanceGroupPk/",customFieldInstanceGroupsMulti:"/api/v1/companies/:shortname/items/custom-field-instance-groups/multi/",duplicateCustomFieldInstanceGroup:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instance-groups/:customFieldInstanceGroupPk/duplicate/",supportedLanguages:"/api/v1/companies/:shortname/supported-languages/",
supportedLanguage:"/api/v1/companies/:shortname/supported-languages/:languagePk/",translationsForModel:"/api/v1/companies/:shortname/supported-languages/:languagePk/translations/:modelName/",translationsForField:"/api/v1/companies/:shortname/translations/:objectType/:objectId/:objectField/",understoodLanguages:"/api/v1/companies/:shortname/understood-languages/",translationsForSubfield:"/api/v1/companies/:shortname/translations/:objectType/:objectId/:objectField/:subfield/",nextAvailability:"/api/v1/companies/:shortname/items/:itemPk/availabilities/next/",
futureAvailabilityCount:"/api/v1/companies/:shortname/:objectType/:objectPk/availabilities/future/count/",availabilitiesByDate:"/api/v1/companies/:shortname/items/:itemPk/availabilities/date/:date/",availabilitiesByResource:"/api/v1/companies/:shortname/items/:itemPk/availabilities/date/:date/resource/:resourcePk/",availabilitiesByTag:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:tag/",availability:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/",availabilityStatus:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/status/",
availabilityLiveCapacity:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/live/",availabilityResourceUses:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/resource-uses/",updateItemAvailabilities:"/api/v1/companies/:shortname/items/:itemPk/availabilities/update/",updateAvailabilities:"/api/v1/companies/:shortname/availabilities/update/",availabilityNote:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/note/",availabilityCheckinStatuses:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/checkin-statuses/",
sendConfirmations:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/send-confirmations/",notifications:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/notifications/",smsNotifications:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/sms-notifications/",subjectsBooking:"/api/v1/companies/:shortname/subjects/:type/bookings/:bookingUuid/:language/",subjectsOrder:"/api/v1/companies/:shortname/subjects/:type/orders/:orderUuid/:language/",
subjectsAvailability:"/api/v1/companies/:shortname/subjects/:type/availabilities/:availabilityPk/:languages/",customerTypeRates:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/customer-type-rates/",customerTypeRate:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/customer-type-rates/:customerTypeRatePk/",blocks:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/blocks/",block:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/blocks/:blockPk/",
rule:"/api/v1/companies/:shortname/items/:itemPk/availabilities/rule/",orders:"/api/v1/companies/:shortname/orders/",order:"/api/v1/companies/:shortname/orders/:orderUuid/",orderPayments:"/api/v1/companies/:shortname/orders/:orderUuid/payments/",orderNotification:"/api/v1/companies/:shortname/orders/:orderUuid/notification/",orderCancellation:"/api/v1/companies/:shortname/orders/:orderUuid/cancel/",book:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/book/",bookings:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/bookings/",
booking:"/api/v1/companies/:shortname/bookings/:bookingUuid/",bookingByPk:"/api/v1/companies/:shortname/bookings/:bookingPk/",repriceBooking:"/api/v1/companies/:shortname/bookings/:bookingUuid/reprice/",bookingCheckinStatus:"/api/v1/companies/:shortname/bookings/:bookingUuid/checkin-status/",customerCheckinStatus:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers/:customerPk/checkin-status/",bookingCustomersWithSeatAssignments:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers-with-seat-assignments/",
orderCustomersWithSeatAssignments:"/api/v1/companies/:shortname/orders/:orderUuid/customers-with-seat-assignments/",bookingNote:"/api/v1/companies/:shortname/bookings/:bookingUuid/note/",bookingExplicitGross:"/api/v1/companies/:shortname/bookings/:bookingUuid/explicit-gross/",bookingExplicitInvoicePrice:"/api/v1/companies/:shortname/bookings/:bookingUuid/explicit-invoice-price/",bookingNotificationOptions:"/api/v1/companies/:shortname/bookings/:bookingUuid/notification-options/",bookingEffectiveCancellationRule:"/api/v1/companies/:shortname/bookings/:bookingUuid/effective-cancellation-rule/",
searchCustomersByEncodedPk:"/embeds/redirect/checkin/:encodedPk/",contact:"/api/v1/companies/:shortname/contacts/:contactPk/",contactBookings:"/api/v1/companies/:shortname/contacts/:contactPk/bookings/",contactPayments:"/api/v1/companies/:shortname/contacts/:contactPk/payments/",affiliation:"/api/v1/companies/:shortname/bookings/:bookingUuid/affiliation/",notification:"/api/v1/companies/:shortname/bookings/:bookingUuid/notification/",smsNotification:"/api/v1/companies/:shortname/bookings/:bookingUuid/sms-notifications/",
lineItems:"/api/v1/companies/:shortname/bookings/:bookingUuid/line-items/",lineItem:"/api/v1/companies/:shortname/bookings/:bookingUuid/line-items/:lineItemPk/",customerCustomFieldValue:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers/custom-field-values/:customerCustomFieldValuePk/",bookingCustomFieldValue:"/api/v1/companies/:shortname/bookings/:bookingUuid/custom-field-values/:bookingCustomFieldValuePk/",payments:"/api/v1/companies/:shortname/bookings/:bookingUuid/payments/",relatedPayments:"/api/v1/companies/:shortname/bookings/:bookingUuid/payments/related/",
authorizationHolds:"/api/v1/companies/:shortname/bookings/:bookingUuid/authorization-holds/",refunds:"/api/v1/companies/:shortname/bookings/:bookingUuid/refunds/",orderRefunds:"/api/v1/companies/:shortname/orders/:orderUuid/refunds/",customRefunds:"/api/v1/companies/:shortname/bookings/:bookingUuid/refunds/custom/",availabilitiesManifest:"/api/v1/companies/:shortname/manifest/availabilities/date/:date/",bookingsManifest:"/api/v1/companies/:shortname/manifest/bookings/date/:date/",runsManifest:"/api/v1/companies/:shortname/manifest/runs/date/:date/",
resourcesManifest:"/api/v1/companies/:shortname/manifest/resources/date/:date/",manifestSelectableAvailabilities:"/api/v1/companies/:shortname/manifest/selectable-availabilities/date/:date/",searchAllAvailabilitiesByDate:"/api/v1/companies/:shortname/search/availabilities/date/:date/",searchAvailabilitiesByDate:"/api/v1/companies/:shortname/search/items/:itemPks(pks)/availabilities/date/:date/",searchAvailabilitiesByUpcoming:"/api/v1/companies/:shortname/search/availabilities/upcoming/:filter",searchAvailabilitiesByPk:"/api/v1/companies/:shortname/search/availabilities/:availabilityPks/",
searchBookingsByQuery:"/api/v1/companies/:shortname/search/bookings/query/:filter",searchBookingsByNew:"/api/v1/companies/:shortname/search/bookings/new/:filter",searchBookingsByUuid:"/api/v1/companies/:shortname/search/bookings/:bookingUuids/",searchRunsByDate:"/api/v1/companies/:shortname/search/runs/date/:date/",bookingsByContact:"/api/v1/companies/:shortname/search/bookings/contact/:contactPk/",invoices:"/api/v1/companies/:shortname/invoices/",invoice:"/api/v1/companies/:shortname/invoices/:invoicePk/",
uuidInvoice:"/api/v1/companies/:shortname/invoices/uuid/:invoiceUuid/",invoiceNotifications:"/api/v1/companies/:shortname/invoices/:invoicePk/notifications/",invoiceUploads:"/api/v1/companies/:shortname/invoices/:invoicePk/uploads/",partnerInvoice:"/api/v1/companies/:shortname/invoices/partner-invoices/:invoicePk/",groups:"/api/v1/companies/:shortname/groups/",group:"/api/v1/companies/:shortname/groups/:groupPk/",duplicateGroup:"/api/v1/companies/:shortname/groups/:groupPk/duplicate/",groupOverrides:"/api/v1/companies/:shortname/group-overrides/",
groupOverride:"/api/v1/companies/:shortname/group-overrides/:groupOverridePk/",groupOverrideActivities:"/api/v1/companies/:shortname/group-overrides/:groupOverridePk/activities/",relatedGroupOverrides:"/api/v1/companies/:shortname/group-overrides/related/",reports:"/api/v1/companies/:shortname/reports/",recentReports:"/api/v1/companies/:shortname/reports/recent/",inProgressReports:"/api/v1/companies/:shortname/reports/in-progress/",volumeOverviewReport:"/api/v1/companies/:shortname/reports/volume-overview/",
dailyVolumeOverviewReport:"/api/v1/companies/:shortname/reports/daily-volume-overview/",paymentOverviewReport:"/api/v1/companies/:shortname/reports/payment-overview/",itemsSummaryOverviewReport:"/api/v1/companies/:shortname/reports/items-summary-overview/",nextPayoutOverviewReport:"/api/v1/companies/:shortname/reports/next-payout-overview/",report:"/api/v1/companies/:shortname/reports/:reportPk(pk)/",reportObjects:"/api/v1/companies/:shortname/reports/:reportPk(pk)/objects/",reportReports:"/api/v1/companies/:shortname/reports/reports/",
reportContacts:"/api/v1/companies/:shortname/reports/contacts/",reportBookings:"/api/v1/companies/:shortname/reports/bookings/",reportInvoiceableBookings:"/api/v1/companies/:shortname/reports/invoiceable-bookings/",reportTest:"/api/v1/companies/:shortname/reports/test/",reportLineItems:"/api/v1/companies/:shortname/reports/line-items/",reportPayments:"/api/v1/companies/:shortname/reports/payments/",reportDisputes:"/api/v1/companies/:shortname/reports/disputes/",reportPayouts:"/api/v1/companies/:shortname/reports/payouts/",
reportInvoices:"/api/v1/companies/:shortname/reports/invoices/",reportAccounts:"/api/v1/companies/:shortname/reports/accounts/",reportTransactions:"/api/v1/companies/:shortname/reports/transactions/",reportEscrow:"/api/v1/companies/:shortname/reports/escrow/",reportVolume:"/api/v1/companies/:shortname/reports/volume/",reportCompanies:"/api/v1/companies/:shortname/reports/companies/",reportItemsSummary:"/api/v1/companies/:shortname/reports/summary/items/",reportUsersSummary:"/api/v1/companies/:shortname/reports/summary/users/",
reportBookingTypesSummary:"/api/v1/companies/:shortname/reports/summary/booking-types/",reportCustomerTypesSummary:"/api/v1/companies/:shortname/reports/summary/customer-types/",reportCustomFieldSummary:"/api/v1/companies/:shortname/reports/summary/custom-field/",reportLodgingsSummary:"/api/v1/companies/:shortname/reports/summary/lodgings/",reportPickupsSummary:"/api/v1/companies/:shortname/reports/summary/pickups/",reportCrewSummary:"/api/v1/companies/:shortname/reports/summary/crew/",reportAgentsSummary:"/api/v1/companies/:shortname/reports/summary/agents/",
reportDesksSummary:"/api/v1/companies/:shortname/reports/summary/desks/",reportCampaignsSummary:"/api/v1/companies/:shortname/reports/summary/campaigns/",reportRevenueSummary:"/api/v1/companies/:shortname/reports/summary/revenue/",reportAdvanced:"/api/v1/companies/:shortname/reports/advanced/",reviewExpressSettings:"/api/v1/companies/:shortname/items/:itemPk/review-express-settings/",picthriveSettings:"/api/v1/companies/:shortname/items/:itemPk/picthrive-settings/",payouts:"/api/v1/companies/:shortname/payouts/",
payout:"/api/v1/companies/:shortname/payouts/:payoutPk/",payoutRetry:"/api/v1/companies/:shortname/payouts/:payoutPk/retry/",transfers:"/api/v1/companies/:shortname/transfers/",transfer:"/api/v1/companies/:shortname/transfers/:transferPk/",oneTimeTransfer:"/api/v1/companies/:shortname/one-time-transfer/",upcomingRefundReserveAmounts:"/api/v1/companies/:shortname/upcoming-refund-reserve-amounts/",uploads:"/api/v1/companies/:shortname/uploads/",upload:"/api/v1/companies/:shortname/uploads/:uploadPk/",
adjustments:"/api/v1/companies/:shortname/adjustments/",adjustment:"/api/v1/companies/:shortname/adjustments/:adjustmentPk/",waivers:"/api/v1/companies/:shortname/waivers/",waiver:"/api/v1/companies/:shortname/waivers/:waiverPk/",waiverInstance:"/api/v1/companies/:shortname/waivers/:waiverPk/waiver-instances/:waiverInstancePk/",connectedWaivers:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-waivers/",connectedWaiver:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-waivers/:connectedWaiverPk/",
locations:"/api/v1/companies/:shortname/locations/",location:"/api/v1/companies/:shortname/locations/:locationPk/",locationItems:"/api/v1/companies/:shortname/locations/:locationPk/items/",primaryLocation:"/api/v1/companies/:shortname/locations/primary/",totalSchedules:"/api/v1/companies/:shortname/total-schedules/",totalSchedule:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/",totalScheduleAffiliations:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/affiliations/",
duplicateTotalSchedule:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/duplicate/",totalScheduleEntries:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/entries/",totalScheduleEntry:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/",totalScheduleEntryRules:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/rules/",totalScheduleEntryRule:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/rules/:totalScheduleEntryRulePk/",
invoiceSchedules:"/api/v1/companies/:shortname/invoice-schedules/",invoiceSchedule:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/",invoiceScheduleAffiliations:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/affiliations/",duplicateInvoiceSchedule:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/duplicate/",invoiceScheduleEntries:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/entries/",invoiceScheduleEntry:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/",
invoiceScheduleEntryRules:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/rules/",invoiceScheduleEntryRule:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/rules/:invoiceScheduleEntryRulePk/",effectiveSheets:"/api/v1/companies/:shortname/availabilities/:availabilityPk/effective-sheets/",affiliationEffectiveSheets:"/api/v1/companies/:shortname/availabilities/:availabilityPk/affiliations/:affiliationPk/effective-sheets/",
rebookingEffectiveSheets:"/api/v1/companies/:shortname/availabilities/:availabilityPk/bookings/:bookingUuid/effective-sheets/",totalScheduleEffectiveSheet:"/api/v1/companies/:shortname/availabilities/:availabilityPk/total-schedules/:totalSchedulePk/effective-sheets/",invoiceScheduleEffectiveSheet:"/api/v1/companies/:shortname/availabilities/:availabilityPk/invoice-schedules/:invoiceSchedulePk/effective-sheets/",totalSheets:"/api/v1/companies/:shortname/total-sheets/",totalSheet:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/",
totalSheetSchedules:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/schedules/",totalSheetAffiliations:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/affiliations/",duplicateTotalSheet:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/duplicate/",totalPricing:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/pricing/:objectCls/:objectPk/",totalStack:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/pricing/:objectCls/:objectPk/stack/",invoiceSheets:"/api/v1/companies/:shortname/invoice-sheets/",
invoiceSheet:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/",invoiceSheetSchedules:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/schedules/",invoiceSheetAffiliations:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/affiliations/",duplicateInvoiceSheet:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/duplicate/",invoicePricing:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/pricing/:objectCls/:objectPk/",invoiceStack:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/pricing/:objectCls/:objectPk/stack/",
resources:"/api/v1/companies/:shortname/resources/",resource:"/api/v1/companies/:shortname/resources/:resourcePk/",resourceItems:"/api/v1/companies/:shortname/resources/:resourcePk/items/",resourceRequirementGroups:"/api/v1/companies/:shortname/resources/:resourcePk/requirement-groups/",resourceAvailabilities:"/api/v1/companies/:shortname/resources/:resourcePk/availabilities/date/:date/",resourceUsesByDate:"/api/v1/companies/:shortname/resources/:resourcePk/resource-uses/:date/",resourceUsesCalendar:"/api/v1/companies/:shortname/resources/:resourcePk/resource-uses/calendar/:year/:month/",
resourceUsesUnassignSeats:"/api/v1/companies/:shortname/resource-uses/unassign-seats/",reapplyResourceUses:"/api/v1/companies/:shortname/reapply-resource-uses/",requirementGroups:"/api/v1/companies/:shortname/requirement-groups/",itemRequirementGroups:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/",requirementGroup:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/",duplicateRequirementGroup:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/duplicate/",
requirementGroupItems:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/items/",requirements:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/requirements/",requirement:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/requirements/:requirementPk/",resourceRequirements:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/requirements/:requirementPk/resource-requirements/",resourceRequirement:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/requirements/:requirementPk/resource-requirements/:resourceRequirementPk/",
resourceUse:"/api/v1/companies/:shortname/bookings/:bookingUuid/resource-uses/:resourceUsePk/",resourceOverride:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:resourceOverridePk/",resourceOverrideRule:"/api/v1/companies/:shortname/resources/:resourcePk/resource-override-rule/",resourceOverridesByTag:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:tag/",resourceOverridesByDate:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:date/",
seatResourceOverrides:"/api/v1/companies/:shortname/seat-resource-overrides/",seatMaps:"/api/v1/companies/:shortname/seat-maps/",seatMap:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/",duplicateSeatMap:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/duplicate/",seatMapResourceUsesBySeat:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/resource-uses/:startAt/:endAt/",seatMapResourceOverridesBySeat:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/resource-overrides/:startAt/:endAt/",seatMapResources:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/resources/",
seatGroups:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/seat-groups/",seatGroup:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/seat-groups/:seatGroupPk/",seatZones:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/seat-zones/",seatZone:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/seat-zones/:seatZonePk/",availabilitiesWithResourceRequirements:"/api/v1/companies/:shortname/availabilities/:availabilityPks(pks)/resource-requirements/",seatRequirements:"/api/v1/companies/:shortname/availabilities/:availabilityPk/total-sheets/:totalSheetPk/seat-requirements/",
customersWithSeats:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers-with-seats/",resellerCompanies:"/api/v1/companies/:shortname/reseller-companies/",resellerCompany:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/",resellerCompanyMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-company-mappings/",resellerCompanyMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-company-mappings/:resellerCompanyMappingPk/",
resellerItems:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/",resellerItem:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/",resellerItemMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-item-mappings/",resellerItemMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-item-mappings/:resellerItemMappingPk",
resellerCustomerTypes:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/",resellerCustomerType:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/",resellerCustomerTypeMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/reseller-customer-type-mappings/",
resellerCustomerTypeMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/reseller-customer-type-mappings/:resellerCustomerTypeMappingPk/",resellerOptions:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/",resellerOption:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/",
resellerOptionMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/reseller-option-mappings/",resellerOptionMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/reseller-option-mappings/:resellerOptionMappingPk/",resellerUnmappedItems:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/unmapped/items/",
resellerUnmappedCustomerPrototypes:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/unmapped/customer-prototypes/",resellerKeys:"/api/v1/companies/:shortname/users/:username/reseller-keys/",resellerKey:"/api/v1/companies/:shortname/reseller-keys/:resellerKeyPk/",resellerApps:"/api/v1/companies/:shortname/reseller-apps/",resellerApp:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/",resellerAppRequests:"/api/v1/companies/:shortname/reseller-app-requests/",
resellerAppRequest:"/api/v1/companies/:shortname/reseller-app-requests/:resellerAppRequestPk/",resellerAppCompanies:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/reseller-app-companies/",resellerAppCompany:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/reseller-app-companies/:resellerAppCompanyPk",ticketLayouts:"/api/v1/companies/:shortname/ticket-layouts/",ticketLayout:"/api/v1/companies/:shortname/ticket-layouts/:ticketLayoutPk/",analyticsServices:"/api/v1/companies/:shortname/a-services/",
analyticsService:"/api/v1/companies/:shortname/a-services/:analyticsServicePk/",cancellationPolicies:"/api/v1/companies/:shortname/cancellation-policies/",cancellationPolicy:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/",cancellationRules:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/cancellation-rules/",cancellationRule:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/cancellation-rules/:cancellationRulePk/",cancellationPolicyAffiliations:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/affiliations/",
cancellationPolicyItems:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/items/",bookingRestrictions:"/api/v1/companies/:shortname/booking-restrictions/",bookingRestriction:"/api/v1/companies/:shortname/booking-restrictions/:bookingRestrictionPk/",bookingRestrictionItems:"/api/v1/companies/:shortname/booking-restrictions/:bookingRestrictionPk/items/",persistentStore:"/api/v1/persistence/:identifier/",persistentStoreForCompany:"/api/v1/persistence/:identifier/:shortname/",
persistentStoreItem:"/api/v1/persistence/:identifier/:shortname/:key/",taskResult:"/api/v1/task-result/:taskId/",version:"/api/v1/version/",token:"/api/v1/queuing/items/:itemPk/refresh/",isItemQueued:"/api/v1/queuing/items/:itemPk/is-queued/",view:"/api/v1/view/:objectType/:objectIdentifier/"}};return n}]);m.run(["$rootScope","urls",function(c,k){c.urls=k}])})();angular.module("native",["native.services"]);
(function(){var m=angular.module("native.services",[]);m.factory("native",["$rootScope","$window","auth","db","events","navigation","urls",function(c,k,d,h,f,n,a){var m={STRONG_SUCCESS_INDICATION:"fareharbor.native.indicate.strongSuccessIndication",WEAK_SUCCESS_INDICATION:"fareharbor.native.indicate.weakSuccessIndication",STRONG_ERROR_INDICATION:"fareharbor.native.indicate.strongErrorIndication",WEAK_ERROR_INDICATION:"fareharbor.native.indicate.weakErrorIndication"},g=h.slipstream("isNative")||!1,
b=h.slipstream("nativeClient")||"",e=h.slipstream("nativeClientVersion")||"",z=h.slipstream("isDebug"),v=h.slipstream("domain"),r=h.slipstream("protocol"),C={isNative:g,client:b,version:e,broadcast:function(a,b,c){c=c||"fareharbor";console.info("native: triggering",a,b,c);k.webkit&&k.webkit.messageHandlers&&k.webkit.messageHandlers[c]?(b=_.extend({type:a},b),k.webkit.messageHandlers[c].postMessage(b)):k.fhdroid?b?fhdroid.postMessage(a,_.stringifyJSON(b)):fhdroid.postMessage(a):console.warn("native: native client unavailable")},
indicate:function(a){a=a||m.WEAK_SUCCESS_INDICATION;C.broadcast("fareharbor.native.indicate",{indication:a})},print:function(a){var b={};if(a){var c=["<!DOCTYPE html>",'<html class="native-print">',"<head>",'<meta name="viewport" content="initial-scale=1.0" />'];_.forEach($('head link[type="text/css"][href^="/"]'),function(a){a=$(a).attr("href");a=_.startsWith(a,"//")?r+":"+a:r+"://"+v+a;c.push('<link rel="stylesheet" href="'+a+'" type="text/css">')});c.push("</head>");c.push("<body>");c.push(a.outerHTML);
c.push("</body>");c.push("</html>");b.html=c.join("\n")}console.info("native: print",b);C.broadcast("fareharbor.native.print",b)}};_.extend(C,m);f.on(c,"auth.logout",function(){C.broadcast("fareharbor.native.loggedOut")});d.currentUser.isAuthenticated||C.broadcast("fareharbor.native.logOut");k.FH={nativeEvent:function(a){c.$safeApply(function(){f.broadcast(a.type,a)})}};C.broadcast("fareharbor.native.ready",{sonarKey:h.slipstream("pusherKey")},"fareharborExtended");f.on(c,"fareharbor.native.inApp",
function(a,b){C.isNative=!0;b=b||{};C.client=b.client||C.client||"unknown";C.version=b.version||C.version||"unknown"});f.on(c,"navigation.company.updated",function(a,b){if(b&&b.company){var c=b.company,e=d.effectiveGroup({},c),c=_.pick(c,"shortname name language imageCdnUrl imageEmailCdnUrl features processorCurrency timezone timeFormatType".split(" ")),e=_.pick(e,["pk","groupPermissions"]);C.broadcast("fareharbor.native.companyChanged",{company:c,group:e},"fareharborExtended")}});h=function(){var a=
d.effectiveGroup({},d.currentUser.company);C.broadcast("fareharbor.native.userPermissionsChanged",{group:_.pick(a,["pk","groupPermissions"])},"fareharborExtended")};f.on(c,"dashboard.shared.userPermissionsChanged",h);f.on(c,"dashboard.shared.permissionsGroupChanged",h);f.on(c,"fareharbor.native.booking.open",function(b,c){var d=a.populate(a.dashboard.overlay.contact.booking,{shortname:c.shortname,contactPk:c.contactPk,bookingUuid:c.bookingUuid});n.navigate(d)});if(z)f.on(c,"fareharbor.native.test",
function(a,b){k.confirm("fareharbor.native.test triggered; respond?")&&C.broadcast("fareharbor.native.testSucceeded",{number:42})});return C}]);m.run(["$rootScope","native",function(c,k){c.native=k}])})();angular.module("navigation",["navigation.services","navigation.directives"]);
(function(){var m=angular.module("navigation.directives",["clientOptions.services","lib.services"]);m.directive("ngNavigationActive",["d","navigation",function(c,d){return{restrict:"A",link:function(h,f,n){var a=h.isSet(n.ngNavigationExact)?d.pathEquals:d.pathStartsWith,m,g=function(){var b=m();b?_.isString(b)?f.toggleClass("current",!!a(b)):_.isArray(b)?f.toggleClass("current",_.any(b,function(c){return!c?(console.warn("ng-navigation-active: empty url in list",c,b,n.ngNavigationActive,n.ngHref),
!1):!!a(c)})):console.warn("ng-navigation-active: invalid url",b,n.ngNavigationActive,n.ngHref):(console.warn("ng-navigation-active: no url",b,n.ngNavigationActive,n.ngHref),f.removeClass("current"))};if(n.ngNavigationActive)m=c.watcher(h,n.ngNavigationActive,"",g,!0);else if(n.ngHref)m=c.observer(n,"ngHref","",g);else{console.warn("invalid use of ng-navigation-active");return}d.watch(h,g);g()}}}]);var c=function(c,d){m.directive(c,["$injector","$parse","navigation",function(h,f,n){var a=h.invoke(d);
return{transclude:"element",priority:1E3,terminal:!0,restrict:"A",compile:function(d,g,b){d=c+"When";var e=g[d]?f(g[d]):null;return function(c,d,f){var g=a(c,d,f),k,h,l=function(a){h&&h.$destroy();h=c.$new();h.route={bindings:a};b(h,function(a){k&&k.remove();d.after(a);k=a})};c.$watch(function(){return e&&!e(c)?!1:g()||!1},function(a,b){f.ngThen&&(c[f.ngThen]=!!a);a&&b?l(a):a?l(a):b&&(h&&h.$destroy(),k&&(k.remove(),k=null))},!0)}}}}])};c("ngNavigationSpec",["$parse","navigation",function(c,d){var h=
{prefix:"pathStartsWith",path:"pathEquals"};return function(f,n,a){var m=_.bind(c(a.ngNavigationSpec),null,f),g=function(a){return d[h[a[0]]](a[1])};return function(){var a=m();return _.chooseFirst(a,g)}}}]);c("ngNavigationPrefix",["$parse","navigation",function(c,d){return function(h,f,n){var a=_.bind(c(n.ngNavigationPrefix),null,h),m=function(a){if(!a)throw Error("ng-navigation-prefix: invalid paths: "+n.ngNavigationPrefix);return d.pathStartsWith(a)};return function(){var c=a();if(_.isUndefined(c))throw Error("ng-navigation-prefix: undefined paths: "+
n.ngNavigationPrefix);_.isArray(c)||(c=[c]);if(!c.length)throw Error("ng-navigation-prefix: empty paths: "+n.ngNavigationPrefix);return _.chooseFirst(c,m)}}}]);c("ngNavigationPath",["$parse","navigation",function(c,d){return function(h,f,n){var a=_.bind(c(n.ngNavigationPath),null,h),m=function(a){if(!a)throw Error("ng-navigation-path: invalid paths: "+n.ngNavigationPath);return d.pathEquals(a)};return function(){var c=a();if(_.isUndefined(c))throw Error("ng-navigation-path: undefined paths: "+n.ngNavigationPath);
_.isArray(c)||(c=[c]);if(!c.length)throw Error("ng-navigation-path: empty paths: "+n.ngNavigationPath);return _.chooseFirst(c,m)}}}]);c("ngNavigationSection",["navigation",function(c){var d={root:"inRootSection",company:"inCompanySection",manifest:"inManifestSection",dashboard:"inDashboardSection"};return function(h,f,n){return function(){return c[d[n.ngNavigationSection]]()}}}]);c("ngNavigationInvoiceLogin",["navigation","urls",function(c,d){var h=d.dashboard.reports.invoices.partnerInvoice.index,
f=function(d){var a=c.get("next");return!a?!1:c.parseQuery(a).source===d};return function(d,a,m){return function(){return c.nextPathEquals(h)&&(f("uuid-invoice")||f("email"))}}}]);m.directive("ngConfirmNavigateAway",["$parse","$rootScope","$window","navigation",function(c,d,h,f){return{restrict:"A",require:"?form",compile:function(d,a){var m=a.ngConfirmNavigateAwayWhen?c(a.ngConfirmNavigateAwayWhen):null,g=a.ngConfirmNavigateAwayComplete?c(a.ngConfirmNavigateAwayComplete):null;return function(a,c,
d,k){c=f.url;var n=f.stripQuery(c),C=f.parseQuery(c);if(!h.slipstream.isEmbedded||h.slipstream.isBookEmbed){var s=function(){return d.ngConfirmNavigateAway?d.ngConfirmNavigateAway:T("Your changes will be lost.")},D=function(c){if(m)return m(a,{$url:c});c=!_.isUndefined(c)?f.stripPrefix(c):"";var d=f.stripQuery(c);n!==d?c=!0:(c=f.parseQuery(c),c=!_.isEmpty(C)&&!_.isEqual(C,c)?!0:!1);return c&&k.$dirty},l=function(){if(D())return s()};a.$on("$locationChangeStart",function(c,d){if(D(d)){var e=h.confirm(T("Are you sure you want to leave this page?")+
" "+s());e||c.preventDefault();g&&g(a,{$complete:e})}});var p=angular.element(h);p.on("beforeunload",l);a.$on("$destroy",function(){p.off("beforeunload",l)})}}}}}]);m.config(["$provide",function(c){c.decorator("ngHrefDirective",["$delegate",function(c){c.shift();return c}])}]);m.directive("ngHref",["$browser","$location","$parse","clientOptions","d","navigation",function(c,d,h,f,n,a){return{restrict:"A",link:function(c,d,b){var e=!1,k=function(){var c=h();e&&(c=a.multiUrl(c));c=f.reflectUrl(c);b.$set("href",
c)},h=n.observer(b,"ngHref","",function(b){!e&&a.parseMultiUrl(b)?(e=!0,a.watch(c,k)):k()})}}}]);c=function(c,d){return m.directive(c,["d","navigation",function(h,f){return{restrict:"A",link:function(n,a,m){var g=n.isSet(m[c+"Strict"]),b=h.observer(m,c);a.on("click",function(c){var k=$(c.target),h=b();if(h&&d.test(c)&&!c.defaultPrevented&&(!g||a.is(k)))if(!k.is("a")||a.is(k))n.$apply(function(){f.navigate(h)}),d.preventDefault&&c.preventDefault()})}}}])};c("ngNavigate",{test:function(c){return!c.shiftKey&&
!c.controlKey&&!c.metaKey&&!c.altKey}});c("ngShiftNavigate",{test:function(c){return c.shiftKey&&!c.controlKey&&!c.metaKey&&!c.altKey}});c("ngControlNavigate",{test:function(c){return!c.shiftKey&&c.ctrlKey&&!c.metaKey&&!c.altKey}});c("ngMetaNavigate",{test:function(c){return!c.shiftKey&&!c.controlKey&&c.metaKey&&!c.altKey}});c("ngAltNavigate",{test:function(c){return!c.shiftKey&&!c.controlKey&&!c.metaKey&&c.altKey},preventDefault:!0});c("ngShiftOrAltNavigate",{test:function(c){return(c.shiftKey||
c.altKey)&&!c.controlKey&&!c.metaKey}});m.directive("ngRedirect",["navigation",function(c){return{restrict:"A",link:function(d,h,f){h=d.$eval(f.ngRedirect);d=d.$eval(f.ngRedirectMode)||"";if(!h)throw Error("ng-redirect: no url: "+f.ngRedirect);c.redirect(h,d)}}}]);m.directive("ngReload",["navigation",function(c){return{restrict:"A",link:function(d,h,f){c.reload()}}}]);m.directive("ngReloadRoot",["$location","$window","navigation","urls",function(c,d,h,f){return{restrict:"A",link:function(){var m=
h.compose(f.root.index,c.search());d.location.replace(m)}}}])})();
(function(){var m=angular.module("navigation.services",["auth.services","db.services","lib.services","urls.services"]);m.factory("navigation",["$rootScope","$browser","$injector","$location","$timeout","$window","auth","db","events","models","urls",function(c,k,d,h,f,m,a,q,g,b,e){q.slipstream("isDebug");var z=q.slipstream("protocol"),v=q.slipstream("domain"),r=k.baseHref();"/"===r[r.length-1]&&(r=r.slice(0,r.length-1));var C=function(a){return!r&&"/embeds/"===a.slice(0,8)||!r&&"/"!==a.slice(0,1)?
!1:a.slice(0,r.length)===r},s=function(a){return!C(a)?r+a:a},D="_top"===$("base").attr("target"),l=function(a,b){var c=m;D&&(c=m.top);b?c.location.replace(a):c.location.assign(a)},p={admin:"admin-section",company:"company-section",dashboard:"dashboard-section",root:"root-section"};p.all=_.values(p).join(" ");var N=function(a,b){b?($("body").removeClass(p.all),$("body").addClass(p[a])):$("body").removeClass(p[a])},w={glob:"([a-zA-Z0-9-_.]+)",slug:"([a-z0-9-_.]+)",path:"([a-z-/]+)",pk:"([0-9]+)",pks:"(([0-9]+)(,[0-9]+)*)"},
u=function(a,b,c){a=a.replace(/\//g,"\\/");a=a.replace(/:(\w+)(\((\w+)\))?/g,function(a,b,d,e){c.push(b);return d?w[e]:w.glob});return RegExp("^"+a+(b?"$":""))},J={},x=function(a,b){if(!a)throw Error("navigation: matcher not given path");if(!_.isString(a))throw console.error("navigation: matcher not given a string path",a,b),Error("navigation: matcher not given string path");var c=a+(b?"$":""),d=J[c];if(d)return d;var e=[],f,g=E.parseMultiUrl(a);if(g&&g.multiPath){f=u(g.path,!1,e);var k=[],l=u(g.multiPath,
b,k),d=function(){var a=h.search()[g.key];if(_.isUndefined(a))return!1;a=a||"/";"/"!==a[a.length-1]&&(a+="/");var b=E.path;"/"!==b[b.length-1]&&(b+="/");b=_.toArray(f.exec(b));if(!b.length)return!1;a=_.toArray(l.exec(a));if(!a.length)return!1;var c={};_.forEach(_.rest(b),function(a,b){c[e[b]]=a});_.forEach(_.rest(a),function(a,b){c[k[b]]=a});return c}}else f=u(a,b,e),d=function(){var a=E.path;"/"!==a[a.length-1]&&(a+="/");a=_.toArray(f.exec(a));if(!a.length)return!1;var b={};_.forEach(_.rest(a),function(a,
c){b[e[c]]=a});return b};return J[c]=d},t={};b=function(a,b){return function(c,d){var e=a+c;if(!d&&!_.isUndefined(t[e]))return t[e];var f=b(c);return t[e]=f}};var B=function(a,b){return function(){if(!_.isUndefined(t[a]))return t[a];var c=b();return t[a]=c}},M=function(a){try{return decodeURIComponent(a)}catch(b){}},Q=function(a){var b={},c,d;_.forEach((a||"").split("&"),function(a){a&&(c=a.replace(/\+/g,"%20").split("="),d=M(c[0]),_.isUndefined(d)||(a=!_.isUndefined(c[1])?M(c[1]):!0,Object.hasOwnProperty.call(b,
d)?_.isArray(b[d])?b[d].push(a):b[d]=[b[d],a]:b[d]=a))});return b},H=function(a){var b=a.replace("%3F","?");return _.contains(b,"?")?b.split("?")[0]:a},y=function(a){return a&&(a=a.replace("%3F","?"),_.contains(a,"?"))?(a=a.split("?")[1],Q(a)):{}},E={base:r,url:s(h.url()||"/"),path:s(h.path()||"/"),compose:function(a,b,c){b=_.pick(b,function(b,d){try{return!RegExp("[&\\?]"+d+"="+(c?"":b)).test(a)}catch(e){return!0}});if(b=q.toKeyValue(b)){var d="",e=a.indexOf("#");-1!==e&&(d=a.slice(e),a=a.slice(0,
e));return _.contains(a,"?")?a+"&"+b+d:a+"?"+b+d}return a},parseQuery:y,stripQuery:H,stripPrefix:function(a){return a.replace(/^https?:\/\/[^\/]+/,"")},extendQuery:function(a,b){var c=E.parseQuery(a);_.extend(c,b);a=H(a);return E.compose(a,c)},pathStartsWith:b("pathStartsWith",function(a){return x(a)()}),pathEquals:b("pathEquals",function(a){return x(a,!0)()}),nextPathEquals:b("nextPathEquals",function(a){a=u(a,!0,[]);var b=h.search().next;if(_.isUndefined(b))return!1;b=H(b);return(a=a.exec(b))&&
a.length}),inCompanySection:B("inCompanySection",function(){var a,b=!E.inRootSection()&&!E.inDashboardSection()&&!E.inLegacyManifestSection()&&!!(a=E.pathStartsWith(e.company.index));N("company",b);return a}),inDashboardSection:B("inDashboardSection",function(){var a,b=!E.inRootSection()&&!!(a=E.pathStartsWith(e.dashboard.index));N("dashboard",b);return a}),inLegacyManifestSection:B("inLegacyManifestSection",function(){var a,b=!E.inRootSection()&&!!(a=E.pathStartsWith(e.legacyManifest));N("dashboard",
b);return a}),inRootSection:B("inRootSection",function(){var a=!1;_.forEach(e.root,function(b){a=b===e.root.index?a||E.pathEquals(b):_.isObject(b)?a||E.pathStartsWith(b.index):a||E.pathStartsWith(b)});N("root",a);return a}),reload:function(){c.$evalAsync(function(){location.reload(!0)})},redirect:function(a,b,c){if(h.$$replace)f(_.bind(E.redirect,E,a,b,c));else if(a=E.multiUrl(a||"/",b||"extend"),!C(a)||c)l(a,!0);else return a=C(a)?a.slice(r.length):a,h.replace(),h.url(a),a},navigate:function(a,b,
c){a=E.multiUrl(a||"/",b||"replace");if(!C(a)||c)l(a);else return a=C(a)?a.slice(r.length):a,h.url(a),a},forceNavigate:function(a){return c.$apply(function(){return E.navigate(a)})},open:function(a,b,c){c&&(c.stopPropagation(),c.preventDefault());b=_.extend({},{status:1,scrollbars:1,resizable:1},b);b=_.map(b,function(a,b){return b+"="+a}).join(",");m.open(a,"$$window",b)},get:function(a){return h.search()[a]},set:function(a,b,c){c&&h.replace();return h.search(a,b)},clear:function(a,b){b&&h.replace();
return h.search(a,null)},getInt:function(a){a=_.int(this.get(a));if(!isNaN(a))return a},getPk:function(a){a=E.getInt(a);if(!_.isUndefined(a)&&!(0>=a))return a},getPks:function(a){return _.splitPks(this.get(a))},parseMultiUrl:function(a){if(_.isUndefined(a))console.warn("navigation: invalid multi-url",a);else if(!/^(https?|ftp|mailto|tel)/.test(a)){var b=_.split(a,"@",2);if(2===b.length&&(a=b[0],b=b[1])){var b=_.split(b,"=",2),c=b[0],d=b[1]||"",e={},b=_.split(d,"?",2);2===b.length&&(d=b[0],e=Q(b[1]));
return{path:a,key:c,multiPath:d,search:e}}}},multiUrl:function(a,b,c){if(!a)throw Error("navigation: bad url to multi");b=b||"replace";var d=E.parseMultiUrl(a),e={};d&&(b="extend",d.multiPath&&(e[d.key]=d.multiPath),_.extend(e,d.search));"extend"===b&&(e=_.extend({},h.search(),e),d&&!d.multiPath&&delete e[d.key]);d&&(a=d.path,c?a=c:E.pathStartsWith(d.path)&&(a=E.path));return E.compose(a,e)},watch:function(a,b,c){var d=function(){a.$safeApply(function(){b(E.path,E.url)})},e=function(a,b){if(_.isObject(c)&&
c.search)if(a===b)d();else{var e=c.search,f=y(a),g=y(b);e&&(f=_.pick(f,e),g=_.pick(g,e));_.isEqual(f,g)||d()}else d()};return"path"===c?a.$watch(function(){var a=E.parseMultiUrl(E.url);return a?a.path:E.path},d):"multiPath"===c?a.$watch(function(){var a=E.parseMultiUrl(E.url);return a?a.key+"="+a.multiPath:""},d):a.$watch(function(){return E.url},e)},currentCompany:null,updateCurrentCompany:function(a,b){var c=d.get("analytics");E.currentCompany=b;c.trackCompany(E.currentCompany);g.broadcast("navigation.company.updated",
{company:E.currentCompany});a.$on("$destroy",function(){E.currentCompany=null;c.trackCompany(null);g.broadcast("navigation.company.updated",{company:E.currentCompany})})},isCurrentCompany:function(a){return E.currentCompany&&_.isUriEqual(E.currentCompany,a)},absoluteUrl:function(a){a=_.isUndefined(a)?E.url:s(a);return z+"://"+v+a},loginRedirectUrl:function(a){var b;b=E.currentCompany?E.currentCompany.$url(e.company.login):e.root.login;var c=E.path,d=_.extend({},h.search());delete d.next;var d=E.compose(c,
d),f={};/\/login\//g.test(c)||(f.next=d,a&&(f.require="yes"));return E.compose(b,f)},startBookingUrl:function(b,c){if(!b)return c.company.$url(e.dashboard.bookings.index);var d=b.availability.startAt,f=b.company,g=moment().startOf("day");0>d.diff(g)&&(d=g);b.affiliation&&b.affiliation.affiliateCompany===a.currentUser.company&&(a.storage.set("currentPartnerSelection",b.company.uri),f=b.affiliation.affiliateCompany);if(E.pathStartsWith(e.dashboard.bookings.day.index))g=e.dashboard.bookings.day.date;
else if(E.pathStartsWith(e.dashboard.bookings.agenda.index))g=e.dashboard.bookings.agenda.date;else if(E.pathStartsWith(e.dashboard.bookings.calendar))g=e.calendarUrls(e.dashboard.bookings.calendar).month;else if(E.pathStartsWith(e.dashboard.bookings.grid.index))g=e.dashboard.bookings.grid.date;else if(E.pathStartsWith(e.dashboard.bookings.timeline.index))g=e.dashboard.bookings.timeline.date;else return E.compose(e.populate(e.dashboard.bookings.index,{shortname:f.shortname}),{date:d.format("YYYY-MM-DD")});
return e.populate(g,{shortname:f.shortname,year:d.format("YYYY"),month:d.format("MM"),date:d.format("YYYY-MM-DD")})}},R=!0;c.$on("$locationChangeStart",function(a){c.$evalAsync(function(){c.$broadcast("$locationChangeComplete",!a.defaultPrevented);a.defaultPrevented&&c.$broadcast("$locationChangeCancelled")})});c.$on("$locationChangeSuccess",function(a,b,c){b=b?E.stripPrefix(b):"/";b=s(b);c=c?E.stripPrefix(c):"/";c=s(c);a=h.path();a=s(a||"/");"/"!==a[a.length-1]?E.redirect(E.compose(a+"/",h.search())):
(t={},E.url=b,E.path=a,(b!==c||R)&&f(function(){console.info("navigation: navigation complete",E.url,b);k.notifyWhenNoOutstandingRequests(function(){E.url===b&&d.get("analytics").trackView(b)})}),R=!1)});m.$$navigation=E;m.$$location=h;return E}]);m.run(["$rootScope","navigation",function(c,k){c.navigation=k}])})();
(function(){var m=angular.module("embeds.cart","lib auth cache cart clientOptions db flash lightframe native navigation tracking urls".split(" "));configure(m);m.controller("embeds.cart.IndexCtrl",["$scope","cart","events","lightframe","navigation","xmessage",function(c,k,d,h,f,m){c.indexCtrl={carts:[],cartEntriesTotal:0};var a,q=function(){c.indexCtrl.cartEntriesTotal=0;c.indexCtrl.carts=_.filter(k.allCompanies.carts,function(a){c.indexCtrl.cartEntriesTotal+=a.entries.length;return!!a.entries.length});
m.broadcast(c.indexCtrl.carts.length?"fareharbor.cart.show":"fareharbor.cart.hide");a=moment()},g=function(){k.allCompanies.load().then(q)};g();m.on(c,"fareharbor.cart.changed",g);m.on(c,"fareharbor.window.focused",_.debounce(g,1E4,{leading:!0,trailing:!1}));setInterval(function(){(!a||12E4<=moment().diff(a))&&g()},12E4);c.indexCtrl.selectedCart=null;c.viewCart=function(a){if(a=a||c.indexCtrl.selectedCart)a=k.permalinkUrl(a.company),a=f.compose(a,{"from-embed":"cart"}),h.open(a),c.indexCtrl.selectedCart=
null};c.hide=function(){m.broadcast("fareharbor.cart.hide")}}])})();
